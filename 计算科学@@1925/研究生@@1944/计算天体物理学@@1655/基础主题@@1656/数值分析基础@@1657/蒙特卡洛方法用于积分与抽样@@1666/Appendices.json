{"hands_on_practices": [{"introduction": "在计算天体物理学中，多维积分是计算可观测量的基本操作。虽然标准的蒙特卡洛方法提供了一种强大的工具，但其收敛速度可能较慢。本练习将引导您探索一种更高效的替代方案——拟蒙特卡洛（QMC）方法，它使用低差异序列来更均匀地填充采样空间，从而对光滑函数展现出更快的收敛速度。通过亲手实现并比较这两种方法，您将深刻理解采样策略对积分精度的影响。[@problem_id:3522913]", "problem": "您的任务是设计并实现一个程序，在计算天体物理学的背景下，比较标准蒙特卡洛积分与准蒙特卡洛积分对单位立方体上的一个光滑、可分离被积函数的计算效果。考虑函数 $f(\\mathbf{x}) = \\cos(x)\\cos(y)\\cos(z)$ 在立方体 $[0,1]^3$ 上的积分，其中 $(x,y,z)$ 是无量纲的，余弦函数的参数以弧度为单位。本问题要求您从蒙特卡洛采样和数值积分的基本原理出发，确保所有推导、算法选择和比较都基于第一性原理和经过充分检验的结果。\n\n您必须完成以下任务：\n\n1. 使用微积分的基本定义和法则，推导积分\n$$\nI = \\int_{[0,1]^3} \\cos(x)\\cos(y)\\cos(z)\\,dx\\,dy\\,dz,\n$$\n的精确值，不使用数值求积。在您的程序中使用此精确值来计算两种方法的绝对误差。\n\n2. 构造 $I$ 的两个估计量：\n   - 一个标准蒙特卡洛估计量 $\\hat{I}_{\\mathrm{MC}}(N)$，基于从 $[0,1]^3$ 中均匀抽取的 $N$ 个独立同分布样本。\n   - 一个准蒙特卡洛估计量 $\\hat{I}_{\\mathrm{QMC}}(N)$，基于 $[0,1]^3$ 上的一个低差异序列中的 $N$ 个点。\n\n3. 对于标准蒙特卡洛估计量，证明该估计量是无偏的，并根据独立同分布样本的基本概率论结果，解释其方差如何随 $N$ 变化。\n\n4. 对于准蒙特卡洛估计量，解释为什么低差异序列能够为光滑被积函数带来改进的收敛性，并阐述光滑性（例如，有界混合偏导数）和 Hardy–Krause 意义下的变差性质所起的作用，以及这些性质如何与星差异度结合以界定积分误差。\n\n5. 在一个程序中实现这两种估计量。对于标准蒙特卡洛采样，使用具有指定种子的可复现伪随机数生成器。对于准蒙特卡洛，使用具有指定种子的可复现加扰低差异序列。不执行数值求积或外部积分；所有采样必须是显式的。\n\n6. 对每个测试用例，计算并报告每个估计量的绝对误差 $|\\hat{I} - I|$。\n\n7. 使用以下样本大小和种子的测试套件来评估估计量。每个测试用例是一个三元组 $(N, s_{\\mathrm{MC}}, s_{\\mathrm{QMC}})$，其中 $N$ 是样本数，$s_{\\mathrm{MC}}$ 是标准蒙特卡洛伪随机数生成器的种子，$s_{\\mathrm{QMC}}$ 是低差异序列加扰的种子：\n   - $(N,s_{\\mathrm{MC}},s_{\\mathrm{QMC}}) = (1, 7, 101)$\n   - $(N,s_{\\mathrm{MC}},s_{\\mathrm{QMC}}) = (32, 11, 103)$\n   - $(N,s_{\\mathrm{MC}},s_{\\mathrm{QMC}}) = (64, 13, 107)$\n   - $(N,s_{\\mathrm{MC}},s_{\\mathrm{QMC}}) = (1000, 17, 109)$\n   - $(N,s_{\\mathrm{MC}},s_{\\mathrm{QMC}}) = (4096, 19, 113)$\n\n8. 所有角度必须以弧度为单位进行解释。本问题中没有物理单位。\n\n9. 最终输出格式必须是单行，包含一个列表，其第 $k$ 个元素对应于上述第 $k$ 个测试用例，每个元素是列表 $[N, e_{\\mathrm{MC}}, e_{\\mathrm{QMC}}]$，其中 $e_{\\mathrm{MC}} = |\\hat{I}_{\\mathrm{MC}}(N) - I|$ 且 $e_{\\mathrm{QMC}} = |\\hat{I}_{\\mathrm{QMC}}(N) - I|$。每个误差必须是浮点数。您的程序应生成单行输出，包含以逗号分隔并用方括号括起来的结果列表（例如：\"[[N1,eMC1,eQMC1],[N2,eMC2,eQMC2],...]\"）。为保证可复现性和可读性，打印前请将每个误差四舍五入到12位小数。\n\n您的实现必须是一个完整、可运行的程序，仅使用明确说明的库，不接受任何用户输入或外部文件。预期的答案类型是按指定格式化的浮点数和整数列表。目标是结合被积函数的光滑性和变差性质，从数值上和概念上评估在相同 $N$ 值下，标准蒙特卡洛与准蒙特卡洛的相对误差行为。", "solution": "所述问题具有科学依据、适定、客观，并包含足够信息以推导出唯一、可验证的解。它提出了计算科学中一个标准而又基本的任务：比较蒙特卡洛和准蒙特卡洛积分方法对光滑、可分离函数的计算效果。所有参数、常数和过程性要求都已明确定义。因此，该问题是有效的，并且可以构建解决方案。\n\n问题的核心是评估积分 $I = \\int_{[0,1]^3} f(\\mathbf{x})\\,d\\mathbf{x}$，其中被积函数为 $f(\\mathbf{x}) = \\cos(x)\\cos(y)\\cos(z)$，积分域为 $\\mathbb{R}^3$ 中的单位立方体，记作 $[0,1]^3$。\n\n**1. 积分的精确值**\n\n积分为：\n$$\nI = \\int_0^1 \\int_0^1 \\int_0^1 \\cos(x)\\cos(y)\\cos(z)\\,dx\\,dy\\,dz\n$$\n由于被积函数 $f(x,y,z) = \\cos(x)\\cos(y)\\cos(z)$ 是其变量的可分离函数，且积分域是区间的笛卡尔积（一个立方体），因此该多维积分可以表示为一维积分的乘积：\n$$\nI = \\left( \\int_0^1 \\cos(u)\\,du \\right) \\left( \\int_0^1 \\cos(v)\\,dv \\right) \\left( \\int_0^1 \\cos(w)\\,dw \\right)\n$$\n这三个积分是相同的。我们使用微积分基本定理计算这个一维积分，并回顾余弦函数的参数是以弧度为单位的：\n$$\n\\int_0^1 \\cos(u)\\,du = [\\sin(u)]_0^1 = \\sin(1) - \\sin(0) = \\sin(1)\n$$\n因此，积分 $I$ 的精确值为：\n$$\nI = (\\sin(1))^3\n$$\n这个精确值将作为我们衡量数值估计量准确性的基准。\n\n**2. 估计量的构造**\n\n对于积分 $I = \\int_{\\Omega} f(\\mathbf{x})\\,d\\mathbf{x}$，其积分域 $\\Omega$ 的体积为 $V = \\int_{\\Omega} d\\mathbf{x}$，蒙特卡洛积分的一般原理是通过在 $N$ 个采样点上求函数值的平均值，并按体积进行缩放，来估计 $I$。估计量为 $\\hat{I}_N = V \\cdot \\frac{1}{N} \\sum_{i=1}^N f(\\mathbf{x}_i)$。对于本问题，积分域是单位立方体 $[0,1]^3$，所以其体积 $V$ 为 $1^3 = 1$。因此，估计量简化为函数值的样本均值。\n\n- **标准蒙特卡洛（MC）估计量：**\n标准 MC 估计量 $\\hat{I}_{\\mathrm{MC}}(N)$ 使用一组 $N$ 个点 $\\{\\mathbf{x}_1, \\mathbf{x}_2, \\dots, \\mathbf{x}_N\\}$，这些点是从 $[0,1]^3$ 上的均匀分布中抽取的独立同分布（i.i.d.）样本。估计量为：\n$$\n\\hat{I}_{\\mathrm{MC}}(N) = \\frac{1}{N} \\sum_{i=1}^N f(\\mathbf{x}_i) = \\frac{1}{N} \\sum_{i=1}^N \\cos(x_i)\\cos(y_i)\\cos(z_i)\n$$\n\n- **准蒙特卡洛（QMC）估计量：**\nQMC 估计量 $\\hat{I}_{\\mathrm{QMC}}(N)$ 的函数形式与 MC 估计量相同。然而，采样点 $\\{\\mathbf{x}_1, \\mathbf{x}_2, \\dots, \\mathbf{x}_N\\}$ 不是随机的，而是确定性的低差异序列的前 $N$ 个点。这些序列被设计用来比伪随机点更均匀地填充空间。\n$$\n\\hat{I}_{\\mathrm{QMC}}(N) = \\frac{1}{N} \\sum_{i=1}^N f(\\mathbf{x}_i) = \\frac{1}{N} \\sum_{i=1}^N \\cos(x_i)\\cos(y_i)\\cos(z_i)\n$$\n在实现中，将使用一种常见且有效的低差异序列——Sobol' 序列。\n\n**3. 标准蒙特卡洛估计量分析**\n\n- **无偏性：**\n对于参数 $\\theta$ 的一个估计量 $\\hat{\\theta}$，如果其期望值等于参数的真值，即 $E[\\hat{\\theta}] = \\theta$，则该估计量是无偏的。对于 MC 估计量，采样点 $\\mathbf{X}_i$ 是随机变量。根据期望的线性性：\n$$\nE[\\hat{I}_{\\mathrm{MC}}(N)] = E\\left[\\frac{1}{N} \\sum_{i=1}^N f(\\mathbf{X}_i)\\right] = \\frac{1}{N} \\sum_{i=1}^N E[f(\\mathbf{X}_i)]\n$$\n由于每个 $\\mathbf{X}_i$ 都是从均匀分布 $U([0,1]^3)$ 中抽取的，其概率密度函数为 $p(\\mathbf{x}) = 1$（当 $\\mathbf{x} \\in [0,1]^3$ 时）否则为 $0$。$f(\\mathbf{X}_i)$ 的期望值为：\n$$\nE[f(\\mathbf{X}_i)] = \\int_{[0,1]^3} f(\\mathbf{x}) p(\\mathbf{x}) \\,d\\mathbf{x} = \\int_{[0,1]^3} f(\\mathbf{x}) \\cdot 1 \\,d\\mathbf{x} = I\n$$\n将此代回，我们得到：\n$$\nE[\\hat{I}_{\\mathrm{MC}}(N)] = \\frac{1}{N} \\sum_{i=1}^N I = \\frac{1}{N} (N \\cdot I) = I\n$$\n因此，标准 MC 估计量是积分 $I$ 的一个无偏估计量。\n\n- **方差与收敛性：**\n估计量的方差决定了其收敛速率。由于样本 $\\mathbf{X}_i$ 是独立同分布的，它们的和的方差等于方差的和：\n$$\n\\mathrm{Var}(\\hat{I}_{\\mathrm{MC}}(N)) = \\mathrm{Var}\\left(\\frac{1}{N} \\sum_{i=1}^N f(\\mathbf{X}_i)\\right) = \\frac{1}{N^2} \\sum_{i=1}^N \\mathrm{Var}(f(\\mathbf{X}_i))\n$$\n单个样本函数值的方差 $\\sigma^2 = \\mathrm{Var}(f(\\mathbf{X}_i))$，对于所有 $i$ 都是有限且恒定的：\n$$\n\\sigma^2 = E[(f(\\mathbf{X}) - E[f(\\mathbf{X})])^2] = \\int_{[0,1]^3} (f(\\mathbf{x}) - I)^2 \\,d\\mathbf{x}\n$$\n因此，MC 估计量的方差为：\n$$\n\\mathrm{Var}(\\hat{I}_{\\mathrm{MC}}(N)) = \\frac{1}{N^2} (N \\sigma^2) = \\frac{\\sigma^2}{N}\n$$\n估计量的标准误差是方差的平方根，即 $\\sigma/\\sqrt{N}$。这表明，标准蒙特卡洛方法的误差以 $O(N^{-1/2})$ 的速率收敛到零，这是中心极限定理的一个结果。这个收敛速率与积分的维度无关，这是 MC 方法的一个关键优势。\n\n**4. 准蒙特卡洛估计量分析**\n\nQMC 方法用确定性的低差异点替代伪随机点。QMC 中的误差不是一个概率量，而是一个确定性的、有界的误差。支配 QMC 误差的主要理论结果是 Koksma-Hlawka 不等式：\n$$\n|\\hat{I}_{\\mathrm{QMC}}(N) - I| = \\left| \\frac{1}{N} \\sum_{i=1}^{N} f(\\mathbf{x}_i) - \\int_{[0,1]^d} f(\\mathbf{x}) \\, d\\mathbf{x} \\right| \\le V_{HK}(f) \\cdot D_N^*(\\mathcal{P}_N)\n$$\n该不等式将积分误差与两个关键量联系起来：\n- **$D_N^*(\\mathcal{P}_N)$**：点集 $\\mathcal{P}_N = \\{\\mathbf{x}_1, \\dots, \\mathbf{x}_N\\}$ 的星差异度。差异度是衡量点集在单位立方体中分布均匀程度的定量指标。对于低差异序列（如 Sobol'、Halton 或 Faure 序列），已知 $d$ 维空间中的星差异度有界，为 $D_N^* = O\\left(\\frac{(\\log N)^d}{N}\\right)$。\n- **$V_{HK}(f)$**：函数 $f$ 在 Hardy 和 Krause 意义下的变差。要使一个被积函数具有有限的 Hardy-Krause 变差，它必须具备一定程度的光滑性。具体来说，如果 $f$ 的所有混合偏导数，直到 $\\frac{\\partial^d f}{\\partial x_1 \\dots \\partial x_d}$，在 $[0,1]^d$ 上存在且连续，则其变差是有限的。\n\n本问题中的函数 $f(x,y,z) = \\cos(x)\\cos(y)\\cos(z)$ 在 $\\mathbb{R}^3$ 上是无限可微的（$C^\\infty$），因此其所有混合偏导数在紧致域 $[0,1]^3$ 上都是连续且有界的。这保证了其 Hardy-Krause 变差 $V_{HK}(f)$ 是有限的。\n\n综合这些事实，本问题中 QMC 误差的界为：\n$$\n|\\hat{I}_{\\mathrm{QMC}}(N) - I| = O\\left(\\frac{(\\log N)^d}{N}\\right)\n$$\n对于我们固定的维度 $d=3$，这个理论收敛速率约为 $O(N^{-1})$，在渐近意义上优于标准 MC 的概率性 $O(N^{-1/2})$ 收敛。这种对光滑函数的改进收敛性是使用 QMC 方法的主要动机。对于有限的 $N$，使用加扰序列通常可以通过打破确定性结构并提供一种误差估计机制来提高实际性能，尽管其渐近速率保持不变。\n\n**5-9. 实现与执行**\n\n以下程序实现了两种估计量，为指定的测试用例计算绝对误差，并按要求格式化输出。它使用 `numpy` 进行数值运算，使用 `numpy.random.default_rng` 生成 MC 中的伪随机数，使用 `scipy.stats.qmc.Sobol` 生成 QMC 中的加扰 Sobol' 序列。精确值 $I = (\\sin(1))^3$ 被预先计算并用于计算误差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import qmc\n\ndef solve():\n    \"\"\"\n    Compares Standard Monte Carlo and Quasi-Monte Carlo integration\n    for a smooth, separable integrand over the unit cube.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, s_MC, s_QMC)\n        (1, 7, 101),\n        (32, 11, 103),\n        (64, 13, 107),\n        (1000, 17, 109),\n        (4096, 19, 113),\n    ]\n\n    # 1. Derive the exact value of the integral.\n    # I = integral_0^1 cos(x)dx * integral_0^1 cos(y)dy * integral_0^1 cos(z)dz\n    # integral_0^1 cos(u)du = [sin(u)]_0^1 = sin(1) - sin(0) = sin(1)\n    # So, I = (sin(1))^3\n    exact_integral_value = np.sin(1)**3\n    \n    # The integrand function f(x) = cos(x)cos(y)cos(z)\n    def integrand(points):\n        # points is an array of shape (N, 3)\n        return np.cos(points[:, 0]) * np.cos(points[:, 1]) * np.cos(points[:, 2])\n\n    results = []\n    \n    for case in test_cases:\n        N, s_mc, s_qmc = case\n        \n        # 2. Standard Monte Carlo (MC) estimator\n        # Use a reproducible pseudo-random number generator\n        rng_mc = np.random.default_rng(seed=s_mc)\n        # Generate N i.i.d. uniform samples in [0,1]^3\n        mc_points = rng_mc.uniform(0, 1, size=(N, 3))\n        # Evaluate the integrand at these points\n        mc_f_values = integrand(mc_points)\n        # The estimator is the sample mean (Volume of unit cube is 1)\n        i_hat_mc = np.mean(mc_f_values)\n        \n        # 3. Quasi-Monte Carlo (QMC) estimator\n        # Use a reproducibly scrambled low-discrepancy sequence (Sobol')\n        # The problem specifies scipy 1.11.4, where the parameter is 'seed'.\n        sampler_qmc = qmc.Sobol(d=3, scramble=True, seed=s_qmc)\n        # Generate N points from the Sobol' sequence\n        qmc_points = sampler_qmc.random(n=N)\n        # Evaluate the integrand at these points\n        qmc_f_values = integrand(qmc_points)\n        # The estimator is the sample mean\n        i_hat_qmc = np.mean(qmc_f_values)\n\n        # 4. Compute absolute errors\n        error_mc = abs(i_hat_mc - exact_integral_value)\n        error_qmc = abs(i_hat_qmc - exact_integral_value)\n\n        # 5. Round errors to 12 decimal places and store results\n        rounded_error_mc = round(error_mc, 12)\n        rounded_error_qmc = round(error_qmc, 12)\n        \n        results.append([N, rounded_error_mc, rounded_error_qmc])\n\n    # Final print statement in the exact required format.\n    # The format is a list of lists, represented as a string.\n    # e.g., \"[[N1,eMC1,eQMC1],[N2,eMC2,eQMC2],...]\"\n    result_str = \",\".join(map(str, results))\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "3522913"}, {"introduction": "蒙特卡洛积分的效率在很大程度上取决于被积函数的方差。重要性采样是一种强大的方差缩减技术，它通过从一个与被积函数形状相似的提议分布中采样来显著提高效率。本练习要求您不仅应用重要性采样，还要从理论上分析其性能，推导其方差有限的条件。理解这些条件对于在实践中设计稳定且高效的蒙特卡洛估计至关重要。[@problem_id:3522899]", "problem": "考虑在计算天体物理学中为指数抑制分布建模时出现的积分 $I=\\int_{0}^{\\infty} e^{-x}\\,dx$。重要性采样是一种用于蒙特卡洛积分的方差缩减技术，它使用具有已知概率密度函数的提议分布来估计积分。设 $X\\sim \\mathrm{Gamma}(k,\\theta)$ 是一个形状参数 $k0$ 且尺度参数 $\\theta0$ 的提议分布，其在支撑集 $x\\in [0,\\infty)$ 上的已知密度为 $q_{k,\\theta}(x)$。重要性采样估计量使用权重函数 $w(x)$，该函数定义为目标被积函数与提议密度之比。该估计量的方差取决于 $w(x)$ 关于 $q_{k,\\theta}(x)$ 的二阶矩，并且仅在 $(k,\\theta)$ 的特定条件下才可能为有限值。\n\n另一种直接方法是在截断域 $[0,L]$ （其中 $L0$）上进行均匀采样，并结合对尾部积分 $\\int_{L}^{\\infty} e^{-x}\\,dx$ 的确定性修正，该尾部积分是可精确计算的。在这种情况下，通过将已知的尾部贡献加到截断积分的蒙特卡洛估计上，可以构造一个无偏估计量。这种截断并修正的估计量的方差取决于当 $X\\sim \\mathrm{Uniform}(0,L)$ 时 $e^{-X}$ 的方差。\n\n从重要性采样的基本定义以及 Gamma 分布和指数积分的已知公式出发，执行以下操作：\n\n1. 对于提议分布 $X\\sim \\mathrm{Gamma}(k,\\theta)$（密度为 $q_{k,\\theta}(x)$），显式推导重要性采样权重 $w(x)$。\n2. 推导二阶矩 $\\mathbb{E}_{q_{k,\\theta}}[w(X)^{2}]$ 关于 $k$ 和 $\\theta$ 的精确闭式表达式，并由此获得样本大小为 $n$ 时 $I$ 的重要性采样估计量的方差。确定使该方差为有限值的 $(k,\\theta)$ 的精确条件。\n3. 对于在 $[0,L]$ 上的截断均匀方法，其中 $X\\sim \\mathrm{Uniform}(0,L)$ 且确定性地添加尾部修正以确保无偏性，推导样本大小为 $n$ 时 $I$ 的蒙特卡洛估计量关于 $L$ 的精确方差。\n4. 定义理论比率\n$$\nR(k,\\theta,L) \\;=\\; \\frac{\\mathrm{Var}[\\hat{I}_{\\mathrm{IS}}]}{\\mathrm{Var}[\\hat{I}_{\\mathrm{UNI}}]} \\,,\n$$\n其中 $\\mathrm{Var}[\\hat{I}_{\\mathrm{IS}}]$ 是使用 $X\\sim \\mathrm{Gamma}(k,\\theta)$ 的重要性采样估计量的方差，而 $\\mathrm{Var}[\\hat{I}_{\\mathrm{UNI}}]$ 是在 $[0,L]$ 上带精确尾部修正的截断均匀估计量的方差。证明 $R(k,\\theta,L)$ 与样本大小 $n$无关，并给出其精确公式。如果重要性采样方差为无穷大，则定义 $R(k,\\theta,L)=+\\infty$。\n\n您的程序必须为以下参数值测试套件计算并输出 $R(k,\\theta,L)$：\n- 情况 1 (理想路径，最优匹配): $(k,\\theta,L)=(1.0,\\,1.0,\\,5.0)$。\n- 情况 2 (有限方差，非平凡): $(k,\\theta,L)=(1.5,\\,0.8,\\,5.0)$。\n- 情况 3 (近边界有限方差): $(k,\\theta,L)=(1.9,\\,0.55,\\,8.0)$。\n- 情况 4 (形状引起的-发散): $(k,\\theta,L)=(2.5,\\,0.8,\\,5.0)$。\n- 情况 5 (尺度引起的-发散): $(k,\\theta,L)=(1.0,\\,0.4,\\,5.0)$。\n\n所有值都是无量纲的；不涉及物理单位或角度单位。您的输出必须是单行，包含一个用方括号括起来的、由逗号分隔的五个数字列表，顺序与上面列出的情况一致。每个条目必须是 $R(k,\\theta,L)$ 的精确理论值，四舍五入到六位小数。如果值为无穷大，则将 Python 浮点表示 $+\\infty$ 显示为标记 $inf$。例如，输出可能看起来像“[0.000000,0.123456,0.654321,inf,inf]”。\n\n您的程序必须是自包含的，不需要任何输入，并且不得使用任何外部数据。最终输出必须以指定格式打印为一行，并且必须依赖于上面推导出的精确公式，而不是经验模拟。", "solution": "该问题陈述是关于蒙特卡洛积分技术分析的一个适定练习。它在科学上基于既定的统计学和数学原理，是自包含的，并且没有矛盾或含糊之处。因此，该问题被认为是有效的，下面提供了完整的解决方案。\n\n该问题要求推导和计算积分 $I=\\int_{0}^{\\infty} e^{-x}\\,dx = 1$ 的两种不同蒙特卡洛估计量的方差之比。这两种方法分别是使用伽马分布提议的重要性采样，以及在截断域上使用精确尾部修正的均匀采样。\n\n**第1部分：重要性采样权重函数**\n\n设目标被积函数为 $f(x) = e^{-x}$。提议分布为 $X\\sim \\mathrm{Gamma}(k,\\theta)$，适用于 $x \\in [0,\\infty)$，参数为 $k0$ 和 $\\theta0$。该分布的概率密度函数 (PDF) 由下式给出：\n$$\nq_{k,\\theta}(x) = \\frac{x^{k-1} e^{-x/\\theta}}{\\theta^k \\Gamma(k)}\n$$\n其中 $\\Gamma(k)$ 是伽马函数。重要性采样权重函数 $w(x)$ 定义为被积函数与提议密度之比：\n$$\nw(x) = \\frac{f(x)}{q_{k,\\theta}(x)} = \\frac{e^{-x}}{x^{k-1} e^{-x/\\theta} / (\\theta^k \\Gamma(k))}\n$$\n简化此表达式，我们得到：\n$$\nw(x) = \\theta^k \\Gamma(k) \\, x^{-(k-1)} e^{-x + x/\\theta} = \\theta^k \\Gamma(k) \\, x^{1-k} e^{-x(1 - 1/\\theta)}\n$$\n这就是权重函数的显式形式。\n\n**第2部分：重要性采样估计量的方差**\n\n基于从 $q_{k,\\theta}(x)$ 抽取的样本大小为 $n$ 的样本 $\\{X_1, \\dots, X_n\\}$，$I$ 的重要性采样估计量为 $\\hat{I}_{\\mathrm{IS}} = \\frac{1}{n} \\sum_{i=1}^n w(X_i)$。此估计量的方差为：\n$$\n\\mathrm{Var}[\\hat{I}_{\\mathrm{IS}}] = \\frac{1}{n} \\mathrm{Var}_{q_{k,\\theta}}[w(X)] = \\frac{1}{n} \\left( \\mathbb{E}_{q_{k,\\theta}}[w(X)^2] - (\\mathbb{E}_{q_{k,\\theta}}[w(X)])^2 \\right)\n$$\n首先，我们通过计算权重的期望值来验证估计量是无偏的：\n$$\n\\mathbb{E}_{q_{k,\\theta}}[w(X)] = \\int_0^\\infty w(x) q_{k,\\theta}(x) \\,dx = \\int_0^\\infty \\frac{f(x)}{q_{k,\\theta}(x)} q_{k,\\theta}(x) \\,dx = \\int_0^\\infty f(x) \\,dx = I = 1\n$$\n因此，$(\\mathbb{E}_{q_{k,\\theta}}[w(X)])^2 = 1^2 = 1$。方差由二阶矩 $\\mathbb{E}_{q_{k,\\theta}}[w(X)^2]$ 决定。\n$$\n\\mathbb{E}_{q_{k,\\theta}}[w(X)^2] = \\int_0^\\infty w(x)^2 q_{k,\\theta}(x) \\,dx\n$$\n代入 $w(x)$ 和 $q_{k,\\theta}(x)$ 的表达式：\n$$\n\\mathbb{E}_{q_{k,\\theta}}[w(X)^2] = \\int_0^\\infty \\left( \\theta^k \\Gamma(k) \\, x^{1-k} e^{-x(1 - 1/\\theta)} \\right)^2 \\left( \\frac{x^{k-1} e^{-x/\\theta}}{\\theta^k \\Gamma(k)} \\right) \\,dx\n$$\n$$\n= (\\theta^k \\Gamma(k))^2 \\frac{1}{\\theta^k \\Gamma(k)} \\int_0^\\infty x^{2(1-k)} x^{k-1} e^{-2x(1-1/\\theta)} e^{-x/\\theta} \\,dx\n$$\n$$\n= \\theta^k \\Gamma(k) \\int_0^\\infty x^{2-2k+k-1} e^{-2x + 2x/\\theta - x/\\theta} \\,dx\n$$\n$$\n= \\theta^k \\Gamma(k) \\int_0^\\infty x^{1-k} e^{-x(2 - 1/\\theta)} \\,dx\n$$\n为了使该积分收敛，指数项的指数必须为正，即 $2 - 1/\\theta  0$，或 $\\theta  1/2$。该积分是伽马函数积分的一种形式，$\\int_0^\\infty t^{z-1} e^{-at} dt = a^{-z}\\Gamma(z)$，当 $z0$ 时收敛。这里，$z-1 = 1-k$，所以 $z=2-k$，收敛条件是 $2-k0$，即 $k2$。\n在这些条件下，积分的计算结果为：\n$$\n\\int_0^\\infty x^{(2-k)-1} e^{-x(2 - 1/\\theta)} \\,dx = (2-1/\\theta)^{-(2-k)} \\Gamma(2-k)\n$$\n将此结果代回二阶矩的表达式中：\n$$\n\\mathbb{E}_{q_{k,\\theta}}[w(X)^2] = \\theta^k \\Gamma(k) (2-1/\\theta)^{k-2} \\Gamma(2-k) = \\theta^k \\Gamma(k) \\Gamma(2-k) \\left(\\frac{2\\theta-1}{\\theta}\\right)^{k-2}\n$$\n$$\n= \\theta^k \\Gamma(k) \\Gamma(2-k) \\frac{\\theta^{2-k}}{(2\\theta-1)^{2-k}} = \\theta^2 \\Gamma(k) \\Gamma(2-k) (2\\theta-1)^{k-2}\n$$\n当且仅当 $k2$ 且 $\\theta  1/2$ 时，方差为有限值。如果任一条件不满足，方差则为无穷大。\n该估计量的方差为：\n$$\n\\mathrm{Var}[\\hat{I}_{\\mathrm{IS}}] = \\frac{1}{n} \\left( \\theta^2 \\Gamma(k) \\Gamma(2-k) (2\\theta-1)^{k-2} - 1 \\right)\n$$\n\n**第3部分：截断均匀估计量的方差**\n\n第二种方法估计 $I = \\int_0^L e^{-x}\\,dx + \\int_L^\\infty e^{-x}\\,dx$。尾部积分可解析计算：$\\int_L^\\infty e^{-x}\\,dx = e^{-L}$。项 $\\int_0^L e^{-x}\\,dx$ 通过蒙特卡洛方法估计，从 $X_i \\sim \\mathrm{Uniform}(0,L)$ 中采样，其概率密度函数为 $p(x) = 1/L$。\n总估计量为 $\\hat{I}_{\\mathrm{UNI}} = \\frac{1}{n} \\sum_{i=1}^n \\frac{e^{-X_i}}{p(X_i)} + e^{-L} = \\frac{L}{n} \\sum_{i=1}^n e^{-X_i} + e^{-L}$。由于 $e^{-L}$ 项是确定性常数，因此它對方差没有贡献。\n$$\n\\mathrm{Var}[\\hat{I}_{\\mathrm{UNI}}] = \\mathrm{Var}\\left[\\frac{L}{n} \\sum_{i=1}^n e^{-X_i}\\right] = \\frac{L^2}{n^2} \\sum_{i=1}^n \\mathrm{Var}[e^{-X_i}] = \\frac{L^2}{n} \\mathrm{Var}[e^{-X}]\n$$\n其中 $X \\sim \\mathrm{Uniform}(0,L)$。我们计算 $\\mathrm{Var}[e^{-X}] = \\mathbb{E}[(e^{-X})^2] - (\\mathbb{E}[e^{-X}])^2$。\n一阶矩为：\n$$\n\\mathbb{E}[e^{-X}] = \\int_0^L e^{-x} \\frac{1}{L} \\,dx = \\frac{1}{L} [-e^{-x}]_0^L = \\frac{1-e^{-L}}{L}\n$$\n二阶矩为：\n$$\n\\mathbb{E}[e^{-2X}] = \\int_0^L e^{-2x} \\frac{1}{L} \\,dx = \\frac{1}{L} \\left[-\\frac{1}{2}e^{-2x}\\right]_0^L = \\frac{1 - e^{-2L}}{2L}\n$$\n$e^{-X}$ 的方差为：\n$$\n\\mathrm{Var}[e^{-X}] = \\frac{1 - e^{-2L}}{2L} - \\left(\\frac{1-e^{-L}}{L}\\right)^2\n$$\n因此，估计量 $\\hat{I}_{\\mathrm{UNI}}$ 的方差为：\n$$\n\\mathrm{Var}[\\hat{I}_{\\mathrm{UNI}}] = \\frac{L^2}{n} \\left[ \\frac{1 - e^{-2L}}{2L} - \\frac{(1-e^{-L})^2}{L^2} \\right] = \\frac{1}{n} \\left[ \\frac{L(1 - e^{-2L})}{2} - (1-e^{-L})^2 \\right]\n$$\n对于任何 $L0$，该方差都是有限且为正的。\n\n**第4部分：方差之比**\n\n比率 $R(k,\\theta,L)$ 定义为两个方差之比。\n$$\nR(k,\\theta,L) = \\frac{\\mathrm{Var}[\\hat{I}_{\\mathrm{IS}}]}{\\mathrm{Var}[\\hat{I}_{\\mathrm{UNI}}]} = \\frac{\\frac{1}{n} \\left( \\theta^2 \\Gamma(k) \\Gamma(2-k) (2\\theta-1)^{k-2} - 1 \\right)}{\\frac{1}{n} \\left( \\frac{L(1 - e^{-2L})}{2} - (1-e^{-L})^2 \\right)}\n$$\n$1/n$ 因子被消掉，表明该比率与样本大小 $n$ 无关。\n$$\nR(k,\\theta,L) = \\frac{\\theta^2 \\Gamma(k) \\Gamma(2-k) (2\\theta-1)^{k-2} - 1}{\\frac{L(1 - e^{-2L})}{2} - (1-e^{-L})^2}\n$$\n此公式在 $k2$ 和 $\\theta>1/2$ 时有效。如果不满足关于 $k$ 和 $\\theta$ 的这些条件，$\\mathrm{Var}[\\hat{I}_{\\mathrm{IS}}]$ 为无穷大，根据定义，$R(k,\\theta,L) = +\\infty$。\n情况 $(k,\\theta)=(1,1)$ 很特殊，因为提议分布 $q_{1,1}(x)=e^{-x}$ 与被积函数 $f(x)$ 完全匹配。这里，权重的二阶矩为 $\\mathbb{E}[w^2] = 1^2 \\Gamma(1)\\Gamma(1)(2-1)^{-1} = 1$，因此重要性采样估计量的方差为零，对于任何 $L0$ 都有 $R(1,1,L)=0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gamma\n\ndef solve():\n    \"\"\"\n    Computes the theoretical variance ratio R(k, theta, L) for five test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path, optimal match)\n        (1.0, 1.0, 5.0),\n        # Case 2 (finite-variance, nontrivial)\n        (1.5, 0.8, 5.0),\n        # Case 3 (near-boundary finite-variance)\n        (1.9, 0.55, 8.0),\n        # Case 4 (shape-induced divergence)\n        (2.5, 0.8, 5.0),\n        # Case 5 (scale-induced divergence)\n        (1.0, 0.4, 5.0),\n    ]\n\n    results = []\n    for k, theta, L in test_cases:\n        # Step 1: Check for conditions of infinite variance in the importance sampling estimator.\n        # The variance is finite if and only if k  2 and theta > 0.5.\n        if k >= 2.0 or theta = 0.5:\n            results.append(np.inf)\n            continue\n\n        # Step 2: Calculate the numerator of the ratio R.\n        # This is the single-sample variance of the importance sampling estimator.\n        # Var_IS = (E[w^2] - 1)\n        # E[w^2] = theta^2 * Gamma(k) * Gamma(2-k) * (2*theta - 1)^(k-2)\n        \n        # A special case for k=1, theta=1 where the proposal matches the integrand.\n        # The variance is exactly 0. This avoids potential floating point issues.\n        if k == 1.0 and theta == 1.0:\n            var_is_num = 0.0\n        else:\n            term1 = theta**2\n            term2 = gamma(k)\n            term3 = gamma(2.0 - k)\n            term4 = (2.0 * theta - 1.0)**(k - 2.0)\n            E_w_sq = term1 * term2 * term3 * term4\n            var_is_num = E_w_sq - 1.0\n\n        # Step 3: Calculate the denominator of the ratio R.\n        # This is the single-sample variance of the truncated uniform estimator.\n        # Var_UNI = L^2 * Var(e^-X) for X ~ U(0,L)\n        # Var_UNI = L/2 * (1 - e^(-2L)) - (1 - e^(-L))^2\n        exp_L = np.exp(-L)\n        exp_2L = np.exp(-2.0 * L)\n        var_uni_den = (L * (1.0 - exp_2L) / 2.0) - (1.0 - exp_L)**2\n\n        # The denominator is a variance, so it should be non-negative.\n        # It is zero only if L->0, which is not the case here.\n        if var_uni_den = 0:\n            # Handle potential numerical instability, although unlikely for these inputs.\n            ratio = np.inf\n        else:\n            ratio = var_is_num / var_uni_den\n        \n        results.append(ratio)\n    \n    # Format the final output string.\n    # Round finite numbers to 6 decimal places.\n    # Python's str() of np.inf produces 'inf'.\n    formatted_results = []\n    for res in results:\n        if np.isinf(res):\n            formatted_results.append(str(res))\n        else:\n            formatted_results.append(f\"{res:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3522899"}, {"introduction": "在现代天体物理学的贝叶斯分析中，从复杂的后验概率分布中采样是核心任务，而马尔可夫链蒙特卡洛（MCMC）是实现这一目标的主力算法。任何有效的 MCMC 算法的基石是其转移核必须满足细致平衡条件，以确保马尔可夫链的平稳分布就是我们想要的目标分布。本练习将带您深入 MCMC 的理论核心，通过为一个相关高斯目标分布构建一个 Metropolis-Hastings 转移核，并用数学方法直接验证其满足细致平衡条件。[@problem_id:3522898]", "problem": "在一项对银道面一小块区域中同步辐射的计算天体物理学分析中，假设一对线性化的讨厌参数 $\\theta = (\\theta_1,\\theta_2)^{T}$ 的后验分布，可以由一个相关的多元高斯目标密度 $\\pi(\\theta) \\propto \\exp\\!\\left(-\\frac{1}{2}\\,\\theta^{T}\\Sigma^{-1}\\theta\\right)$ 很好地近似。这对参数代表了在通过噪声协方差对数据进行白化处理后，前景模型的局部振幅和局部谱指数。其中 $\\Sigma$ 是一个对称、严格正定的协方差矩阵，它是根据正向模型在其最大后验点周围的费希尔信息估计出来的。\n\n你的目标是构造一个可逆的马尔可夫链蒙特卡洛（MCMC）转移核，该转移核能保持此 $\\pi(\\theta)$ 不变，并通过直接计算来验证细致平衡。从马尔可夫链和细致平衡的核心定义出发，并仅使用关于高斯密度和强制可逆性的马尔可夫链蒙特卡洛构造方法的经过充分检验的事实。\n\n任务：\n1. 使用一个基于协方差 $\\Sigma$ 的多元正态随机游走，明确构建一个提议机制，该机制能产生一个相对于目标 $\\pi(\\theta)$ 的可逆转移核。将转移核 $K(\\theta,\\phi)$ 写成一个可调尺度参数 $\\tau0$、协方差 $\\Sigma$ 以及状态 $\\theta$ 和 $\\phi$ 的闭式函数。\n2. 从细致平衡的定义出发，推导相应的接受函数，并说明它如何与提议相结合以产生一个对于 $\\pi(\\theta)$ 的可逆核。\n3. 通过直接计算非对角通量来验证细致平衡。定义\n$$\n\\Delta(\\theta,\\phi) \\equiv \\pi(\\theta)\\,K(\\theta,\\phi)\\;-\\;\\pi(\\phi)\\,K(\\phi,\\theta),\n$$\n对于 $\\theta \\neq \\phi$，并仅使用基于 $\\pi(\\theta)$ 的高斯形式和你所提议的对称性质的代数操作，来完全简化此表达式。\n\n请提供 $\\Delta(\\theta,\\phi)$ 的最终简化解析表达式作为你的答案。不需要进行数值舍入。答案以无单位形式表示。", "solution": "该问题陈述是有效的。它提出了一个应用于天体物理学的计算统计学中的标准、良态问题。它在科学上基于贝叶斯推断和马尔可夫链蒙特卡洛（MCMC）方法的原理，没有任何事实上的不健全或模糊之处。所有必要的组成部分，包括目标密度的形式和协方差矩阵的性质，都已提供。这些任务要求构造和验证一个 Metropolis-Hastings 采样器，这是一个基本且可形式化的过程。\n\n给定一个二维参数向量 $\\theta = (\\theta_1, \\theta_2)^T$ 的目标后验密度。该密度是一个以原点为中心、具有对称正定协方差矩阵 $\\Sigma$ 的多元高斯分布：\n$$\n\\pi(\\theta) \\propto \\exp\\left(-\\frac{1}{2}\\theta^T\\Sigma^{-1}\\theta\\right)\n$$\n我们可以用一个显式归一化常数 $Z$ 将其写为 $\\pi(\\theta) = Z^{-1} \\exp(-\\frac{1}{2}\\theta^T\\Sigma^{-1}\\theta)$。任务是构造一个可逆的 MCMC 转移核 $K(\\theta, \\phi)$，它能使 $\\pi(\\theta)$ 保持不变。如果一个核满足细致平衡条件，则它相对于分布 $\\pi$ 是可逆的：\n$$\n\\pi(\\theta) K(\\theta, \\phi) = \\pi(\\phi) K(\\phi, \\theta) \\quad \\forall \\theta, \\phi\n$$\n这个条件确保了分布 $\\pi$ 是马尔可夫链的一个平稳分布。\n\n**1. 构造提议和转移核**\n\nMetropolis-Hastings 算法为构造此类核提供了一种通用方法。从状态 $\\theta$ 到不同状态 $\\phi$ 的转移（即对于 $\\theta \\neq \\phi$）是一个两步过程：\n1. 从一个提议分布 $q(\\phi|\\theta)$ 中提议一个候选状态 $\\phi$。\n2. 以概率 $\\alpha(\\theta, \\phi)$ 接受该提议状态。\n\n因此，转移核的非对角部分由 $K(\\theta, \\phi) = q(\\phi|\\theta) \\alpha(\\theta, \\phi)$ 给出。\n\n问题要求使用一个基于协方差 $\\Sigma$ 的多元正态随机游走来构建提议机制。一个自然的选择是从一个以当前状态 $\\theta$ 为中心、协方差矩阵与目标协方差 $\\Sigma$ 成比例的高斯分布中抽取提议 $\\phi$。设 $\\tau  0$ 为一个可调尺度参数。提议分布为：\n$$\n\\phi \\sim \\mathcal{N}(\\theta, \\tau^2 \\Sigma)\n$$\n该提议的概率密度函数为：\n$$\nq(\\phi|\\theta) = \\frac{1}{\\sqrt{(2\\pi)^2 |\\tau^2 \\Sigma|}} \\exp\\left(-\\frac{1}{2}(\\phi - \\theta)^T (\\tau^2 \\Sigma)^{-1} (\\phi - \\theta)\\right)\n$$\n注意到对于维度 $d=2$，有 $|\\tau^2\\Sigma| = (\\tau^2)^2 |\\Sigma| = \\tau^4 |\\Sigma|$ 和 $(\\tau^2\\Sigma)^{-1} = \\frac{1}{\\tau^2}\\Sigma^{-1}$，我们得到：\n$$\nq(\\phi|\\theta) = \\frac{1}{2\\pi\\tau^2\\sqrt{|\\Sigma|}} \\exp\\left(-\\frac{1}{2\\tau^2}(\\phi - \\theta)^T \\Sigma^{-1} (\\phi - \\theta)\\right)\n$$\n这个提议分布的一个关键性质是其对称性。让我们检查从 $\\phi$ 提议 $\\theta$ 的密度：\n$$\nq(\\theta|\\phi) = \\frac{1}{2\\pi\\tau^2\\sqrt{|\\Sigma|}} \\exp\\left(-\\frac{1}{2\\tau^2}(\\theta - \\phi)^T \\Sigma^{-1} (\\theta - \\phi)\\right)\n$$\n指数中的二次型可以重写为：\n$$\n(\\theta - \\phi)^T \\Sigma^{-1} (\\theta - \\phi) = (-(\\phi - \\theta))^T \\Sigma^{-1} (-(\\phi - \\theta)) = (\\phi - \\theta)^T \\Sigma^{-1} (\\phi - \\theta)\n$$\n因为 $\\Sigma^{-1}$ 是对称的。指数项和归一化常数是相同的。因此，提议分布是对称的：$q(\\phi|\\theta) = q(\\theta|\\phi)$。\n\n**2. 推导接受函数**\n\n我们从细致平衡方程开始，并代入核的形式：\n$$\n\\pi(\\theta) q(\\phi|\\theta) \\alpha(\\theta, \\phi) = \\pi(\\phi) q(\\theta|\\phi) \\alpha(\\phi, \\theta)\n$$\n标准的 Metropolis-Hastings 接受概率被设计用来满足这个关系：\n$$\n\\alpha(\\theta, \\phi) = \\min\\left(1, \\frac{\\pi(\\phi)q(\\theta|\\phi)}{\\pi(\\theta)q(\\phi|\\theta)}\\right)\n$$\n因为我们选择的提议是对称的（$q(\\phi|\\theta) = q(\\theta|\\phi)$），接受概率简化为 Metropolis 形式：\n$$\n\\alpha(\\theta, \\phi) = \\min\\left(1, \\frac{\\pi(\\phi)}{\\pi(\\theta)}\\right)\n$$\n让我们计算比率 $\\pi(\\phi)/\\pi(\\theta)$：\n$$\n\\frac{\\pi(\\phi)}{\\pi(\\theta)} = \\frac{Z^{-1} \\exp(-\\frac{1}{2}\\phi^T\\Sigma^{-1}\\phi)}{Z^{-1} \\exp(-\\frac{1}{2}\\theta^T\\Sigma^{-1}\\theta)} = \\exp\\left(-\\frac{1}{2}(\\phi^T\\Sigma^{-1}\\phi - \\theta^T\\Sigma^{-1}\\theta)\\right)\n$$\n所以接受概率是：\n$$\n\\alpha(\\theta, \\phi) = \\min\\left(1, \\exp\\left(\\frac{1}{2}(\\theta^T\\Sigma^{-1}\\theta - \\phi^T\\Sigma^{-1}\\phi)\\right)\\right)\n$$\n结合提议函数和接受函数，对于 $\\theta \\neq \\phi$ 的非对角转移核 $K(\\theta, \\phi)$ 是：\n$$\nK(\\theta, \\phi) = \\frac{1}{2\\pi\\tau^2\\sqrt{|\\Sigma|}} \\exp\\left(-\\frac{1}{2\\tau^2}(\\phi - \\theta)^T \\Sigma^{-1} (\\phi - \\theta)\\right) \\min\\left(1, \\frac{\\pi(\\phi)}{\\pi(\\theta)}\\right)\n$$\n这个核，根据其构造，是相对于 $\\pi(\\theta)$ 可逆的。\n\n**3. 验证细致平衡**\n\n我们被要求通过简化净通量差 $\\Delta(\\theta, \\phi)$ 的表达式来验证细致平衡，其中 $\\theta \\neq \\phi$：\n$$\n\\Delta(\\theta, \\phi) = \\pi(\\theta) K(\\theta, \\phi) - \\pi(\\phi) K(\\phi, \\theta)\n$$\n代入核的表达式 $K(\\theta, \\phi) = q(\\phi|\\theta) \\alpha(\\theta, \\phi)$，我们得到：\n$$\n\\Delta(\\theta, \\phi) = \\pi(\\theta) q(\\phi|\\theta) \\alpha(\\theta, \\phi) - \\pi(\\phi) q(\\theta|\\phi) \\alpha(\\phi, \\theta)\n$$\n由于提议分布是对称的（$q(\\phi|\\theta) = q(\\theta|\\phi)$），我们可以将其因子提出来：\n$$\n\\Delta(\\theta, \\phi) = q(\\phi|\\theta) \\left[ \\pi(\\theta) \\alpha(\\theta, \\phi) - \\pi(\\phi) \\alpha(\\phi, \\theta) \\right]\n$$\n现在我们通过考虑接受概率 $\\alpha(\\theta, \\phi) = \\min(1, \\pi(\\phi)/\\pi(\\theta))$ 的两种可能情况来分析方括号中的项。\n\n情况1：$\\pi(\\phi) \\le \\pi(\\theta)$。\n在这种情况下，比率 $\\pi(\\phi)/\\pi(\\theta) \\le 1$。接受概率为：\n$$\n\\alpha(\\theta, \\phi) = \\min\\left(1, \\frac{\\pi(\\phi)}{\\pi(\\theta)}\\right) = \\frac{\\pi(\\phi)}{\\pi(\\theta)}\n$$\n$$\n\\alpha(\\phi, \\theta) = \\min\\left(1, \\frac{\\pi(\\theta)}{\\pi(\\phi)}\\right) = 1 \\quad \\left(\\text{因为 } \\frac{\\pi(\\theta)}{\\pi(\\phi)} \\ge 1\\right)\n$$\n将这些代入方括号中的项：\n$$\n\\pi(\\theta) \\alpha(\\theta, \\phi) - \\pi(\\phi) \\alpha(\\phi, \\theta) = \\pi(\\theta) \\left( \\frac{\\pi(\\phi)}{\\pi(\\theta)} \\right) - \\pi(\\phi) (1) = \\pi(\\phi) - \\pi(\\phi) = 0\n$$\n\n情况2：$\\pi(\\phi)  \\pi(\\theta)$。\n在这种情况下，比率 $\\pi(\\phi)/\\pi(\\theta)  1$。接受概率为：\n$$\n\\alpha(\\theta, \\phi) = \\min\\left(1, \\frac{\\pi(\\phi)}{\\pi(\\theta)}\\right) = 1\n$$\n$$\n\\alpha(\\phi, \\theta) = \\min\\left(1, \\frac{\\pi(\\theta)}{\\pi(\\phi)}\\right) = \\frac{\\pi(\\theta)}{\\pi(\\phi)} \\quad \\left(\\text{因为 } \\frac{\\pi(\\theta)}{\\pi(\\phi)}  1\\right)\n$$\n将这些代入方括号中的项：\n$$\n\\pi(\\theta) \\alpha(\\theta, \\phi) - \\pi(\\phi) \\alpha(\\phi, \\theta) = \\pi(\\theta) (1) - \\pi(\\phi) \\left( \\frac{\\pi(\\theta)}{\\pi(\\phi)} \\right) = \\pi(\\theta) - \\pi(\\theta) = 0\n$$\n\n在两种情况下，方括号内的项都为零。因此，$\\Delta(\\theta, \\phi)$ 的整个表达式简化为零。\n$$\n\\Delta(\\theta, \\phi) = q(\\phi|\\theta) \\times 0 = 0\n$$\n这个直接计算证实了，对于我们构造的核，细致平衡条件 $\\pi(\\theta) K(\\theta, \\phi) = \\pi(\\phi) K(\\phi, \\theta)$ 对所有非对角转移（$\\theta \\neq \\phi$）都成立。$\\Delta(\\theta, \\phi)$ 的最终简化解析表达式为 $0$。", "answer": "$$\n\\boxed{0}\n$$", "id": "3522898"}]}