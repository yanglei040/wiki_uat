## 引言
平滑粒子[流体动力学](@entry_id:136788)（SPH）作为一种无网格的[拉格朗日方法](@entry_id:142825)，在模拟天体物理和工程领域中的复杂流体流动方面展现了巨大的威力。然而，其从拉格朗日量推导出的[运动方程](@entry_id:170720)本质上是无耗散的，这使其在处理一个至关重要的物理现象——激波——时遇到了根本性的困难。在没有适当处理的情况下，SPH模拟会导致粒子在激波处非物理地穿透并产生剧烈的[数值振荡](@entry_id:163720)，无法正确再现激波所必需的[熵增](@entry_id:138799)。为了弥补这一核心缺陷，**[人工粘性](@entry_id:142854)**（Artificial Viscosity, AV）应运而生，它并非一种物理粘性，而是一种精巧的数值工具，旨在引入受控的耗散来稳定地捕捉激波。

本文将系统性地剖析SPH中的[人工粘性](@entry_id:142854)。在第一章**“原理与机制”**中，我们将从激波的物理学出发，阐明引入[人工粘性](@entry_id:142854)的必要性，并详细拆解其最经典的Monaghan-Gingold数学形式，探讨其如何确保基本守恒律。随后，在第二章**“应用与跨学科联系”**中，我们将展示[人工粘性](@entry_id:142854)在天体[物理模拟](@entry_id:144318)（如[宇宙学结构形成](@entry_id:160031)）中的具体应用，讨论其局限性以及如粘性开关等高级改进方案，并探索其概念如何延伸至[磁流体动力学](@entry_id:264274)等其他领域。最后，通过第三章**“动手实践”**中的一系列问题，读者将有机会将理论知识应用于解决实际的计算问题。让我们首先深入其核心，探究人工粘性的基本原理与实现机制。

## 原理与机制

在上一章引言之后，我们现在深入探讨平滑粒子[流体动力学](@entry_id:136788)（SPH）中人工粘性（Artificial Viscosity, AV）的核心原理和具体实现机制。理想流体的演化由无粘的[欧拉方程](@entry_id:177914)描述，但在许多天体物理场景中，例如超新星爆发、[星系碰撞](@entry_id:158614)或[宇宙学结构形成](@entry_id:160031)，流体速度可能超过当地声速，形成激波（shock wave）。这些激波是物理量（如密度、压力和温度）发生剧烈、不连续跳变的极薄区域。对于旨在求解欧拉方程的数值方法而言，准确并稳定地捕捉激波是一个核心挑战。本章将阐明为什么纯粹的、无耗散的[SPH方法](@entry_id:755216)无法处理激波，并详细介绍人工粘性是如何作为一种必要的数值工具来解决这一问题的。

### 激波的物理学与[熵条件](@entry_id:166346)

为了理解人工粘性的必要性，我们必须首先回顾激波的基本物理学。在激波的极薄层内部，物理过程是不可逆的，动能通过粘性耗散转化为内能（热量）。然而，在宏观尺度上，如果我们将激波视为一个数学上的[不连续面](@entry_id:180188)，其两侧的状态（分别为上游“状态1”和下游“状态2”）由一组守恒律联系起来。这些守恒律源于对跨越激波的控制体积分形式的欧拉方程。对于一个位于其[静止参考系](@entry_id:262703)中的定常平面激波，这些守恒律构成了**兰金-雨贡尼奥（Rankine-Hugoniot）[跳跃条件](@entry_id:750965)**：

1.  **质量守恒**: 跨越激波的质量通量是连续的。
    $[\rho u] = \rho_2 u_2 - \rho_1 u_1 = 0$

2.  **[动量守恒](@entry_id:149964)**: 动量通量与压力的和是连续的。
    $[\rho u^2 + p] = (\rho_2 u_2^2 + p_2) - (\rho_1 u_1^2 + p_1) = 0$

3.  **[能量守恒](@entry_id:140514)**: 能量通量是连续的。
    $[\rho u (e + \frac{1}{2}u^2 + p/\rho)] = 0$

在此，$\rho$ 是密度，$u$ 是垂直于激波面的速度分量，$p$ 是压力，$e$ 是比内能。方括号 $[q]$ 表示物理量 $q$ 从状态1到状态2的跳变，即 $q_2 - q_1$ [@problem_id:3465332]。

然而，仅有这些守恒律是不够的。它们在数学上允许非物理的解，例如密度自发降低的“膨胀激波”。物理现实由**热力学第二定律**提供最终约束，该定律要求在任何绝热的[自发过程](@entry_id:137544)中，熵不能减少。对于一个真实的、压缩性的激波，不可逆的耗散过程必须导致熵的净增加。因此，一个物理上允许的激波必须满足**[熵条件](@entry_id:166346)**：下游比熵 $s_2$ 必须严格大于上游比熵 $s_1$ [@problem_id:3465273]。

$$ s_2 > s_1 $$

这个熵增条件正是标准[SPH方法](@entry_id:755216)遇到的根本障碍。SPH从一个离散的拉格朗日量推导而来，其运动方程在没有额外耗散项的情况下，能精确地守恒总质量、总动量、总角动量和总能量。对于一个理想气体，这种[能量守恒](@entry_id:140514)的演化形式等价于每个独立粒子的比[熵守恒](@entry_id:749018)，即 $ds_i/dt = 0$（在[数值精度](@entry_id:173145)范围内）。因此，一个“纯粹”的SPH模拟无法产生激波所必需的熵增，导致粒子在压缩流动中非物理地相互穿透，并在激波附近产生剧烈的[数值振荡](@entry_id:163720) [@problem_id:3504476]。为了使SPH能够正确模拟激波，必须引入一个机制来模拟耗散过程，并确保熵在压缩区域内正确增加。这个机制就是人工粘性。

### 人工粘性：一种数值工具而非物理模型

在深入其数学形式之前，至关重要的是要区分**[人工粘性](@entry_id:142854)**和**物理粘性**。物理粘性是流体的一种内在输运性质，由动粘性系数 $\nu$ 或动量粘性系数 $\mu$ 来量化。它源于微观粒子（分子、离子）的动量交换，并在连续介质的纳维-斯托克斯（[Navier-Stokes](@entry_id:276387)）方程中表现为与[速度梯度](@entry_id:261686)相关的[应力张量](@entry_id:148973)。物理粘性耗散发生在微观尺度上，例如碰撞[平均自由程](@entry_id:139563) $l_{\text{mfp}}$。

相比之下，SPH中使用的[人工粘性](@entry_id:142854)是一种纯粹的**数值工具**，其唯一目的是在数值上捕捉激波并维持稳定性。它被设计用来在几个SPH平滑长度 $h$ 的尺度上“涂抹”不连续性，确保兰金-雨贡尼奥[跳跃条件](@entry_id:750965)得到满足，并产生正确的熵增。在绝大多数天体[物理模拟](@entry_id:144318)中，数值分辨率远大于微观物理尺度（即 $h \gg l_{\text{mfp}}$），因此[人工粘性](@entry_id:142854)绝不应被解释为对真实微观粘性（如库仑粘性或布拉金斯基粘性）的模拟。它的作用是在计算上实现正则化，而不是忠实地再现微观物理过程 [@problem_id:3465288] [@problem_id:3465269]。

### Monaghan-Gingold 人工粘性机制

最广泛使用的SPH[人工粘性](@entry_id:142854)形式由Monaghan和Gingold提出。它通过在动量方程的压力项中引入一个额外的成对“粘性压力”或标量项 $\Pi_{ij}$ 来实现。这个项被设计为仅在粒子相互靠近时激活，从而模拟压缩过程中的耗散。

其[标准形式](@entry_id:153058)定义如下 [@problem_id:3504531] [@problem_id:3465317]：
$$
\Pi_{ij} \equiv 
\begin{cases}
\dfrac{-\alpha c_{ij} \mu_{ij} + \beta \mu_{ij}^2}{\rho_{ij}},  &\text{if } \mathbf{v}_{ij}\cdot\mathbf{r}_{ij}  0 \\
0,  \text{otherwise}
\end{cases}
$$
其中，各个符号的定义如下：
- $\mathbf{r}_{ij} = \mathbf{r}_i - \mathbf{r}_j$ 和 $\mathbf{v}_{ij} = \mathbf{v}_i - \mathbf{v}_j$ 分别是粒子 $i$ 和 $j$ 之间的位置和速度差向量。
- 激活条件 $\mathbf{v}_{ij}\cdot\mathbf{r}_{ij}  0$ 精确地识别出相互靠近（即处于压缩状态）的粒子对。
- $\rho_{ij} = (\rho_i + \rho_j)/2$ 和 $c_{ij} = (c_i + c_j)/2$ 分别是成对平均的密度和声速。
- $\alpha$ 和 $\beta$ 是控制粘性大小的[无量纲参数](@entry_id:169335)，通常取 $\mathcal{O}(1)$ 的值。
- $\mu_{ij}$ 是一个衡量粒子间压缩程度的量，定义为：
$$
\mu_{ij} \equiv \dfrac{h_{ij} \mathbf{v}_{ij} \cdot \mathbf{r}_{ij}}{|\mathbf{r}_{ij}|^2 + \eta^2}
$$
这里，$h_{ij} = (h_i + h_j)/2$ 是平均平滑长度。小参数 $\eta^2$（通常为 $0.01 h_{ij}^2$）是一个正则化项，用于防止当粒子间距 $|\mathbf{r}_{ij}| \to 0$ 时分母变为零。

$\Pi_{ij}$ 中的两个项各有其作用：
- **线性项（$\alpha$ 项）**: 该项提供了类似于体粘性的作用，负责在激波中产生大部分熵。对于相互靠近的粒子，$\mu_{ij}  0$，因此 $-\alpha c_{ij} \mu_{ij}$ 项为正，贡献一个排斥性的粘性压力。
- **二次项（$\beta$ 项）**: 该项对于高[马赫数](@entry_id:274014)的强激波至关重要。它提供了一个更强的排斥力，有效防止粒子在极端压缩下发生非物理的相互穿透。由于 $\mu_{ij}$ 是由相对位置和相对速度构成的，它本身是伽利略不变的，因此包含二次项并不会破坏伽利略不变性 [@problem_id:3504476]。

### 离散方程中的实现与守恒性质

这个粘性项 $\Pi_{ij}$ 被对称地引入到SPH的动量和能量方程中。

**[动量方程](@entry_id:197225)**:
[人工粘性](@entry_id:142854)对粒子 $i$ 速度变化率的贡献是：
$$
\left.\dfrac{d\mathbf{v}_i}{dt}\right|_{\mathrm{AV}} = -\sum_j m_j \Pi_{ij} \nabla_i W_{ij}
$$
这里，$m_j$ 是粒子 $j$ 的质量，$\nabla_i W_{ij}$ 是[平滑核](@entry_id:195877)函数关于粒子 $i$ 位置的梯度。由于 $\Pi_{ij}$ 是对称的（$\Pi_{ij} = \Pi_{ji}$），并且梯度是反对称的（$\nabla_i W_{ij} = -\nabla_j W_{ji}$），整个粘性力是成对反对称的（$\mathbf{F}_{ij}^{\text{AV}} = - \mathbf{F}_{ji}^{\text{AV}}$）。这精确地满足了牛顿第三定律，从而确保了系统的**[总线动量](@entry_id:173071)守恒**。此外，由于粘性力是沿着粒子对的连线方向作用的中心力，它不会产生净内力矩，因此也保证了**总角动量守恒** [@problem_id:3465273]。

**能量方程**:
为了确保**总[能量守恒](@entry_id:140514)**，[人工粘性](@entry_id:142854)力所做的功必须被完全转化为内能。这个过程表现为对比内能 $u$ 的一个加热项：
$$
\left.\dfrac{du_i}{dt}\right|_{\mathrm{AV}} = \dfrac{1}{2}\sum_j m_j \Pi_{ij} \mathbf{v}_{ij} \cdot\nabla_i W_{ij}
$$
这个表达式中的因子 $\frac{1}{2}$ 对于[能量守恒](@entry_id:140514)至关重要。它确保了整个系统动能的减少量精确等于内能的增加量。对于相互靠近的粒子，$\mathbf{v}_{ij} \cdot \nabla_i W_{ij}$ 通常为正（因为 $\nabla_i W_{ij}$ 通常与 $\mathbf{r}_{ij}$ 反平行），且 $\Pi_{ij}$ 为正，因此 $du_i/dt$ 为正。这代表了一个正定的耗散过程，即动能被不可逆地转化为热能 [@problem_id:3504531]。

这个加热项 $Q_{\mathrm{av}} = (du/dt)_{\mathrm{AV}}$ 直接与熵的产生联系起来。从热力学第一定律可以导出关系式 $T ds/dt = Q_{\mathrm{av}}$ [@problem_id:3465269]。通过确保 $Q_{\mathrm{av}} \ge 0$，[人工粘性](@entry_id:142854)机制保证了在压缩流动中熵总是非负产生，从而满足了[热力学第二定律](@entry_id:142732)，并使SPH能够模拟出物理上正确的激波解。任何违反此条件的方案都将导致非物理的“激波冷却”或数值崩溃。

### 局限性与改进方案

尽管标准的[人工粘性](@entry_id:142854)在捕捉激波方面非常成功，但它也存在一些已知的缺陷，催生了多种改进方案。

**1. 在[剪切流](@entry_id:266817)中的过度耗散**
标准[人工粘性](@entry_id:142854)的激活条件 $\mathbf{v}_{ij} \cdot \mathbf{r}_{ij}  0$ 虽然简单，但不够精确。在纯[剪切流](@entry_id:266817)中（$\nabla \cdot \mathbf{v} = 0$, $\nabla \times \mathbf{v} \neq 0$），粒子对也可能满足这个条件，从而错误地激活粘性，导致对物理不稳定性（如[Kelvin-Helmholtz不稳定性](@entry_id:154138)）的过度抑制。为了解决这个问题，引入了各种**粘性开关（viscosity switches）**。其中一个著名的例子是Balsara开关，它通过引入一个因子来降低在涡旋主导区域的粘性：
$$ f = \frac{|\nabla \cdot \mathbf{v}|}{|\nabla \cdot \mathbf{v}| + |\nabla \times \mathbf{v}| + \epsilon} $$
其中 $\epsilon$ 是一个小的正则化项。在纯压缩区域，$|\nabla \times \mathbf{v}| \to 0$，$f \to 1$，粘性完全激活。在纯剪切区域，$|\nabla \cdot \mathbf{v}| \to 0$，$f \to 0$，粘性被有效抑制 [@problem_id:3504476]。

类似地，在亚声速[湍流](@entry_id:151300)中，一个固定的、较大的粘性系数 $\alpha$ 会导致过度耗散，人为地降低了流动的有效雷诺数。为了模拟具有特定雷诺数的[湍流](@entry_id:151300)，需要采用可变粘性方案，使 $\alpha$ 随流场动态调整，仅在真正的激波前沿才提升至较大值 [@problem_id:3504527]。

**2. 接触[不连续面](@entry_id:180188)处的失效**
另一个标准SPH的著名难题是处理**接触[不连续面](@entry_id:180188)**。这是一个压力和速度连续，但密度和温度（或熵）不连续的界面。在这样的界面上，速度场为零或均匀，因此压缩条件 $\mathbf{v}_{ij} \cdot \mathbf{r}_{ij}  0$ 不被满足，导致[人工粘性](@entry_id:142854)完全失效。然而，在标准的密度-熵SPH中，由于核函数的平滑作用，界面两侧粒子的密度被混合，但熵函数 $A_i$ 仍然是粒子自身的、不连续的。这导致在计算压力 $P_i = A_i \rho_i^{\gamma}$ 时，在界面处产生一个虚假的、非零的压力梯度（“压力尖峰”），进而产生非物理的表面张力效应。

由于人工粘性对此无能为力，需要其他的解决方案 [@problem_id:3504512]：
- **人工热导（Artificial Conductivity）**: 引入一个额外的耗散项，用于平滑温度或熵的剧烈梯度。这可以有效地消除接触[不连续面](@entry_id:180188)上的压力尖峰。
- **压力-熵SPH（Pressure-Entropy SPH）**: 采用更先进的SPH方程形式，这些形式从一个将压力视为更基本变量的[拉格朗日量](@entry_id:174593)导出。通过这种方式，压[力平衡](@entry_id:267186)在离散层面得到更好的保证，从而从根本上消除了问题的根源。

**3. 现代粘性方案：[信号速度](@entry_id:261601)**
为了提供一个更具物理动机的粘性框架，现代SPH方案常使用“[信号速度](@entry_id:261601)”的概念。例如，粒子 $i$ 和 $j$ 之间的[信号速度](@entry_id:261601)可以定义为 $v_{\text{sig}} = c_i + c_j - \beta(\mathbf{v}_{ij} \cdot \hat{\mathbf{r}}_{ij})$，其中 $\hat{\mathbf{r}}_{ij}$ 是单位方向向量。这个表达式考虑了从两侧传播的声[波速](@entry_id:186208)度以及粒子对的接近速度，为粒子间信息传播的最快速度提供了一个伽利略不变的上限。这种方法可以更自适应地调节粘性强度，并且在[宇宙学模拟](@entry_id:747928)中，通过只使用[本动速度](@entry_id:157964)（peculiar velocity），可以确保粘性不会对均匀的哈勃流产生虚假响应 [@problem_id:3465283]。

总之，[人工粘性](@entry_id:142854)是[SPH方法](@entry_id:755216)中一个至关重要且经过深入研究的组成部分。它通过在离散方程中引入一个受控的、满足守恒律的耗散项，成功地解决了无粘SPH无法处理激波的根本问题。尽管标准模型存在局限性，但通过引入各种开关和改进方案，[人工粘性](@entry_id:142854)仍然是模拟天体物理中[可压缩流体](@entry_id:164617)动力学的强大而灵活的工具。