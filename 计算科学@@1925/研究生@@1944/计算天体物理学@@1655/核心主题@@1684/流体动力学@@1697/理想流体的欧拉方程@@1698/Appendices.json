{"hands_on_practices": [{"introduction": "欧拉方程常被写成紧凑的守恒形式 $\\partial_{t} U + \\partial_{x} F(U) = 0$，这种形式对于发展能正确捕捉激波的数值方法至关重要。这个练习 [@problem_id:3539810] 提供了基础的训练，要求你仅根据守恒变量 $U$ 来推导通量矢量 $F(U)$。掌握这种代数变换是理解和实现现代激波捕捉格式的第一步。", "problem": "在可压缩、无粘性、非相对论性的天体物理流体动力学中，且无外部体积力的情况下，理想流体的动力学由质量、动量和总能量的局域守恒定律决定。考虑一个沿空间坐标 $x$ 的一维笛卡尔域，其中流体密度为 $\\rho(x,t)$，速度为 $u(x,t)$，压强为 $p(x,t)$，总能量密度为 $E(x,t)$。总能量密度的定义为 $E = \\rho e + \\tfrac{1}{2}\\rho u^{2}$，其中 $e$ 是比内能。假设理想气体状态方程 (EOS) 具有恒定的绝热指数 $\\gamma$，因此 $p = (\\gamma - 1)\\rho e$。\n\n仅从一维笛卡尔几何中控制体积上的质量、动量和能量守恒的积分形式出发，推导守恒状态矢量 $U = (\\rho, \\rho u, E)$ 的守恒、通量-散度形式 $\\partial_{t} U + \\partial_{x} F(U) = 0$。使用给定关系式消去 $e$ 和 $p$，使得最终的通量矢量 $F(U)$ 完全用守恒变量 $(\\rho, \\rho u, E)$ 和参数 $\\gamma$ 表示，除了通过这些守恒变量出现外，不应出现其他原始变量。\n\n将你的最终结果以单个闭式解析表达式的形式给出，该表达式为通量矢量 $F(U)$，写成包含三个分量的行矢量，且仅包含 $\\rho$, $\\rho u$, $E$ 和 $\\gamma$。最终表达式中不要引入任何额外的变量。不需要数值。", "solution": "所述问题具有科学依据，是自洽且适定的。它要求推导气体动力学一维欧拉方程的通量矢量，这是计算流体动力学和天体物理学中一个标准且基础的练习。所有必要的定义和物理关系均已提供，不存在内部矛盾、歧义或事实错误。因此，该问题是有效的，我们可以开始推导。\n\n目标是为守恒律系统 $\\partial_{t} U + \\partial_{x} F(U) = 0$ 推导通量矢量 $F(U)$，其中守恒变量的状态矢量为 $U = (\\rho, \\rho u, E)$。推导将从一维笛卡尔域中理想、无粘性流体在无外部力作用下的质量、动量和能量守恒定律的积分形式开始。\n\n考虑一个由区间 $[x_1, x_2]$ 定义的固定空间控制体积 (CV)。对于一个守恒量密度 $q$ 及其对应的通量 $f_q$，其通用守恒律的积分形式为：\n$$\n\\frac{d}{dt} \\int_{x_1}^{x_2} q \\, dx = f_q(x_1) - f_q(x_2)\n$$\n等式右边表示该物理量进入控制体积的净速率。根据微积分基本定理，有 $f_q(x_1) - f_q(x_2) = -\\int_{x_1}^{x_2} \\frac{\\partial f_q}{\\partial x} dx$。代入此式并将时间导数移入积分号内（因为积分域是固定的）可得：\n$$\n\\int_{x_1}^{x_2} \\left[ \\frac{\\partial q}{\\partial t} + \\frac{\\partial f_q}{\\partial x} \\right] dx = 0\n$$\n由于此关系对任意控制体积 $[x_1, x_2]$ 都必须成立，因此被积函数必须恒等于零。这就给出了守恒律的微分形式，或称“通量-散度”形式：\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{\\partial f_q}{\\partial x} = 0\n$$\n现在我们将这一普遍原理应用于质量、动量和总能量。\n\n1.  **质量守恒**\n    守恒量是质量密度，$q = \\rho$。质量通量，即单位面积上的质量输运率，是 $f_{\\rho} = \\rho u$。应用上述原理可得连续性方程：\n    $$\n    \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u) = 0\n    $$\n    这是我们矢量方程的第一个分量。状态矢量的第一个分量是 $U_1 = \\rho$，通量矢量的第一个分量是 $F_1 = \\rho u$。\n\n2.  **动量守恒**\n    守恒量是动量密度，$q = \\rho u$。动量通量有两个贡献：动量的平流输运 $\\rho u^2$，以及由压强施加的单位面积上的力 $p$。因此，动量通量为 $f_{\\rho u} = \\rho u^2 + p$。这给出了动量方程：\n    $$\n    \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u^2 + p) = 0\n    $$\n    状态矢量的第二个分量是 $U_2 = \\rho u$，通量矢量的第二个分量是 $F_2 = \\rho u^2 + p$。\n\n3.  **能量守恒**\n    守恒量是总能量密度，$q = E = \\rho e + \\tfrac{1}{2}\\rho u^{2}$。能量通量 $f_E$ 是总能量的平流输运 $E u$ 与边界上压强力对流体做功的速率 $p u$ 之和。因此，能量通量为 $f_E = E u + p u = (E+p)u$。这给出了能量方程：\n    $$\n    \\frac{\\partial E}{\\partial t} + \\frac{\\partial}{\\partial x}((E+p)u) = 0\n    $$\n    状态矢量的第三个分量是 $U_3 = E$，通量矢量的第三个分量是 $F_3 = (E+p)u$。\n\n综合这些结果，方程组为 $\\partial_t U + \\partial_x F = 0$，其中 $U = (\\rho, \\rho u, E)$ 且 $F = (\\rho u, \\rho u^2 + p, (E+p)u)$。问题要求通量矢量 $F$ 仅用 $U$ 的分量 $\\rho$, $\\rho u$, $E$ 以及常数 $\\gamma$ 来表示。为实现这一点，我们必须从 $F$ 的表达式中消去原始变量 $p$ 和 $u$。\n\n速度 $u$ 可以表示为动量密度与质量密度之比：\n$$\nu = \\frac{\\rho u}{\\rho}\n$$\n接下来，我们用守恒变量来表示压强 $p$。给定理想气体状态方程 (EOS) $p = (\\gamma-1)\\rho e$ 和总能量密度的定义 $E = \\rho e + \\frac{1}{2}\\rho u^2$。从 $E$ 的定义中，我们可以分离出内能密度 $\\rho e$：\n$$\n\\rho e = E - \\frac{1}{2}\\rho u^2\n$$\n代入 $u$ 的表达式：\n$$\n\\rho e = E - \\frac{1}{2}\\rho \\left(\\frac{\\rho u}{\\rho}\\right)^2 = E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\n$$\n现在，我们将 $\\rho e$ 的这个表达式代入状态方程 (EOS) 以求出 $p$：\n$$\np = (\\gamma - 1) (\\rho e) = (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right)\n$$\n我们现在已经成功地用 $\\rho$、$\\rho u$ 和 $E$ 表示了 $u$ 和 $p$。最后一步是将这些表达式代入通量矢量 $F$ 的各个分量中。\n\n-   **通量分量 $F_1$：**\n    $F_1 = \\rho u$。这已经是一个守恒变量。\n\n-   **通量分量 $F_2$：**\n    $F_2 = \\rho u^2 + p$。我们代入 $u$ 和 $p$ 的表达式：\n    $$\n    F_2 = \\rho \\left(\\frac{\\rho u}{\\rho}\\right)^2 + (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right)\n    $$\n    $$\n    F_2 = \\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho}\n    $$\n    合并与 $(\\rho u)^2/\\rho$ 成比例的项：\n    $$\n    F_2 = \\left(1 - \\frac{\\gamma-1}{2}\\right)\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E = \\left(\\frac{2 - \\gamma + 1}{2}\\right)\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E\n    $$\n    $$\n    F_2 = \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E\n    $$\n\n-   **通量分量 $F_3$：**\n    $F_3 = (E+p)u$。我们代入 $p$ 和 $u$ 的表达式：\n    $$\n    F_3 = \\left[ E + (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right) \\right] \\left( \\frac{\\rho u}{\\rho} \\right)\n    $$\n    首先，简化方括号中的项：\n    $$\n    E + p = E + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho} = \\gamma E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho}\n    $$\n    现在，乘以 $u = \\frac{\\rho u}{\\rho}$：\n    $$\n    F_3 = \\left( \\gamma E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho} \\right) \\frac{\\rho u}{\\rho} = \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2}\n    $$\n\n因此，完全用守恒变量 $(\\rho, \\rho u, E)$ 表示的通量矢量 $F(U)$ 是：\n$$\nF(U) = \\left( \\rho u, \\quad \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E, \\quad \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2} \\right)\n$$\n这个结果符合要求的形式。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\rho u  \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E  \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2} \\end{pmatrix}}\n$$", "id": "3539810"}, {"introduction": "激波在天体物理学中无处不在，它被描述为一种不连续面，流体性质在此处根据兰金-雨果尼厄关系发生跳变。跨越激波的压缩比是一个关键参数，它取决于激波的强度和流体的状态方程。在这个实践中 [@problem_id:3539802]，你将推导压缩比作为马赫数和绝热指数 $\\gamma$ 的函数，然后通过编写一个简单的程序来探究不同物理环境（例如单原子气体与辐射主导气体）对激波压缩的响应有何不同。", "problem": "考虑理想、无粘、非相对论性流体的一维欧拉方程，其状态方程为理想气体状态方程，其中压强 $p$、密度 $\\rho$、速度 $u$ 和比内能 $e$ 遵循 $p = (\\gamma - 1)\\,\\rho\\,e$，$\\gamma$ 为绝热指数。在激波静止坐标系中，一个稳定、平面、正激波的特征是其具有均匀的上游状态 $(\\rho_1, u_1, p_1)$ 和均匀的下游状态 $(\\rho_2, u_2, p_2)$。上游流是超音速的，马赫数 $M \\equiv u_1 / c_1$，其中 $c_1 = \\sqrt{\\gamma p_1/\\rho_1}$ 是上游声速。仅从跨越间断面的质量、动量和能量守恒定律以及理想气体状态方程出发，推导压缩比 $r \\equiv \\rho_2 / \\rho_1$ 作为 $\\gamma$ 和 $M$ 的函数的显式表达式。你可以假设 $M \\ge 1$。使用无量纲量表示所有变量和常数；不需要物理单位。\n\n推导出关系式后，编写一个程序：\n- 实现一个函数，给定 $(\\gamma, M)$，返回压缩比 $r$。对于边界情况 $M \\le 1$，返回 $r = 1.0$。\n- 使用该函数计算对应于天体物理学相关领域的两个绝热指数值的 $r$：$\\gamma = 5/3$（单原子理想气体）和 $\\gamma = 4/3$（辐射压主导的替代模型）。\n- 对以下一组上游马赫数 $M$ 进行 $r$ 的求值，以探究近阈值、中等和强激波行为：$M \\in \\{1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0\\}$。\n\n测试套件：\n- 情况集 A：$\\gamma = 5/3$，其中 $M \\in \\{1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0\\}$。\n- 情况集 B：$\\gamma = 4/3$，其中 $M \\in \\{1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0\\}$。\n\n你的程序应产生单行输出，包含一个含有两个子列表的列表。第一个子列表必须按照上面给出的 $M$ 顺序包含 $\\gamma = 5/3$ 的七个压缩比，并四舍五入到八位小数。第二个子列表必须按照相同的 $M$ 顺序包含 $\\gamma = 4/3$ 的七个压缩比，并四舍五入到八位小数。确切的输出格式为单行，无额外空格，使用方括号括起来的逗号分隔列表。例如，输出结构必须是以下形式：\n[[r_5_3_M1,r_5_3_M2,...,r_5_3_M7],[r_4_3_M1,r_4_3_M2,...,r_4_3_M7]]\n其中每个 $r_{\\cdot}$ 是一个小数点后恰好有八位数字的小数。\n\n你的任务是：\n- 从守恒定律和状态方程出发，从第一性原理推导 $r(\\gamma, M)$。\n- 实现指定的程序以计算所需的值，并以上述确切格式打印它们。", "solution": "该问题是有效的，因为它科学地基于流体动力学原理，是适定且客观的。它要求推导理想气体的 Rankine-Hugoniot 压缩比，这是研究激波的一个标准和基本结果。所有必要的信息和定义都已提供，没有矛盾或含糊之处。\n\n压缩比 $r \\equiv \\rho_2 / \\rho_1$ 作为绝热指数 $\\gamma$ 和上游马赫数 $M$ 的函数的推导始于应用于激波间断面上的一维、稳态欧拉方程。这些是 Rankine-Hugoniot 跳跃条件，代表了质量、动量和能量的守恒。\n\n让上游状态用下标 $1$ 表示，下游状态用下标 $2$ 表示。变量是密度 $\\rho$、速度 $u$ 和压强 $p$。\n\n守恒定律是：\n1.  **质量守恒：** 质量通量在激波前后是恒定的。\n    $$ \\rho_1 u_1 = \\rho_2 u_2 $$\n2.  **动量守恒：** 动压和静压之和是恒定的。\n    $$ p_1 + \\rho_1 u_1^2 = p_2 + \\rho_2 u_2^2 $$\n3.  **能量守恒：** 总能量通量是恒定的。一个更方便的形式是总比焓守恒。\n    $$ h_1 + \\frac{1}{2}u_1^2 = h_2 + \\frac{1}{2}u_2^2 $$\n    其中 $h = e + p/\\rho$ 是比焓，$e$ 是比内能。\n\n该系统由理想气体状态方程（EOS）封闭：\n$$ p = (\\gamma - 1)\\rho e $$\n\n从状态方程，我们可以用压强和密度表示比焓 $h$：\n$$ h = e + \\frac{p}{\\rho} = \\frac{p}{(\\gamma - 1)\\rho} + \\frac{p}{\\rho} = \\left(\\frac{1}{\\gamma-1} + 1\\right)\\frac{p}{\\rho} = \\frac{\\gamma}{\\gamma-1}\\frac{p}{\\rho} $$\n\n我们的目标是找到压缩比 $r = \\rho_2 / \\rho_1$ 关于 $\\gamma$ 和上游马赫数 $M = u_1 / c_1$ 的表达式，其中 $c_1 = \\sqrt{\\gamma p_1 / \\rho_1}$ 是上游声速。\n\n从质量守恒方程(1)，我们用上游速度 $u_1$ 和压缩比 $r$ 表示下游速度 $u_2$：\n$$ u_2 = \\frac{\\rho_1}{\\rho_2}u_1 = \\frac{u_1}{r} $$\n\n接下来，我们重排动量守恒方程(2)以求解压强跃升 $p_2 - p_1$：\n$$ p_2 - p_1 = \\rho_1 u_1^2 - \\rho_2 u_2^2 $$\n代入 $u_2 = u_1/r$ 和 $\\rho_2=r\\rho_1$：\n$$ p_2 - p_1 = \\rho_1 u_1^2 - (r\\rho_1)\\left(\\frac{u_1}{r}\\right)^2 = \\rho_1 u_1^2 - \\frac{\\rho_1 u_1^2}{r} = \\rho_1 u_1^2 \\left(1 - \\frac{1}{r}\\right) $$\n两边同除以 $p_1$ 得到压强比 $p_2/p_1$：\n$$ \\frac{p_2}{p_1} - 1 = \\frac{\\rho_1 u_1^2}{p_1} \\left(1 - \\frac{1}{r}\\right) $$\n我们可以将项 $\\rho_1 u_1^2 / p_1$ 与马赫数 $M$ 联系起来：\n$$ M^2 = \\frac{u_1^2}{c_1^2} = \\frac{u_1^2}{\\gamma p_1 / \\rho_1} = \\frac{\\rho_1 u_1^2}{\\gamma p_1} \\implies \\frac{\\rho_1 u_1^2}{p_1} = \\gamma M^2 $$\n将此代入压强比方程，得到：\n$$ \\frac{p_2}{p_1} = 1 + \\gamma M^2 \\left(1 - \\frac{1}{r}\\right) \\quad (\\text{Eq. A}) $$\n\n现在我们转向能量守恒方程(3)，使用比焓 $h$ 的表达式：\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}u_1^2 = \\frac{\\gamma}{\\gamma-1}\\frac{p_2}{\\rho_2} + \\frac{1}{2}u_2^2 $$\n代入 $\\rho_2 = r\\rho_1$ 和 $u_2 = u_1/r$：\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}u_1^2 = \\frac{\\gamma}{\\gamma-1}\\frac{p_2}{r\\rho_1} + \\frac{1}{2}\\frac{u_1^2}{r^2} $$\n为简化，我们代入动量方程中的 $p_2$，$p_2 = p_1 + \\rho_1 u_1^2 (1 - 1/r)$：\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}u_1^2 = \\frac{\\gamma}{(\\gamma-1)r\\rho_1}\\left[p_1 + \\rho_1 u_1^2 \\left(1 - \\frac{1}{r}\\right)\\right] + \\frac{1}{2}\\frac{u_1^2}{r^2} $$\n我们先以一种更有启发性的方式重排能量方程。\n$$ \\frac{2\\gamma}{\\gamma-1}\\left(\\frac{p_1}{\\rho_1} - \\frac{p_2}{\\rho_2}\\right) = u_2^2 - u_1^2 $$\n$$ \\frac{2\\gamma}{\\gamma-1}\\left(\\frac{p_1}{\\rho_1} - \\frac{p_2}{r\\rho_1}\\right) = \\left(\\frac{u_1}{r}\\right)^2 - u_1^2 = u_1^2\\left(\\frac{1}{r^2}-1\\right) $$\n$$ \\frac{2\\gamma}{(\\gamma-1)\\rho_1}\\frac{rp_1 - p_2}{r} = -u_1^2\\frac{r^2 - 1}{r^2} $$\n$$ p_2 - rp_1 = \\frac{\\rho_1 u_1^2 (\\gamma-1)}{2\\gamma} \\frac{r^2 - 1}{r} $$\n从动量方程，我们也有 $p_2 - p_1 = \\rho_1 u_1^2 (1 - 1/r)$。这两个关于 $p_2$ 的表达式可以相等：\n$$ rp_1 + \\frac{\\rho_1 u_1^2 (\\gamma-1)}{2\\gamma} \\frac{r^2 - 1}{r} = p_1 + \\rho_1 u_1^2 \\frac{r - 1}{r} $$\n假设激波存在 ($r \\ne 1$)，我们可以两边同除以 $r-1$：\n$$ p_1 + \\frac{\\rho_1 u_1^2 (\\gamma-1)(r+1)}{2\\gamma r} = \\frac{\\rho_1 u_1^2}{r} $$\n方程两边同乘以 $2\\gamma r / (\\rho_1 u_1^2)$:\n$$ \\frac{2\\gamma p_1 r}{\\rho_1 u_1^2} + (\\gamma-1)(r+1) = 2\\gamma $$\n使用 $\\frac{p_1}{\\rho_1 u_1^2} = \\frac{1}{\\gamma M^2}$：\n$$ \\frac{2\\gamma r}{\\gamma M^2} + (\\gamma-1)r + (\\gamma-1) = 2\\gamma $$\n$$ \\frac{2r}{M^2} + (\\gamma-1)r = 2\\gamma - (\\gamma-1) $$\n$$ r\\left(\\frac{2}{M^2} + \\gamma - 1\\right) = \\gamma + 1 $$\n$$ r\\left(\\frac{2 + (\\gamma - 1)M^2}{M^2}\\right) = \\gamma + 1 $$\n解出 $r$ 得到压缩比的最终表达式：\n$$ r(\\gamma, M) = \\frac{(\\gamma+1)M^2}{(\\gamma-1)M^2 + 2} $$\n对于 $M=1$ 的情况，该公式给出 $r = (\\gamma+1)/(\\gamma-1+2) = 1$，对应于无压缩。对于强激波极限（$M \\to \\infty$），压缩比趋于一个有限极限 $r_{\\text{max}} = (\\gamma+1)/(\\gamma-1)$。\n对于单原子气体（$\\gamma = 5/3$），$r_{\\text{max}} = (8/3)/(2/3) = 4$。对于辐射主导气体（$\\gamma = 4/3$），$r_{\\text{max}} = (7/3)/(1/3) = 7$。\n问题指明，对于 $M \\le 1$，函数应返回 $r=1$，这与激波不会在亚音速流中形成的物理事实相符。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the compression ratio for a normal shock in an ideal gas.\n    \"\"\"\n\n    def compression_ratio(gamma: float, M: float) -> float:\n        \"\"\"\n        Calculates the shock compression ratio r = rho_2 / rho_1.\n\n        Args:\n            gamma: The adiabatic index of the gas.\n            M: The upstream Mach number.\n\n        Returns:\n            The compression ratio r. For M = 1, r = 1.0.\n        \"\"\"\n        if M = 1.0:\n            return 1.0\n        \n        M2 = M * M\n        numerator = (gamma + 1.0) * M2\n        denominator = (gamma - 1.0) * M2 + 2.0\n        \n        return numerator / denominator\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case set A: gamma = 5/3\n        (5.0 / 3.0, [1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0]),\n        # Case set B: gamma = 4/3\n        (4.0 / 3.0, [1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0]),\n    ]\n\n    all_results = []\n    \n    for gamma, mach_numbers in test_cases:\n        case_results = []\n        for M in mach_numbers:\n            r = compression_ratio(gamma, M)\n            # Format the result to exactly eight decimal places.\n            formatted_r = f\"{r:.8f}\"\n            case_results.append(formatted_r)\n        \n        # Create the string representation for one sublist.\n        list_string = f\"[{','.join(case_results)}]\"\n        all_results.append(list_string)\n\n    # Final print statement in the exact required format.\n    # The output is a string representing a list of lists.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```", "id": "3539802"}, {"introduction": "数值求解欧拉方程需要在单元交界处使用“近似黎曼求解器”来计算通量。求解器的选择极大地影响了模拟的准确性，尤其是在解析接触间断等特征时。这个高级练习 [@problem_id:3539851] 要求你实现并比较两种流行的求解器：HLLE 和 HLLC。通过模拟接触波的平流，你将亲身体验 HLLE 格式的数值扩散效应，并体会 HLLC 格式在保持清晰接触间断方面的卓越能力，这对于多流体天体物理模拟至关重要。", "problem": "考虑理想气体流体的一维欧拉方程，其比热比为 $\\gamma$，写成质量、动量和总能量的守恒律形式。设守恒变量为 $U = [\\rho, \\rho u, E]$，物理通量为 $F(U) = [\\rho u, \\rho u^2 + p, u(E + p)]$，状态方程为 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$。在无量纲单位下，定义域在区间 $[0,1]$ 上是周期的。您需要进行一次有限体积模拟，以恒定的速度和压力平流一个方波接触间断，并比较两种近似黎曼求解器：Harten–Lax–van Leer–Einfeldt (HLLE) 求解器和 Harten–Lax–van Leer–Contact (HLLC) 求解器，评估它们捕捉接触间断的能力。比较的度量标准是在接触间断穿过一个完整定义域的时间后，其数值厚度。\n\n从以下基本原理出发，推导并实现一个针对欧拉方程组的一阶精度、显式、带有周期性边界条件的有限体积方法：\n- 质量守恒：$\\partial_t \\rho + \\partial_x(\\rho u) = 0$。\n- 动量守恒：$\\partial_t (\\rho u) + \\partial_x(\\rho u^2 + p) = 0$。\n- 能量守恒：$\\partial_t E + \\partial_x(u(E + p)) = 0$。\n- 理想气体状态方程：$p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$。\n\n您的初始条件应表示一个在均匀压力和速度下的方波接触，这是一个熵波/接触波。具体来说，设置 $\\gamma = 1.4$，$u_0 = 1$，$p_0 = 1$，并定义两个密度状态 $\\rho_{\\mathrm{low}} = 1$ 和 $\\rho_{\\mathrm{high}} = 2$。每个区域的总能量密度为 $E = \\tfrac{p_0}{\\gamma - 1} + \\tfrac{1}{2}\\rho u_0^2$。初始化定义域：当 $x \\in [0, \\tfrac{1}{2})$ 时，$\\rho(x) = \\rho_{\\mathrm{high}}$；当 $x \\in [\\tfrac{1}{2}, 1)$ 时，$\\rho(x) = \\rho_{\\mathrm{low}}$。同时设置 $u(x) \\equiv u_0$ 和 $p(x) \\equiv p_0$，并采用周期性边界条件。将求解推进到最终时间 $t_{\\mathrm{end}} = 1$，这对应于方波在定义域内平流一个完整的周期。\n\n实现两个有限体积求解器，它们仅在界面处的数值通量函数上有所不同：\n- Harten–Lax–van Leer–Einfeldt (HLLE) 通量。\n- Harten–Lax–van Leer–Contact (HLLC) 通量。\n\n使用 Courant–Friedrichs–Lewy (CFL) 数 $0.4$ 来确定时间步长 $\\Delta t = \\mathrm{CFL}\\,\\Delta x / \\max_i(|u_i| + a_i)$，其中局部声速为 $a_i = \\sqrt{\\gamma p_i / \\rho_i}$，$\\Delta x$ 是均匀的网格间距。\n\n按如下方式定义最终时刻的接触厚度。设参考的低密度和高密度为 $\\rho_{\\mathrm{low}}$ 和 $\\rho_{\\mathrm{high}}$。对每个单元索引 $i$，计算归一化密度 $q_i = \\mathrm{clip}\\left((\\rho_i - \\rho_{\\mathrm{low}})/(\\rho_{\\mathrm{high}} - \\rho_{\\mathrm{low}}), 0, 1\\right)$。找出满足 $q_i \\in (0.1, 0.9)$ 的索引集合；这些索引标记了接触点附近的过渡区域。接触厚度是每个连续过渡段中的网格单元数。由于方波在周期性定义域中有两个接触界面，因此报告在 $t_{\\mathrm{end}}$ 时刻存在的所有过渡段的平均厚度。厚度以整数个单元格表示。\n\n设计一个程序，对于测试套件中的每个网格分辨率，运行两次模拟（一次使用 HLLE，一次使用 HLLC），并报告每个求解器测得的平均接触厚度。\n\n测试套件与覆盖范围：\n- 案例 1：$N = 64$ 个单元（一个用于测试强数值扩散的粗糙分辨率）。\n- 案例 2：$N = 128$ 个单元（一个用于测试收敛性的中等分辨率）。\n- 案例 3：$N = 256$ 个单元（一个用于测试更清晰捕捉能力和稳定性的精细分辨率）。\n\n答案规格：\n- 对于每个案例，生成一个整数厚度对 $[\\text{thickness}_{\\mathrm{HLLE}}, \\text{thickness}_{\\mathrm{HLLC}}]$，单位为单元格数量。\n- 您的程序应生成单行输出，其中包含三个案例的三个对，格式为方括号括起来的列表的逗号分隔列表，例如：$[[a,b],[c,d],[e,f]]$。\n\n所有量均为无量纲，并且要求的输出是网格单元数量的整数。不涉及其他单位。实现必须是自包含的，不需要任何输入，并遵守指定的环境约束。", "solution": "该问题要求实现并比较两种用于一维气体动力学欧拉方程的近似黎曼求解器：Harten–Lax–van Leer–Einfeldt (HLLE) 和 Harten–Lax–van Leer–Contact (HLLC)。比较的依据是它们解析接触间断的能力。该解法采用一阶显式有限体积法进行开发。\n\n守恒形式的一维欧拉方程由下式给出：\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\n其中 $U$ 是守恒变量的向量，$F(U)$ 是相应通量的向量。对于比热比为 $\\gamma$ 的理想气体，它们是：\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad F(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{bmatrix}\n$$\n在这里，$\\rho$ 是流体密度，$u$ 是速度，$E$ 是单位体积的总能量密度，$p$ 是压力。该方程组通过理想气体状态方程封闭，该方程将压力与守恒量联系起来：\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right)\n$$\n\n数值解是在周期性定义域 $[0,1]$ 上的均匀网格上使用有限体积法构建的。该定义域被离散化为 $N$ 个宽度为 $\\Delta x = 1/N$ 的单元。设 $U_i(t)$ 为第 $i$ 个单元 $[x_{i-1/2}, x_{i+1/2}]$ 上在时间 $t$ 的守恒变量的空间平均值。在单元 $i$ 上对守恒律进行积分，得到半离散更新方程：\n$$\n\\frac{dU_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\n其中 $F_{i+1/2}$ 是单元 $i$ 和单元 $i+1$ 之间界面上的数值通量。对于一阶精度格式，该通量是相邻单元中常数状态 $U_i$ 和 $U_{i+1}$ 的函数：$F_{i+1/2} = F_{\\text{num}}(U_i, U_{i+1})$。时间积分使用显式向前欧拉法执行：\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\n时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件确定，以确保数值稳定性：\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{\\max_i(|u_i| + a_i)}\n$$\n其中 $a_i = \\sqrt{\\gamma p_i / \\rho_i}$ 是单元 $i$ 中的局部声速，我们使用的 CFL 数为 $0.4$。\n\n该方法的核心在于数值通量函数 $F_{\\text{num}}$ 的选择。我们实现并比较了两种这样的函数。\n\n**1. Harten–Lax–van Leer–Einfeldt (HLLE) 求解器**\nHLLE 求解器基于黎曼问题的双波模型，假设解由原始的左、右状态组成，它们被一个由最快的左行波和右行波界定的单一接触区域所分隔。信号速度估计如下：\n$$\nS_L = \\min(u_L - a_L, u_R - a_R) \\quad \\text{and} \\quad S_R = \\max(u_L + a_L, u_R + a_R)\n$$\n其中下标 $L$ 和 $R$ 分别表示界面左侧和右侧的状态。HLLE 通量则由一个分段函数给出：\n$$\nF_{\\text{HLLE}}(U_L, U_R) = \\begin{cases} \nF(U_L)   \\text{if } S_L \\geq 0 \\\\\n\\frac{S_R F(U_L) - S_L F(U_R) + S_L S_R (U_R - U_L)}{S_R - S_L}   \\text{if } S_L  0  S_R \\\\\nF(U_R)   \\text{if } S_R \\leq 0\n\\end{cases}\n$$\n该求解器非常稳健，但众所周知具有扩散性，因为它会抹平接触间断和剪切波等中间波。\n\n**2. Harten–Lax–van Leer–Contact (HLLC) 求解器**\nHLLC 求解器在 HLLE 的基础上进行了改进，通过将接触波重新引入模型，形成了一个三波结构（$S_L$、$S_*$、$S_R$）。接触波速度 $S_*$ 估计如下：\n$$\nS_* = \\frac{p_R - p_L + \\rho_L u_L (S_L - u_L) - \\rho_R u_R (S_R - u_R)}{\\rho_L (S_L - u_L) - \\rho_R (S_R - u_R)}\n$$\n这一补充使得 HLLC 求解器能够精确解析孤立的接触间断。其通量同样是一个分段函数，但现在由波速定义了四个区域：\n$$\nF_{\\text{HLLC}}(U_L, U_R) = \\begin{cases} \nF_L   \\text{if } 0 \\le S_L \\\\\nF_L + S_L(U_*^L - U_L)   \\text{if } S_L  0 \\le S_* \\\\\nF_R + S_R(U_*^R - U_R)   \\text{if } S_*  0  S_R \\\\\nF_R   \\text{if } S_R \\le 0\n\\end{cases}\n$$\n其中 $F_L = F(U_L)$，$F_R = F(U_R)$，而 $U_*^K$ ($K \\in \\{L, R\\}$) 是声波和接触波之间的“星”区状态。它们由下式给出：\n$$\nU_*^K = \\rho_K \\left( \\frac{S_K - u_K}{S_K - S_*} \\right) \\begin{bmatrix} 1 \\\\ S_* \\\\ E_K/\\rho_K + (S_* - u_K)(S_* + p_K/(\\rho_K(S_K-u_K))) \\end{bmatrix}\n$$\n\n**模拟设置与测量**\n模拟以一个接触间断进行初始化。参数为 $\\gamma = 1.4$，均匀速度 $u_0 = 1$，均匀压力 $p_0 = 1$。密度分布是一个方波：当 $x \\in [0, 0.5)$ 时 $\\rho = \\rho_{\\mathrm{high}} = 2$，当 $x \\in [0.5, 1)$ 时 $\\rho = \\rho_{\\mathrm{low}} = 1$。此设置是欧拉方程的一个精确解，表示一个以速度 $u_0=1$ 平流的接触波。模拟运行至 $t_{\\mathrm{end}}=1$，这对应于波在定义域内穿越一个完整周期。\n\n每个求解器的性能通过最终时刻接触间断的数值厚度来量化。每个单元中的密度 $\\rho_i$ 被归一化：\n$$\nq_i = \\text{clip}\\left(\\frac{\\rho_i - \\rho_{\\mathrm{low}}}{\\rho_{\\mathrm{high}} - \\rho_{\\mathrm{low}}}, 0, 1\\right)\n$$\n满足 $q_i \\in (0.1, 0.9)$ 的单元被认为是过渡区域的一部分。由于周期性，初始条件有两个这样的过渡。厚度定义为一个连续过渡段中的单元格数量。最终报告的值是在 $t_{\\mathrm{end}}$ 时刻存在的两个过渡段的平均厚度，四舍五入到最接近的整数。\n\n算法的流程是：首先用方波初始条件初始化网格，然后进入一个时间循环。在每一步中，计算 $\\Delta t$，使用 HLLE 或 HLLC 求解器计算所有单元界面的数值通量，并更新所有单元中的守恒变量。通过将网格视为循环数组来施加周期性边界条件。达到 $t_{\\mathrm{end}}$ 后，分析最终的密度分布以计算平均接触厚度。对每个求解器和每个指定的网格分辨率 $N$ 重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Global constants\nGAMMA = 1.4\n\ndef cons_to_prim(U):\n    \"\"\"Converts a conserved state vector U to primitive variables rho, u, p.\"\"\"\n    rho = U[..., 0]\n    # To avoid division by zero in vacuum states (not in this problem, but good practice)\n    u = U[..., 1] / (rho + 1e-12)\n    E = U[..., 2]\n    # Prevent negative pressure from numerical errors\n    p = np.maximum((GAMMA - 1.0) * (E - 0.5 * rho * u**2), 1e-9)\n    return rho, u, p\n\ndef prim_to_cons(rho, u, p):\n    \"\"\"Converts primitive variables rho, u, p to a conserved state vector U.\"\"\"\n    shape = rho.shape + (3,) if rho.ndim > 0 else (3,)\n    U = np.zeros(shape)\n    U[..., 0] = rho\n    U[..., 1] = rho * u\n    U[..., 2] = p / (GAMMA - 1.0) + 0.5 * rho * u**2\n    return U\n\ndef get_physical_flux_from_cons(U):\n    \"\"\"Computes the physical flux F from a conserved state vector U.\"\"\"\n    rho, u, p = cons_to_prim(U)\n    F = np.zeros_like(U)\n    F[..., 0] = rho * u\n    F[..., 1] = rho * u**2 + p\n    F[..., 2] = u * (U[..., 2] + p)\n    return F\n\ndef hlle_flux(U_L, U_R):\n    \"\"\"Computes the HLLE flux at interfaces.\"\"\"\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n\n    a_L = np.sqrt(GAMMA * p_L / rho_L)\n    a_R = np.sqrt(GAMMA * p_R / rho_R)\n\n    S_L = np.minimum(u_L - a_L, u_R - a_R)\n    S_R = np.maximum(u_L + a_L, u_R + a_R)\n\n    F_L = get_physical_flux_from_cons(U_L)\n    F_R = get_physical_flux_from_cons(U_R)\n    \n    # Numerator of the intermediate HLLE flux state\n    F_hlle_num = (S_R[:, None] * F_L - S_L[:, None] * F_R +\n                  S_L[:, None] * S_R[:, None] * (U_R - U_L))\n    F_hlle_den = S_R - S_L\n    \n    F_hlle = F_hlle_num / (F_hlle_den[:, None] + 1e-12)\n\n    flux = np.zeros_like(U_L)\n    \n    cond_L_region = S_L >= 0\n    cond_R_region = S_R = 0\n    cond_HLL_region = ~(cond_L_region | cond_R_region)\n    \n    flux = np.where(cond_L_region[:, None], F_L, flux)\n    flux = np.where(cond_R_region[:, None], F_R, flux)\n    flux = np.where(cond_HLL_region[:, None], F_hlle, flux)\n    \n    return flux\n\ndef hllc_flux(U_L, U_R):\n    \"\"\"Computes the HLLC flux at interfaces.\"\"\"\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n\n    a_L = np.sqrt(GAMMA * p_L / rho_L)\n    a_R = np.sqrt(GAMMA * p_R / rho_R)\n\n    S_L = np.minimum(u_L - a_L, u_R - a_R)\n    S_R = np.maximum(u_L + a_L, u_R + a_R)\n\n    S_star_num = (p_R - p_L + rho_L * u_L * (S_L - u_L) - rho_R * u_R * (S_R - u_R))\n    S_star_den = (rho_L * (S_L - u_L) - rho_R * (S_R - u_R))\n    S_star = S_star_num / (S_star_den + 1e-12)\n\n    F_L = get_physical_flux_from_cons(U_L)\n    F_R = get_physical_flux_from_cons(U_R)\n    \n    flux = np.zeros_like(U_L)\n\n    # Conditions based on interface location relative to waves\n    cond_L_region = S_L >= 0\n    cond_R_region = S_R = 0\n    cond_L_star_region = (S_L  0)  (S_star >= 0)\n    cond_R_star_region = (S_R > 0)  (S_star  0)\n\n    # Flux in L region\n    flux = np.where(cond_L_region[:, None], F_L, flux)\n    # Flux in R region\n    flux = np.where(cond_R_region[:, None], F_R, flux)\n\n    if np.any(cond_L_star_region):\n        fact = rho_L * (S_L - u_L) / (S_L - S_star)\n        U_star_L = np.zeros_like(U_L)\n        U_star_L[:, 0] = fact\n        U_star_L[:, 1] = fact * S_star\n        E_L = U_L[:, 2]\n        term_E = (S_star - u_L) * (S_star + p_L / (rho_L * (S_L - u_L) + 1e-12))\n        U_star_L[:, 2] = fact * (E_L / rho_L + term_E)\n        F_star_L = F_L + S_L[:, None] * (U_star_L - U_L)\n        flux = np.where(cond_L_star_region[:, None], F_star_L, flux)\n        \n    if np.any(cond_R_star_region):\n        fact = rho_R * (S_R - u_R) / (S_R - S_star)\n        U_star_R = np.zeros_like(U_R)\n        U_star_R[:, 0] = fact\n        U_star_R[:, 1] = fact * S_star\n        E_R = U_R[:, 2]\n        term_E = (S_star - u_R) * (S_star + p_R / (rho_R * (S_R - u_R) + 1e-12))\n        U_star_R[:, 2] = fact * (E_R / rho_R + term_E)\n        F_star_R = F_R + S_R[:, None] * (U_star_R - U_R)\n        flux = np.where(cond_R_star_region[:, None], F_star_R, flux)\n\n    return flux\n\ndef run_simulation(N, solver_type, CFL, t_end):\n    \"\"\"Main simulation driver.\"\"\"\n    dx = 1.0 / N\n    x = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n    \n    rho_low, rho_high = 1.0, 2.0\n    p0, u0 = 1.0, 1.0\n\n    rho = np.full(N, rho_low)\n    rho[x  0.5] = rho_high\n    u = np.full(N, u0)\n    p = np.full(N, p0)\n\n    U = prim_to_cons(rho, u, p)\n\n    flux_func = hlle_flux if solver_type == 'HLLE' else hllc_flux\n\n    t = 0.0\n    while t  t_end:\n        rho_n, u_n, p_n = cons_to_prim(U)\n        a_n = np.sqrt(GAMMA * p_n / rho_n)\n        max_speed = np.max(np.abs(u_n) + a_n)\n        dt = CFL * dx / max_speed\n        if t + dt > t_end:\n            dt = t_end - t\n\n        U_L = U\n        U_R = np.roll(U, -1, axis=0)\n        \n        fluxes = flux_func(U_L, U_R)\n        fluxes_L = np.roll(fluxes, 1, axis=0)\n        \n        U = U - (dt / dx) * (fluxes - fluxes_L)\n        \n        t += dt\n\n    final_rho = U[:, 0]\n    return calculate_thickness(final_rho, rho_low, rho_high)\n\ndef calculate_thickness(rho, rho_low, rho_high):\n    \"\"\"Calculates the average thickness of contact discontinuities.\"\"\"\n    q = (rho - rho_low) / (rho_high - rho_low)\n    q = np.clip(q, 0, 1)\n    \n    is_transitional = (q > 0.1)  (q  0.9)\n    total_cells = np.sum(is_transitional)\n    \n    if total_cells == 0:\n        return 0\n\n    is_transitional_shifted = np.roll(is_transitional, 1)\n    num_segments = np.sum(is_transitional  ~is_transitional_shifted)\n\n    if num_segments == 0:\n        return total_cells if total_cells > 0 else 0\n\n    avg_thickness = total_cells / num_segments\n    return int(round(avg_thickness))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [64, 128, 256]\n    CFL = 0.4\n    t_end = 1.0\n\n    results = []\n    for N in test_cases:\n        thickness_hlle = run_simulation(N, 'HLLE', CFL, t_end)\n        thickness_hllc = run_simulation(N, 'HLLC', CFL, t_end)\n        results.append([thickness_hlle, thickness_hllc])\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3539851"}]}