{"hands_on_practices": [{"introduction": "本练习将指导您完成一次直接计算，将一组给定的守恒变量——质量密度、动量密度和总能量密度——转换为对应的基本变量，特别是压力和声速。这个基本流程是许多流体动力学程序的基础，通过将守恒量与更直观的基本状态联系起来，它能巩固您对守恒量物理意义的理解。", "problem": "考虑一个由欧拉方程描述的三维牛顿可压缩理想气体。守恒变量为质量密度、动量密度矢量和总能量密度，记为 $U = (\\rho, \\mathbf{m}, E)$。原始变量为质量密度、速度矢量和压力，记为 $(\\rho, \\mathbf{v}, p)$。对于绝热指数为 $\\gamma$ 的理想气体，单位质量的内能 $e$ 和压力 $p$ 通过理想气体闭合关系相关联。绝热声速 $c_{s}$ 是通过对方程在均匀状态附近进行线性化，由局部热力学状态确定。\n\n给定数值状态\n$$\n\\rho = 3.0 \\times 10^{-19}, \\quad \\mathbf{m} = \\left(6.0 \\times 10^{-15},\\,-4.0 \\times 10^{-15},\\,2.0 \\times 10^{-15}\\right), \\quad E = 6.0 \\times 10^{-10},\n$$\n以及绝热指数\n$$\n\\gamma = \\frac{5}{3}.\n$$\n所有量均采用国际单位制 (SI)：$\\rho$ 的单位是 $\\mathrm{kg\\,m^{-3}}$，$\\mathbf{m}$ 的单位是 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$， $E$ 的单位是 $\\mathrm{J\\,m^{-3}}$。理想气体闭合关系以及守恒变量和原始变量的标准定义均适用。\n\n任务：\n- 从守恒律中 $U$ 的定义以及 $e$ 和 $p$ 之间的理想气体闭合关系出发，进行反演以求得给定状态下的压力 $p$ 和绝热声速 $c_{s}$。\n- 显式计算 $p$ 和 $c_{s}$，并验证正值性和可采纳性条件，包括 $p > 0$，$\\rho > 0$ 和 $c_{s}^{2} \\ge 0$；评论总能量密度相对于动能密度为满足可采纳性所需的必要条件。\n- 将 $p$ 以帕斯卡 (Pascal) 表示，$c_{s}$ 以 $\\mathrm{km\\,s^{-1}}$ 表示，并将每个值四舍五入到四位有效数字。\n\n你最终报告的答案必须是数对 $(p, c_{s})$。", "solution": "该问题要求对于一个由可压缩理想气体的欧拉方程描述的状态，将守恒变量转换为原始变量。我们已知守恒状态矢量 $U = (\\rho, \\mathbf{m}, E)$ 和绝热指数 $\\gamma$，任务是求出压力 $p$ 和绝热声速 $c_s$。\n\n守恒变量是质量密度 $\\rho$、动量密度矢量 $\\mathbf{m}$ 和总能量密度 $E$。原始变量是质量密度 $\\rho$、流体速度矢量 $\\mathbf{v}$ 和压力 $p$。这两组变量之间的关系定义如下：\n1.  质量密度 $\\rho$ 在两组变量中是共同的。\n2.  动量密度定义为 $\\mathbf{m} = \\rho \\mathbf{v}$。\n3.  总能量密度 $E$ 是动能密度和内能密度之和：$E = E_{\\text{kin}} + E_{\\text{int}}$。\n    动能密度由 $E_{\\text{kin}} = \\frac{1}{2}\\rho |\\mathbf{v}|^2$ 给出。\n    内能密度由 $E_{\\text{int}} = \\rho e$ 给出，其中 $e$ 是比内能（单位质量的内能）。\n\n对于理想气体，压力 $p$ 通过状态方程与内能密度相关：\n$p = (\\gamma - 1) E_{\\text{int}} = (\\gamma - 1) \\rho e$。\n\n我们的第一步是用给定的守恒量来表示压力 $p$。根据动量密度的定义，速度为 $\\mathbf{v} = \\frac{\\mathbf{m}}{\\rho}$。将此代入动能密度的表达式中，得到：\n$$\nE_{\\text{kin}} = \\frac{1}{2}\\rho \\left|\\frac{\\mathbf{m}}{\\rho}\\right|^2 = \\frac{1}{2}\\rho \\frac{|\\mathbf{m}|^2}{\\rho^2} = \\frac{|\\mathbf{m}|^2}{2\\rho}\n$$\n然后，可以通过从总能量密度中减去动能密度来求得内能密度：\n$$\nE_{\\text{int}} = E - E_{\\text{kin}} = E - \\frac{|\\mathbf{m}|^2}{2\\rho}\n$$\n现在，我们可以使用理想气体状态方程来求出压力：\n$$\np = (\\gamma - 1) E_{\\text{int}} = (\\gamma - 1) \\left(E - \\frac{|\\mathbf{m}|^2}{2\\rho}\\right)\n$$\n这个方程使我们能够从给定的守恒变量计算出压力 $p$。\n\n在进行计算之前，我们先讨论物理可采纳性的问题。如果密度和压力都为正值，即 $\\rho > 0$ 和 $p > 0$，则该状态被认为是物理上可采纳的。给定的密度为 $\\rho = 3.0 \\times 10^{-19} \\, \\mathrm{kg\\,m^{-3}}$，是正值。为了使压力为正，由于 $\\gamma = \\frac{5}{3} > 1$，因此 $(\\gamma - 1)$ 项是正的。因此，条件 $p > 0$ 要求内能密度为正，这意味着 $E - \\frac{|\\mathbf{m}|^2}{2\\rho} > 0$。这意味着对总能量密度有一个必要条件：它必须严格大于动能密度，即 $E > E_{\\text{kin}}$。\n\n我们现在进行数值计算。给定的值为：\n$\\rho = 3.0 \\times 10^{-19}$\n$\\mathbf{m} = \\left(6.0 \\times 10^{-15},\\,-4.0 \\times 10^{-15},\\,2.0 \\times 10^{-15}\\right)$\n$E = 6.0 \\times 10^{-10}$\n$\\gamma = \\frac{5}{3}$\n\n首先，我们计算动量密度矢量的模的平方：\n$$\n|\\mathbf{m}|^2 = (6.0 \\times 10^{-15})^2 + (-4.0 \\times 10^{-15})^2 + (2.0 \\times 10^{-15})^2\n$$\n$$\n|\\mathbf{m}|^2 = (36 \\times 10^{-30}) + (16 \\times 10^{-30}) + (4.0 \\times 10^{-30}) = (36 + 16 + 4) \\times 10^{-30} = 56 \\times 10^{-30} = 5.6 \\times 10^{-29}\n$$\n单位是 $(\\mathrm{kg\\,m^{-2}\\,s^{-1}})^2$。\n\n接下来，我们计算动能密度：\n$$\nE_{\\text{kin}} = \\frac{|\\mathbf{m}|^2}{2\\rho} = \\frac{5.6 \\times 10^{-29}}{2 \\times (3.0 \\times 10^{-19})} = \\frac{5.6}{6.0} \\times 10^{-10} = \\frac{14}{15} \\times 10^{-10} \\approx 0.9333 \\times 10^{-10} \\, \\mathrm{J\\,m^{-3}}\n$$\n我们检查可采纳性条件：$E = 6.0 \\times 10^{-10}$ 且 $E_{\\text{kin}} \\approx 0.9333 \\times 10^{-10}$。由于 $E > E_{\\text{kin}}$，压力将为正值，该状态是物理上可采纳的。\n\n现在我们计算压力 $p$：\n$$\np = \\left(\\frac{5}{3} - 1\\right) \\left(6.0 \\times 10^{-10} - \\frac{14}{15} \\times 10^{-10}\\right)\n$$\n$$\np = \\frac{2}{3} \\left(6.0 - \\frac{14}{15}\\right) \\times 10^{-10} = \\frac{2}{3} \\left(\\frac{90 - 14}{15}\\right) \\times 10^{-10} = \\frac{2}{3} \\left(\\frac{76}{15}\\right) \\times 10^{-10}\n$$\n$$\np = \\frac{152}{45} \\times 10^{-10} \\approx 3.3777... \\times 10^{-10} \\, \\mathrm{Pa}\n$$\n四舍五入到四位有效数字，我们得到 $p = 3.378 \\times 10^{-10} \\, \\mathrm{Pa}$。\n\n接下来，我们计算绝热声速 $c_s$。对于理想气体，声速的平方由以下公式给出：\n$$\nc_s^2 = \\frac{\\gamma p}{\\rho}\n$$\n可采纳性要求 $c_s^2 \\ge 0$。由于 $\\gamma > 0$、$\\rho > 0$，并且我们已经求得 $p > 0$，所以这个条件是满足的。\n代入 $\\gamma$、$p$ 和 $\\rho$ 的值：\n$$\nc_s^2 = \\frac{\\frac{5}{3} \\times \\left(\\frac{152}{45} \\times 10^{-10}\\right)}{3.0 \\times 10^{-19}} = \\frac{5 \\times 152}{3 \\times 45 \\times 3.0} \\times 10^9 = \\frac{760}{405} \\times 10^9 = \\frac{152}{81} \\times 10^9\n$$\n$c_s^2 \\approx 1.87654... \\times 10^9 \\, (\\mathrm{m/s})^2$。\n\n声速 $c_s$ 是这个值的平方根：\n$$\nc_s = \\sqrt{\\frac{152}{81} \\times 10^9} \\approx \\sqrt{1.87654... \\times 10^9} \\approx 43319.086... \\, \\mathrm{m\\,s^{-1}}\n$$\n问题要求 $c_s$ 的单位是 $\\mathrm{km\\,s^{-1}}$。\n$$\nc_s \\approx 43.319086... \\, \\mathrm{km\\,s^{-1}}\n$$\n四舍五入到四位有效数字，我们得到 $c_s = 43.32 \\, \\mathrm{km\\,s^{-1}}$。\n\n最终答案是数对 $(p, c_s)$，其中 $p$ 的单位是帕斯卡 (Pascals)，$c_s$ 的单位是 $\\mathrm{km\\,s^{-1}}$，并四舍五入到四位有效数字。\n$p \\approx 3.378 \\times 10^{-10} \\, \\mathrm{Pa}$\n$c_s \\approx 43.32 \\, \\mathrm{km\\,s^{-1}}$", "answer": "$$\n\\boxed{\\begin{pmatrix} 3.378 \\times 10^{-10} & 43.32 \\end{pmatrix}}\n$$", "id": "3530060"}, {"introduction": "尽管代数转换看似简单，但在动能远超内能的情况下，其数值实现可能会遭遇灾难性的失败。本练习 [@problem_id:3530106] 提供了一个关于“总能量灾难”的具体例子，要求您通过两种不同途径（其一从总能量，其二从一个被平流输运的熵示踪量）计算压力，并分析其间的差异。这个实践凸显了在计算天体物理学中，开发数值稳健方法的重要性。", "problem": "考虑一个由欧拉方程和理想气体状态方程（EOS）控制的三维可压缩流体，其绝热指数为 $\\gamma = \\frac{5}{3}$。守恒状态向量经过擴充，包含了一个平流熵示踪剂，因此存储的变量为\n$$\n\\boldsymbol{U} = \\left( \\rho,\\, \\rho v_{x},\\, \\rho v_{y},\\, \\rho v_{z},\\, E,\\, S \\right),\n$$\n其中 $\\rho$ 是质量密度，$\\rho \\boldsymbol{v}$ 是动量密度，$E$ 是总能量密度，$S$ 是一个与理想气体热力学一致、源自熵的标量示踪剂。示踪剂 $S$ 由单位质量比熵 $s$ 通过理想气体基本关系式 $s/c_{v} = \\ln(p) - \\gamma \\ln(\\rho) + \\text{constant}$ 构建，其中 $c_{v}$ 是定容比热。该示踪剂经过归一化，使得 $S = p \\rho^{-\\gamma}$ 在光滑绝热流中对应于 $S = p \\rho^{-\\gamma}$。\n\n给定以下高马赫数测试状态（以无量纲代码单位表示）：\n$$\n\\rho = 1,\\quad \\rho v_{x} = 100,\\quad \\rho v_{y} = 0,\\quad \\rho v_{z} = 0,\\quad E = 5004.0,\\quad S = 3.0.\n$$\n\n仅使用基本定义和理想气体状态方程，通过两种方式计算压力 $p$：\n1. 从熵示踪剂 $S$ 和密度 $\\rho$ 计算。\n2. 从总能量 $E$ 和动量 $\\rho \\boldsymbol{v}$ 的反演计算。\n\n然后，将两种压力之间的相对差异量化为\n$$\n\\delta = \\frac{|p_{S} - p_{E}|}{p_{S}},\n$$\n其中，$p_{S}$ 是从 $S$ 和 $\\rho$ 重构的压力，$p_{E}$ 是通过总能量反演获得的压力。将您的最终值 $\\delta$ 四舍五入到四位有效数字。此外，请根据第一性原理推断和数值稳定性考量，解释对于此状态应接受哪个压力值及其原因，但最终答案中只提供 $\\delta$ 的数值。", "solution": "该问题要求使用两种不同的方法从给定的守恒状态向量计算压力，然后比较结果并对其有效性进行严格评估。流体由欧拉方程和理想气体状态方程控制。\n\n给定的守恒状态向量为 $\\boldsymbol{U} = \\left( \\rho, \\rho v_{x}, \\rho v_{y}, \\rho v_{z}, E, S \\right)$。给定的无量纲代码单位值为：\n- 质量密度：$\\rho = 1$\n- 动量密度：$\\rho v_{x} = 100$, $\\rho v_{y} = 0$, $\\rho v_{z} = 0$\n- 总能量密度：$E = 5004.0$\n- 熵示踪剂：$S = 3.0$\n绝热指数给定为 $\\gamma = \\frac{5}{3}$。\n\n首先，我们将使用熵示踪剂 $S$ 计算压力 $p_S$。问题陈述，该示踪剂经过归一化，使得 $S = p \\rho^{-\\gamma}$，其中 $p$ 是压力。将此表达式重新整理以求解 $p$ 可得：\n$$\np_{S} = S \\rho^{\\gamma}\n$$\n代入给定的值 $\\rho = 1$ 和 $S = 3.0$，并使用 $\\gamma = \\frac{5}{3}$：\n$$\np_{S} = (3.0) \\times (1)^{\\frac{5}{3}} = 3.0\n$$\n\n其次，我们将通过反演总能量密度 $E$ 来计算压力 $p_E$。总能量密度是动能密度和内能密度 $e$ 的总和：\n$$\nE = \\frac{1}{2}\\rho v^2 + e\n$$\n其中 $v^2 = v_x^2 + v_y^2 + v_z^2$ 是流体速度大小的平方。对于理想气体，内能密度与压力之间的关系为：\n$$\ne = \\frac{p}{\\gamma - 1}\n$$\n结合这两个方程，我们可以用 $E$、$\\rho$ 和 $\\boldsymbol{v}$ 来表示压力：\n$$\np_{E} = (\\gamma - 1) \\left( E - \\frac{1}{2}\\rho v^2 \\right)\n$$\n为使用此公式，我们首先需要从给定的质量密度和动量密度计算速度分量：\n$$\nv_x = \\frac{\\rho v_x}{\\rho} = \\frac{100}{1} = 100\n$$\n$$\nv_y = \\frac{\\rho v_y}{\\rho} = \\frac{0}{1} = 0\n$$\n$$\nv_z = \\frac{\\rho v_z}{\\rho} = \\frac{0}{1} = 0\n$$\n速度大小的平方为 $v^2 = 100^2 + 0^2 + 0^2 = 10000$。\n因此，动能密度为：\n$$\nE_{\\text{kin}} = \\frac{1}{2}\\rho v^2 = \\frac{1}{2} \\times 1 \\times 10000 = 5000\n$$\n现在，我们通过从总能量密度中减去动能密度来求得内能密度：\n$$\ne = E - E_{\\text{kin}} = 5004.0 - 5000 = 4.0\n$$\n最后，我们使用理想气体关系式计算压力 $p_E$。当 $\\gamma = \\frac{5}{3}$ 时，项 $(\\gamma - 1)$ 为 $(\\frac{5}{3} - 1) = \\frac{2}{3}$。\n$$\np_{E} = e(\\gamma - 1) = 4.0 \\times \\frac{2}{3} = \\frac{8.0}{3}\n$$\n\n第三，我们计算两个压力值之间的相对差异 $\\delta$：\n$$\n\\delta = \\frac{|p_{S} - p_{E}|}{p_{S}}\n$$\n代入计算出的值 $p_S = 3.0$ 和 $p_E = \\frac{8.0}{3}$：\n$$\n\\delta = \\frac{\\left| 3.0 - \\frac{8.0}{3} \\right|}{3.0} = \\frac{\\left| \\frac{9.0}{3} - \\frac{8.0}{3} \\right|}{3.0} = \\frac{\\frac{1.0}{3}}{3.0} = \\frac{1}{9}\n$$\n写成小数形式，$\\delta = 0.1111\\overline{1}$。四舍五入到四位有效数字，得到 $\\delta = 0.1111$。\n\n最后，我们必须确定对于此状态应接受哪个压力值，$p_S$ 还是 $p_E$。$p_S$ 和 $p_E$ 之间的差异揭示了在理想气体模型下解释所提供的状态向量 $\\boldsymbol{U}$ 时存在的内部不一致性。这种不一致性在数值模拟中很常见，原因是离散化和浮点运算误差。问题的核心是确定哪种计算方法更为鲁棒。\n\n$p_E$ 的计算涉及两个大数相减以得到一个小数：$e = E - E_{\\text{kin}} = 5004.0 - 5000$。流体显然处于高马赫数区域，其中动能（$E_{\\text{kin}} = 5000$）远大于内能（$e \\approx 4.0$）。在浮点运算中，这种减法会受到灾难性抵消的影响，可能导致 $e$ 的结果出现严重的相对精度损失。$E$ 或 $E_{\\text{kin}}$ 中一个微小的误差（源于它们的存储方式或数值演化过程）都可能转化为 $e$ 中一个非常大的相对误差，并因此导致 $p_E$ 的巨大误差。这是计算流体力学中一个众所周知的问题，通常被称为“总能量灾难”。\n\n相比之下，$p_S$ 的计算使用公式 $p_S = S \\rho^{\\gamma}$。量 $S$ 和 $\\rho$ 是平流标量。对于给定状态，它们是数量级为 1 的数（$S=3.0$，$\\rho=1$）。计算仅涉及对这些性质良好的值进行乘法和求幂运算，这个过程是数值稳定的，不易发生灾难性抵消。\n\n因此，对于像这样的高马赫数状态，从熵示踪剂导出的压力 $p_S$ 远比从总能量导出的压力 $p_E$ 更可靠、数值上更鲁棒。现代天体物理学代码为此经常采用“双能”格式：它们同时演化 $E$ 和一个类熵变量，在高度超音速区域使用后者计算压力，以避免与总能量公式相关的精度问题。因此，压力值 $p_S = 3.0$ 应被接受为对此物理状态更准确的表示。状态向量中的值 $E = 5004.0$ 与其他变量不一致，因为一个一致的总能量应该是 $E' = E_{\\text{kin}} + \\frac{p_S}{\\gamma - 1} = 5000 + \\frac{3.0}{2/3} = 5000 + 4.5 = 5004.5$。给定的 $E$ 偏离了大约 $0.01\\%$，但这个小误差导致计算出的压力 $p_E$ 出现超过 $11\\%$ 的误差。", "answer": "$$\n\\boxed{0.1111}\n$$", "id": "3530106"}, {"introduction": "现在我们进入计算天体物理学的前沿领域：狭义相对论磁流体力学（SRMHD）。在这里，物质、场与时空几何之间的耦合，使得从守恒量到基本量的转换成为一个非平凡的求根问题。这个高级练习 [@problem_id:3530073] 将挑战您从第一性原理出发，推导整个反演方案，最终得到一个标量方程，其解能够解锁所有的基本量。这项实践对于开发能够模拟宇宙中最剧烈事件的现代程序至关重要。", "problem": "你的任务是在计算天体物理学领域内，设计并实现一个完整的算法以及一个可运行的程序，用于在理想相对论磁流体力学中将守恒变量反演为原始变量。推导和算法必须仅从基本定义和定律出发，不得依赖任何预先给定的简化公式。目标是为一个约化变量（例如 $\\hat{W} = \\rho h W^2$）推导出一个标量求根方程，该方程可被求解以恢复流体压力 $p$、洛伦兹因子 $W$ 和三维速度 $v^i$，并指定能够一致地计算磁四维矢量 $b^\\mu$ 的计算步骤。使用几何化单位制，其中光速设为 $c = 1$。\n\n从以下基础出发：\n- 流体四维速度 $u^\\mu$ 满足 $u^\\mu u_\\mu = -1$。\n- 流体静止系中的电磁场由磁四维矢量 $b^\\mu$ 表示，在理想磁流体力学条件下，流体静止系中的电场为零。\n- 理想相对论磁流体力学（狭义相对论磁流体力学，SRMHD）的能动量张量为\n$$\nT^{\\mu\\nu} = (\\rho h + b^2) u^\\mu u^\\nu + \\left(p + \\frac{b^2}{2}\\right) g^{\\mu\\nu} - b^\\mu b^\\nu,\n$$\n其中 $\\rho$ 是静止质量密度，$p$ 是流体压力，$h$ 是比焓，$b^2 \\equiv b^\\mu b_\\mu$，$g^{\\mu\\nu}$ 是时空度规。对于程序和测试套件，使用号差为 $(-,+,+,+)$ 的 Minkowski 度规，垂直函数 $\\alpha = 1$，移位矢量 $\\beta^i = 0$，空间度规 $\\gamma_{ij} = \\delta_{ij}$。在这种情况下，空间指标可通过 $\\delta_{ij}$ 升降，且空间点积为欧几里得点积。\n- Valencia 形式的守恒变量是通过将 $T^{\\mu\\nu}$ 和 $u^\\mu$ 投影到 Eulerian 观测者上构造的。定义：\n    - 质量密度 $D \\equiv \\rho W$，其中 $W \\equiv u^0$ 是洛伦兹因子，$v^i \\equiv u^i / W$ 是三维速度。\n    - 动量密度 $S_i \\equiv T^{0}{}_i$。\n    - 能量变量 $\\tau \\equiv T^{00} - D$。\n    - 在 Eulerian 坐标系中测量的磁场三维矢量 $B^i$。\n- 使用绝热指数为 $\\Gamma$ 的理想气体状态方程，即 $p = (\\Gamma - 1) \\rho \\epsilon$，其中 $\\epsilon$ 是比内能，且 $h = 1 + \\epsilon + p/\\rho$。\n\n你的任务是：\n1. 从上述基础和定义出发，推导出一个关于约化变量 $\\hat{W} \\equiv \\rho h W^2$ 的单一标量求根方程，该方程用守恒变量 $U \\equiv (D, S_i, \\tau, B^i)$ 和度规表示。该方程必须可以求解 $\\hat{W}$，并在求解后能够得到 $p$，$W$ 和 $v^i$。\n2. 指定从恢复的原始变量出发，使用指定的度规，一致地计算磁四维矢量 $b^\\mu$ 的计算步骤。\n3. 实现一个程序，该程序：\n    - 对于每个给定的原始变量测试用例 $(\\rho, p, v^i, B^i, \\Gamma)$，使用所述的 Minkowski 度规计算相应的守恒变量 $(D, S_i, \\tau, B^i)$。\n    - 通过求解你推导出的关于 $\\hat{W}$ 的标量求根方程，然后计算 $p$，$W$ 和 $v^i$，将 $(D, S_i, \\tau, B^i)$ 反演回原始变量。从恢复的原始变量一致地计算 $b^\\mu$。\n    - 将恢复的 $(p, W, v^i)$ 和 $b^\\mu$ 与原始输入进行比较，并返回一个布尔值，指示所有恢复的量是否与原始量在严格的容差 $10^{-9}$ 内匹配。对于标量分量，此容差为绝对差；对于空间矢量，此容差为欧几里得范数差。问题中不出现角度；在 $c=1$ 的单位选择下，所有量都是无量纲的。\n4. 最终的程序输出必须是单行，包含一个用方括号括起来的逗号分隔的布尔值列表，每个测试用例对应一个布尔值，表示该测试用例是否通过了所有检查，例如 $[{\\rm True},{\\rm False},\\dots]$。\n\n测试套件：\n- 测试用例 1 (通用、非简并配置)：\n    - $\\rho = 1.0$, $p = 0.1$, $\\Gamma = \\frac{4}{3}$, $v^i = (0.2, -0.1, 0.05)$, $B^i = (0.3, 0.4, -0.2)$。\n- 测试用例 2 (磁场与速度对齐，中等磁化强度)：\n    - $\\rho = 0.8$, $p = 0.05$, $\\Gamma = \\frac{5}{3}$, $v^i = (0.4, 0.0, 0.0)$, $B^i = (0.8, 0.0, 0.0)$。\n- 测试用例 3 (近相对论速度，弱磁化强度)：\n    - $\\rho = 1.0$, $p = 0.01$, $\\Gamma = \\frac{5}{3}$, $v^i = (0.5, 0.7, 0.2)$ 缩放使其 $|v| = 0.95$ (欧几里得范数), $B^i = (0.001, -0.002, 0.001)$。\n- 测试用例 4 (强磁化强度，小压力，低速)：\n    - $\\rho = 2.0$, $p = 0.001$, $\\Gamma = \\frac{4}{3}$, $v^i = (0.05, -0.03, 0.02)$, $B^i = (5.0, -3.0, 2.0)$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如， $[{\\rm True},{\\rm True},{\\rm True},{\\rm True}]$）。", "solution": "任务是推导并实现一个一致的算法，用于在理想狭义相对论磁流体力学（SRMHD）中将守恒变量转换为原始变量。推导应从基本原理开始。时空由笛卡尔坐标系中的 Minkowski 度规 $g_{\\mu\\nu} = \\text{diag}(-1, 1, 1, 1)$ 描述，对应于垂直函数 $\\alpha=1$、移位矢量 $\\beta^i=0$ 和空间度规 $\\gamma_{ij}=\\delta_{ij}$。我们使用光速 $c=1$ 的几何化单位制。\n\n### 1. Eulerian 坐标系中的基本量\n\n流体四维速度 $u^\\mu$ 被归一化，使得 $u^\\mu u_\\mu = -1$。在 Eulerian（实验室）坐标系中，它通过三维速度 $v^i \\equiv u^i/u^0$ 表示为 $u^\\mu = (W, Wv^i)$，其中 $W \\equiv u^0$ 是洛伦兹因子。归一化条件给出 $g_{\\mu\\nu}u^\\mu u^\\nu = -W^2 + W^2 v_i v^i = -1$，这意味着 $W = (1-v^2)^{-1/2}$，其中 $v^2 \\equiv v_i v^i$。\n\n磁场由磁四维矢量 $b^\\mu$ 描述。在理想 MHD 中，流体静止系中的电场为零。这导致在实验室坐标系中，$b^\\mu$ 的分量可以由实验室坐标系磁场 $B^i$ 和流体三维速度 $v^i$ 表示如下：\n$$\nb^0 = u_i B^i = W (v_k B^k)\n$$\n$$\nb^i = \\frac{B^i}{W} + u^i b^0 = \\frac{B^i}{W} + W v^i (v_k B^k)\n$$\n磁四维矢量与流体四维速度正交，$b^\\mu u_\\mu = 0$。磁四维矢量的模的平方是一个洛伦兹不变量，由下式给出：\n$$\nb^2 \\equiv b^\\mu b_\\mu = -(b^0)^2 + b_i b^i = \\frac{B_k B^k}{W^2} + (v_k B^k)^2\n$$\n让我们定义标量积 $B^2 \\equiv B_k B^k$ 和 $(\\mathbf{v} \\cdot \\mathbf{B}) \\equiv v_k B^k$。那么 $b^2 = B^2/W^2 + (\\mathbf{v} \\cdot \\mathbf{B})^2$。\n\n### 2. 用原始变量表示的守恒变量\n\n守恒变量由能动量张量 $T^{\\mu\\nu}$ 定义。\n$$\nT^{\\mu\\nu} = (\\rho h + b^2) u^\\mu u^\\nu + \\left(p + \\frac{b^2}{2}\\right) g^{\\mu\\nu} - b^\\mu b^\\nu\n$$\n这里，$\\rho$ 是静止质量密度，$p$ 是气体压力，$h$ 是比焓，它们通过理想气体状态方程 $p=(\\Gamma-1)\\rho\\epsilon$ 和 $h = 1+\\epsilon+p/\\rho$ 相关联。这意味着 $\\rho h = \\rho + \\frac{\\Gamma p}{\\Gamma-1}$。\n\n守恒变量是：\n- 质量密度：$D \\equiv \\rho W$。\n- 动量密度：$S_i \\equiv T^{0}{}_i = T^{0i}$。\n- 能量密度：$\\tau \\equiv T^{00} - D$。\n- 磁场：$B^i$，它是被平流的。\n\n让我们用原始变量来表示 $S_i$ 和 $\\tau$。\n对于动量密度 $S_i$：\n$$\nS_i = T^{0i} = (\\rho h + b^2) u^0 u^i + \\left(p + \\frac{b^2}{2}\\right) g^{0i} - b^0 b^i\n$$\n由于 $u^0=W$，$u^i = Wv^i$ 且 $g^{0i}=0$：\n$$\nS_i = (\\rho h + b^2) W^2 v_i - b^0 b_i\n$$\n让我们定义辅助变量 $\\hat{W} \\equiv \\rho h W^2$。\n$$\nS_i = (\\hat{W} + b^2 W^2) v_i - b^0 b_i\n$$\n代入 $b^2$，$b^0$ 和 $b_i$ 的表达式：\n$$\n S_i = (\\hat{W} + B^2 + W^2(\\mathbf{v}\\cdot\\mathbf{B})^2)v_i - W(\\mathbf{v}\\cdot\\mathbf{B}) \\left(\\frac{B_i}{W} + Wv_i(\\mathbf{v}\\cdot\\mathbf{B}) \\right)\n$$\n$$\n S_i = (\\hat{W} + B^2)v_i + W^2(\\mathbf{v}\\cdot\\mathbf{B})^2 v_i - (\\mathbf{v}\\cdot\\mathbf{B})B_i - W^2(\\mathbf{v}\\cdot\\mathbf{B})^2 v_i\n$$\n这可以简化为一个关键方程，将 $S_i$ 与原始变量联系起来：\n$$\nS_i = (\\hat{W} + B^2)v_i - (\\mathbf{v}\\cdot\\mathbf{B})B_i\n$$\n\n对于能量密度 $\\tau$：\n$$\nT^{00} = (\\rho h + b^2)(u^0)^2 + \\left(p + \\frac{b^2}{2}\\right)g^{00} - (b^0)^2 = \\hat{W} + b^2 W^2 - p - \\frac{b^2}{2} - (b^0)^2\n$$\n使用 $b^2 W^2 - (b^0)^2 = B^2$ 和 $b^2 = B^2/W^2 + (\\mathbf{v}\\cdot\\mathbf{B})^2$：\n$$\nT^{00} = \\hat{W} - p + B^2 - \\frac{b^2}{2} = \\hat{W} - p + B^2 - \\frac{1}{2}\\left(\\frac{B^2}{W^2} + (\\mathbf{v}\\cdot\\mathbf{B})^2\\right)\n$$\n使用 $W^{-2} = 1-v^2$，上式变为：\n$$\nT^{00} = \\hat{W} - p + B^2 - \\frac{B^2(1-v^2)}{2} - \\frac{(\\mathbf{v}\\cdot\\mathbf{B})^2}{2} = \\hat{W} - p + \\frac{B^2(1+v^2)}{2} - \\frac{(\\mathbf{v}\\cdot\\mathbf{B})^2}{2}\n$$\n守恒能量变量为 $\\tau = T^{00} - D$。\n\n### 3. $\\hat{W}$ 的标量求根方程的推导\n\n反演过程需要从守恒变量 $(D, S_i, \\tau, B^i)$ 求解原始变量 $(\\rho, p, v^i)$。我们将为辅助变量 $\\hat{W} = \\rho h W^2$ 推导一个单一的标量方程。\n\n从动量方程 $\\mathbf{S} = (\\hat{W} + B^2)\\mathbf{v} - (\\mathbf{v}\\cdot\\mathbf{B})\\mathbf{B}$ 出发，我们可以用 $\\hat{W}$ 和已知的守恒量来表示 $\\mathbf{v}$。令 $S^2 = S_k S^k$ 且 $S_B = S_k B^k$。\n将动量方程与 $\\mathbf{B}$ 做点积：\n$$\nS_B = (\\hat{W} + B^2)(\\mathbf{v}\\cdot\\mathbf{B}) - (\\mathbf{v}\\cdot\\mathbf{B})B^2 = \\hat{W}(\\mathbf{v}\\cdot\\mathbf{B})\n$$\n这得出了一个关于速度-磁场投影的非常简洁的表达式：\n$$\n(\\mathbf{v}\\cdot\\mathbf{B}) = \\frac{S_B}{\\hat{W}}\n$$\n将此结果代回动量方程：\n$$\n\\mathbf{S} = (\\hat{W} + B^2)\\mathbf{v} - \\frac{S_B}{\\hat{W}}\\mathbf{B}\n$$\n解出 $\\mathbf{v}$：\n$$\n\\mathbf{v} = \\frac{\\mathbf{S} + (S_B/\\hat{W})\\mathbf{B}}{\\hat{W}+B^2} = \\frac{\\hat{W}\\mathbf{S} + S_B\\mathbf{B}}{\\hat{W}(\\hat{W}+B^2)}\n$$\n现在我们可以用 $\\hat{W}$ 来表示 $v^2 = \\mathbf{v}\\cdot\\mathbf{v}$：\n$$\nv^2 = \\frac{(\\hat{W}\\mathbf{S} + S_B\\mathbf{B})\\cdot(\\hat{W}\\mathbf{S} + S_B\\mathbf{B})}{\\hat{W}^2(\\hat{W}+B^2)^2} = \\frac{\\hat{W}^2 S^2 + 2\\hat{W}S_B^2 + S_B^2 B^2}{\\hat{W}^2(\\hat{W}+B^2)^2}\n$$\n这使得 $v^2$ 以及其后的 $W=(1-v^2)^{-1/2}$，都成为 $\\hat{W}$ 和已知量的函数。\n\n接下来，我们用 $\\hat{W}$ 来表示压力 $p$。根据理想气体的比焓定义，$\\rho h = \\rho + \\Gamma p / (\\Gamma - 1)$。于是，$\\hat{W} = \\rho h W^2 = \\left(\\rho + \\frac{\\Gamma p}{\\Gamma-1}\\right)W^2$。使用 $D=\\rho W$，我们有 $\\rho = D/W$：\n$$\n\\hat{W} = \\left(\\frac{D}{W} + \\frac{\\Gamma p}{\\Gamma-1}\\right)W^2 = DW + \\frac{\\Gamma p W^2}{\\Gamma-1}\n$$\n解出 $p$：\n$$\np = \\frac{\\Gamma-1}{\\Gamma W^2}(\\hat{W} - DW) = \\frac{\\Gamma-1}{\\Gamma}(1-v^2)(\\hat{W} - D(1-v^2)^{-1/2})\n$$\n现在我们拥有了所有可以代入能量方程 $\\tau = T^{00} - D$ 的分量：\n$$\n\\tau + D = \\hat{W} - p + \\frac{B^2(1+v^2)}{2} - \\frac{(S_B/\\hat{W})^2}{2}\n$$\n代入 $p$ 的表达式：\n$$\n\\tau + D = \\hat{W} - \\frac{\\Gamma-1}{\\Gamma}(1-v^2)\\left(\\hat{W} - \\frac{D}{\\sqrt{1-v^2}}\\right) + \\frac{B^2(1+v^2)}{2} - \\frac{S_B^2}{2\\hat{W}^2}\n$$\n这个方程，我们称之为 $f(\\hat{W}) = 0$，是关于 $\\hat{W}$ 的最终标量方程。其中所有量要么是已知的守恒变量，要么是 $\\hat{W}$ 的函数。\n$$\nf(\\hat{W}) = \\hat{W} - (\\tau+D) - \\frac{\\Gamma-1}{\\Gamma}(1-v^2(\\hat{W}))\\left(\\hat{W} - \\frac{D}{\\sqrt{1-v^2(\\hat{W})}}\\right) + \\frac{B^2(1+v^2(\\hat{W}))}{2} - \\frac{S_B^2}{2\\hat{W}^2} = 0\n$$\n其中 $v^2(\\hat{W})$ 是先前推导出的表达式。这个非线性方程可以使用数值求根算法求解 $\\hat{W}$。注意，对于一个物理上有效的解，必须满足 $\\hat{W} > D$，$p > 0$ 且 $v^2 < 1$。\n\n### 4. 恢复算法\n\n一旦找到根 $\\hat{W}$，原始变量按以下步骤恢复：\n1.  计算 $v^2 = \\frac{\\hat{W}^2 S^2 + S_B^2(2\\hat{W}+B^2)}{\\hat{W}^2(\\hat{W}+B^2)^2}$。\n2.  计算洛伦兹因子 $W = (1-v^2)^{-1/2}$。\n3.  计算三维速度矢量 $v^i = \\frac{\\hat{W}S^i + S_B B^i}{\\hat{W}(\\hat{W}+B^2)}$。\n4.  计算静止质量密度 $\\rho = D/W$。\n5.  计算气体压力 $p = \\frac{\\Gamma-1}{\\Gamma W^2}(\\hat{W} - DW)$。\n\n### 5. 磁四维矢量 $b^\\mu$ 的计算\n\n磁四维矢量 $b^\\mu$ 可以从恢复的原始变量 $(v^i, W)$ 和守恒磁场 $B^i$ 计算得出。计算步骤如下：\n1.  计算标量积 $\\mathbf{v}\\cdot\\mathbf{B} = v_k B^k$。\n2.  计算时间分量 $b^0 = W(\\mathbf{v}\\cdot\\mathbf{B})$。\n3.  计算空间分量 $b^i = \\frac{B^i}{W} + W v^i (\\mathbf{v}\\cdot\\mathbf{B})$。\n得到的四维矢量是 $b^\\mu = (b^0, b^i)$。它与恢复的原始变量一致，并满足 $b^\\mu u_\\mu=0$。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the SRMHD inversion problem for a given set of test cases.\n    \"\"\"\n    # Test case 3 requires scaling the velocity vector\n    v3_raw = np.array([0.5, 0.7, 0.2])\n    v3_norm = np.linalg.norm(v3_raw)\n    v3_scaled = v3_raw * (0.95 / v3_norm)\n\n    test_cases = [\n        # (rho, p, v, B, Gamma)\n        (1.0, 0.1, np.array([0.2, -0.1, 0.05]), np.array([0.3, 0.4, -0.2]), 4.0/3.0),\n        (0.8, 0.05, np.array([0.4, 0.0, 0.0]), np.array([0.8, 0.0, 0.0]), 5.0/3.0),\n        (1.0, 0.01, v3_scaled, np.array([0.001, -0.002, 0.001]), 5.0/3.0),\n        (2.0, 0.001, np.array([0.05, -0.03, 0.02]), np.array([5.0, -3.0, 2.0]), 4.0/3.0),\n    ]\n\n    results = []\n    TOLERANCE = 1e-9\n\n    for case in test_cases:\n        rho, p, v, B, Gamma = case\n\n        # --- 1. Forward conversion (Primitives to Conserved) ---\n        v_sq = np.dot(v, v)\n        W = 1.0 / np.sqrt(1.0 - v_sq)\n        \n        # Calculate specific enthalpy h\n        epsilon = p / ((Gamma - 1.0) * rho)\n        h = 1.0 + epsilon + p / rho\n        \n        # Conserved variables\n        D = rho * W\n        \n        # Auxiliary variable W_hat\n        W_hat_orig = rho * h * W**2\n        \n        # Magnetic field related scalars\n        B_sq = np.dot(B, B)\n        v_dot_B = np.dot(v, B)\n        \n        # Momentum S_i\n        S = (W_hat_orig + B_sq) * v - v_dot_B * B\n        \n        # Energy tau\n        b_sq = B_sq / W**2 + v_dot_B**2\n        T00 = (rho * h + b_sq) * W**2 - (p + 0.5 * b_sq) - (W * v_dot_B)**2\n        tau = T00 - D\n\n        # --- 2. Inversion (Conserved to Primitives) ---\n        \n        # Pre-compute scalars from conserved variables\n        S_sq = np.dot(S, S)\n        S_dot_B = np.dot(S, B)\n        # B_sq is the same as before, B is a conserved variable\n\n        def root_function(W_hat_guess):\n            # Equation for v^2 in terms of W_hat\n            numerator_v_sq = W_hat_guess**2 * S_sq + S_dot_B**2 * (2 * W_hat_guess + B_sq)\n            denominator_v_sq = (W_hat_guess * (W_hat_guess + B_sq))**2\n            \n            # Avoid division by zero, though W_hat > D > 0\n            if abs(denominator_v_sq)  1e-40:\n                return np.inf\n\n            v_sq_rec = numerator_v_sq / denominator_v_sq\n            \n            # Physical constraints\n            if v_sq_rec >= 1.0 or W_hat_guess = D:\n                return np.inf # Return a large value to repel the solver\n            \n            W_rec = 1.0 / np.sqrt(1.0 - v_sq_rec)\n            \n            # Pressure from W_hat\n            p_rec_term = W_hat_guess / W_rec**2 - D / W_rec\n            p_rec = (Gamma - 1.0) / Gamma * p_rec_term\n            \n            # If p becomes negative, unphysical solution\n            if p_rec  0:\n                return np.inf\n\n            # Reconstruct tau from the guess\n            tau_rec = W_hat_guess - p_rec - D + 0.5 * B_sq * (1.0 + v_sq_rec) - 0.5 * S_dot_B**2 / W_hat_guess**2\n            \n            return tau - tau_rec\n\n        # Find a bracketing interval for the root finder\n        # Lower bound: W_hat > D\n        # Upper bound: A generous estimate based on total energy\n        lower_bound = D * (1.0 + 1e-10)\n        upper_bound_factor = 10.0\n        upper_bound = max(tau + D, lower_bound) * upper_bound_factor + B_sq\n        \n        try:\n            W_hat_rec = brentq(root_function, lower_bound, upper_bound, xtol=1e-15, rtol=1e-15)\n        except ValueError:\n            # If brentq fails to find a root in the interval, the case fails\n            results.append(False)\n            continue\n\n        # --- Recovery of primitive variables from W_hat_rec ---\n        v_sq_rec_final = (W_hat_rec**2 * S_sq + S_dot_B**2 * (2 * W_hat_rec + B_sq)) / (W_hat_rec * (W_hat_rec + B_sq))**2\n        W_rec = 1.0 / np.sqrt(1.0 - v_sq_rec_final)\n        v_rec = (W_hat_rec * S + S_dot_B * B) / (W_hat_rec * (W_hat_rec + B_sq))\n        rho_rec = D / W_rec\n        \n        p_rec_term = W_hat_rec / W_rec**2 - D / W_rec\n        p_rec = (Gamma - 1.0) / Gamma * p_rec_term\n\n        # --- 3. Comparison ---\n        \n        # Original b^mu\n        b0_orig = W * v_dot_B\n        b_vec_orig = B / W + W * v * v_dot_B\n\n        # Recovered b^mu\n        v_dot_B_rec = np.dot(v_rec, B)\n        b0_rec = W_rec * v_dot_B_rec\n        b_vec_rec = B / W_rec + W_rec * v_rec * v_dot_B_rec\n\n        # Boolean checks with tolerance\n        check_rho = np.abs(rho - rho_rec)  TOLERANCE\n        check_p = np.abs(p - p_rec)  TOLERANCE\n        check_W = np.abs(W - W_rec)  TOLERANCE\n        check_v = np.linalg.norm(v - v_rec)  TOLERANCE\n        check_b0 = np.abs(b0_orig - b0_rec)  TOLERANCE\n        check_b_vec = np.linalg.norm(b_vec_orig - b_vec_rec)  TOLERANCE\n\n        all_checks_passed = all([check_rho, check_p, check_W, check_v, check_b0, check_b_vec])\n        results.append(all_checks_passed)\n\n    print(f\"[{','.join(map(str, results))}]\".replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3530073"}]}