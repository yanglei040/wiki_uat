{"hands_on_practices": [{"introduction": "在我们能够数值求解欧拉方程之前，我们必须理解其基本的数学结构。这个基础练习 [@problem_id:3513199] 将引导你通过“纸和笔”的推导，揭示决定可压缩流体中信息如何传播的特征波——声波和熵波。掌握这种特征值分解分析是设计Godunov型方法核心的“迎风”格式的必经之路。", "problem": "考虑无粘、可压缩理想气体的一维欧拉方程，写为质量、动量和能量的守恒形式。引入原始变量向量 $W = (\\rho, u, p)^{\\top}$，其中 $\\rho$ 是质量密度，$u$ 是流体速度，$p$ 是气体压力。假设气体是热力学和量热学完美的，绝热指数 $\\gamma  1$。在用于双曲守恒律的Godunov型有限体积方法的背景下，准线性原始变量形式\n$$\n\\frac{\\partial W}{\\partial t} + B(W)\\,\\frac{\\partial W}{\\partial x} = 0\n$$\n的局部特征结构决定了在单元界面处黎曼问题中出现的波族。\n\n从守恒律和理想气体闭合关系出发，推导原始变量下的准线性矩阵 $B(W)$，计算其特征值和一组相应的右特征向量，并将每个波族与一个物理模式联系起来。你可以使用经过充分检验的理想气体绝热声速 $c(W)$ 的热力学关系式 $c^{2} = \\gamma p / \\rho$，但需要在推导中证明其作用。\n\n说明：\n- 从第一性原理推导 $B(W)$，然后计算 $B(W)$ 的所有特征值和一组完整的线性无关右特征向量。\n- 将右特征向量归一化，使得每个特征向量的第一个分量（$\\rho$ 分量）等于 $1$。\n- 根据与黎曼问题和Godunov型迎风格式相关的物理波传播，解释哪些特征对对应于声学模式，哪些对应于熵（接触）模式，包括每种模式如何平流或耦合 $(\\rho, u, p)$。\n\n答案规格：\n- 以单一闭式解析表达式的形式，提供你的最终特征值和右特征向量矩阵。\n- 使用符号 $\\rho$、 $u$、 $p$、 $\\gamma$ 和 $c$，其中 $c^{2} = \\gamma p / \\rho$。不需要进行数值计算。\n- 最终答案不得包含任何解释性文本或单位。将多个答案表示为一个行矩阵，其第一个条目是 $1 \\times 3$ 的特征值行向量，第二个条目是 $3 \\times 3$ 的右特征向量矩阵，其列的顺序与特征值一致。", "solution": "该问题要求推导一维欧拉方程的准线性原始变量形式，并计算系统矩阵的特征值和特征向量。这种特征分析对于理解可压缩流体中的波传播至关重要，并构成了Godunov型数值方法的基础。\n\n无粘、可压缩气体的一维欧拉方程的守恒形式为：\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\n其中 $U$ 是守恒变量向量，$F(U)$ 是通量向量：\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ (E+p)u \\end{pmatrix}\n$$\n这里，$\\rho$ 是质量密度，$u$ 是流体速度，$p$ 是压力，$E$ 是单位体积的总能量。对于量热学完美的理想气体，总能量由 $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2$ 给出，其中 $\\gamma$ 是绝热指数。原始变量由向量 $W = (\\rho, u, p)^{\\top}$ 给出。\n\n我们的目标是将该系统转换为准线性形式 $\\frac{\\partial W}{\\partial t} + B(W)\\frac{\\partial W}{\\partial x} = 0$。我们通过展开守恒方程中的导数并用原始变量的导数重新表达它们来实现这一目标。\n\n1.  **质量守恒方程：**\n    $$\n    \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0\n    $$\n    对空间导数应用乘法法则得到：\n    $$\n    \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0\n    $$\n    该方程提供了我们原始变量系统的第一行。\n\n2.  **动量守恒方程：**\n    $$\n    \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 0\n    $$\n    展开导数：\n    $$\n    \\rho\\frac{\\partial u}{\\partial t} + u\\frac{\\partial \\rho}{\\partial t} + u^2 \\frac{\\partial \\rho}{\\partial x} + 2\\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0\n    $$\n    我们从质量方程中代入 $\\frac{\\partial \\rho}{\\partial t}$：\n    $$\n    \\rho\\frac{\\partial u}{\\partial t} + u\\left(-u \\frac{\\partial \\rho}{\\partial x} - \\rho \\frac{\\partial u}{\\partial x}\\right) + u^2 \\frac{\\partial \\rho}{\\partial x} + 2\\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0\n    $$\n    简化表达式：\n    $$\n    \\rho\\frac{\\partial u}{\\partial t} - u^2 \\frac{\\partial \\rho}{\\partial x} - \\rho u \\frac{\\partial u}{\\partial x} + u^2 \\frac{\\partial \\rho}{\\partial x} + 2\\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0\n    $$\n    $$\n    \\rho\\frac{\\partial u}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0\n    $$\n    除以 $\\rho$ (因为 $\\rho  0$)：\n    $$\n    \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} = 0\n    $$\n    这是我们系统的第二行。\n\n3.  **能量守恒方程：**\n    与其直接处理繁琐的能量方程，我们可以使用流体微元的第一热力学定律，对于无粘、非导热流动，该定律表明熵沿着流体路径线是守恒的：$\\frac{DS}{Dt} = 0$，其中 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u \\frac{\\partial}{\\partial x}$ 是物质导数。对于理想气体，熵 $S$ 与 $p$ 和 $\\rho$ 的关系为 $p = K\\rho^\\gamma \\exp(S/c_v)$，这意味着对于恒定熵，$p/\\rho^\\gamma$ 是一个常数。该量的物质导数为零：\n    $$\n    \\frac{D}{Dt}\\left(\\frac{p}{\\rho^\\gamma}\\right) = 0 \\implies \\frac{1}{\\rho^\\gamma}\\frac{Dp}{Dt} - \\frac{\\gamma p}{\\rho^{\\gamma+1}}\\frac{D\\rho}{Dt} = 0\n    $$\n    $$\n    \\frac{Dp}{Dt} = \\frac{\\gamma p}{\\rho}\\frac{D\\rho}{Dt}\n    $$\n    从质量方程，我们有 $\\frac{D\\rho}{Dt} = -\\rho \\frac{\\partial u}{\\partial x}$。将其代入得到：\n    $$\n    \\frac{Dp}{Dt} = -\\frac{\\gamma p}{\\rho} \\left(\\rho \\frac{\\partial u}{\\partial x}\\right) = - \\gamma p \\frac{\\partial u}{\\partial x}\n    $$\n    展开物质导数 $\\frac{Dp}{Dt} = \\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x}$：\n    $$\n    \\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x} + \\gamma p \\frac{\\partial u}{\\partial x} = 0\n    $$\n    问题给出了绝热声速的关系式，$c^2 = \\gamma p / \\rho$。这个量自然地出现在推导中。它的作用是定义压力波的特征速度。将 $c$ 代入方程，我们得到：\n    $$\n    \\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x} + \\rho c^2 \\frac{\\partial u}{\\partial x} = 0\n    $$\n    这是我们系统的第三行。\n\n将三个推导出的方程组装成矩阵形式 $\\frac{\\partial W}{\\partial t} + B(W)\\frac{\\partial W}{\\partial x} = 0$：\n$$\n\\frac{\\partial}{\\partial t}\\begin{pmatrix} \\rho \\\\ u \\\\ p \\end{pmatrix} + \\begin{pmatrix} u  \\rho  0 \\\\ 0  u  1/\\rho \\\\ 0  \\rho c^2  u \\end{pmatrix} \\frac{\\partial}{\\partial x}\\begin{pmatrix} \\rho \\\\ u \\\\ p \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n因此，准线性矩阵为：\n$$\nB(W) = \\begin{pmatrix}\nu  \\rho  0 \\\\\n0  u  1/\\rho \\\\\n0  \\rho c^2  u\n\\end{pmatrix}\n$$\n\n接下来，我们通过求解特征方程 $\\det(B - \\lambda I) = 0$ 来计算 $B(W)$ 的特征值 $\\lambda$：\n$$\n\\det\\begin{pmatrix}\nu-\\lambda  \\rho  0 \\\\\n0  u-\\lambda  1/\\rho \\\\\n0  \\rho c^2  u-\\lambda\n\\end{pmatrix} = (u-\\lambda)\\left((u-\\lambda)^2 - (\\rho c^2)(1/\\rho)\\right) = (u-\\lambda)((u-\\lambda)^2 - c^2) = 0\n$$\n该方程的根即为特征值：\n$$\n\\lambda_1 = u - c, \\quad \\lambda_2 = u, \\quad \\lambda_3 = u + c\n$$\n\n现在，我们通过对每个特征值求解 $(B - \\lambda_k I)r_k = 0$ 来找到相应的右特征向量 $r_k$，并进行归一化，使得第一个分量为 $1$。\n\n对于 $\\lambda_1 = u-c$：\n$$\n\\begin{pmatrix} c  \\rho  0 \\\\ 0  c  1/\\rho \\\\ 0  \\rho c^2  c \\end{pmatrix} \\begin{pmatrix} r_\\rho \\\\ r_u \\\\ r_p \\end{pmatrix} = 0 \\implies\n\\begin{cases} c r_\\rho + \\rho r_u = 0 \\\\ c r_u + (1/\\rho) r_p = 0 \\end{cases}\n\\implies\n\\begin{cases} r_u = -(c/\\rho) r_\\rho \\\\ r_p = -\\rho c r_u = c^2 r_\\rho \\end{cases}\n$$\n使用 $r_\\rho = 1$ 进行归一化，我们得到 $r_1 = (1, -c/\\rho, c^2)^{\\top}$。\n\n对于 $\\lambda_2 = u$：\n$$\n\\begin{pmatrix} 0  \\rho  0 \\\\ 0  0  1/\\rho \\\\ 0  \\rho c^2  0 \\end{pmatrix} \\begin{pmatrix} r_\\rho \\\\ r_u \\\\ r_p \\end{pmatrix} = 0 \\implies\n\\begin{cases} \\rho r_u = 0 \\\\ (1/\\rho) r_p = 0 \\end{cases}\n\\implies\n\\begin{cases} r_u = 0 \\\\ r_p = 0 \\end{cases}\n$$\n$r_\\rho$ 是一个自由参数。使用 $r_\\rho = 1$ 进行归一化，我们得到 $r_2 = (1, 0, 0)^{\\top}$。\n\n对于 $\\lambda_3 = u+c$：\n$$\n\\begin{pmatrix} -c  \\rho  0 \\\\ 0  -c  1/\\rho \\\\ 0  \\rho c^2  -c \\end{pmatrix} \\begin{pmatrix} r_\\rho \\\\ r_u \\\\ r_p \\end{pmatrix} = 0 \\implies\n\\begin{cases} -c r_\\rho + \\rho r_u = 0 \\\\ -c r_u + (1/\\rho) r_p = 0 \\end{cases}\n\\implies\n\\begin{cases} r_u = (c/\\rho) r_\\rho \\\\ r_p = \\rho c r_u = c^2 r_\\rho \\end{cases}\n$$\n使用 $r_\\rho = 1$ 进行归一化，我们得到 $r_3 = (1, c/\\rho, c^2)^{\\top}$。\n\n三个特征对 $(\\lambda_k, r_k)$ 代表了欧拉方程的三个特征波族。\n\n- **声学模式 ($\\lambda_{1,3} = u \\mp c$)：** 特征值 $\\lambda_1=u-c$ 和 $\\lambda_3=u+c$ 分别对应于相对于流体向左和向右传播的声波。它们的特征向量是 $r_1=(1, -c/\\rho, c^2)^{\\top}$ 和 $r_3=(1, c/\\rho, c^2)^{\\top}$。穿过这些波时，密度、速度和压力都是耦合的。原始变量扰动之间的关系是 $\\Delta p = c^2 \\Delta \\rho$ 和 $\\Delta u = \\mp (c/\\rho) \\Delta \\rho$。这是等熵压缩或膨胀的特征。在黎曼问题的背景下，这些波表现为激波（不连续跳跃）或稀疏波（平滑过渡）。\n\n- **熵（接触）模式 ($\\lambda_2 = u$)：** 特征值 $\\lambda_2=u$ 对应于随流体速度被动平流的波。其特征向量是 $r_2=(1, 0, 0)^{\\top}$。该向量表明，穿过此波时只有密度 $\\rho$ 发生变化，而速度 $u$ 和压力 $p$ 保持不变。这种结构描述了接触间断。由于在恒定压力下密度的变化意味着熵的变化（对于理想气体，$S \\propto \\ln(p/\\rho^\\gamma)$），因此这也是一个熵波。在黎曼问题中，这个波将最初在左侧的流体与最初在右侧的流体分开。\n\n在Godunov型格式中，这种特征分解至关重要。特征值确定了信息传播的方向（迎风），而特征向量提供了基，将单元界面处状态之间的跳跃投影到该基上，以确定每个物理波（声学波或熵波）的强度。\n\n最终答案由特征值行向量和相应右特征向量的矩阵组成，两者顺序一致。\n特征值为 $\\begin{pmatrix} u-c  u  u+c \\end{pmatrix}$。\n右特征向量矩阵 $R = \\begin{pmatrix} r_1  r_2  r_3 \\end{pmatrix}$ 是：\n$$\nR = \\begin{pmatrix}\n1  1  1 \\\\\n-c/\\rho  0  c/\\rho \\\\\nc^2  0  c^2\n\\end{pmatrix}\n$$\n这些在最终答案框中以单个行矩阵的形式提供。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} u - c  u  u + c \\end{pmatrix} \\quad \\begin{pmatrix} 1  1  1 \\\\ -\\frac{c}{\\rho}  0  \\frac{c}{\\rho} \\\\ c^{2}  0  c^{2} \\end{pmatrix}\n}\n$$", "id": "3513199"}, {"introduction": "一阶Godunov格式虽然稳健，但对于天体物理应用来说，其数值耗散通常过大，会模糊掉重要的细节。为了达到更高精度，我们必须以优于分段常数的方式重构每个单元内的流体状态。这个动手编码练习 [@problem_id:3513180] 实现了广泛使用的MUSCL重构技术，在该技术中，我们利用前一个练习中得到的特征场信息来智能地限制斜率并防止非物理振荡，这是现代激波捕捉格式的基石。", "problem": "您需要为理想气体的一维欧拉方程实现一种基于特征的守恒律单调上游中心格式（MUSCL）分段线性重构。目标是通过将原始变量斜率投影到特征场上，应用总变差递减（TVD）限制器，并恢复守恒变量，来在单个界面上重构左右守恒态。重构必须在两个给定单元之间的界面上进行，使用它们的直接相邻单元，这是Godunov型有限体积格式的标准做法。\n\n从以下基本基础开始：\n- 理想气体的一维欧拉方程的守恒形式，其守恒态向量为 $U = (\\rho, \\rho u, E)^\\top$。\n- 原始变量为 $W = (\\rho, u, p)^\\top$，理想气体声速为 $c = \\sqrt{\\gamma p / \\rho}$，总能量为 $E = p/(\\gamma - 1) + \\tfrac{1}{2} \\rho u^2$。\n- 原始变量 $W$ 的准线性形式为 $\\partial_t W + A_p(W) \\partial_x W = 0$，其中 $A_p(W)$ 是原始变量的雅可比矩阵。$A_p(W)$ 的特征分解产生三个实特征值 $u - c$、$u$ 和 $u + c$，以及相应的左右特征向量，它们被收集在矩阵 $R(W)$ 和 $L(W)$ 中，使得 $L(W) R(W) = I$。\n\n您的重构必须在单元 $i$ 和 $i+1$ 之间的界面上遵循以下步骤：\n1. 对于界面处的左状态，使用中心单元 $i$ 及其相邻单元 $i-1$ 和 $i+1$。计算单侧原始变量差分 $\\Delta W_L = W_i - W_{i-1}$ 和 $\\Delta W_R = W_{i+1} - W_i$。使用左特征向量矩阵 $L(W_i)$ 将这些差分投影到特征空间，得到 $\\Delta \\alpha_L = L(W_i) \\Delta W_L$ 和 $\\Delta \\alpha_R = L(W_i) \\Delta W_R$。\n2. 在特征空间中应用逐分量的 minmod 限制器，以获得单元 $i$ 处的受限特征斜率 $\\Delta \\alpha$：\n   $$\\operatorname{mm}(a,b) = \\begin{cases}\n   \\operatorname{sign}(a) \\min(|a|,|b|)  \\text{if } \\operatorname{sign}(a) = \\operatorname{sign}(b), \\\\\n   0  \\text{otherwise,}\n   \\end{cases}$$\n   应用于每个特征分量，其中 $a = \\Delta \\alpha_L$，$b = \\Delta \\alpha_R$。\n3. 通过 $R(W_i)$ 在物理空间中恢复单元 $i$ 处的受限原始斜率，并构造界面处的左状态：\n   $$W_{i+1/2}^L = W_i + \\tfrac{1}{2} R(W_i) \\Delta \\alpha.$$\n4. 对于界面处的右状态，使用中心单元 $i+1$ 及其相邻单元 $i$ 和 $i+2$。重复在 $i+1$ 处进行的类似于步骤 $1-3$ 的操作，以获得\n   $$W_{i+1/2}^R = W_{i+1} - \\tfrac{1}{2} R(W_{i+1}) \\Delta \\alpha_{i+1},$$\n   其中 $\\Delta \\alpha_{i+1}$ 是将 $W_{i+1} - W_i$ 和 $W_{i+2} - W_{i+1}$ 通过 $L(W_{i+1})$ 投影并进行 minmod 限制后计算出的受限特征斜率。\n5. 将重构的原始状态 $W_{i+1/2}^{L}$ 和 $W_{i+1/2}^{R}$ 转换为守恒状态 $U_{i+1/2}^{L} = (\\rho^L, \\rho^L u^L, E^L)^\\top$ 和 $U_{i+1/2}^{R} = (\\rho^R, \\rho^R u^R, E^R)^\\top$，其中 $E = p/(\\gamma - 1) + \\tfrac{1}{2} \\rho u^2$。\n\n实现上述重构，并将其应用于以下测试套件。对于每种情况，界面位于索引为 1 和 2 的单元之间（零基索引），提供的四个原始状态分别对应于单元 0、1、2、3：\n- 测试 1（光滑亚音速梯度）：\n  - $\\gamma = 1.4$\n  - $\\{(\\rho, u, p)\\}_j = [(1.0, 0.1, 1.0), (1.1, 0.12, 1.05), (1.2, 0.14, 1.1), (1.3, 0.16, 1.15)]$。\n- 测试 2（类接触间断的密度梯度，速度和压力恒定）：\n  - $\\gamma = 1.4$\n  - $\\{(\\rho, u, p)\\}_j = [(1.0, 0.0, 1.0), (2.0, 0.0, 1.0), (3.0, 0.0, 1.0), (4.0, 0.0, 1.0)]$。\n- 测试 3（单侧斜率符号不同的强跳跃）：\n  - $\\gamma = 1.4$\n  - $\\{(\\rho, u, p)\\}_j = [(1.0, 3.0, 0.1), (1.0, 3.0, 0.1), (3.0, 1.0, 10.0), (3.0, 0.5, 12.0)]$。\n- 测试 4（近真空光滑变化）：\n  - $\\gamma = 1.6666666667$\n  - $\\{(\\rho, u, p)\\}_j = [(0.001, 0.0, 0.000001), (0.002, 0.0, 0.0000015), (0.003, 0.0, 0.0000025), (0.004, 0.0, 0.000004)]$。\n\n您的程序必须按顺序为每个测试输出重构的界面左右守恒态，每个测试合并成一个单一的扁平列表：\n- 对于每个测试，输出 $[\\rho^L, \\rho^L u^L, E^L, \\rho^R, \\rho^R u^R, E^R]$。\n- 将所有测试结果聚合到单行中，该行包含一个由这些每个测试的列表组成的列表，任何地方都没有空格。例如，形式为 $[[\\dots],[\\dots],[\\dots],[\\dots]]$ 的一行，其中包含逗号分隔的值，并且没有附加文本。\n\n不需要物理单位；所有输入和输出都是无量纲的。不涉及角度。所有数值输出必须是实数。最终输出必须是如上所述的、精确的单行。", "solution": "我们寻求一种适用于Godunov型方法的高分辨率界面重构。我们从理想气体的一维欧拉方程开始，其守恒变量为 $U = (\\rho, \\rho u, E)^\\top$，原始变量为 $W = (\\rho, u, p)^\\top$。总能量为 $E = p/(\\gamma - 1) + \\tfrac{1}{2} \\rho u^2$。理想气体声速为 $c = \\sqrt{\\gamma p / \\rho}$。\n\n一种鲁棒的斜率限制的标准方法使用准线性原始变量形式\n$$\n\\partial_t W + A_p(W) \\,\\partial_x W = 0,\n$$\n其原始变量的雅可比矩阵为\n$$\nA_p(W) =\n\\begin{pmatrix}\nu  \\rho  0 \\\\\n0  u  1/\\rho \\\\\n0  \\gamma p  u\n\\end{pmatrix}.\n$$\n该矩阵具有实特征值 $\\lambda_1 = u - c$、$\\lambda_2 = u$ 和 $\\lambda_3 = u + c$。其右特征向量 $r_k$ 和左特征向量 $\\ell_k^\\top$ 构成矩阵 $R(W) = [r_1, r_2, r_3]$ 和 $L(W) = [\\ell_1^\\top; \\ell_2^\\top; \\ell_3^\\top]$，它们将 $A_p$ 对角化为 $A_p = R \\Lambda L$，其中 $\\Lambda = \\operatorname{diag}(u - c, u, u + c)$ 且 $L R = I$。\n\n我们通过求解原始变量中的 $(A_p - \\lambda I) r = 0$ 来推导右特征向量。对于 $\\lambda_1 = u - c$，设 $r_1 = (a, b, d)^\\top$。从第一行我们得到 $c a + \\rho b = 0$，所以 $b = - c a / \\rho$。从第二行 $c b + (1/\\rho) d = 0$，得出 $d = c^2 a$。第三行是满足的，因为 $c^2 = \\gamma p / \\rho$。选择 $a = 1$ 给出 $r_1 = (1, -c/\\rho, c^2)^\\top$。对 $\\lambda_2 = u$ 重复此过程，得到 $r_2 = (1, 0, 0)^\\top$，对于 $\\lambda_3 = u + c$，我们获得 $r_3 = (1, c/\\rho, c^2)^\\top$。因此\n$$\nR(W) = \\begin{pmatrix}\n1  1  1 \\\\\n- c/\\rho  0  c/\\rho \\\\\nc^2  0  c^2\n\\end{pmatrix}.\n$$\n左特征向量是 $R^{-1}(W)$ 的行。我们显式求解 $L R = I$。设 $a = c/\\rho$ 和 $b = c^2$。求解行的线性方程组可得\n$$\n\\ell_1^\\top = \\begin{pmatrix} 0  -\\tfrac{1}{2} \\tfrac{\\rho}{c}  \\tfrac{1}{2} \\tfrac{1}{c^2} \\end{pmatrix},\\quad\n\\ell_2^\\top = \\begin{pmatrix} 1  0  -\\tfrac{1}{c^2} \\end{pmatrix},\\quad\n\\ell_3^\\top = \\begin{pmatrix} 0  \\tfrac{1}{2} \\tfrac{\\rho}{c}  \\tfrac{1}{2} \\tfrac{1}{c^2} \\end{pmatrix},\n$$\n因此\n$$\nL(W) = \\begin{pmatrix}\n0  -\\tfrac{1}{2} \\tfrac{\\rho}{c}  \\tfrac{1}{2} \\tfrac{1}{c^2} \\\\\n1  0  -\\tfrac{1}{c^2} \\\\\n0  \\tfrac{1}{2} \\tfrac{\\rho}{c}  \\tfrac{1}{2} \\tfrac{1}{c^2}\n\\end{pmatrix}.\n$$\n\n利用这个特征结构，我们在界面 $i + \\tfrac{1}{2}$ 处执行基于特征的 MUSCL 重构，如下所示。\n\n对于 $i + \\tfrac{1}{2}$ 处的左状态：\n- 计算单侧原始变量差分 $\\Delta W_L = W_i - W_{i-1}$ 和 $\\Delta W_R = W_{i+1} - W_i$。\n- 使用 $L(W_i)$ 投影到特征变量：\n$$\n\\Delta \\alpha_L = L(W_i) \\,\\Delta W_L,\\quad \\Delta \\alpha_R = L(W_i)\\, \\Delta W_R.\n$$\n- 应用逐分量的 minmod 限制器。对于每个分量 $k \\in \\{1,2,3\\}$，定义\n$$\n\\Delta \\alpha^{(k)} = \\operatorname{mm}\\big(\\Delta \\alpha_L^{(k)}, \\Delta \\alpha_R^{(k)}\\big) =\n\\begin{cases}\n\\operatorname{sign}(\\Delta \\alpha_L^{(k)}) \\min\\big(|\\Delta \\alpha_L^{(k)}|, |\\Delta \\alpha_R^{(k)}|\\big),  \\text{if } \\Delta \\alpha_L^{(k)} \\Delta \\alpha_R^{(k)}  0, \\\\\n0,  \\text{otherwise.}\n\\end{cases}\n$$\n- 在物理空间中恢复受限原始斜率并重构左原始状态：\n$$\nW_{i+1/2}^L = W_i + \\tfrac{1}{2}\\, R(W_i)\\, \\Delta \\alpha.\n$$\n\n对于 $i + \\tfrac{1}{2}$ 处的右状态：\n- 计算围绕 $i+1$ 的单侧差分：$\\Delta W_L^{+} = W_{i+1} - W_i$，$\\Delta W_R^{+} = W_{i+2} - W_{i+1}$。\n- 使用 $L(W_{i+1})$ 投影并应用 minmod 限制器以获得 $\\Delta \\alpha_{i+1}$。\n- 重构右原始状态：\n$$\nW_{i+1/2}^R = W_{i+1} - \\tfrac{1}{2}\\, R(W_{i+1})\\, \\Delta \\alpha_{i+1}.\n$$\n\n最后，通过以下方式将 $W_{i+1/2}^{L,R}$ 转换为守恒变量\n$$\nU^L = \\big(\\rho^L,\\ \\rho^L u^L,\\ p^L/(\\gamma - 1) + \\tfrac{1}{2}\\rho^L (u^L)^2\\big)^\\top,\\quad\nU^R = \\big(\\rho^R,\\ \\rho^R u^R,\\ p^R/(\\gamma - 1) + \\tfrac{1}{2}\\rho^R (u^R)^2\\big)^\\top.\n$$\n\n算法设计总结：\n- 根据 $c = \\sqrt{\\gamma p / \\rho}$ 在相关单元中心计算 $c$。\n- 根据推导出的公式在 $i$ 和 $i+1$ 处组装 $R(W)$ 和 $L(W)$。\n- 在特征空间中执行投影和 minmod 限制以获得受限斜率。\n- 重构 $W^L$ 和 $W^R$ 并转换为守恒状态 $U^L$ 和 $U^R$。\n- 对每个测试用例，在索引 1 和 2（零基）之间的界面处重复此过程，并汇总结果。\n\n此过程严格基于方程的守恒形式、理想气体定律以及准线性原始变量系统的特征结构。它通过投影分离波族，通过 minmod 限制强制单调性，并重构适用于Godunov型黎曼求解器的物理上有意义的左右状态。输出是每个测试的六个守恒量，按指定方式连接，产生一个单行的逗号分隔数值列表。", "answer": "```python\nimport numpy as np\n\ndef sound_speed(gamma, rho, p):\n    return np.sqrt(gamma * p / rho)\n\ndef eigen_matrices_primitive(rho, u, p, gamma):\n    \"\"\"\n    Construct right (R) and left (L) eigenvector matrices of the 1D Euler\n    primitive-variable Jacobian at (rho,u,p) for ideal gas with gamma.\n    W = [rho, u, p]^T\n    A_p(W) has eigenvalues u-c, u, u+c, with:\n      R = [[1, 1, 1],\n           [-c/rho, 0, c/rho],\n           [c^2, 0, c^2]]\n      L rows (inverse of R):\n           [0, -0.5*rho/c, 0.5/c^2]\n           [1, 0, -1/c^2]\n           [0, 0.5*rho/c, 0.5/c^2]\n    \"\"\"\n    c = sound_speed(gamma, rho, p)\n    # Right eigenvectors (columns)\n    R = np.array([\n        [1.0, 1.0, 1.0],\n        [-c / rho, 0.0, c / rho],\n        [c * c, 0.0, c * c]\n    ], dtype=float)\n    # Left eigenvectors (rows)\n    L = np.array([\n        [0.0, -0.5 * rho / c, 0.5 / (c * c)],\n        [1.0, 0.0, -1.0 / (c * c)],\n        [0.0, 0.5 * rho / c, 0.5 / (c * c)]\n    ], dtype=float)\n    return L, R\n\ndef minmod_pair(a, b):\n    \"\"\"\n    Component-wise minmod of two same-shaped arrays a and b.\n    mm(a,b) = sign(a)*min(|a|,|b|) if sign(a)==sign(b) != 0, else 0.\n    \"\"\"\n    s = np.sign(a) * np.sign(b)\n    same_sign = s > 0.0\n    out = np.zeros_like(a)\n    out[same_sign] = np.sign(a[same_sign]) * np.minimum(np.abs(a[same_sign]), np.abs(b[same_sign]))\n    return out\n\ndef reconstruct_interface(Wm, Wi, Wp, Wpp, gamma):\n    \"\"\"\n    Given four primitive states Wm=W_{i-1}, Wi=W_{i}, Wp=W_{i+1}, Wpp=W_{i+2},\n    perform characteristic-based MUSCL reconstruction at interface i+1/2.\n    Returns (UL, UR) as conservative states arrays of length 3: [rho, mom, E].\n    \"\"\"\n    # Left state from cell i\n    rho_i, u_i, p_i = Wi\n    L_i, R_i = eigen_matrices_primitive(rho_i, u_i, p_i, gamma)\n    dWL = Wi - Wm\n    dWR = Wp - Wi\n    daL = L_i @ dWL\n    daR = L_i @ dWR\n    da = minmod_pair(daL, daR)\n    W_L = Wi + 0.5 * (R_i @ da)\n\n    # Right state from cell i+1\n    rho_ip, u_ip, p_ip = Wp\n    L_ip, R_ip = eigen_matrices_primitive(rho_ip, u_ip, p_ip, gamma)\n    dWLp = Wp - Wi\n    dWRp = Wpp - Wp\n    daLp = L_ip @ dWLp\n    daRp = L_ip @ dWRp\n    dap = minmod_pair(daLp, daRp)\n    W_R = Wp - 0.5 * (R_ip @ dap)\n\n    # Convert to conservative variables\n    def prim_to_cons(W, gamma):\n        rho, u, p = W\n        mom = rho * u\n        E = p / (gamma - 1.0) + 0.5 * rho * u * u\n        return np.array([rho, mom, E], dtype=float)\n\n    U_L = prim_to_cons(W_L, gamma)\n    U_R = prim_to_cons(W_R, gamma)\n    return U_L, U_R\n\ndef format_float(x):\n    # Use up to 10 significant digits, strip spaces\n    return f\"{x:.10g}\"\n\ndef format_list(lst):\n    return \"[\" + \",\".join(format_float(x) for x in lst) + \"]\"\n\ndef solve():\n    # Define test cases: each is (gamma, [W0,W1,W2,W3]) with W=(rho,u,p)\n    test_cases = [\n        (1.4, [\n            np.array([1.0, 0.1, 1.0], dtype=float),\n            np.array([1.1, 0.12, 1.05], dtype=float),\n            np.array([1.2, 0.14, 1.1], dtype=float),\n            np.array([1.3, 0.16, 1.15], dtype=float),\n        ]),\n        (1.4, [\n            np.array([1.0, 0.0, 1.0], dtype=float),\n            np.array([2.0, 0.0, 1.0], dtype=float),\n            np.array([3.0, 0.0, 1.0], dtype=float),\n            np.array([4.0, 0.0, 1.0], dtype=float),\n        ]),\n        (1.4, [\n            np.array([1.0, 3.0, 0.1], dtype=float),\n            np.array([1.0, 3.0, 0.1], dtype=float),\n            np.array([3.0, 1.0, 10.0], dtype=float),\n            np.array([3.0, 0.5, 12.0], dtype=float),\n        ]),\n        (1.6666666667, [\n            np.array([0.001, 0.0, 0.000001], dtype=float),\n            np.array([0.002, 0.0, 0.0000015], dtype=float),\n            np.array([0.003, 0.0, 0.0000025], dtype=float),\n            np.array([0.004, 0.0, 0.000004], dtype=float),\n        ]),\n    ]\n\n    results_strs = []\n    for gamma, Wlist in test_cases:\n        Wm, Wi, Wp, Wpp = Wlist\n        UL, UR = reconstruct_interface(Wm, Wi, Wp, Wpp, gamma)\n        combined = np.concatenate([UL, UR])\n        results_strs.append(format_list(combined))\n\n    print(\"[\" + \",\".join(results_strs) + \"]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3513180"}, {"introduction": "近似黎曼求解器（如流行的Roe求解器）为计算数值通量提供了一种高效的方法，但在某些情况下可能会失效，产生非物理的解，例如膨胀激波。这个高级编码实践 [@problem_id:3513255] 通过实现一个“熵修正”来解决这个关键的稳健性问题。你将学习如何在跨音速流区域“外科手术式”地施加数值耗散，以确保求解器遵守热力学第二定律，同时又不牺牲其他地方的精度。", "problem": "考虑理想气体的一维可压缩欧拉方程，其比热比为$\\gamma$，单位为无量纲。采用Roe线性化的Godunov型离散方法利用在合适的Roe平均态下计算的通量雅可比矩阵，来近似求解单元界面上的黎曼问题。在马赫数$M$约等于$1$的跨音速状态附近，除非应用熵修正，否则Roe线性化可能会产生非物理的膨胀激波。您的任务是设计并实现一种熵修正，该修正在类射流黎曼问题中能够保持接触波速，同时对声学场进行正则化。\n\n从守恒律和理想气体关系式这两个基本基础出发，推导左、右原始态$\\rho_L,u_L,p_L$和$\\rho_R,u_R,p_R$之间界面上的Roe平均态、相关的特征值和特征向量，以及通过将守恒态跳跃投影到特征基上获得的波强度。构建一个由阈值$\\delta$参数化的熵修正，该修正仅修改声学场，并保持接触场不变，即接触特征值始终等于Roe平均速度。该熵修正必须对于小特征值作为$\\delta$的函数连续过渡，并且不得改变特征速度的符号。\n\n实现一个程序，对于一组类射流和接触黎曼初值状态，在施加您设计的带有指定$\\delta$的熵修正后，计算修正后的声学特征速度的绝对值，验证接触特征值是否保持不变，并且在纯接触情况下，验证声学波强度是否为零。\n\n全程使用无量纲单位。所有关于特征速度的浮点数输出必须四舍五入到六位小数。\n\n测试组：\n- 设$\\gamma=1.4$。\n- 测试用例1（类射流，无熵修正的基线）：左态$\\rho_L=1.0$，$p_L=1.0$，$u_L=1.05\\,c_L$，其中$c_L=\\sqrt{\\gamma p_L/\\rho_L}$；右态$\\rho_R=0.8$，$p_R=1.0$，$u_R=0.3\\,c_R$，其中$c_R=\\sqrt{\\gamma p_R/\\rho_R}$；熵修正阈值$\\delta=0.0$。\n- 测试用例2（类射流，温和的熵修正）：左、右态与测试用例1相同；熵修正阈值$\\delta=0.1$。\n- 测试用例3（跨越跨音速区的熵修正）：左态$\\rho_L=1.0$，$p_L=1.0$，$u_L=1.05\\,c_L$，其中$c_L=\\sqrt{\\gamma p_L/\\rho_L}$；右态$\\rho_R=0.7$，$p_R=0.7$，$u_R=0.95\\,c_R$，其中$c_R=\\sqrt{\\gamma p_R/\\rho_R}$；熵修正阈值$\\delta=0.1$。\n- 测试用例4（纯接触间断）：左态$\\rho_L=1.0$，$p_L=1.0$，$u_L=0.3$；右态$\\rho_R=2.0$，$p_R=1.0$，$u_R=0.3$；熵修正阈值$\\delta=0.5$。\n\n对于每个测试用例：\n- 计算Roe平均速度和声速。\n- 计算Roe矩阵的声学特征值和接触特征值。\n- 仅对声学特征值应用熵修正，保持接触特征值不变。熵修正必须满足以下性质：对于任何声学特征值$\\lambda$，修正后的绝对值是$|\\lambda|$的一个由$\\delta$参数化的连续非减函数，并且当$|\\lambda|$足够大时等于$|\\lambda|$。\n- 对于测试用例1-3，输出一个列表，其中包含一个布尔值，表示接触特征值是否在$10^{-12}$的容差内等于Roe平均速度，以及一个修正后的声学特征值绝对值的列表 $\\{|\\lambda_-|_{\\mathrm{corr}},|\\lambda_+|_{\\mathrm{corr}}\\}$，每个值都四舍五入到六位小数。\n- 对于测试用例4，输出一个列表，其中包含一个布尔值，表示接触特征值是否在相同容差内等于Roe平均速度，以及一个布尔值，表示声学波强度是否均在$10^{-12}$的容差内接近于零。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[[True,[0.123456,1.234567]],[...],...]\"）。", "solution": "理想气体的一维可压缩欧拉方程的守恒形式如下：\n$$\n\\frac{\\partial}{\\partial t}\n\\begin{bmatrix}\n\\rho\\\\\n\\rho u\\\\\nE\n\\end{bmatrix}\n+\n\\frac{\\partial}{\\partial x}\n\\begin{bmatrix}\n\\rho u\\\\\n\\rho u^2 + p\\\\\nu(E+p)\n\\end{bmatrix}\n= 0,\n$$\n其中$\\rho$是质量密度，$u$是速度，$p$是压力，$E$是总能量密度。对于比热比为$\\gamma$的理想气体，热力学闭合关系为$p=(\\gamma-1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$，声速为$c=\\sqrt{\\gamma p/\\rho}$。\n\n在Godunov型方法中，界面上的数值通量是通过求解或近似求解由左、右状态构成的黎曼问题得到的。Roe线性化构建一个常系数雅可比矩阵$\\mathbf{A}_{\\mathrm{Roe}}$，该矩阵以保持某些守恒性和一致性属性的方式来近似通量雅可比矩阵。该构造使用了从基本守恒律和理想气体关系式推导出的Roe平均值。\n\n定义原始态$(\\rho_L,u_L,p_L)$和$(\\rho_R,u_R,p_R)$以及相应的总能量密度\n$$\nE_L = \\frac{p_L}{\\gamma-1} + \\frac{1}{2}\\rho_L u_L^2,\\quad\nE_R = \\frac{p_R}{\\gamma-1} + \\frac{1}{2}\\rho_R u_R^2,\n$$\n和总比焓\n$$\nH_L = \\frac{E_L + p_L}{\\rho_L},\\quad\nH_R = \\frac{E_R + p_R}{\\rho_R}.\n$$\nRoe平均值是使用基于密度的权重构建的。设$\\tilde{\\rho}=\\sqrt{\\rho_L \\rho_R}$，并定义权重$w_L=\\sqrt{\\rho_L}$和$w_R=\\sqrt{\\rho_R}$。Roe平均速度和焓为\n$$\n\\tilde{u} = \\frac{w_L u_L + w_R u_R}{w_L + w_R},\\quad\n\\tilde{H} = \\frac{w_L H_L + w_R H_R}{w_L + w_R}.\n$$\n由此，通过理想气体关系式得到Roe平均声速，\n$$\n\\tilde{c} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)}.\n$$\n$\\mathbf{A}_{\\mathrm{Roe}}$的特征值是特征速度\n$$\n\\lambda_1 = \\tilde{u} - \\tilde{c},\\quad\n\\lambda_2 = \\tilde{u},\\quad\n\\lambda_3 = \\tilde{u} + \\tilde{c}.\n$$\n相应的右特征向量构成一个基，在该基中可以分解守恒态跳跃$\\Delta \\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$。利用Roe平均量和原始变量跳跃$\\Delta \\rho = \\rho_R - \\rho_L$, $\\Delta u = u_R - u_L$, and $\\Delta p = p_R - p_L$，通过求解由特征向量矩阵给出的线性系统，可以推导出将$\\Delta \\mathbf{U}$投影到Roe特征基上的波强度$\\alpha_i$。一组经过充分检验的公式（与理想气体欧拉系统和Roe平均法一致）是\n$$\n\\alpha_1 = \\frac{1}{2}\\frac{\\Delta p - \\tilde{\\rho}\\,\\tilde{c}\\,\\Delta u}{\\tilde{c}^2},\\quad\n\\alpha_2 = \\Delta \\rho - \\frac{\\Delta p}{\\tilde{c}^2},\\quad\n\\alpha_3 = \\frac{1}{2}\\frac{\\Delta p + \\tilde{\\rho}\\,\\tilde{c}\\,\\Delta u}{\\tilde{c}^2}.\n$$\n这些表达式是通过匹配沿特征场的质量、动量和能量跳跃得出的，其中$\\tilde{\\rho}$作为确保一致性的Roe密度标度。\n\n在马赫数$M\\approx 1$的跨音速状态附近，没有熵修正的Roe格式可能产生非物理解的膨胀激波，因为当状态跨越音速条件时，绝对值$|\\lambda_1|$和$|\\lambda_3|$可能会消失或突然改变。熵修正会修改与小特征速度相关的粘性，以强制执行熵一致性。一种常见的构造方法由Harten和Hyman提出。对于每个声学特征值$\\lambda\\in\\{\\lambda_1,\\lambda_3\\}$，定义一个修正后的绝对值\n$$\n|\\lambda|_{\\mathrm{corr}} =\n\\begin{cases}\n\\frac{1}{2}\\left(\\frac{\\lambda^2}{\\delta} + \\delta\\right),  \\text{if } |\\lambda|  \\delta,\\\\\n|\\lambda|,  \\text{if } |\\lambda| \\ge \\delta,\n\\end{cases}\n$$\n其中阈值$\\delta\\ge 0$。此函数是$|\\lambda|$的连续非减函数，在重构耗散时保持$\\lambda$的符号，并且对于足够大的特征速度，该函数简化为原始的$|\\lambda|$。重要的是，为了保持接触波，此修正仅应用于声学场，保持$\\lambda_2=\\tilde{u}$不变。保持$\\lambda_2$可以维持接触波速，并确保纯接触间断不会因对接触特征速度的人为调整而被无意中抹平。\n\n纯接触间断在界面两侧具有相等的速度和压力，但密度不同，即$\\Delta u=0$和$\\Delta p=0$，而$\\Delta \\rho\\ne 0$。将这些条件代入波强度公式可得\n$$\n\\alpha_1 = 0,\\quad \\alpha_3 = 0,\\quad \\alpha_2 = \\Delta \\rho,\n$$\n所以只有接触波存在。因为熵修正不修改$\\lambda_2$，接触波速保持为$\\tilde{u}$，并且在声学场上没有熵引起的粘性。对于静止接触（$\\tilde{u}=0$），与接触波相关的数值粘性消失，从而在Roe框架中精确地保持间断；对于移动接触，Roe求解器仍然引入与$|\\lambda_2|$成正比的接触耗散，但当熵修正仅限于声学场时，这与熵修正无关。\n\n每个测试用例的算法步骤：\n1. 根据给定的原始态和$\\gamma$计算$E_L$、$E_R$、$H_L$和$H_R$。\n2. 使用基于密度的权重和$\\tilde{\\rho}=\\sqrt{\\rho_L\\rho_R}$计算Roe平均值$\\tilde{u}$和$\\tilde{H}$。\n3. 计算Roe平均声速$\\tilde{c}$和特征值$\\lambda_1$、$\\lambda_2$、$\\lambda_3$。\n4. 仅对声学特征值应用阈值为$\\delta$的Harten–Hyman熵修正，得到$|\\lambda_1|_{\\mathrm{corr}}$和$|\\lambda_3|_{\\mathrm{corr}}$，如上所示；保持$\\lambda_2$不变。\n5. 对于测试用例4（纯接触），计算$\\alpha_1$和$\\alpha_3$，并验证它们是否在$10^{-12}$的容差内接近于零；对于所有用例，验证$\\lambda_2=\\tilde{u}$是否在$10^{-12}$的容差内成立。\n6. 将修正后的声学特征值绝对值四舍五入到六位小数以便输出。\n\n最终输出汇总了测试用例1-3的接触特征值保持布尔值和修正后的声学速度绝对值列表，以及测试用例4的接触特征值保持布尔值和声学强度消失布尔值。程序打印单行，其中包含一个用方括号括起来的逗号分隔列表的结果。", "answer": "```python\nimport numpy as np\n\n# Constants\nGAMMA = 1.4\n\ndef primitive_to_conservative(rho, u, p, gamma=GAMMA):\n    E = p / (gamma - 1.0) + 0.5 * rho * u * u\n    return np.array([rho, rho * u, E])\n\ndef sound_speed(rho, p, gamma=GAMMA):\n    return np.sqrt(gamma * p / rho)\n\ndef roe_averages(prim_L, prim_R, gamma=GAMMA):\n    rhoL, uL, pL = prim_L\n    rhoR, uR, pR = prim_R\n    # Conservative variables\n    UL = primitive_to_conservative(rhoL, uL, pL, gamma)\n    UR = primitive_to_conservative(rhoR, uR, pR, gamma)\n    _, _, EL_tot = UL\n    _, _, ER_tot = UR\n    # Specific total enthalpy H = (E + p)/rho\n    HL = (EL_tot + pL) / rhoL\n    HR = (ER_tot + pR) / rhoR\n    # Roe weights\n    wL = np.sqrt(rhoL)\n    wR = np.sqrt(rhoR)\n    u_tilde = (wL * uL + wR * uR) / (wL + wR)\n    H_tilde = (wL * HL + wR * HR) / (wL + wR)\n    c_tilde = np.sqrt((gamma - 1.0) * (H_tilde - 0.5 * u_tilde * u_tilde))\n    rho_tilde = np.sqrt(rhoL * rhoR)\n    return u_tilde, c_tilde, rho_tilde\n\ndef eigenvalues(u_tilde, c_tilde):\n    lam1 = u_tilde - c_tilde\n    lam2 = u_tilde\n    lam3 = u_tilde + c_tilde\n    return lam1, lam2, lam3\n\ndef harten_hyman_entropy_fix_abs(lam, delta):\n    a = abs(lam)\n    if delta == 0.0:\n        return a\n    if a  delta:\n        return 0.5 * (a * a / delta + delta)\n    else:\n        return a\n\ndef wave_strengths(prim_L, prim_R, u_tilde, c_tilde, rho_tilde):\n    rhoL, uL, pL = prim_L\n    rhoR, uR, pR = prim_R\n    drho = rhoR - rhoL\n    du = uR - uL\n    dp = pR - pL\n    denom = c_tilde * c_tilde\n    alpha1 = 0.5 * (dp - rho_tilde * c_tilde * du) / denom\n    alpha2 = drho - dp / denom\n    alpha3 = 0.5 * (dp + rho_tilde * c_tilde * du) / denom\n    return alpha1, alpha2, alpha3\n\ndef round6(x):\n    return float(f\"{x:.6f}\")\n\ndef test_case_results(prim_L, prim_R, delta):\n    # Compute Roe averages\n    u_tilde, c_tilde, rho_tilde = roe_averages(prim_L, prim_R)\n    # Eigenvalues\n    lam1, lam2, lam3 = eigenvalues(u_tilde, c_tilde)\n    # Entropy fix applied only to acoustic eigenvalues\n    l1_corr_abs = harten_hyman_entropy_fix_abs(lam1, delta)\n    l3_corr_abs = harten_hyman_entropy_fix_abs(lam3, delta)\n    # Contact preservation check (lambda_2 = u_tilde, unmodified)\n    contact_preserved = np.isclose(lam2, u_tilde, rtol=0.0, atol=1e-12)\n    # For pure contact case, check acoustic strengths vanish\n    alpha1, alpha2, alpha3 = wave_strengths(prim_L, prim_R, u_tilde, c_tilde, rho_tilde)\n    acoustic_strengths_zero = (np.isclose(alpha1, 0.0, rtol=0.0, atol=1e-12) and\n                               np.isclose(alpha3, 0.0, rtol=0.0, atol=1e-12))\n    return contact_preserved, [round6(l1_corr_abs), round6(l3_corr_abs)], acoustic_strengths_zero\n\ndef build_test_cases():\n    gamma = GAMMA\n    # Test case 1: jet-like, no entropy fix (delta=0.0)\n    rhoL1, pL1 = 1.0, 1.0\n    cL1 = sound_speed(rhoL1, pL1, gamma)\n    uL1 = 1.05 * cL1\n    rhoR1, pR1 = 0.8, 1.0\n    cR1 = sound_speed(rhoR1, pR1, gamma)\n    uR1 = 0.3 * cR1\n    prim_L1 = (rhoL1, uL1, pL1)\n    prim_R1 = (rhoR1, uR1, pR1)\n    delta1 = 0.0\n\n    # Test case 2: jet-like, mild entropy fix (delta=0.1)\n    prim_L2 = prim_L1\n    prim_R2 = prim_R1\n    delta2 = 0.1\n\n    # Test case 3: near-transonic straddling with entropy fix\n    rhoL3, pL3 = 1.0, 1.0\n    cL3 = sound_speed(rhoL3, pL3, gamma)\n    uL3 = 1.05 * cL3\n    rhoR3, pR3 = 0.7, 0.7\n    cR3 = sound_speed(rhoR3, pR3, gamma)\n    uR3 = 0.95 * cR3\n    prim_L3 = (rhoL3, uL3, pL3)\n    prim_R3 = (rhoR3, uR3, pR3)\n    delta3 = 0.1\n\n    # Test case 4: pure contact discontinuity\n    prim_L4 = (1.0, 0.3, 1.0)\n    prim_R4 = (2.0, 0.3, 1.0)\n    delta4 = 0.5\n\n    return [\n        (prim_L1, prim_R1, delta1),\n        (prim_L2, prim_R2, delta2),\n        (prim_L3, prim_R3, delta3),\n        (prim_L4, prim_R4, delta4)\n    ]\n\ndef solve():\n    test_cases = build_test_cases()\n    results = []\n    for idx, (prim_L, prim_R, delta) in enumerate(test_cases):\n        contact_preserved, corrected_acoustic, acoustic_strengths_zero = test_case_results(prim_L, prim_R, delta)\n        if idx  3:\n            # For test cases 1-3: output [contact_preserved, [|lambda_-|_corr, |lambda_+|_corr]]\n            results.append([bool(contact_preserved), corrected_acoustic])\n        else:\n            # For test case 4: output [contact_preserved, acoustic_strengths_zero]\n            results.append([bool(contact_preserved), bool(acoustic_strengths_zero)])\n    # Print in the exact required format: single line as a comma-separated list enclosed in square brackets\n    print(str(results).replace(\" \", \"\"))\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3513255"}]}