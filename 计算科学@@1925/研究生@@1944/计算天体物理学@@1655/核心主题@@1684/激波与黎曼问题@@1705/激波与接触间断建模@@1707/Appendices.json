{"hands_on_practices": [{"introduction": "在验证包含激波或接触间断的流体动力学代码时，传统的点对点误差范数（如 $L_2$ 范数）可能会产生误导，因为它们对间断位置的微小偏移非常敏感。这个实践练习将指导您使用更符合物理直觉的误差度量，即激波位置误差和接触间断宽度，来实施网格加密研究。通过为简单的激波和接触间断问题实现基础的数值格式，您将学习如何量化和验证您的代码捕捉这些非连续性特征的收敛率 [@problem_id:3521202]。", "problem": "您需要实现并分析包含传播激波和传播接触间断的一维守恒律模型。目标是为间断定义适用于界面的误差范数，并设计一个网格加密研究，以测量激波位置和接触宽度的收敛性与精确解的对比。所有数学实体必须用 LaTeX 书写，所有物理输出在适用情况下必须以米为单位表示。\n\n其基本理论基础是双曲守恒律、Rankine–Hugoniot 跳跃条件以及 Courant–Friedrichs–Lewy (CFL) 稳定性条件。使用以下两个模型：\n\n1. 激波模型：无粘性 Burgers 守恒律，\n$$\nu_t + \\left(\\frac{1}{2} u^2\\right)_x = 0,\n$$\n在位置 $x_0$ 处具有 Riemann 初始数据，\n$$\nu(x,0) = \\begin{cases}\nu_L,  x  x_0,\\\\\nu_R,  x > x_0,\n\\end{cases}\n$$\n且 $u_L > u_R$。根据 Rankine–Hugoniot 跳跃条件，精确的激波速度为\n$$\ns = \\frac{f(u_L) - f(u_R)}{u_L - u_R}, \\quad \\text{with} \\quad f(u) = \\frac{1}{2}u^2,\n$$\n可简化为\n$$\ns = \\frac{u_L + u_R}{2}.\n$$\n那么精确的激波位置为\n$$\nx_s(t) = x_0 + s t.\n$$\n\n2. 接触间断模型：无源标量密度的线性平流，\n$$\n\\rho_t + a \\rho_x = 0,\n$$\n在位置 $x_0$ 处具有 Riemann 初始数据，\n$$\n\\rho(x,0) = \\begin{cases}\n\\rho_L,  x  x_0,\\\\\n\\rho_R,  x > x_0,\n\\end{cases}\n$$\n其中 $a$ 是一个恒定的平流速度。精确的接触间断以速度 $a$ 传播而无扩散，并且其精确宽度在所有时间都保持为零。精确的接触位置是\n$$\nx_c(t) = x_0 + a t \\quad \\text{对于周期性边界，需要对区域长度取模}。\n$$\n\n为间断定义合适的误差范数。对于由一个界面（激波或接触）表示的间断，我们如下定义指示函数、阈值和几何误差度量：\n\n- 激波指示函数：令 $H(x; x_*)$ 为以 $x_*$ 为中心的 Heaviside 函数，\n$$\nH(x; x_*) = \\begin{cases}\n1,  x \\le x_*,\\\\\n0,  x > x_*.\n\\end{cases}\n$$\n对于 $u_L > u_R$ 的 Burgers 激波，精确指示函数为 $\\chi_{\\mathrm{exact}}(x,t) = H(x; x_s(t))$，而数值指示函数为 $\\chi_{\\mathrm{num}}(x,t) = \\mathbf{1}_{\\{u(x,t) > u_m\\}}$，其中中间值阈值为 $u_m = \\frac{u_L + u_R}{2}$。指示函数误差场为 $e_\\chi(x,t) = \\chi_{\\mathrm{num}}(x,t) - \\chi_{\\mathrm{exact}}(x,t)$。$e_\\chi$ 在空间域 $[0,L]$ 上的 $L_1$、$L_2$ 和 $L_\\infty$ 范数为\n$$\n\\|e_\\chi\\|_{1} = \\int_0^L |e_\\chi(x,t)| \\, dx, \\quad\n\\|e_\\chi\\|_{2} = \\left(\\int_0^L |e_\\chi(x,t)|^2 \\, dx\\right)^{1/2}, \\quad\n\\|e_\\chi\\|_{\\infty} = \\sup_{x \\in [0,L]} |e_\\chi(x,t)|.\n$$\n对于理想的尖锐阶跃，$\\|e_\\chi\\|_{1}$ 等于激波位置偏差 $|x_s^{\\mathrm{num}}(t) - x_s(t)|$，$\\|e_\\chi\\|_{2} = \\sqrt{|x_s^{\\mathrm{num}}(t) - x_s(t)|}$，而 $\\|e_\\chi\\|_{\\infty}$ 为 $0$ 或 $1$。在实践中，由于数值抹平效应，$\\|e_\\chi\\|_{1}$ 同时包含了位置偏差和抹平的贡献。为了分离出几何上的激波位置误差，定义标量位置误差\n$$\ne_s(t) = x_s^{\\mathrm{num}}(t) - x_s(t),\n$$\n并使用其标量范数，\n$$\n\\|e_s\\|_{1} = |e_s|, \\quad \\|e_s\\|_{2} = \\sqrt{e_s^2}, \\quad \\|e_s\\|_{\\infty} = |e_s|.\n$$\n\n- 接触宽度指示器：通过跳跃幅度对密度进行归一化，\n$$\n\\eta(x,t) = \\frac{\\rho(x,t) - \\rho_R}{\\rho_L - \\rho_R}.\n$$\n在水平 $\\eta_{10} = 0.1$ 和 $\\eta_{90} = 0.9$ 处定义阈值穿越点。令 $x_{10}(t)$ 和 $x_{90}(t)$ 分别为时刻 $t$ 时 $\\eta$ 穿越 $0.1$ 和 $0.9$ 的位置，使用网格点之间的线性插值计算。数值接触宽度为\n$$\n\\hat{w}(t) = x_{90}(t) - x_{10}(t).\n$$\n精确宽度为 $w(t) = 0$，因此标量宽度误差为\n$$\ne_w(t) = \\hat{w}(t) - w(t) = \\hat{w}(t).\n$$\n为 $e_w$ 定义标量范数为\n$$\n\\|e_w\\|_{1} = \\hat{w}, \\quad \\|e_w\\|_{2} = \\sqrt{\\hat{w}^2}, \\quad \\|e_w\\|_{\\infty} = \\hat{w}.\n$$\n\n将要使用的数值格式：\n\n- 对于 Burgers 激波，使用一阶守恒有限体积法，配以 Lax–Friedrichs 数值通量，在均匀网格上实现。$i+\\frac{1}{2}$ 界面处的 Lax–Friedrichs 通量为\n$$\nF_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(f(u_i) + f(u_{i+1})\\right) - \\frac{1}{2}\\alpha_{i+\\frac{1}{2}}(u_{i+1} - u_i),\n$$\n其中 $f(u) = \\frac{1}{2}u^2$ 且 $\\alpha_{i+\\frac{1}{2}} = \\max\\{|u_i|,|u_{i+1}|\\}$。更新\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),\n$$\n并通过对虚拟单元进行常数外插来强制执行流出（透射）边界条件。根据 Courant–Friedrichs–Lewy (CFL) 条件选择时间步长，\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i|},\n$$\n其中 $\\mathrm{CFL} = 0.45$。\n\n- 对于接触间断，在均匀周期性网格上使用与 $a$ 的符号相适应的一阶迎风有限差分格式。如果 $a \\ge 0$，\n$$\n\\rho_i^{n+1} = \\rho_i^n - \\nu\\left(\\rho_i^n - \\rho_{i-1}^n\\right), \\quad \\nu = \\frac{a \\Delta t}{\\Delta x},\n$$\n对 $i-1$ 进行周期性处理。如果 $a  0$，\n$$\n\\rho_i^{n+1} = \\rho_i^n - \\nu\\left(\\rho_{i+1}^n - \\rho_i^n\\right), \\quad \\nu = \\frac{a \\Delta t}{\\Delta x},\n$$\n对 $i+1$ 进行周期性处理。根据 Courant–Friedrichs–Lewy (CFL) 条件选择 $\\Delta t$\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{|a|},\n$$\n其中 $\\mathrm{CFL} = 0.9$。\n\n几何检测程序：\n\n- 激波位置检测：在最终时刻 $t$，定义中间状态 $u_m = \\frac{u_L + u_R}{2}$，并通过在跨越 $u_m$ 的两个相邻网格点之间进行线性插值，来定位 $u(x,t)$ 中对 $u_m$ 水平的唯一穿越点。如果由于数值异常未找到穿越点，则退而求其次，将具有最大梯度大小 $|u_{i+1} - u_i|$ 的单元面中点定位为界面。\n\n- 接触宽度检测：在最终时刻 $t$，计算归一化场 $\\eta$。通过线性插值定位 $\\eta$ 穿越水平 $0.1$ 和 $0.9$ 的位置 $x_{10}$ 和 $x_{90}$。为避免因周期性引起的伪穿越，使用（在索引空间中）最接近最大梯度位置的那一对穿越点。宽度则为 $\\hat{w} = x_{90} - x_{10}$。\n\n网格加密研究和要求的输出：\n\n- 区域长度为 $L = 1$ 米。激波的初始间断位置为 $x_0 = 0.5$ 米，接触间断的初始位置为 $x_0 = 0.25$ 米。最终时间和参数如下：\n\n  - 激波情况：$u_L = 2$ 米/秒，$u_R = 0$ 米/秒，最终时间 $t_{\\mathrm{shock}} = 0.2$ 秒。\n  - 接触间断情况：$\\rho_L = 1$ 千克/立方米，$\\rho_R = 0.1$ 千克/立方米，平流速度 $a = 0.5$ 米/秒，最终时间 $t_{\\mathrm{contact}} = 0.4$ 秒。\n\n- 使用单元数量为 $N \\in \\{100, 200, 400, 800\\}$ 的均匀网格。对于每个 $N$，计算激波位置误差的 $L_1$ 范数 $\\|e_s\\|_1$（单位：米）和接触宽度误差的 $L_1$ 范数 $\\|e_w\\|_1$（单位：米）。然后通过连续加密的成对比例计算每个量的经验收敛率，\n$$\nR = \\frac{1}{M}\\sum_{j=1}^{M} \\frac{\\log\\left(E_{N_j} / E_{N_{j+1}}\\right)}{\\log\\left(\\Delta x_{N_j} / \\Delta x_{N_{j+1}}\\right)} = \\frac{1}{M}\\sum_{j=1}^{M} \\frac{\\log\\left(E_{N_j} / E_{N_{j+1}}\\right)}{\\log(2)},\n$$\n其中 $E_{N}$ 是分辨率为 $N$ 时的误差，$\\Delta x_N = L/N$，对于序列 $\\{100,200,400,800\\}$，$M = 3$。\n\n- 物理单位：所有位置和宽度都必须以米表示。报告所有误差和收敛率时，除了所有误差值代表以米为单位的长度外，均使用无单位浮点数。\n\n- 测试套件：对上述两种情况均使用网格尺寸 $N \\in \\{100, 200, 400, 800\\}$。\n\n- 最终输出格式：您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，并严格按照以下顺序\n$$\n[\\|e_s\\|_1(N{=}100), \\|e_s\\|_1(N{=}200), \\|e_s\\|_1(N{=}400), \\|e_s\\|_1(N{=}800), R_{\\mathrm{shock}}, \\|e_w\\|_1(N{=}100), \\|e_w\\|_1(N{=}200), \\|e_w\\|_1(N{=}400), \\|e_w\\|_1(N{=}800), R_{\\mathrm{contact}}],\n$$\n其中每个 $\\|e_s\\|_1$ 和 $\\|e_w\\|_1$ 的单位是米，每个收敛率 $R$ 是无单位的。必须严格按照规定格式打印列表，不得包含任何额外文本。", "solution": "该问题要求实现和分析两种基本的一维双曲守恒律的数值解：用于模拟激波形成的无粘性 Burgers 方程，以及用于模拟接触间断传播的线性平流方程。分析涉及一个网格加密研究，以测量适用于间断解的特定误差度量的收敛性。\n\n解决方案的结构如下：首先，我们使用一阶有限体积法和 Lax-Friedrichs 通量为 Burgers 方程开发数值求解器。其次，我们使用一阶迎风格式为线性平流方程开发求解器。对于这两种情况，我们都实现了用于检测特征（激波位置或接触宽度）并计算与精确解之间误差的指定程序。最后，我们对两个模型进行网格加密研究，计算网格尺寸为 $N \\in \\{100, 200, 400, 800\\}$ 时的误差，并计算经验收敛率。\n\n### 1. 激波模型：无粘性 Burgers 方程\n\n**控制方程和精确解**\n无粘性 Burgers 方程由下式给出\n$$u_t + \\left(\\frac{1}{2} u^2\\right)_x = 0.$$\n对于 Riemann 初始数据，$x  x_0$ 时 $u(x,0) = u_L$，$x > x_0$ 时 $u(x,0) = u_R$，其中 $u_L > u_R$，会形成一个激波并以恒定速度 $s$ 传播，该速度由 Rankine-Hugoniot 条件确定：\n$$s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{u_L + u_R}{2}.$$\n在时间 $t$ 的精确激波位置是 $x_s(t) = x_0 + st$。\n\n**数值实现**\n我们在单元尺寸为 $\\Delta x = L/N$ 的均匀网格上实现一个守恒有限体积格式。状态变量 $u_i^n$ 表示在时间 $t^n$ 时单元 $i$ 中解的单元平均值。更新公式为\n$$u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),$$\n其中 $F_{i+\\frac{1}{2}}$ 是单元 $i$ 和单元 $i+1$ 之间界面的数值通量。我们使用 Lax-Friedrichs 通量：\n$$F_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(f(u_i) + f(u_{i+1})\\right) - \\frac{1}{2}\\alpha_{i+\\frac{1}{2}}(u_{i+1} - u_i),$$\n其中通量函数为 $f(u) = \\frac{1}{2}u^2$，局部耗散系数为 $\\alpha_{i+\\frac{1}{2}} = \\max\\{|u_i|, |u_{i+1}|\\}$。该格式为一阶精度。时间步长 $\\Delta t$ 由 CFL 条件控制，常数 $\\mathrm{CFL}=0.45$：\n$$\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i^n|}.$$\n流出边界条件通过将区域两端的单个虚拟单元中的值设置为与其相邻的内部单元中心值相等来处理（零梯度外插）。\n\n**误差分析：激波位置**\n主要的误差度量是激波位置误差，$e_s(t) = x_s^{\\mathrm{num}}(t) - x_s(t)$。为了找到数值激波位置 $x_s^{\\mathrm{num}}(t)$，我们定位数值解 $u(x,t)$ 穿过中间状态值 $u_m = (u_L+u_R)/2$ 的位置。这通过找到跨越 $u_m$ 的两个相邻网格单元 $(i, i+1)$ 并使用线性插值来找到子网格穿越点来实现。为了保证鲁棒性，实现了一个基于定位最大梯度单元界面的备用程序，尽管预计单调的 Lax-Friedrichs 格式不会触发它。这个标量误差的 $L_1$ 范数就是它的绝对值，$\\|e_s\\|_1 = |e_s(t)|$。\n\n### 2. 接触间断模型：线性平流\n\n**控制方程和精确解**\n无源标量密度 $\\rho$ 的线性平流由下式控制\n$$\\rho_t + a \\rho_x = 0,$$\n其中 $a$ 是一个恒定速度。对于 Riemann 初始数据，间断仅以速度 $a$ 平移而不改变其形状。接触的精确宽度保持为零。对于长度为 $L$ 的周期性区域，其位置为 $x_c(t) = (x_0 + at) \\pmod{L}$。\n\n**数值实现**\n在均匀的周期性网格上使用一阶迎风有限差分格式。对于给定的参数 $a=0.5 \\text{ m/s} > 0$，更新公式为\n$$\\rho_i^{n+1} = \\rho_i^n - \\nu\\left(\\rho_i^n - \\rho_{i-1}^n\\right),$$\n其中 $\\nu = a\\Delta t / \\Delta x$ 是 Courant 数。通过对 $\\rho_{i-1}$ 项使用循环移位来强制周期性。时间步长由 CFL 条件确定，$\\mathrm{CFL}=0.9$：\n$$\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{|a|}.$$\n\n**误差分析：接触宽度**\n一阶格式会引入数值扩散，这会人为地加宽接触间断。这种加宽是要测量的主要误差。数值接触宽度 $\\hat{w}(t)$ 是根据归一化密度剖面 $\\eta(x,t) = (\\rho(x,t) - \\rho_R)/(\\rho_L - \\rho_R)$ 计算的。我们识别出 $\\eta$ 分别穿过阈值 $0.1$ 和 $0.9$ 的位置 $x_{10}(t)$ 和 $x_{90}(t)$。这些位置通过线性插值找到，搜索范围局限在 $\\eta$ 的最大梯度点周围，以确保识别出正确的过渡区。然后数值宽度计算为 $\\hat{w}(t) = |x_{10}(t) - x_{90}(t)|$。由于精确宽度 $w(t)$ 为零，宽度误差为 $e_w(t) = \\hat{w}(t)$，其 $L_1$ 范数为 $\\|e_w\\|_1 = \\hat{w}(t)$。\n\n### 3. 网格加密研究和收敛率\n\n对两种模型都进行了一项收敛性研究，使用了一系列四个网格分辨率，$N = 100, 200, 400, 800$。对于每个分辨率，记录相应的误差，即激波的 $\\|e_s\\|_1$ 或接触间断的 $\\|e_w\\|_1$。然后，经验收敛率 $R$ 计算为从连续加密中确定的成对率的平均值：\n$$R = \\frac{1}{3} \\sum_{j=1}^{3} \\frac{\\log\\left(E_{N_j} / E_{N_{j+1}}\\right)}{\\log(2)},$$\n其中 $E_{N_j}$ 是来自序列 $\\{100, 200, 400, 800\\}$ 的分辨率 $N_j$ 的误差。对于一阶格式，激波位置误差预计以 $R \\approx 1$ 的速率收敛，而由与 $\\Delta x$ 成正比的数值扩散主导的接触宽度，也预计以 $R \\approx 1$ 的速率收敛。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_shock_sim(N):\n    \"\"\"\n    Solves the 1D inviscid Burgers' equation for a shock tube problem\n    using a first-order Lax-Friedrichs finite-volume scheme.\n    \"\"\"\n    # Parameters from problem statement\n    L = 1.0  # meters\n    x0 = 0.5  # meters\n    u_L = 2.0  # m/s\n    u_R = 0.0  # m/s\n    t_final = 0.2  # seconds\n    CFL_val = 0.45\n\n    # Grid setup\n    dx = L / N\n    # Array with one ghost cell on each side\n    u = np.zeros(N + 2)\n    # Cell centers for the physical domain\n    domain_x = np.linspace(0.5 * dx, L - 0.5 * dx, N)\n\n    # Initial condition\n    u[1:-1] = np.where(domain_x  x0, u_L, u_R)\n    \n    t = 0.0\n    while t  t_final:\n        # Boundary conditions: outflow (zero-gradient)\n        u[0] = u[1]\n        u[-1] = u[-2]\n\n        # Time step from CFL condition\n        max_speed = np.max(np.abs(u))\n        if max_speed  1e-9: # Avoid division by zero\n            dt = t_final - t\n        else:\n            dt = CFL_val * dx / max_speed\n        \n        dt = min(dt, t_final - t)\n\n        # Lax-Friedrichs flux calculation\n        f_u = 0.5 * u**2\n        u_left = u[:-1]\n        u_right = u[1:]\n        \n        alpha = np.maximum(np.abs(u_left), np.abs(u_right))\n        flux = 0.5 * (f_u[:-1] + f_u[1:]) - 0.5 * alpha * (u_right - u_left)\n        \n        # Update solution in the physical domain\n        u[1:-1] -= (dt / dx) * (flux[1:] - flux[:-1])\n        \n        t += dt\n\n    # Post-processing to find error\n    s = (u_L + u_R) / 2.0\n    x_s_exact = x0 + s * t_final\n    \n    u_m = (u_L + u_R) / 2.0\n    u_domain = u[1:-1]\n    \n    x_s_num = None\n    # Find shock position via linear interpolation\n    for i in range(N - 1):\n        if u_domain[i] > u_m and u_domain[i+1] = u_m:\n            y1, y2 = u_domain[i], u_domain[i+1]\n            x1 = domain_x[i]\n            # (x2-x1) is dx\n            x_s_num = x1 + dx * (u_m - y1) / (y2 - y1)\n            break\n            \n    # Fallback if no crossing is found\n    if x_s_num is None:\n        grad_u = np.abs(u_domain[1:] - u_domain[:-1])\n        max_grad_idx = np.argmax(grad_u)\n        # Midpoint of the cell face with maximal gradient\n        x_s_num = domain_x[max_grad_idx] + 0.5 * dx\n\n    return np.abs(x_s_num - x_s_exact)\n\n\ndef run_contact_sim(N):\n    \"\"\"\n    Solves the 1D linear advection equation for a contact discontinuity\n    using a first-order upwind finite-difference scheme.\n    \"\"\"\n    # Parameters from problem statement\n    L = 1.0  # meters\n    x0 = 0.25  # meters\n    rho_L = 1.0  # kg/m^3\n    rho_R = 0.1  # kg/m^3\n    a = 0.5  # m/s\n    t_final = 0.4  # seconds\n    CFL_val = 0.9\n\n    # Grid setup\n    dx = L / N\n    x = np.linspace(0.5 * dx, L - 0.5 * dx, N)\n    rho = np.where(x  x0, rho_L, rho_R)\n    \n    t = 0.0\n    # Fixed timestep and Courant number for linear advection\n    dt_cfl = CFL_val * dx / np.abs(a)\n    nu_cfl = a * dt_cfl / dx\n\n    while t  t_final:\n        dt = min(dt_cfl, t_final - t)\n        nu = a * dt / dx\n        \n        # Update with first-order upwind scheme (a > 0)\n        # Periodic BCs handled by np.roll\n        rho_prev = np.roll(rho, 1)\n        rho = rho - nu * (rho - rho_prev)\n        \n        t += dt\n\n    # Post-processing to find contact width\n    eta = (rho - rho_R) / (rho_L - rho_R)\n    \n    def find_crossing_pos(vals, x_coords, threshold):\n        for i in range(N):\n            i_p1 = (i + 1) % N\n            y1, y2 = vals[i], vals[i_p1]\n            if (y1 - threshold) * (y2 - threshold) = 0 and y1 > y2:\n                x1 = x_coords[i]\n                return x1 + dx * (threshold - y1) / (y2 - y1)\n        return None\n\n    x_90 = find_crossing_pos(eta, x, 0.9)\n    x_10 = find_crossing_pos(eta, x, 0.1)\n\n    if x_90 is None or x_10 is None:\n        return np.nan # Should not happen in this problem\n\n    # Since profile is decreasing, x_90  x_10. Width is positive.\n    width = x_10 - x_90\n    if width  0: # Handle periodic wrap-around case\n        width += L\n    \n    return width\n\n\ndef calculate_rate(errors):\n    \"\"\"Calculates the average convergence rate.\"\"\"\n    rates = []\n    for i in range(len(errors) - 1):\n        # Avoid log(0) or division by zero\n        if errors[i] = 0 or errors[i+1] = 0:\n            continue\n        ratio_err = errors[i] / errors[i+1]\n        rate = np.log2(ratio_err) # Equivalent to log(ratio)/log(2)\n        rates.append(rate)\n    return np.mean(rates) if rates else np.nan\n\n\ndef solve():\n    \"\"\"\n    Main driver function to run simulations, calculate errors and rates,\n    and print the final result in the specified format.\n    \"\"\"\n    N_vals = [100, 200, 400, 800]\n    \n    shock_errors = [run_shock_sim(N) for N in N_vals]\n    R_shock = calculate_rate(shock_errors)\n\n    contact_errors = [run_contact_sim(N) for N in N_vals]\n    R_contact = calculate_rate(contact_errors)\n    \n    results = shock_errors + [R_shock] + contact_errors + [R_contact]\n    \n    # Format and print the final output line\n    print(f\"[{','.join(f'{x:.8f}' for x in results)}]\")\n\nsolve()\n\n```", "id": "3521202"}, {"introduction": "为了在不引入数值振荡的情况下精确地捕捉间断，高阶数值格式至关重要。本练习将带您深入了解现代激波捕捉格式的核心——MUSCL (Monotonic Upstream-centered Schemes for Conservation Laws) 重构。您将亲手实现一个二阶有限体积法，并探索不同斜率限制器（如 minmod、MC、van Leer 和 superbee）在模拟接触间断时的效果，从而直观地理解在保持数值稳定性和获得高分辨率之间的权衡 [@problem_id:3521267]。", "problem": "考虑一维标量守恒律 $\\partial_t q + \\partial_x f(q) = 0$，该方程定义在长度为 $L$ 的周期性域上，并具有包含单个接触间断的分段常数初始条件。在可压缩流的接触间断中，诸如密度或质量分数之类的被动平流标量由底层速度场输运，其形状保持不变。使用线性平流通量 $f(q) = a q$ 对此输运过程进行建模，其中平流速度 $a$ 为常数，使得守恒律变为 $\\partial_t q + a \\partial_x q = 0$。使用具有均匀网格单元的有限体积法，其中 $q_i^n$ 表示在时间层 $n$ 时网格单元索引 $i$ 处的单元平均值，均匀网格间距为 $\\Delta x = L/N$，时间步长 $\\Delta t$ 由指定的库朗数 $C$ 通过 $\\Delta t = C \\Delta x / |a|$ 设定。单个时间步的更新公式为 $q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right)$，其中 $F_{i+1/2}^n$ 是网格单元 $i$ 和 $i+1$ 之间界面上的数值通量，并施加周期性边界条件。\n\n通过对 $q_i^n$ 进行分段线性重构，构造二阶精度守恒律单调上游中心格式 (MUSCL) 的界面状态 $q_{i+1/2}^{L}$ 和 $q_{i+1/2}^{R}$，并使用从以下集合中选择的斜率限制器：minmod、单调中心 (MC)、van Leer 或 superbee。该斜率限制器必须强制执行与总变差递减 (TVD) 要求一致的单调性，在存在局部极值时降为一阶迎风格式，并在可能的情况下锐化接触间断而不产生伪振荡。使用线性平流的迎风 Godunov 通量：对于 $a \\ge 0$，选择 $F_{i+1/2}^n = a \\, q_{i+1/2}^{L}$；对于 $a  0$，选择 $F_{i+1/2}^n = a \\, q_{i+1/2}^{R}$。\n\n将解从初始数据推进一个时间步后，使用以下指标评估振荡控制和接触锐度：\n- 最大过冲幅度：设 $q_{\\min}^0 = \\min_i q_i^0$ 和 $q_{\\max}^0 = \\max_i q_i^0$，定义 $\\mathrm{overshoot\\_max} = \\max_i \\max\\left(0, q_i^{1} - q_{\\max}^0, q_{\\min}^0 - q_i^{1}\\right)$，表示为浮点数。\n- 总变差增量：设 $\\mathrm{TV}(q) = \\sum_i \\left|q_{i+1} - q_i\\right|$（使用周期性索引），定义 $\\Delta \\mathrm{TV} = \\mathrm{TV}(q^{1}) - \\mathrm{TV}(q^{0})$，表示为浮点数。\n- 接触过渡宽度：给定已知的平台值 $q_L$（左态）和 $q_R$（右态），定义 $\\mathrm{width} = \\#\\{i \\mid \\min(q_L,q_R)  q_i^1  \\max(q_L,q_R)\\}$，表示为更新后其值严格位于两个平台之间的网格单元的整数计数。\n\n您的程序必须实现单个时间步的重构和更新，并为下面的每个测试用例计算这些指标。使用周期性域。所有数学运算必须一致且科学上合理。不允许外部输入。\n\n测试套件：\n- 用例 1：$N = 100$，$L = 1$，$a = 1$，$C = 0.8$，限制器 = minmod，接触位置在域的 $x_c = 0.4$ 比例处，平台值为 $q_L = 1.0$，$q_R = 0.1$，附加局部噪声振幅 $\\epsilon = 0$。\n- 用例 2：$N = 100$，$L = 1$，$a = 1$，$C = 0.95$，限制器 = MC，接触位置在域的 $x_c = 0.4$ 比例处，平台值为 $q_L = 1.0$，$q_R = 0.1$，附加局部噪声振幅 $\\epsilon = 0.01$，通过 $q_i \\mapsto q_i + \\epsilon \\sin\\left(2\\pi i / N\\right)$ 应用于以接触点为中心的确切 5 个单元。\n- 用例 3：$N = 20$，$L = 1$，$a = 1$，$C = 0.5$，限制器 = vanleer，接触位置在域的 $x_c = 0.5$ 比例处，平台值为 $q_L = 2.0$，$q_R = 1.5$，$\\epsilon = 0$。\n- 用例 4：$N = 80$，$L = 1$，$a = -1$，$C = 0.9$，限制器 = superbee，接触位置在域的 $x_c = 0.5$ 比例处，平台值为 $q_L = 1.0$，$q_R = 0.0$，附加局部噪声振幅 $\\epsilon = 0.005$，通过 $q_i \\mapsto q_i + \\epsilon \\sin\\left(2\\pi i / N\\right)$ 应用于以接触点为中心的确切 3 个单元。\n- 用例 5（边界条件和退化检查）：$N = 50$，$L = 1$，$a = 1$，$C = 0.7$，限制器 = MC，接触位置在域的 $x_c = 0.3$ 比例处，平台值为 $q_L = 0.5$，$q_R = 0.5$，$\\epsilon = 0$。\n\n初始化：对于每个用例，通过设置 $q_i^0 = q_L$（对于 $x_i  x_c L$）和 $q_i^0 = q_R$（对于 $x_i \\ge x_c L$）在均匀网格点 $x_i = (i+1/2)\\Delta x$ 上初始化 $q_i^0$，然后在以接触点索引 $i_c = \\lfloor x_c N \\rfloor$ 为中心的指定数量的单元上添加指定的局部噪声。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是一个包含三个值 $[\\mathrm{overshoot\\_max}, \\mathrm{width}, \\Delta \\mathrm{TV}]$ 的列表。将浮点值 $\\mathrm{overshoot\\_max}$ 和 $\\Delta \\mathrm{TV}$ 四舍五入到 $6$ 位小数，并将 $\\mathrm{width}$ 作为整数输出。例如，包含两个用例的输出将类似于 $[[0.000123,4,0.001234],[0.0,0,-0.000456]]$。", "solution": "用户提供的问题已经过验证，并被确定为是合理的、适定的和客观的。它代表了计算流体动力学和天体物理学领域中计算方法的标准任务。以下解决方案详细解释了方法论及其实施。\n\n该问题要求实现一个二阶精度守恒律单调上游中心格式 (MUSCL) 的有限体积法，以求解一维线性平流方程，\n$$\n\\partial_t q + a \\partial_x q = 0\n$$\n该方程定义在长度为 $L$ 的周期性域上。此处，$q(x,t)$ 是一个标量，而 $a$ 是一个恒定的平流速度。该方程是守恒律 $\\partial_t q + \\partial_x f(q) = 0$ 的一个特例，其线性通量函数为 $f(q) = aq$。\n\n数值解在 $N$ 个单元的均匀网格上计算，其中单元 $i$ 覆盖区间 $[x_{i-1/2}, x_{i+1/2}]$。单元中心位于 $x_i = (i+1/2)\\Delta x$，其中 $i=0, 1, \\dots, N-1$，网格间距为 $\\Delta x = L/N$。在时间层 $n$ 时，单元 $i$ 中 $q$ 的单元平均值记为 $q_i^n$。\n\n有限体积法通过守恒公式将单元平均值从时间层 $n$ 更新到下一层 $n+1$：\n$$\nq_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right)\n$$\n其中 $\\Delta t$ 是时间步长，而 $F_{i+1/2}^n$ 是网格单元 $i$ 和 $i+1$ 之间界面上的数值通量。时间步长由库朗-弗里德里希斯-列维 (CFL) 条件 $\\Delta t = C \\Delta x / |a|$ 确定，其中 $C$ 是指定的库朗数，为保证稳定性，其值必须小于或等于 $1$。应用周期性边界条件，意味着索引按模 $N$ 处理。\n\nMUSCL 格式的核心是在单元界面上对状态进行二阶精度的空间重构。在每个单元 $i$ 内部，数据由一个分段线性函数表示。这导致在每个界面处有两个不同的值：$q_{i+1/2}^L$，从左侧（单元 $i$）重构的状态，和 $q_{i+1/2}^R$，从右侧（单元 $i+1$）重构的状态。它们由以下公式给出：\n$$\nq_{i+1/2}^L = q_i^n + \\frac{1}{2} \\sigma_i\n$$\n$$\nq_{i+1/2}^R = q_{i+1}^n - \\frac{1}{2} \\sigma_{i+1}\n$$\n此处，$\\sigma_i$ 是 $q$ 在单元 $i$ 上变化的斜率限制表示。为防止伪振荡并确保格式是总变差递减 (TVD) 的，斜率 $\\sigma_i$ 是通过对相对于单元 $i$ 的后向和前向差分 $\\Delta q_{i-1/2} = q_i^n - q_{i-1}^n$ 和 $\\Delta q_{i+1/2} = q_{i+1}^n - q_i^n$ 应用斜率限制器函数来计算的。\n$$\n\\sigma_i = \\text{limiter}(\\Delta q_{i-1/2}, \\Delta q_{i+1/2})\n$$\n限制器函数定义如下，对于两个参数 $u$ 和 $v$：\n1.  **minmod**:\n    $$\n    \\text{minmod}(u, v) =\n    \\begin{cases}\n    \\text{sgn}(u) \\min(|u|, |v|)  \\text{if } uv > 0 \\\\\n    0  \\text{if } uv \\le 0\n    \\end{cases}\n    $$\n2.  **单调中心 (MC)**:\n    $$\n    \\text{MC}(u, v) =\n    \\begin{cases}\n    \\text{sgn}(u) \\min\\left(2|u|, 2|v|, \\frac{|u+v|}{2}\\right)  \\text{if } uv > 0 \\\\\n    0  \\text{if } uv \\le 0\n    \\end{cases}\n    $$\n3.  **van Leer**:\n    $$\n    \\text{vanLeer}(u, v) =\n    \\begin{cases}\n    \\frac{2uv}{u+v}  \\text{if } uv > 0 \\\\\n    0  \\text{if } uv \\le 0\n    \\end{cases}\n    $$\n4.  **superbee**:\n    $$\n    \\text{superbee}(u, v) =\n    \\begin{cases}\n    \\text{sgn}(u) \\max\\left(\\min(2|u|,|v|), \\min(|u|,2|v|)\\right)  \\text{if } uv > 0 \\\\\n    0  \\text{if } uv \\le 0\n    \\end{cases}\n    $$\n\n数值通量 $F_{i+1/2}^n$ 是一个迎风 Godunov 通量，它根据由平流速度 $a$ 的符号确定的信息流方向来选择界面状态：\n$$\nF_{i+1/2}^n =\n\\begin{cases}\na \\, q_{i+1/2}^{L}  \\text{if } a \\ge 0 \\\\\na \\, q_{i+1/2}^{R}  \\text{if } a  0\n\\end{cases}\n$$\n\n在计算所有单元 $i$ 的更新状态 $q_i^1$ 后，评估以下指标以评定格式的性能：\n-   **最大过冲幅度**：此指标衡量对初始数据全局最小值和最大值的最大违反程度。设 $q_{\\min}^0 = \\min_j q_j^0$ 和 $q_{\\max}^0 = \\max_j q_j^0$。过冲为：\n    $$\n    \\mathrm{overshoot\\_max} = \\max_i \\max\\left(0, q_i^{1} - q_{\\max}^0, q_{\\min}^0 - q_i^{1}\\right)\n    $$\n    值为 $0$ 表示一个尊重初始边界的无振荡结果。\n-   **总变差增量**：总变差 $\\mathrm{TV}(q) = \\sum_i \\left|q_{i+1} - q_i\\right|$（使用周期性索引）是衡量数据中总振荡的指标。对于 TVD 格式，总变差不应随时间增加。该指标是一个时间步后总变差的变化量：\n    $$\n    \\Delta \\mathrm{TV} = \\mathrm{TV}(q^{1}) - \\mathrm{TV}(q^{0})\n    $$\n-   **接触过渡宽度**：此指标衡量接触间断的数值耗散。它定义为值严格位于初始左右平台值 $q_L$ 和 $q_R$ 之间的单元数量：\n    $$\n    \\mathrm{width} = \\#\\{i \\mid \\min(q_L,q_R)  q_i^1  \\max(q_L,q_R)\\}\n    $$\n    较小的宽度表示捕获到的间断更锐利。\n\n算法的流程是：首先根据给定的分段常数剖面和任何指定的噪声来初始化单元平均值 $q_i^0$，然后计算斜率和界面状态，计算迎风通量，将解推进一个时间步，最后计算所需的指标。对于常数初始数据 ($q_L = q_R$) 的情况，格式应能精确地保持此状态，从而所有指标均为零。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a MUSCL finite volume scheme for the 1D linear advection equation\n    and computes performance metrics for several test cases.\n    \"\"\"\n    \n    test_cases = [\n        {'N': 100, 'L': 1.0, 'a': 1.0, 'C': 0.8, 'limiter': 'minmod', 'xc': 0.4, 'qL': 1.0, 'qR': 0.1, 'epsilon': 0.0, 'noise_cells': 0},\n        {'N': 100, 'L': 1.0, 'a': 1.0, 'C': 0.95, 'limiter': 'mc', 'xc': 0.4, 'qL': 1.0, 'qR': 0.1, 'epsilon': 0.01, 'noise_cells': 5},\n        {'N': 20, 'L': 1.0, 'a': 1.0, 'C': 0.5, 'limiter': 'vanleer', 'xc': 0.5, 'qL': 2.0, 'qR': 1.5, 'epsilon': 0.0, 'noise_cells': 0},\n        {'N': 80, 'L': 1.0, 'a': -1.0, 'C': 0.9, 'limiter': 'superbee', 'xc': 0.5, 'qL': 1.0, 'qR': 0.0, 'epsilon': 0.005, 'noise_cells': 3},\n        {'N': 50, 'L': 1.0, 'a': 1.0, 'C': 0.7, 'limiter': 'mc', 'xc': 0.3, 'qL': 0.5, 'qR': 0.5, 'epsilon': 0.0, 'noise_cells': 0},\n    ]\n\n    # --- Slope Limiter Functions ---\n    def minmod(a, b):\n        return np.where(a * b > 0, np.sign(a) * np.minimum(np.abs(a), np.abs(b)), 0)\n\n    def mc(a, b):\n        s = (a + b) / 2.0\n        # Use np.sign(s) instead of np.sign(a) to handle s=0 case if a,b are opposite signs\n        return np.where(a * b > 0, np.sign(s) * np.minimum(np.abs(s), np.minimum(2 * np.abs(a), 2 * np.abs(b))), 0)\n\n    def vanleer(a, b):\n        # Handle division by zero when a+b is close to zero\n        # This happens if a = -b or a=b=0. If a*b > 0, then a+b=0 only if a=b=0.\n        denom = a + b\n        # Epsilon can be larger since we're dealing with differences, not just machine precision\n        return np.where( (a * b > 0)  (np.abs(denom) > 1e-12), 2 * a * b / denom, 0)\n        \n    def superbee(a, b):\n        t1 = np.minimum(2 * np.abs(a), np.abs(b))\n        t2 = np.minimum(np.abs(a), 2 * np.abs(b))\n        return np.where(a * b > 0, np.sign(a) * np.maximum(t1, t2), 0)\n\n    limiters = {\n        'minmod': minmod,\n        'mc': mc,\n        'vanleer': vanleer,\n        'superbee': superbee\n    }\n\n    def total_variation(q):\n        \"\"\"Computes the total variation of a periodic array.\"\"\"\n        return np.sum(np.abs(np.roll(q, -1) - q))\n\n    results = []\n\n    for case in test_cases:\n        N = case['N']\n        L = case['L']\n        a = case['a']\n        C = case['C']\n        qL = case['qL']\n        qR = case['qR']\n        xc = case['xc']\n        epsilon = case['epsilon']\n        noise_cells = case['noise_cells']\n        limiter_func = limiters[case['limiter']]\n\n        # --- Grid and Time Step Setup ---\n        dx = L / N\n        dt = C * dx / abs(a)\n        \n        # --- Initialization ---\n        i = np.arange(N)\n        x = (i + 0.5) * dx\n        q0 = np.where(x  xc * L, qL, qR)\n\n        if epsilon > 0 and noise_cells > 0:\n            ic = int(np.floor(xc * N))\n            m = noise_cells // 2\n            noise_indices = np.arange(ic - m, ic + m + 1)\n            noise_indices = noise_indices % N  # Handle periodic wrap-around\n            q0[noise_indices] += epsilon * np.sin(2 * np.pi * noise_indices / N)\n\n        # --- Initial Metrics ---\n        q0_min = np.min(q0)\n        q0_max = np.max(q0)\n        tv0 = total_variation(q0)\n        \n        # --- MUSCL Finite Volume Step ---\n        # Get neighboring cell values with periodic boundaries\n        q_im1 = np.roll(q0, 1)\n        q_ip1 = np.roll(q0, -1)\n\n        # Compute differences for slope calculation\n        delta_fwd = q_ip1 - q0  # Corresponds to q_{i+1} - q_i\n        delta_bwd = q0 - q_im1  # Corresponds to q_i - q_{i-1}\n\n        # Compute limited slopes for each cell\n        # The limiter function arguments are (q_i - q_{i-1}, q_{i+1} - q_i)\n        sigma = limiter_func(delta_bwd, delta_fwd)\n\n        # Reconstruct interface states\n        q_L = q0 + 0.5 * sigma\n        q_R = q_ip1 - 0.5 * np.roll(sigma, -1)\n\n        # Compute upwind Godunov flux at interfaces i+1/2\n        if a >= 0:\n            F = a * q_L\n        else:\n            F = a * q_R\n        \n        # Get fluxes at interfaces i-1/2 by rolling\n        F_im1_2 = np.roll(F, 1)\n\n        # Update solution by one time step\n        q1 = q0 - (dt / dx) * (F - F_im1_2)\n\n        # --- Final Metrics Calculation ---\n        # 1. Maximum overshoot\n        overshoot = np.maximum(0, q1 - q0_max)\n        undershoot = np.maximum(0, q0_min - q1)\n        overshoot_max = np.max(np.maximum(overshoot, undershoot))\n\n        # 2. Total variation increase\n        tv1 = total_variation(q1)\n        delta_tv = tv1 - tv0\n\n        # 3. Contact transition width\n        plateau_min = min(qL, qR)\n        plateau_max = max(qL, qR)\n        \n        if plateau_min == plateau_max:\n             width = 0\n        else:\n             width = np.sum((q1 > plateau_min)  (q1  plateau_max))\n\n        results.append([round(overshoot_max, 6), int(width), round(delta_tv, 6)])\n\n    # --- Format final output correctly ---\n    formatted_results = []\n    for r in results:\n        # Use standard float formatting; round() handles cases like 0.0 correctly\n        # f-strings with precision (e.g. .6f) would write 0.0 as 0.000000\n        formatted_results.append(f\"[{r[0]},{r[1]},{r[2]}]\")\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3521267"}, {"introduction": "数值耗散是激波捕捉算法中一个不可或缺的组成部分，它模仿了物理粘性，以确保解的稳定性和唯一性。然而，不同数值方法处理耗散的方式各不相同，这导致它们在模拟不同类型的间断时表现出不同的特性。本练习通过一个半解析模型，让您比较两种在计算天体物理学中广泛使用的主要方法——基于网格的欧拉方法和基于粒子的拉格朗日方法（光滑粒子流体动力学，SPH）——是如何通过人工粘性来处理激波和接触间断的，从而揭示它们各自的优缺点 [@problem_id:3521219]。", "problem": "考虑由理想气体欧拉方程控制的一维可压缩流，其比热比为 $\\gamma$。该方程通过一个线性形式的人工粘性项 $q = C_{\\rm av}\\, \\rho\\, c_s\\, |\\nabla \\cdot u|$ 进行增广，其中 $\\rho$ 是质量密度，$u$ 是速度，$c_s$ 是当地声速，$C_{\\rm av}$ 是一个无量纲系数。在基于网格的有限体积格式中，通常将 $q$ 视为在特征分辨率尺度 $\\Delta x$ 上作用的有效体积粘性。在光滑粒子流体动力学 (SPH) 中，类似的耗散通常在光滑长度 $h$ 上进行参数化。对于正激波，假设耗散在分辨率尺度 $\\ell$ 上局部作用，表现为运动粘性 $\\nu_{\\rm eff}$，且 $\\nu_{\\rm eff} = C_{\\rm av}\\, c_s\\, \\ell$。\n\n您的任务是为一组测试案例计算以下四个量：\n- 在网格格式中，激波宽度（以 $\\Delta x$ 为单位测量），使用从粘性 Burgers 方程导出的稳态激波类比。\n- 在光滑粒子流体动力学 (SPH) 格式中，当其调整为与网格在分辨率尺度上的耗散相匹配时，激波宽度（以 $\\Delta x$ 为单位测量）。\n- 为使 SPH 在分辨率尺度上的耗散与网格耗散相匹配所需的 SPH 系数 $C_{\\rm av}^{\\rm sph}$。\n- 在有限时间 $t$ 后，网格格式中的接触间断弥散宽度（以 $\\Delta x$ 为单位测量），该过程被建模为被动标量的扩散，其扩散系数等于有效粘性。以及相应的 SPH 接触宽度，假设没有显式热导（因此密度扩散可忽略不计）。\n\n需使用的基本和建模假设：\n- 使用理想气体的正激波关系，根据上游马赫数 $M_1$ 和 $\\gamma$ 来确定下游与上游的密度压缩比 $r$。将上游状态视为 $(\\rho_1, p_1, u_1)$，其中 $\\rho_1 = 1$，$p_1 = 1$，且 $u_1 = M_1\\, c_{s1}$，这里 $c_{s1} = \\sqrt{\\gamma p_1 / \\rho_1} = \\sqrt{\\gamma}$。\n- 对于存在有效粘性 $\\nu_{\\rm eff}$ 的一维稳态激波，使用粘性 Burgers 方程的稳态解来近似激波内部结构，并通过最大梯度的倒数（基于斜率的厚度）来定义激波宽度 $\\delta$。这得出 $\\delta = 4 \\nu_{\\rm eff}/\\Delta u$，其中 $\\Delta u = u_1 - u_2$ 是速度跳跃，而 $u_2 = u_1/r$ 从质量守恒得到。\n- 对于网格格式，取 $\\nu_{\\rm eff}^{\\rm grid} = C_{\\rm av}^{\\rm grid}\\, c_{s1}\\, \\Delta x$，并以网格单元为单位计算激波宽度 $w_{\\rm shock}^{\\rm grid} = \\delta/\\Delta x$。\n- 对于 SPH 格式，取 $\\nu_{\\rm eff}^{\\rm sph} = C_{\\rm av}^{\\rm sph}\\, c_{s1}\\, h$。通过使两种格式的物理激波宽度 $\\delta$ 相等，来强制在分辨率尺度上耗散匹配，这将 $C_{\\rm av}^{\\rm sph}$ 定义为 $C_{\\rm av}^{\\rm grid}$ 和比率 $s = h/\\Delta x$ 的函数。使用这个匹配的 $C_{\\rm av}^{\\rm sph}$ 报告 SPH 激波宽度，单位为 $\\Delta x$。\n- 对于网格格式中的接触弥散，将一个初始尖锐的被动标量接触间断的演化建模为在时间 $t$ 内以扩散系数 $D = \\nu_{\\rm eff}^{\\rm grid}$ 进行的平流-扩散过程。将接触宽度测量为梯度函数的半峰全宽 (FWHM)，这得出 $w_{\\rm contact}^{\\rm grid} = 4 \\sqrt{(\\ln 2)\\, D\\, t}/\\Delta x$。对于没有显式热导的 SPH 格式，假设密度扩散可忽略不计，并取 $w_{\\rm contact}^{\\rm sph} \\approx 0$（以 $\\Delta x$ 为单位）。\n\n所有计算都是无量纲的，其中 $\\rho_1 = 1$，$p_1 = 1$，长度单位与 $\\Delta x$ 相同，时间单位与长度单位匹配，使得速度单位为单位长度/单位时间。宽度必须以 $\\Delta x$ 为单位报告，为无量纲浮点数。\n\n使用的定义：\n- 上游声速：$c_{s1} = \\sqrt{\\gamma}$。\n- 压缩比：$r = \\dfrac{(\\gamma + 1)\\, M_1^2}{(\\gamma - 1)\\, M_1^2 + 2}$。\n- 速度跳跃：$\\Delta u = u_1\\left(1 - \\dfrac{1}{r}\\right)$，其中 $u_1 = M_1\\, c_{s1}$。\n- 有效粘性：$\\nu_{\\rm eff}^{\\rm grid} = C_{\\rm av}^{\\rm grid}\\, c_{s1}\\, \\Delta x$，$\\nu_{\\rm eff}^{\\rm sph} = C_{\\rm av}^{\\rm sph}\\, c_{s1}\\, h$。\n- 激波宽度（基于斜率）：$\\delta = \\dfrac{4 \\nu_{\\rm eff}}{\\Delta u}$。\n- 以网格单元为单位的网格激波宽度：$w_{\\rm shock}^{\\rm grid} = \\dfrac{\\delta}{\\Delta x} = \\dfrac{4\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}}{\\Delta u}$。\n- SPH 网格匹配系数：$C_{\\rm av}^{\\rm sph} = C_{\\rm av}^{\\rm grid}\\, \\dfrac{\\Delta x}{h} = \\dfrac{C_{\\rm av}^{\\rm grid}}{s}$。\n- 以网格单元报告的 SPH 激波宽度：$w_{\\rm shock}^{\\rm sph} = \\left(\\dfrac{\\delta}{h}\\right)\\, s = \\dfrac{4\\, C_{\\rm av}^{\\rm sph}\\, c_{s1}}{\\Delta u}\\, s$。\n- 时间 $t$ 后以网格单元为单位的网格接触 FWHM：$w_{\\rm contact}^{\\rm grid} = \\dfrac{4 \\sqrt{(\\ln 2)\\, \\nu_{\\rm eff}^{\\rm grid}\\, t}}{\\Delta x} = 4 \\sqrt{(\\ln 2)\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}\\, t/\\Delta x}$。\n- 以网格单元为单位的 SPH 接触宽度：$w_{\\rm contact}^{\\rm sph} \\approx 0$。\n\n测试套件：\n提供以下参数集 $(\\gamma, M_1, C_{\\rm av}^{\\rm grid}, \\Delta x, s, t)$：\n- 案例 A（中等强度激波，典型光滑）：$(\\gamma = 1.4, M_1 = 2.0, C_{\\rm av}^{\\rm grid} = 1.0, \\Delta x = 1/400, s = 1.2, t = 0.1)$。\n- 案例 B（近声速边缘情况，典型光滑）：$(\\gamma = 1.4, M_1 = 1.05, C_{\\rm av}^{\\rm grid} = 1.0, \\Delta x = 1/400, s = 1.2, t = 0.1)$。\n- 案例 C（强激波，不同的 $\\gamma$ 和更精细的网格）：$(\\gamma = 1.667, M_1 = 10.0, C_{\\rm av}^{\\rm grid} = 0.5, \\Delta x = 1/1000, s = 1.0, t = 0.05)$。\n\n要求输出：\n对于每个案例，按以下顺序计算并输出一个包含五个浮点数的列表：\n$[w_{\\rm shock}^{\\rm grid}, w_{\\rm shock}^{\\rm sph}, C_{\\rm av}^{\\rm sph}, w_{\\rm contact}^{\\rm grid}, w_{\\rm contact}^{\\rm sph}]$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含所有三个案例的结果，形式为一个用方括号括起来的逗号分隔列表。将案例 A、案例 B 和案例 C 的五元素结果按顺序连接成一个扁平列表，例如 $[{\\rm A}_1,{\\rm A}_2,{\\rm A}_3,{\\rm A}_4,{\\rm A}_5,{\\rm B}_1,\\dots,{\\rm C}_5]$。所有宽度必须以 $\\Delta x$ 为单位报告，为无量纲浮点数，时间使用上述指定的无量纲单位。", "solution": "我们从一维理想气体欧拉方程的守恒形式开始，其比热比为 $\\gamma$。为了对激波进行数值模拟，许多格式通过增加一个人工粘性项来增广方程，该项在压缩时起到有效体积粘性的作用。在线性人工粘性中，我们在动量和能量方程的压力项中加入 $q = C_{\\rm av}\\, \\rho\\, c_s\\, |\\nabla \\cdot u|$，其中 $C_{\\rm av}$ 是无量纲的，$\\rho$ 是密度，$u$ 是速度，$c_s$ 是声速。当在分辨率尺度 $\\ell$ 上进行粗粒化时，这相当于一个运动粘性 $\\nu_{\\rm eff}$，它与 $c_s$ 和 $\\ell$ 成正比：\n$$\n\\nu_{\\rm eff} = \\frac{q}{\\rho\\, |\\nabla \\cdot u|} \\approx C_{\\rm av}\\, c_s\\, \\ell.\n$$\n这种近似捕捉了分辨率尺度耗散的主导作用，并且对于设计参数研究是稳健的。\n\n对于正激波，无粘跳跃条件（Rankine–Hugoniot 关系）给出了压缩比作为上游马赫数 $M_1$ 和 $\\gamma$ 的函数：\n$$\nr \\equiv \\frac{\\rho_2}{\\rho_1} = \\frac{(\\gamma + 1) M_1^2}{(\\gamma - 1) M_1^2 + 2}.\n$$\n假设上游无量纲状态为 $\\rho_1 = 1$, $p_1 = 1$，则上游声速为 $c_{s1} = \\sqrt{\\gamma p_1/\\rho_1} = \\sqrt{\\gamma}$，上游速度为 $u_1 = M_1\\, c_{s1}$。根据激波前后的质量守恒，$\\rho_1 u_1 = \\rho_2 u_2$，因此 $u_2 = u_1/r$。速度跳跃则为\n$$\n\\Delta u = u_1 - u_2 = u_1 \\left(1 - \\frac{1}{r}\\right).\n$$\n\n为了将有效粘性与激波内部厚度联系起来，我们采用经过充分检验的粘性 Burgers 方程作为激波陡峭化与粘性平衡的局部模型：\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = \\nu_{\\rm eff} \\frac{\\partial^2 u}{\\partial x^2}.\n$$\n在稳态下（$\\partial u/\\partial t = 0$），连接两个具有速度跳跃 $\\Delta u$ 的恒定速度状态的精确激波解是\n$$\nu(x) = u_2 + \\frac{\\Delta u}{2} \\left[1 - \\tanh\\left(\\frac{\\Delta u}{2 \\nu_{\\rm eff}} (x - x_0)\\right)\\right].\n$$\n最大斜率出现在拐点 $x_0$ 处，其值为\n$$\n\\left|\\frac{du}{dx}\\right|_{\\max} = \\frac{(\\Delta u)^2}{4 \\nu_{\\rm eff}}.\n$$\n基于斜率的激波厚度 $\\delta$ 定义将 $\\delta$ 设为振幅与最大斜率之比：\n$$\n\\delta \\equiv \\frac{\\Delta u}{\\left|\\dfrac{du}{dx}\\right|_{\\max}} = \\frac{4 \\nu_{\\rm eff}}{\\Delta u}.\n$$\n该度量被广泛使用，因为它直接关系到所能达到的最陡梯度，并且对于剖面的单调重参数化是稳健的。\n\n在网格尺寸为 $\\Delta x$ 的网格格式中，设置 $\\nu_{\\rm eff}^{\\rm grid} = C_{\\rm av}^{\\rm grid} c_{s1} \\Delta x$ 会得到以网格单元为单位的网格激波宽度\n$$\nw_{\\rm shock}^{\\rm grid} \\equiv \\frac{\\delta}{\\Delta x} = \\frac{4 \\nu_{\\rm eff}^{\\rm grid}}{\\Delta u\\, \\Delta x} = \\frac{4\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}}{\\Delta u}.\n$$\n在光滑粒子流体动力学 (SPH) 中，光滑长度为 $h$，类似的有效粘性为 $\\nu_{\\rm eff}^{\\rm sph} = C_{\\rm av}^{\\rm sph} c_{s1} h$（光滑粒子流体动力学 (SPH) 用 $h$ 替代了网格分辨率 $\\Delta x$）。为了在分辨率尺度上匹配耗散（即产生相同的物理激波厚度 $\\delta$），我们令两种格式的 $\\delta$ 相等：\n$$\n\\frac{4\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}\\, \\Delta x}{\\Delta u} = \\frac{4\\, C_{\\rm av}^{\\rm sph}\\, c_{s1}\\, h}{\\Delta u}\n\\quad \\Rightarrow \\quad\nC_{\\rm av}^{\\rm sph} = C_{\\rm av}^{\\rm grid} \\frac{\\Delta x}{h}.\n$$\n定义 $s \\equiv h/\\Delta x$，这给出 $C_{\\rm av}^{\\rm sph} = C_{\\rm av}^{\\rm grid}/s$。以网格单元为单位报告的 SPH 激波宽度则为\n$$\nw_{\\rm shock}^{\\rm sph} \\equiv \\left(\\frac{\\delta}{h}\\right) s = \\left(\\frac{4\\, C_{\\rm av}^{\\rm sph}\\, c_{s1}}{\\Delta u}\\right) s = \\frac{4\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}}{\\Delta u} = w_{\\rm shock}^{\\rm grid}.\n$$\n因此，当在分辨率尺度上匹配耗散时，两种格式在以 $\\Delta x$ 为单位测量时会产生相同的激波宽度。\n\n为了量化接触间断的弥散，考虑一个被动标量（例如密度对比）以恒定的平均速度平流并以扩散系数 $D$ 扩散。从一个尖锐的阶跃开始，剖面演化为一个误差函数，其梯度等于一个方差为 $\\sigma^2 = 2 D t$ 的高斯函数。一个物理上有意义且可测量的宽度是梯度的半峰全宽 (FWHM)，即\n$$\n{\\rm FWHM} = 2 \\sqrt{2 \\ln 2}\\, \\sigma = 2 \\sqrt{2 \\ln 2}\\, \\sqrt{2 D t} = 4 \\sqrt{(\\ln 2)\\, D\\, t}.\n$$\n对于网格格式，我们设置 $D = \\nu_{\\rm eff}^{\\rm grid} = C_{\\rm av}^{\\rm grid} c_{s1} \\Delta x$，因此在时间 $t$ 之后，以网格单元为单位的接触宽度为\n$$\nw_{\\rm contact}^{\\rm grid} = \\frac{{\\rm FWHM}}{\\Delta x} = \\frac{4 \\sqrt{(\\ln 2)\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}\\, \\Delta x\\, t}}{\\Delta x} = 4 \\sqrt{(\\ln 2)\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}\\, t / \\Delta x}.\n$$\n在没有显式人工热导的 SPH 中，密度由粒子精确平流，并且不受速度散度粘性的影响；因此，在连续介质极限下，接触保持尖锐，给出\n$$\nw_{\\rm contact}^{\\rm sph} \\approx 0.\n$$\n\n每个测试案例 $(\\gamma, M_1, C_{\\rm av}^{\\rm grid}, \\Delta x, s, t)$ 的算法步骤：\n1. 计算 $c_{s1} = \\sqrt{\\gamma}$，$u_1 = M_1 c_{s1}$。\n2. 计算 $r = \\dfrac{(\\gamma + 1) M_1^2}{(\\gamma - 1) M_1^2 + 2}$ 和 $\\Delta u = u_1\\left(1 - \\dfrac{1}{r}\\right)$。\n3. 计算 $w_{\\rm shock}^{\\rm grid} = \\dfrac{4 C_{\\rm av}^{\\rm grid} c_{s1}}{\\Delta u}$。\n4. 计算 $C_{\\rm av}^{\\rm sph} = \\dfrac{C_{\\rm av}^{\\rm grid}}{s}$。\n5. 计算 $w_{\\rm shock}^{\\rm sph} = \\left(\\dfrac{4 C_{\\rm av}^{\\rm sph} c_{s1}}{\\Delta u}\\right) s$；根据构造，这等于 $w_{\\rm shock}^{\\rm grid}$。\n6. 计算 $w_{\\rm contact}^{\\rm grid} = 4 \\sqrt{(\\ln 2)\\, C_{\\rm av}^{\\rm grid}\\, c_{s1}\\, t / \\Delta x}$。\n7. 设置 $w_{\\rm contact}^{\\rm sph} = 0$。\n\n边缘情况和一致性：\n- 当 $M_1 \\to 1^+$ 时，压缩比 $r \\to 1$，所以 $\\Delta u \\to 0^+$ 且 $w_{\\rm shock}^{\\rm grid} \\to \\infty$，反映了弱激波的物理扩散。这是对公式的一个敏感测试。\n- 当 $M_1$ 很大时，$r \\to (\\gamma + 1)/(\\gamma - 1)$ 且 $\\Delta u \\sim u_1 (1 - 1/r)$ 随 $M_1$ 线性增长；因此 $w_{\\rm shock}^{\\rm grid} \\propto 1/M_1$，这是一个强激波极限的检验。\n- 在固定的 $C_{\\rm av}^{\\rm grid}$ 和 $c_{s1}$ 下，接触宽度 $w_{\\rm contact}^{\\rm grid}$ 与 $\\sqrt{t/\\Delta x}$ 成比例，这与网格上的扩散一致，其中 $\\nu_{\\rm eff} \\propto \\Delta x$。\n\n将此应用于指定的测试套件，程序将为每个案例计算并返回五个所要求的浮点数 $[w_{\\rm shock}^{\\rm grid}, w_{\\rm shock}^{\\rm sph}, C_{\\rm av}^{\\rm sph}, w_{\\rm contact}^{\\rm grid}, w_{\\rm contact}^{\\rm sph}]$，并将它们连接成一个扁平列表。所有宽度以 $\\Delta x$ 为单位，时间使用指定的无量纲单位。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef shock_compression_ratio(gamma, M1):\n    # r = ((gamma + 1) M^2) / ((gamma - 1) M^2 + 2)\n    return ((gamma + 1.0) * M1**2) / (((gamma - 1.0) * M1**2) + 2.0)\n\ndef upstream_sound_speed(gamma):\n    # c_s1 = sqrt(gamma * p1 / rho1) with p1 = rho1 = 1\n    return np.sqrt(gamma)\n\ndef delta_u(gamma, M1):\n    c1 = upstream_sound_speed(gamma)\n    u1 = M1 * c1\n    r = shock_compression_ratio(gamma, M1)\n    if np.abs(r)  1e-9: # Avoid division by zero if r is zero for some reason\n        return u1\n    return u1 * (1.0 - 1.0 / r)\n\ndef w_shock_grid(gamma, M1, C_av_grid):\n    # w_shock_grid = 4 * C_av_grid * c_s1 / Δu\n    c1 = upstream_sound_speed(gamma)\n    du = delta_u(gamma, M1)\n    if np.abs(du)  1e-9: # Avoid division by zero for very weak shocks (M1 -> 1)\n        return np.inf\n    return 4.0 * C_av_grid * c1 / du\n\ndef cav_sph_match(C_av_grid, s):\n    # C_av_sph = C_av_grid / s\n    if np.abs(s)  1e-9:\n        return np.inf\n    return C_av_grid / s\n\ndef w_shock_sph_matched(gamma, M1, C_av_grid, s):\n    # w_shock_sph in grid-cell units = (4 * C_av_sph * c1 / Δu) * s\n    # By construction, this is equal to w_shock_grid\n    return w_shock_grid(gamma, M1, C_av_grid)\n\ndef w_contact_grid(gamma, C_av_grid, dx, t):\n    # w_contact_grid = 4 * sqrt( ln(2) * C_av_grid * c_s1 * t / dx )\n    c1 = upstream_sound_speed(gamma)\n    if np.abs(dx)  1e-9:\n        return np.inf\n    return 4.0 * np.sqrt(np.log(2.0) * C_av_grid * c1 * t / dx)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (gamma, M1, C_av_grid, dx, s, t)\n    test_cases = [\n        (1.4,   2.0, 1.0, 1.0/400.0, 1.2, 0.1),    # Case A\n        (1.4,   1.05, 1.0, 1.0/400.0, 1.2, 0.1),   # Case B (near-sonic)\n        (1.667, 10.0, 0.5, 1.0/1000.0, 1.0, 0.05), # Case C (strong shock)\n    ]\n\n    results = []\n    for gamma, M1, C_av_grid, dx, s, t in test_cases:\n        w_grid = w_shock_grid(gamma, M1, C_av_grid)\n        w_sph = w_shock_sph_matched(gamma, M1, C_av_grid, s)\n        cav_sph = cav_sph_match(C_av_grid, s)\n        wc_grid = w_contact_grid(gamma, C_av_grid, dx, t)\n        wc_sph = 0.0  # negligible without explicit conductivity\n        results.extend([\n            w_grid, w_sph, cav_sph, wc_grid, wc_sph\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3521219"}]}