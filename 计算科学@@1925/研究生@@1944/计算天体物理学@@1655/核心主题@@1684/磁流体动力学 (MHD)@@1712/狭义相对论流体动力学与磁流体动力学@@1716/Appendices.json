{"hands_on_practices": [{"introduction": "狭义相对论流体动力学的基石是应力-能量张量 $T^{\\mu\\nu}$。这个单一的数学对象以一种尊重相对论原理的方式，优雅地包含了能量和动量的密度与通量。本练习 [@problem_id:3536844] 提供了一个基础训练，即从物理上更直观的原始变量（如静止质量密度 $\\rho$、压力 $p$ 和速度 $\\mathbf{v}$）出发，构建实验室参考系中的 $T^{\\mu\\nu}$ 各个分量。掌握这一转换是理解和开发相对论天体物理保守格式数值格式的首要基本步骤。", "problem": "考虑在平直时空中的非磁化理想流体，这与狭义相对论流体动力学 (SRHD) 相关，并且在计算天体物理应用中，原始变量被映射到守恒变量。采用自然单位制，其中光速 $c=1$，并使用闵可夫斯基度规 $g^{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$，其中希腊指标取值从 $0$ 到 $3$，拉丁指标取值从 $1$ 到 $3$。原始状态由静质量密度 $\\rho$、热压力 $p$ 和三维速度 $\\mathbf{v}=(v_{x},v_{y},v_{z})$ 给出，且 $|\\mathbf{v}|  1$。洛伦兹因子为 $\\gamma=\\left(1-|\\mathbf{v}|^{2}\\right)^{-1/2}$，状态方程为 $\\Gamma$ 律理想气体，绝热指数 $\\Gamma=\\tfrac{4}{3}$。\n\n仅使用与理想流体的洛伦茲协变性一致的基本原理以及四维速度 $u^{\\mu}=\\gamma(1,\\mathbf{v})$ 的定义，构建实验室参考系下的应力-能量张量 $T^{\\mu\\nu}$，并用 $\\rho$、$p$ 和 $\\mathbf{v}$ 表示。具体要求如下：\n- 从狭义相对论中理想流体应力-能量张量的一个有效协变表示和 $\\Gamma$ 律状态方程出发，不使用任何特殊的捷径。\n- 明确推导出所有分量 $T^{00}$、$T^{0i}$ 和 $T^{ij}$ 作为 $\\rho$、$p$、$v_{x}$、$v_{y}$ 和 $v_{z}$ 的函数。\n- 验证对称性 $T^{\\mu\\nu}=T^{\\nu\\mu}$，并计算当 $\\Gamma=\\tfrac{4}{3}$ 时的标量迹 $T\\equiv g_{\\mu\\nu}T^{\\mu\\nu}$，将其用 $\\rho$ 和 $p$ 表示。\n\n将您的最终答案表示为一个完整的 $4\\times 4$ 矩阵 $T^{\\mu\\nu}$，其矩阵元明确地用 $\\rho$、$p$、$v_{x}$、$v_{y}$、$v_{z}$ 和 $\\gamma$ 写出。不需要进行数值计算。如果您引入了中间热力学量，请在给出最终矩阵之前，使用给定的状态方程将其消去，用 $\\rho$ 和 $p$ 表示。最终答案必须是 $T^{\\mu\\nu}$ 的单一闭合形式解析表达式，表达式中不包含任何单位。", "solution": "我们在平直时空中工作，使用闵可夫斯基度规 $g^{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$ 和自然单位制 $c=1$。对于理想流体，应力-能量张量必须是对称的、二阶的、洛伦兹协变的，并且在共动参考系中必须简化为能量密度和各向同性压力。满足这些要求的、经过充分检验的协变形式是\n$$\nT^{\\mu\\nu}=\\rho h\\,u^{\\mu}u^{\\nu}+p\\,g^{\\mu\\nu},\n$$\n其中 $\\rho$ 是静质量密度，$u^{\\mu}$ 是满足 $u^{\\mu}u_{\\mu}=-1$ 的四维速度，$p$ 是各向同性热压力，$h$ 是比焓。实验室参考系中的四维速度是\n$$\nu^{\\mu}=\\gamma(1,v_{x},v_{y},v_{z}),\n$$\n其中 $\\gamma=(1-|\\mathbf{v}|^{2})^{-1/2}$ 且 $|\\mathbf{v}|^{2}=v_{x}^{2}+v_{y}^{2}+v_{z}^{2}$。对于 $\\Gamma$ 律理想气体，\n$$\np=(\\Gamma-1)\\rho\\epsilon,\n$$\n其中 $\\epsilon$ 是比内能，比焓为\n$$\nh=1+\\epsilon+\\frac{p}{\\rho}.\n$$\n使用状态方程消去 $\\epsilon$ 得到\n$$\n\\epsilon=\\frac{p}{(\\Gamma-1)\\rho}\\quad\\Longrightarrow\\quad h=1+\\frac{p}{(\\Gamma-1)\\rho}+\\frac{p}{\\rho}=1+\\frac{\\Gamma}{\\Gamma-1}\\frac{p}{\\rho}.\n$$\n对于 $\\Gamma=\\tfrac{4}{3}$，\n$$\n\\frac{\\Gamma}{\\Gamma-1}=\\frac{\\tfrac{4}{3}}{\\tfrac{1}{3}}=4\\quad\\Longrightarrow\\quad h=1+4\\frac{p}{\\rho}.\n$$\n因此\n$$\n\\rho h=\\rho+4p.\n$$\n\n将 $u^{\\mu}$ 和 $g^{\\mu\\nu}$ 代入 $T^{\\mu\\nu}=\\rho h\\,u^{\\mu}u^{\\nu}+p\\,g^{\\mu\\nu}$，我们按分量得到：\n- 时间-时间分量：\n$$\nT^{00}=\\rho h\\,u^{0}u^{0}+p\\,g^{00}=\\rho h\\,\\gamma^{2}+p(-1)=(\\rho+4p)\\gamma^{2}-p.\n$$\n- 时间-空间分量：\n$$\nT^{0i}=\\rho h\\,u^{0}u^{i}+p\\,g^{0i}=\\rho h\\,\\gamma^{2}v_{i}+0=(\\rho+4p)\\gamma^{2}v_{i},\\quad i\\in\\{x,y,z\\}.\n$$\n- 空间-空间分量：\n$$\nT^{ij}=\\rho h\\,u^{i}u^{j}+p\\,g^{ij}=\\rho h\\,\\gamma^{2}v_{i}v_{j}+p\\,\\delta^{ij}=(\\rho+4p)\\gamma^{2}v_{i}v_{j}+p\\,\\delta^{ij}.\n$$\n\n将这些分量收集到有序基 $(0,1,2,3)\\equiv(0,x,y,z)$ 下的完整矩阵中，我们有\n$$\nT^{\\mu\\nu}=\n\\begin{pmatrix}\n(\\rho+4p)\\gamma^{2}-p  (\\rho+4p)\\gamma^{2}v_{x}  (\\rho+4p)\\gamma^{2}v_{y}  (\\rho+4p)\\gamma^{2}v_{z} \\\\\n(\\rho+4p)\\gamma^{2}v_{x}  (\\rho+4p)\\gamma^{2}v_{x}^{2}+p  (\\rho+4p)\\gamma^{2}v_{x}v_{y}  (\\rho+4p)\\gamma^{2}v_{x}v_{z} \\\\\n(\\rho+4p)\\gamma^{2}v_{y}  (\\rho+4p)\\gamma^{2}v_{x}v_{y}  (\\rho+4p)\\gamma^{2}v_{y}^{2}+p  (\\rho+4p)\\gamma^{2}v_{y}v_{z} \\\\\n(\\rho+4p)\\gamma^{2}v_{z}  (\\rho+4p)\\gamma^{2}v_{x}v_{z}  (\\rho+4p)\\gamma^{2}v_{y}v_{z}  (\\rho+4p)\\gamma^{2}v_{z}^{2}+p\n\\end{pmatrix}.\n$$\n\n对称性的验证从其构造上是显而易见的：$u^{\\mu}u^{\\nu}$ 对其指标是对称的，而 $g^{\\mu\\nu}$ 也是对称的，因此 $T^{\\mu\\nu}=T^{\\nu\\mu}$。\n\n对于迹，我们与度规进行缩并：\n$$\nT\\equiv g_{\\mu\\nu}T^{\\mu\\nu}=g_{\\mu\\nu}\\left(\\rho h\\,u^{\\mu}u^{\\nu}+p\\,g^{\\mu\\nu}\\right)=\\rho h\\,u^{\\mu}u_{\\mu}+p\\,g_{\\mu\\nu}g^{\\mu\\nu}.\n$$\n使用 $u^{\\mu}u_{\\mu}=-1$ 和 $g_{\\mu\\nu}g^{\\mu\\nu}=\\delta^{\\mu}_{\\mu}=4$，我们得到\n$$\nT=-\\rho h+4p.\n$$\n代入 $h=1+4p/\\rho$，上式变为\n$$\nT=-\\rho\\left(1+4\\frac{p}{\\rho}\\right)+4p=-\\rho-4p+4p=-\\rho.\n$$\n因此，对于 $\\Gamma=\\tfrac{4}{3}$，理想流体应力-能量张量的迹等于 $-\\rho$，与 $\\mathbf{v}$ 和 $p$ 无关。这与预期相符，即在共动参考系中，能量密度等于 $E=\\rho+\\rho\\epsilon$，而焓满足 $\\rho h=E+p$，从而确保在静止时 $T^{00}=E$ 且空间应力各向同性 $T^{ii}=p$，并在洛伦茲变换后得出上述迹的关系。\n\n因此，对于给定的状态 $(\\rho,p,\\mathbf{v})$ 和 $\\Gamma=\\tfrac{4}{3}$，完整的实验室参考系应力-能量张量如上所示，它是对称的，且其迹等于 $-\\rho$。", "answer": "$$\\boxed{\n\\begin{pmatrix}\n(\\rho+4p)\\gamma^{2}-p  (\\rho+4p)\\gamma^{2}v_{x}  (\\rho+4p)\\gamma^{2}v_{y}  (\\rho+4p)\\gamma^{2}v_{z} \\\\\n(\\rho+4p)\\gamma^{2}v_{x}  (\\rho+4p)\\gamma^{2}v_{x}^{2}+p  (\\rho+4p)\\gamma^{2}v_{x}v_{y}  (\\rho+4p)\\gamma^{2}v_{x}v_{z} \\\\\n(\\rho+4p)\\gamma^{2}v_{y}  (\\rho+4p)\\gamma^{2}v_{x}v_{y}  (\\rho+4p)\\gamma^{2}v_{y}^{2}+p  (\\rho+4p)\\gamma^{2}v_{y}v_{z} \\\\\n(\\rho+4p)\\gamma^{2}v_{z}  (\\rho+4p)\\gamma^{2}v_{x}v_{z}  (\\rho+4p)\\gamma^{2}v_{y}v_{z}  (\\rho+4p)\\gamma^{2}v_{z}^{2}+p\n\\end{pmatrix}\n}$$", "id": "3536844"}, {"introduction": "应力-能量张量描述了流体的状态，而相对论声速 $c_s$ 则决定了信息如何以微小扰动的形式在流体中传播。它是一个关键参数，不仅决定了流动的因果结构，也是现代基于特征线的数值方法的基础。本练习 [@problem_id:3536864] 将指导您从第一性原理出发，推导理想流体的 $c_s$，并揭示其对流体热力学状态的依赖性。通过计算相对论马赫数，您将能对流动进行亚声速或超声速的分类，这对于理解激波和吸积流等现象至关重要。", "problem": "考虑一个由狭义相对论流体动力学 (SRHD) 描述的均匀理想流体，其状态方程 (EOS) 为伽马定律，绝热指数为 $\\Gamma=4/3$。采用光速 $c=1$ 的单位制，因此所有速度都是无量纲的。该流体的静质量密度为 $\\rho=1.0$，热力学压力为 $p=1.0$。在实验室参考系中，一个稳定流以速度 $v=0.9$ 运动。从相对论声速的基本定义和伽马定律状态方程出发，推导该流体的相对论声速 $c_s$ 关于 $(\\Gamma,\\rho,p)$ 的表达式。然后，根据给定的 $(\\rho,p)$ 计算 $c_s$ 的值，并对给定的流速计算马赫数 $M=v/c_s$。将 $c_s$ 和 $M$ 表示为无量纲数。将数值结果四舍五入至四位有效数字。", "solution": "**相对论声速 $c_s$ 的推导**\n\n相对论声速的平方 $c_s^2$ 定义为在比熵 $s$ 恒定的情况下，压力 $p$ 对总能量密度 $e$ 的偏导数。在 $c=1$ 的单位制下，表达式为：\n$$c_s^2 = \\left( \\frac{\\partial p}{\\partial e} \\right)_s$$\n总能量密度 $e$ 是静质量密度 $\\rho$ 与内能密度 $\\rho\\epsilon$ 之和：\n$$e = \\rho + \\rho\\epsilon$$\n比焓 $h$ 定义为：\n$$h = \\frac{e+p}{\\rho}$$\n流体元的热力学第一定律 $d(e/\\rho) + p d(1/\\rho) = T ds$（其中 $T$ 是温度，$s$ 是比熵）可以重排为关系式 $de = h d\\rho + \\rho T ds$。对于等熵过程，$ds=0$，该式简化为：\n$$de = h d\\rho \\quad \\implies \\quad \\left( \\frac{\\partial e}{\\partial \\rho} \\right)_s = h$$\n使用链式法则，我们可以重写 $c_s^2$ 的定义：\n$$c_s^2 = \\left( \\frac{\\partial p}{\\partial \\rho} \\right)_s \\left( \\frac{\\partial \\rho}{\\partial e} \\right)_s$$\n代入热力学结果 $(\\partial \\rho / \\partial e)_s = 1/h$，我们得到：\n$$c_s^2 = \\frac{1}{h} \\left( \\frac{\\partial p}{\\partial \\rho} \\right)_s$$\n接下来，我们对伽马定律状态方程计算导数 $(\\partial p / \\partial \\rho)_s$。状态方程为 $p = K\\rho^\\Gamma$，其中比例常数 $K$ 仅是熵的函数，因此在等熵过程中为常数。所以：\n$$\\left( \\frac{\\partial p}{\\partial \\rho} \\right)_s = \\frac{d}{d\\rho}(K\\rho^\\Gamma) = K\\Gamma\\rho^{\\Gamma-1} = \\frac{p}{\\rho^\\Gamma} \\Gamma\\rho^{\\Gamma-1} = \\frac{\\Gamma p}{\\rho}$$\n将此结果代入 $c_s^2$ 的表达式中：\n$$c_s^2 = \\frac{\\Gamma p}{\\rho h}$$\n为了得到仅用 $\\Gamma$，$p$ 和 $\\rho$ 表示的 $c_s$ 表达式，我们必须用这些量来表示 $h$。对于具有伽马定律状态方程的理想流体，压力与比内能 $\\epsilon$ 的关系为 $p = (\\Gamma-1)\\rho\\epsilon$。在 $c=1$ 的单位制下，比焓为 $h = 1 + \\epsilon + p/\\rho$。代入 $\\epsilon = p/((\\Gamma-1)\\rho)$：\n$$h = 1 + \\frac{p}{(\\Gamma-1)\\rho} + \\frac{p}{\\rho} = 1 + p/\\rho \\left( \\frac{1}{\\Gamma-1} + 1 \\right) = 1 + \\frac{\\Gamma p}{(\\Gamma-1)\\rho}$$\n将这个 $h$ 的表达式代入 $c_s^2$ 的方程，我们便得到所需的表达式：\n$$c_s^2 = \\frac{\\Gamma p / \\rho}{1 + \\frac{\\Gamma p}{(\\Gamma-1)\\rho}} = \\frac{\\Gamma p}{\\rho + \\frac{\\Gamma p}{\\Gamma-1}}$$\n因此，相对论声速的表达式为：\n$$c_s = \\sqrt{\\frac{\\Gamma p}{\\rho + \\frac{\\Gamma p}{\\Gamma-1}}}$$\n\n**数值计算**\n\n我们已知以下数值：\n$\\Gamma = 4/3$\n$\\rho = 1.0$\n$p = 1.0$\n$v = 0.9$\n\n首先，我们计算 $c_s$ 的值。我们注意到 $\\Gamma-1 = 4/3 - 1 = 1/3$。\n$$c_s^2 = \\frac{(4/3)(1.0)}{(1.0) + \\frac{(4/3)(1.0)}{(1/3)}} = \\frac{4/3}{1.0 + 4.0} = \\frac{4/3}{5.0} = \\frac{4}{15}$$\n因此，声速为：\n$$c_s = \\sqrt{\\frac{4}{15}} = \\frac{2}{\\sqrt{15}} \\approx 0.51639777...$$\n四舍五入到四位有效数字，我们得到 $c_s = 0.5164$。由于 $c=1$，该值是无量纲的。\n\n接下来，我们计算马赫数 $M$，其定义为流速 $v$ 与声速 $c_s$之比：\n$$M = \\frac{v}{c_s} = \\frac{0.9}{2/\\sqrt{15}} = \\frac{0.9 \\sqrt{15}}{2} = 0.45\\sqrt{15} \\approx 1.7428425...$$\n四舍五入到四位有效数字得到 $M = 1.743$。由于 $M > 1$，该流动是超音速的。\n\n计算出的值为 $c_s \\approx 0.5164$ 和 $M \\approx 1.743$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.5164  1.743\n\\end{pmatrix}\n}\n$$", "id": "3536864"}, {"introduction": "相对论激波是流体力学守恒律的戏剧性体现，在超新星遗迹和天体物理喷流等现象中随处可见。它们代表了流体状态发生突变的不连续面。这个高级实践 [@problem_id:3536875] 将挑战您求解相对论的Rankine-Hugoniot跳跃关系——即守恒律在激波前后的积分形式。通过实现一个适用于不同物态方程（EOS）的求解器——从简单的理想气体到更真实的Synge气体——您将亲身体验流体的微观物理（EOS）如何决定这些强大宇宙事件的宏观属性。", "problem": "您需要编写一个完整且可运行的程序，该程序实现一个状态方程 (EOS) 模型的层次结构，以及一个用于求解狭义相对论流体动力学 (SRHD) 中一维平面激波的求解器，并额外校验在磁场消失时狭义相对论磁流体动力学 (SRMHD) 的简并情况。该程序必须根据给定的上游状态，计算激波压缩比和激波后有效绝热指数，并将指定测试套件的结果汇总到单行输出中。所有计算都应在程序单位下进行，其中光速 $c=1$、玻尔兹曼常数 $k_{\\mathrm{B}}=1$、粒子质量 $m=1$，从而使类温度量变为无量纲。不涉及角度计算。\n\n基本原理包括：\n- 在激波静止系中，对于理想流体，静止质量、动量和能量守恒：这些导出了朗肯-雨贡纽关系。设上游量为 $(\\rho_1, p_1, v_1)$，其中 $\\rho$ 是静止质量密度，$p$ 是热压力，$v$ 是沿激波法线方向的流速。设 $\\gamma = 1/\\sqrt{1-v^2}$ 为洛伦兹因子。定义单位静止质量的比焓为 $h = 1 + \\epsilon + p/\\rho$，其中 $\\epsilon$ 是比内能（不包括静止质量能）。\n- 用 $w = \\rho h$ 表示焓密度，用 $j = \\rho \\gamma v$ 表示质量通量。对于理想流体，从激波静止系中的守恒律推导出一组经过充分检验的关系式，即陶布跳跃条件（也称为陶布绝热线）和质量通量关系式：\n$$\nh_2^2 - h_1^2 = (p_2 - p_1)\\left(\\frac{h_2}{\\rho_2} + \\frac{h_1}{\\rho_1}\\right),\n$$\n$$\nj^2 = \\frac{p_2 - p_1}{\\frac{h_1}{\\rho_1} - \\frac{h_2}{\\rho_2}},\n$$\n其中下标 $1$ 表示上游量，下标 $2$ 表示下游量。\n- 对于狭义相对论流体动力学 (SRHD)，这些关系式与一个状态方程 $h(p,\\rho)$ 一起，可以从上游状态 $(\\rho_1,p_1,v_1)$ 确定下游状态 $(\\rho_2,p_2,v_2)$。\n\n您必须实现三种 EOS 模型：\n1. 具有恒定绝热指数的理想气体 EOS：$p = (\\Gamma - 1)\\rho \\epsilon$，对于给定的常数 $\\Gamma$，这意味着 $h = 1 + \\frac{\\Gamma}{\\Gamma - 1}\\frac{p}{\\rho}$。\n2. 用于归一化质量单一组分的 Synge EOS（相对论性 Maxwell–Jüttner 气体），其压力为 $p = \\rho \\Theta$，其中无量纲温度 $\\Theta = k_{\\mathrm{B}}T/mc^2$，比焓由第二类修正贝塞尔函数给出：\n$$\nh(\\Theta) = \\frac{K_3(1/\\Theta)}{K_2(1/\\Theta)},\n$$\n其中 $K_\\nu$ 表示 $\\nu$ 阶第二类修正贝塞尔函数。在采用的程序单位中，$p/\\rho = \\Theta$。\n3. 表格化 EOS，它通过对一个预设 $\\Theta$ 值网格上的 Synge EOS 计算出的 $(\\Theta, h)$ 值固定程序内表格进行单调插值来提供 $h(\\Theta)$。\n\n通过一个在下游状态下匹配理想气体焓关系的代数恒等式，为任何 EOS 定义激波后有效绝热指数 $\\Gamma_{\\mathrm{eff},2}$：\n$$\nh_2 = 1 + \\frac{\\Gamma_{\\mathrm{eff},2}}{\\Gamma_{\\mathrm{eff},2} - 1}\\frac{p_2}{\\rho_2}.\n$$\n求解 $\\Gamma_{\\mathrm{eff},2}$ 可得：\n$$\n\\Gamma_{\\mathrm{eff},2} = \\frac{h_2 - 1}{(h_2 - 1) - \\frac{p_2}{\\rho_2}}.\n$$\n\n为给定的上游状态和 EOS 获取下游状态的算法规范：\n- 给定 $(\\rho_1, p_1, v_1)$，计算 $\\gamma_1 = 1/\\sqrt{1-v_1^2}$，从 EOS 计算上游比焓 $h_1$，以及质量通量的平方 $j^2 = (\\rho_1 \\gamma_1 v_1)^2$。\n- 未知量 $p_2$ 通过施加陶布跳跃条件来确定。为了评估一个试探值 $p_2$ 的残差，您必须一致地从 EOS 和质量通量关系式中获取 $(h_2, \\rho_2)$。引入无量纲的下游类温度变量 $\\Theta_2 = p_2/\\rho_2$。对于一个给定的试探值 $p_2$，定义：\n$$\nA(p_2) = \\frac{h_1}{\\rho_1} - \\frac{p_2 - p_1}{j^2}.\n$$\n使用质量通量关系式，一致性关系为 $\\frac{h_2}{\\rho_2} = A(p_2)$。用 $\\Theta_2$ 和 EOS 表示，这变成了一个标量方程：\n$$\ng(\\Theta_2; p_2) = \\Theta_2 \\, h(\\Theta_2) - p_2 \\, A(p_2) = 0,\n$$\n其解可以得到 $\\Theta_2$，然后是 $\\rho_2 = p_2 / \\Theta_2$ 和 $h_2 = h(\\Theta_2)$。\n- 定义陶布残差函数：\n$$\nR(p_2) = h_2^2 - h_1^2 - (p_2 - p_1)\\left(\\frac{h_2}{\\rho_2} + \\frac{h_1}{\\rho_1}\\right),\n$$\n并使用一个鲁棒的区间求根方案在 $p_2 \\in (p_1, p_{\\max})$ 范围内求解 $R(p_2) = 0$ 以得到 $p_2$，其中 $p_{\\max} = p_1 + \\alpha \\, j^2 \\, (h_1/\\rho_1)$ 且 $\\alpha \\in (0,1)$，以确保 $A(p_2)  0$。对于 $R(p_2)$ 的每一次评估，利用 $h(\\Theta)$ 在 $\\Theta$ 上的单调性，通过一个在固定边界 $[\\Theta_{\\min}, \\Theta_{\\max}]$ 上的区间标量求根器求解 $g(\\Theta_2; p_2) = 0$。\n\n对于狭义相对论磁流体动力学 (SRMHD) 的简并性校验，考虑磁场消失的情况。在理想 SRMHD 中，当磁场为零时，跳跃条件精确地简化为 SRHD 的跳跃条件，因此计算出的 $(\\rho_2, p_2)$、压缩比 $r = \\rho_2/\\rho_1$ 以及下游有效绝热指数 $\\Gamma_{\\mathrm{eff},2}$ 与 SRHD 的解完全一致。\n\n您必须实现所有三种 EOS 类（理想、Synge、插值表格化），上述求解器，并为每个测试用例计算激波压缩比 $r$ 和激波后有效绝热指数 $\\Gamma_{\\mathrm{eff},2}$。在所述的程序单位中，所有结果都是无量纲的。将每个浮点数结果表示为四舍五入到六位小数。\n\n测试套件：\n- 案例 1 (SRHD，理想 EOS，冷-中等强度激波): $\\rho_1 = 1.0$, $p_1 = 10^{-3}$, $v_1 = 0.5$, $\\Gamma = 5/3$.\n- 案例 2 (SRHD，理想 EOS，强-超相对论性入流): $\\rho_1 = 1.0$, $p_1 = 10^{-3}$, $v_1 = 0.9$, $\\Gamma = 4/3$.\n- 案例 3 (SRHD，Synge EOS，中等热度上游): $\\rho_1 = 1.0$, $p_1 = 0.1$, $v_1 = 0.9$.\n- 案例 4 (SRHD，Synge EOS，热上游): $\\rho_1 = 1.0$, $p_1 = 1.0$, $v_1 = 0.95$.\n- 案例 5 (SRHD，近似 Synge 的表格化 EOS，中等热度上游): $\\rho_1 = 1.0$, $p_1 = 0.1$, $v_1 = 0.9$，使用一个固定的程序内 $(\\Theta, h)$ 值表格，该表格由 Synge EOS 在 $\\Theta \\in \\{0.01, 0.05, 0.1, 0.5, 1.0, 2.0, 5.0\\}$ 上生成，并使用线性插值来评估 $h(\\Theta)$。\n- 案例 6 (零磁场下的 SRMHD 简并性，理想 EOS): $\\rho_1 = 1.0$, $p_1 = 10^{-3}$, $v_1 = 0.9$, $\\Gamma = 4/3$，磁场为零，必须重现案例 2 的 SRHD 解。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的、逗号分隔的列表的列表形式的结果。每个内部列表必须包含两个浮点数，即压缩比 $r$ 和激波后有效绝热指数 $\\Gamma_{\\mathrm{eff},2}$，两者都四舍五入到六位小数。例如，它应看起来像：\n$[ [r_1,\\Gamma_{\\mathrm{eff},2,1}], [r_2,\\Gamma_{\\mathrm{eff},2,2}], \\ldots ]$，\n不带任何额外文本。方括号和逗号的格式必须与 Python 列表的字符串表示形式完全相同。\n\n科学真实性与约束：\n- 仅使用指定的运行时环境和库。Synge EOS 必须使用受支持的数值库中的第二类修正贝塞尔函数。表格化 EOS 必须在提供的 $\\Theta$ 网格上使用单调线性插值。求解器必须通过对两个嵌套的标量方程使用区间求根法，来对所提供的测试用例表现出鲁棒性。所有计算都必须遵循 $c=1$ 单位制。\n\n交付物：\n- 一个完整的程序，该程序执行所述的计算并以指定格式打印汇总结果。", "solution": "基本物理原理是跨越激波前沿的静止质量、动量和能量守恒。在激波静止系中，对于理想流体，这些守恒律导出了一个连接上游（激波前，下标 1）和下游（激波后，下标 2）流体状态的代数方程组。流体的状态由其静止质量密度 $\\rho$、压力 $p$ 和速度 $v$ 描述。使用比焓 $h = 1 + \\epsilon + p/\\rho$（其中 $\\epsilon$ 是比内能）和洛伦兹因子 $\\gamma = (1 - v^2)^{-1/2}$ 会很方便。所有计算都在光速 $c=1$ 的单位制下进行。\n\n提供的控制方程是陶布跳跃条件和质量通量关系式：\n$$\nh_2^2 - h_1^2 = (p_2 - p_1)\\left(\\frac{h_2}{\\rho_2} + \\frac{h_1}{\\rho_1}\\right)\n$$\n$$\nj^2 = \\frac{p_2 - p_1}{\\frac{h_1}{\\rho_1} - \\frac{h_2}{\\rho_2}}\n$$\n此处，$j = \\rho \\gamma v$ 是跨激波的守恒质量通量。给定一个上游状态 $(\\rho_1, p_1, v_1)$ 和一个 EOS，联立求解这两个方程即可确定下游状态。\n\n问题指定了一个基于嵌套求根方法的算法流程。外部问题是找到满足陶布条件的下游压力 $p_2$。对于任何试探性的 $p_2$ 值，必须找到相应的下游密度 $\\rho_2$ 和比焓 $h_2$。这构成了内部问题。\n\n让我们将嵌套求解器结构形式化。首先，我们计算已知的上游量：$\\gamma_1 = (1 - v_1^2)^{-1/2}$、$h_1$（通过 EOS）和质量通量的平方 $j^2 = (\\rho_1 \\gamma_1 v_1)^2$。\n\n内部问题是，对于一个给定的试探值 $p_2$，找到与质量通量关系式和 EOS 一致的下游状态。我们可以重新整理质量通量关系式，用已知量和试探值 $p_2$ 来表示下游量 $h_2/\\rho_2$：\n$$\n\\frac{h_2}{\\rho_2} = \\frac{h_1}{\\rho_1} - \\frac{p_2 - p_1}{j^2} \\equiv A(p_2)\n$$\nEOS 提供了 $h_2$、$p_2$ 和 $\\rho_2$ 之间的关系。我们引入无量纲的类温度变量 $\\Theta_2 = p_2/\\rho_2$。EOS 于是可以写成 $h_2 = h(\\Theta_2)$。将 $\\rho_2 = p_2/\\Theta_2$ 代入前一个方程得到：\n$$\n\\frac{h(\\Theta_2)}{p_2/\\Theta_2} = A(p_2) \\implies \\Theta_2 h(\\Theta_2) - p_2 A(p_2) = 0\n$$\n我们定义内部残差函数 $g(\\Theta_2; p_2) = \\Theta_2 h(\\Theta_2) - p_2 A(p_2)$。对于给定的 $p_2$，我们使用区间求根方法（例如 Brent-Dekker 方法）求解 $g(\\Theta_2; p_2) = 0$ 以得到 $\\Theta_2$。由于函数 $f(\\Theta) = \\Theta h(\\Theta)$ 对于任何物理 EOS 都是单调递增的，因此在一个足够大的区间 $[\\Theta_{\\min}, \\Theta_{\\max}]$ 内保证存在唯一的 $\\Theta_2$ 解。\n\n一旦找到 $\\Theta_2$，我们就有 $\\rho_2 = p_2/\\Theta_2$ 和 $h_2 = h(\\Theta_2)$。这些值随后用于外部问题，即求解陶布跳跃条件。我们定义陶布残差函数：\n$$\nR(p_2) = h_2^2 - h_1^2 - (p_2 - p_1)\\left(\\frac{h_2}{\\rho_2} + \\frac{h_1}{\\rho_1}\\right)\n$$\n我们寻求当 $p_2  p_1$ 时 $R(p_2) = 0$ 的根。对 $p_2$ 的搜索在一个具有物理动机的区间 $(p_1, p_{\\max})$ 内进行。一个有效的上界 $p_{\\max}$ 源自 $h_2/\\rho_2 = A(p_2)$ 必须为正的要求。这意味着 $p_2  p_1 + j^2 (h_1/\\rho_1)$。我们选择 $p_{\\max} = p_1 + \\alpha j^2 (h_1/\\rho_1)$ 并取 $\\alpha  1$（例如 $\\alpha = 0.9999$）来定义一个安全的搜索区间。再次使用一个鲁棒的区间求根器来找到 $p_2$。\n\n该实现将采用基于类的设计来实现 EOS 模型，其中有一个定义接口的抽象基类 `EOS`，以及针对所需三种模型的具体类：\n1.  **理想气体 EOS**：对于恒定的绝热指数 $\\Gamma$，压力为 $p = (\\Gamma-1)\\rho\\epsilon$，这可转换为 $h(\\Theta) = 1 + \\frac{\\Gamma}{\\Gamma-1}\\Theta$，其中 $\\Theta=p/\\rho$。\n2.  **Synge EOS**：这描述了一种相对论性理想气体。比焓由 $h(\\Theta) = K_3(1/\\Theta)/K_2(1/\\Theta)$ 给出，其中 $K_\\nu$ 是 $\\nu$ 阶第二类修正贝塞尔函数。这需要使用像 `SciPy` 这样的数值库中的函数。\n3.  **表格化 EOS**：此模型通过对一个预先计算的 $(\\Theta, h)$ 值表格进行线性插值来近似 Synge EOS。\n\n求解下游状态 $(p_2, \\rho_2)$ 后，我们计算两个感兴趣的量：压缩比 $r = \\rho_2/\\rho_1$ 和激波后有效绝热指数 $\\Gamma_{\\mathrm{eff},2}$。后者是通过强制理想气体焓关系对计算出的激波后状态成立来定义的：\n$$\nh_2 = 1 + \\frac{\\Gamma_{\\mathrm{eff},2}}{\\Gamma_{\\mathrm{eff},2} - 1}\\frac{p_2}{\\rho_2} \\implies \\Gamma_{\\mathrm{eff},2} = \\frac{h_2 - 1}{h_2 - 1 - p_2/\\rho_2}\n$$\n程序的结构是为六个测试用例中的每一个执行这整个流程。这包括对 SRMHD 简并性的校验，其中 SRHD 代码使用与具有消失磁场的理想 SRMHD 激波相对应的参数运行，其结果必须与等效的 SRHD 问题相同。最终结果被收集并以特定的列表的列表格式打印。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import kn\nfrom scipy.optimize import brentq\nfrom abc import ABC, abstractmethod\n\nclass EOS(ABC):\n    \"\"\"Abstract base class for Equations of State.\"\"\"\n    @abstractmethod\n    def h_from_theta(self, theta: float) - float:\n        \"\"\"Calculates specific enthalpy from dimensionless temperature.\"\"\"\n        pass\n\n    def h_from_p_rho(self, p: float, rho: float) - float:\n        \"\"\"Calculates specific enthalpy from pressure and rest-mass density.\"\"\"\n        if rho == 0:\n            return 1.0\n        theta = p / rho\n        return self.h_from_theta(theta)\n\nclass IdealEOS(EOS):\n    \"\"\"Ideal gas Equation of State with a constant adiabatic index.\"\"\"\n    def __init__(self, gamma_ad: float):\n        if gamma_ad = 1.0:\n            raise ValueError(\"Adiabatic index must be  1.\")\n        self.gamma_ad = gamma_ad\n        self.factor = gamma_ad / (gamma_ad - 1.0)\n    \n    def h_from_theta(self, theta: float) - float:\n        return 1.0 + self.factor * theta\n\nclass SyngeEOS(EOS):\n    \"\"\"Synge Equation of State for a relativistic Maxwell-Jüttner gas.\"\"\"\n    def h_from_theta(self, theta: float) - float:\n        if theta  1e-15:  # Cold limit\n            return 1.0\n        inv_theta = 1.0 / theta\n        # For very large arguments, kn can be 0, h - 1 in this limit.\n        if inv_theta  700:\n            return 1.0\n        # The ratio is well-behaved even if individual kn values are large.\n        return kn(3, inv_theta) / kn(2, inv_theta)\n\nclass TabulatedEOS(EOS):\n    \"\"\"Tabulated Equation of State based on Synge gas values.\"\"\"\n    def __init__(self):\n        synge_ref = SyngeEOS()\n        self.theta_points = np.array([0.01, 0.05, 0.1, 0.5, 1.0, 2.0, 5.0])\n        self.h_points = np.array([synge_ref.h_from_theta(t) for t in self.theta_points])\n\n    def h_from_theta(self, theta: float) - float:\n        # np.interp handles extrapolation by using boundary values, which is acceptable.\n        return np.interp(theta, self.theta_points, self.h_points)\n\ndef solve_shock(rho1: float, p1: float, v1: float, eos: EOS) - tuple[float, float]:\n    \"\"\"\n    Solves the SRHD shock jump conditions for a given upstream state and EOS.\n    Returns the compression ratio and post-shock effective adiabatic index.\n    \"\"\"\n    gamma1 = 1.0 / np.sqrt(1.0 - v1**2)\n    h1 = eos.h_from_p_rho(p1, rho1)\n    j2 = (rho1 * gamma1 * v1)**2\n\n    # Inner residual for theta2 solver\n    def g_theta2(theta2: float, p2: float) - float:\n        A_p2 = h1 / rho1 - (p2 - p1) / j2\n        # A_p2 must be  0 for a physical solution.\n        # The p2 bracket ensures this.\n        h2 = eos.h_from_theta(theta2)\n        return theta2 * h2 - p2 * A_p2\n        \n    # Outer residual for p2 solver (Taub residual)\n    def R_p2(p2: float) - float:\n        # Solve for theta2 for the trial p2\n        try:\n            # The function g_theta2 is monotonic, so a solution exists if the bracket\n            # contains the root.\n            theta2 = brentq(lambda t2: g_theta2(t2, p2), 1e-8, 1e4)\n        except ValueError:\n            # Failure to find a root for theta2 likely means p2 is out of bounds\n            # such that g_theta2 does not cross zero in the bracket.\n            # This is typically because A_p2 becomes non-positive.\n            return -1e100 # Return a large negative number to guide solver\n            \n        rho2 = p2 / theta2\n        h2 = eos.h_from_theta(theta2)\n        \n        term_p = (p2 - p1) * (h2 / rho2 + h1 / rho1)\n        return h2**2 - h1**2 - term_p\n        \n    # Set up bracketing for the p2 root-finder\n    p_min_bracket = p1 * (1.0 + 1e-9) # Must be a compressive shock\n    alpha = 0.9999 # Safety factor to keep A(p2)  0\n    p_max_bracket = p1 + alpha * j2 * (h1 / rho1)\n\n    p2 = brentq(R_p2, p_min_bracket, p_max_bracket)\n    \n    # Recalculate final state with converged p2\n    theta2 = brentq(lambda t2: g_theta2(t2, p2), 1e-8, 1e4)\n    rho2 = p2 / theta2\n    h2 = eos.h_from_theta(theta2)\n\n    # Compute final results\n    r = rho2 / rho1\n    \n    eps2_over_rho2 = h2 - 1.0 - theta2\n    if eps2_over_rho2 = 0:\n        # This case is unphysical and indicates an error or an extreme limit\n        gamma_eff_2 = float('inf')\n    else:\n        gamma_eff_2 = (h2 - 1.0) / eps2_over_rho2\n        \n    return r, gamma_eff_2\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        {'rho1': 1.0, 'p1': 1e-3, 'v1': 0.5, 'eos': IdealEOS(5.0/3.0)},\n        {'rho1': 1.0, 'p1': 1e-3, 'v1': 0.9, 'eos': IdealEOS(4.0/3.0)},\n        {'rho1': 1.0, 'p1': 0.1,  'v1': 0.9, 'eos': SyngeEOS()},\n        {'rho1': 1.0, 'p1': 1.0,  'v1': 0.95, 'eos': SyngeEOS()},\n        {'rho1': 1.0, 'p1': 0.1,  'v1': 0.9, 'eos': TabulatedEOS()},\n        {'rho1': 1.0, 'p1': 1e-3, 'v1': 0.9, 'eos': IdealEOS(4.0/3.0)}, # SRMHD degeneracy check\n    ]\n\n    results = []\n    for case in test_cases:\n        r, g_eff = solve_shock(case['rho1'], case['p1'], case['v1'], case['eos'])\n        results.append(f\"[{r:.6f},{g_eff:.6f}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3536875"}]}