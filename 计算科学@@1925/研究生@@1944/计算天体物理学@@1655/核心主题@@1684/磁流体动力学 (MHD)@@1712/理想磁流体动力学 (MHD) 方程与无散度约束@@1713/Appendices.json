{"hands_on_practices": [{"introduction": "在数值求解磁流体动力学（MHD）方程之前，我们必须理解其基本的数学结构。理想MHD方程构成了一个双曲守恒律系统，意味着信息以有限的速度传播，这些传播速度被称为特征波速。本练习将引导你推导并计算这些波速，它们是现代Godunov型数值格式的基石，决定了计算网格中信息的流动方式。 [@problem_id:3539067]", "problem": "考虑 Heaviside–Lorentz 单位制（磁导率设为1）下的理想磁流体力学 (MHD) 方程组，包括质量连续性方程、包含磁力（洛伦兹力）的动量方程、包含理想欧姆定律的感应方程以及无散约束。一个均匀、同性的平衡态由常数背景场 $\\rho_{0}$、 $p_{0}$、 $\\mathbf{v}_{0}$ 和 $\\mathbf{B}_{0}$ 以及比热比为 $\\gamma$ 的绝热状态方程给出。无散约束 $\\nabla \\cdot \\mathbf{B} = 0$ 初始满足。\n\n将理想 MHD 方程组在该均匀平衡态附近线性化，并假设平面波微扰正比于 $\\exp\\left[i\\left(k\\,\\hat{\\mathbf{n}}\\cdot\\mathbf{x} - \\omega t\\right)\\right]$ 沿给定单位方向 $\\hat{\\mathbf{n}}$ 传播。仅使用基本方程和无散约束，推导线性波的色散关系，从而获得实验室参考系中沿 $\\hat{\\mathbf{n}}$ 方向的特征相速度：平熵模速度 $v_{n}$、阿尔芬波速 $v_{n} \\pm c_{A,n}$ 以及快、慢磁声波速 $v_{n} \\pm c_{f}$ 和 $v_{n} \\pm c_{s}$（其中 $c_{f} \\ge c_{s} \\ge 0$）。这里 $v_{n} \\equiv \\mathbf{v}_{0}\\cdot\\hat{\\mathbf{n}}$，$c_{A,n} \\equiv |\\mathbf{B}_{0}\\cdot\\hat{\\mathbf{n}}|/\\sqrt{\\rho_{0}}$，并且 $a \\equiv \\sqrt{\\gamma p_{0}/\\rho_{0}}$ 是绝热声速。您必须明确展示无散约束在线性化演化过程中如何保持不变，以及它如何约束微扰。\n\n然后，对于特定的均匀态\n- $\\rho_{0} = 1$,\n- $p_{0} = 1$,\n- $\\gamma = \\dfrac{5}{3}$,\n- $\\mathbf{v}_{0} = (0.3,\\,-0.2,\\,0.4)$,\n- $\\mathbf{B}_{0} = (1,\\,2,\\,2)$,\n- $\\hat{\\mathbf{n}} = (0,\\,0,\\,1)$,\n\n计算按标准排序的七个特征速度\n$$v_{n} - c_{f},\\quad v_{n} - c_{A,n},\\quad v_{n} - c_{s},\\quad v_{n},\\quad v_{n} + c_{s},\\quad v_{n} + c_{A,n},\\quad v_{n} + c_{f}.$$\n\n将所有速度表示为无量纲代码单位的纯数，并将每个条目四舍五入到 $6$ 位有效数字。按指定顺序以单行向量的形式提供最终数值结果。最终的方框答案中不应包含任何单位。", "solution": "该问题要求推导理想磁流体力学 (MHD) 中线性波的色散关系，并随后计算特定物理状态下的特征波速。该过程始于验证问题陈述，经判定其在科学上是合理、适定且完整的。\n\nHeaviside-Lorentz 单位制下的理想 MHD 方程组为：\n1.  质量连续性：$\\dfrac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{v}) = 0$\n2.  动量：$\\rho \\left( \\dfrac{\\partial \\mathbf{v}}{\\partial t} + (\\mathbf{v} \\cdot \\nabla) \\mathbf{v} \\right) = -\\nabla p + (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$\n3.  感应：$\\dfrac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B})$\n4.  无散约束：$\\nabla \\cdot \\mathbf{B} = 0$\n5.  绝热状态方程：$\\dfrac{d}{dt}\\left(\\dfrac{p}{\\rho^\\gamma}\\right) = 0$，其中 $\\dfrac{d}{dt} = \\dfrac{\\partial}{\\partial t} + \\mathbf{v} \\cdot \\nabla$\n\n我们在由常数 $\\rho_0$、 $p_0$、 $\\mathbf{v}_0$ 和 $\\mathbf{B}_0$ 定义的均匀平衡态附近对这些方程进行线性化。我们引入小微扰：\n$\\rho = \\rho_0 + \\delta\\rho$, $p = p_0 + \\delta p$, $\\mathbf{v} = \\mathbf{v}_0 + \\delta\\mathbf{v}$, $\\mathbf{B} = \\mathbf{B}_0 + \\delta\\mathbf{B}$。\n将这些代入 MHD 方程组并仅保留微扰的一阶项，我们得到线性化方程：\n1.  $\\dfrac{\\partial \\delta\\rho}{\\partial t} + \\mathbf{v}_0 \\cdot \\nabla \\delta\\rho + \\rho_0 \\nabla \\cdot \\delta\\mathbf{v} = 0$\n2.  $\\rho_0 \\left( \\dfrac{\\partial \\delta\\mathbf{v}}{\\partial t} + (\\mathbf{v}_0 \\cdot \\nabla) \\delta\\mathbf{v} \\right) = -\\nabla \\delta p + (\\nabla \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0$\n3.  $\\dfrac{\\partial \\delta\\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v}_0 \\times \\delta\\mathbf{B} + \\delta\\mathbf{v} \\times \\mathbf{B}_0)$\n4.  $\\nabla \\cdot \\delta\\mathbf{B} = 0$ (因为 $\\nabla \\cdot \\mathbf{B}_0 = 0$)\n5.  $\\left(\\dfrac{\\partial}{\\partial t} + \\mathbf{v}_0 \\cdot \\nabla\\right) (\\delta p - a^2 \\delta\\rho) = 0$，其中 $a^2 = \\gamma p_0 / \\rho_0$ 是绝热声速的平方。\n\n我们假设微扰的平面波解形式为 $\\delta f \\propto \\exp[i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t)]$，其中 $\\mathbf{k} = k\\hat{\\mathbf{n}}$。这将微分算子转换为 $\\dfrac{\\partial}{\\partial t} \\to -i\\omega$ 和 $\\nabla \\to i\\mathbf{k}$。\n线性化方程变成一个代数方程组：\n1.  $-i\\omega \\delta\\rho + i(\\mathbf{k} \\cdot \\mathbf{v}_0) \\delta\\rho + i\\rho_0 (\\mathbf{k} \\cdot \\delta\\mathbf{v}) = 0$\n2.  $-i\\omega\\rho_0\\delta\\mathbf{v} + i\\rho_0(\\mathbf{k} \\cdot \\mathbf{v}_0)\\delta\\mathbf{v} = -i\\mathbf{k}\\delta p + (i\\mathbf{k} \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0$\n3.  $-i\\omega\\delta\\mathbf{B} = i\\mathbf{k} \\times (\\mathbf{v}_0 \\times \\delta\\mathbf{B} + \\delta\\mathbf{v} \\times \\mathbf{B}_0)$\n4.  $i\\mathbf{k} \\cdot \\delta\\mathbf{B} = 0$\n5.  $(-i\\omega + i\\mathbf{k}\\cdot\\mathbf{v}_0)(\\delta p - a^2 \\delta\\rho) = 0$\n\n我们定义等离子体参考系中的多普勒频移频率 $\\omega' = \\omega - \\mathbf{k} \\cdot \\mathbf{v}_0$。方程组简化为：\n1.  $-\\omega' \\delta\\rho + \\rho_0 (\\mathbf{k} \\cdot \\delta\\mathbf{v}) = 0$\n2.  $-\\omega'\\rho_0\\delta\\mathbf{v} = -\\mathbf{k}\\delta p + (\\mathbf{k} \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0$\n3.  $-\\omega'\\delta\\mathbf{B} = \\mathbf{k} \\times (\\delta\\mathbf{v} \\times \\mathbf{B}_0)$\n4.  $\\mathbf{k} \\cdot \\delta\\mathbf{B} = 0$\n5.  $\\omega'(\\delta p - a^2 \\delta\\rho) = 0$\n\n无散约束 $\\nabla \\cdot \\mathbf{B} = 0$ 在动力学过程中保持不变。对感应方程取散度得到 $\\dfrac{\\partial (\\nabla \\cdot \\mathbf{B})}{\\partial t} = \\nabla \\cdot (\\nabla \\times \\mathbf{Q}) = 0$，其中 $\\mathbf{Q} = \\mathbf{v} \\times \\mathbf{B}$。因此，如果在 $t=0$ 时 $\\nabla \\cdot \\mathbf{B} = 0$，那么它在所有时间都保持为零。在傅里叶空间中，这意味着 $\\mathbf{k} \\cdot \\delta\\mathbf{B} = 0$，即磁场微扰完全垂直于波传播方向。这个约束被线性化感应方程自动满足：用 $\\mathbf{k}$ 点乘方程 (3) 得到 $-\\omega'(\\mathbf{k} \\cdot \\delta\\mathbf{B}) = \\mathbf{k} \\cdot (\\mathbf{k} \\times (\\delta\\mathbf{v} \\times \\mathbf{B}_0)) = 0$。\n\n从方程 (5) 中，我们得到两族解：\n-   如果 $\\omega' \\neq 0$，则 $\\delta p = a^2 \\delta\\rho$。这些是声波和磁波模式。\n-   如果 $\\omega' = 0$，则 $\\omega = \\mathbf{k} \\cdot \\mathbf{v}_0$。这给出的相速度为 $\\omega/k = \\mathbf{v}_0 \\cdot \\hat{\\mathbf{n}} = v_n$。这是熵模，对应于随流体流动的密度微扰，其中 $\\delta\\mathbf{v}=0$，$\\delta\\mathbf{B}=0$，$\\delta p=0$。\n\n对于 $\\omega'\\neq 0$ 的模式，我们求解该方程组。方便起见，选择一个坐标系，使得 $\\mathbf{k} = (0,0,k)$ 且 $\\mathbf{B}_0$ 位于 x-z 平面内，即 $\\mathbf{B}_0 = (B_{0x}, 0, B_{0z})$。约束 $\\mathbf{k} \\cdot \\delta\\mathbf{B}=0$ 意味着 $\\delta B_z = 0$。$\\delta\\mathbf{v}$ 和 $\\delta\\mathbf{B}$ 各分量的方程解耦。\n\ny 分量方程产生不可压缩横波，即阿尔芬波：\n$$(\\omega'^2 - k^2 c_{A,n}^2) \\delta v_y = 0$$\n其中 $c_{A,n} = |\\mathbf{B}_0 \\cdot \\hat{\\mathbf{k}}|/\\sqrt{\\rho_0}$ 是阿尔芬波速沿传播方向的分量。色散关系为 $\\omega' = \\pm k c_{A,n}$。实验室参考系中的相速度为 $v_{ph} = \\omega/k = v_n \\pm c_{A,n}$。\n\nx 和 z 分量是耦合的，描述了可压缩磁声波。一个关于 $(\\delta v_x, \\delta v_z)$ 的 $2 \\times 2$ 系统导出了快、慢磁声波模式的色散关系。定义流体参考系中的相速度 $V = \\omega'/k$，我们得到一个关于 $V^2$ 的二次方程：\n$$V^4 - (a^2 + c_A^2)V^2 + a^2 c_{A,n}^2 = 0$$\n其中 $c_A^2 = |\\mathbf{B}_0|^2/\\rho_0$ 是总阿尔芬波速的平方。$V^2$ 的解是快 ($c_f^2$) 和慢 ($c_s^2$) 磁声波速的平方：\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ (a^2 + c_A^2) \\pm \\sqrt{(a^2+c_A^2)^2 - 4 a^2 c_{A,n}^2} \\right]$$\n快模对应于“+”号，慢模对应于“-”号，这确保了 $c_f \\ge c_s \\ge 0$。实验室参考系中的相速度为 $v_{ph} = v_n \\pm c_f$ 和 $v_n \\pm c_s$。\n\n总而言之，沿 $\\hat{\\mathbf{n}}$ 方向的七个特征波速为：\n1.  熵模：$v_n$\n2.  阿尔芬模：$v_n \\pm c_{A,n}$\n3.  慢磁声模：$v_n \\pm c_s$\n4.  快磁声模：$v_n \\pm c_f$\n\n现在我们为给定的数值计算这些速度：\n-   $\\rho_{0} = 1$\n-   $p_{0} = 1$\n-   $\\gamma = \\dfrac{5}{3}$\n-   $\\mathbf{v}_{0} = (0.3, -0.2, 0.4)$\n-   $\\mathbf{B}_{0} = (1, 2, 2)$\n-   $\\hat{\\mathbf{n}} = (0, 0, 1)$\n\n首先，我们计算所需的物理参数：\n-   沿 $\\hat{\\mathbf{n}}$ 的平流速度：$v_n = \\mathbf{v}_0 \\cdot \\hat{\\mathbf{n}} = (0.3)(0) + (-0.2)(0) + (0.4)(1) = 0.4$。\n-   声速的平方：$a^2 = \\dfrac{\\gamma p_0}{\\rho_0} = \\dfrac{(5/3)(1)}{1} = \\dfrac{5}{3}$。\n-   总阿尔芬波速的平方：$|\\mathbf{B}_0|^2 = 1^2+2^2+2^2 = 9$。所以，$c_A^2 = \\dfrac{|\\mathbf{B}_0|^2}{\\rho_0} = \\dfrac{9}{1} = 9$。\n-   沿 $\\hat{\\mathbf{n}}$ 投影的阿尔芬波速的平方：$\\mathbf{B}_0 \\cdot \\hat{\\mathbf{n}} = (1)(0) + (2)(0) + (2)(1) = 2$。所以，$c_{A,n}^2 = \\dfrac{(\\mathbf{B}_0 \\cdot \\hat{\\mathbf{n}})^2}{\\rho_0} = \\dfrac{2^2}{1} = 4$。\n-   由此，投影的阿尔芬波速为 $c_{A,n} = \\sqrt{4} = 2$。\n\n接下来，我们计算快、慢磁声波速 $c_f$ 和 $c_s$：\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ \\left(\\frac{5}{3} + 9\\right) \\pm \\sqrt{\\left(\\frac{5}{3}+9\\right)^2 - 4\\left(\\frac{5}{3}\\right)(4)} \\right]$$\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\sqrt{\\left(\\frac{32}{3}\\right)^2 - \\frac{80}{3}} \\right] = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\sqrt{\\frac{1024}{9} - \\frac{240}{9}} \\right]$$\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\sqrt{\\frac{784}{9}} \\right] = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\frac{28}{3} \\right]$$\n-   快模速度平方：$c_f^2 = \\dfrac{1}{2}\\left(\\dfrac{32+28}{3}\\right) = \\dfrac{1}{2}\\left(\\dfrac{60}{3}\\right) = 10$。所以，$c_f = \\sqrt{10}$。\n-   慢模速度平方：$c_s^2 = \\dfrac{1}{2}\\left(\\dfrac{32-28}{3}\\right) = \\dfrac{1}{2}\\left(\\dfrac{4}{3}\\right) = \\dfrac{2}{3}$。所以，$c_s = \\sqrt{\\dfrac{2}{3}}$。\n\n最后，我们计算实验室参考系中的七个特征速度，并四舍五入到 6 位有效数字：\n-   $v_{n} - c_{f} = 0.4 - \\sqrt{10} \\approx 0.4 - 3.16227766 = -2.76227766 \\approx -2.76228$\n-   $v_{n} - c_{A,n} = 0.4 - 2 = -1.60000$\n-   $v_{n} - c_{s} = 0.4 - \\sqrt{2/3} \\approx 0.4 - 0.81649658 = -0.41649658 \\approx -0.416497$\n-   $v_{n} = 0.400000$\n-   $v_{n} + c_{s} = 0.4 + \\sqrt{2/3} \\approx 0.4 + 0.81649658 = 1.21649658 \\approx 1.21650$\n-   $v_{n} + c_{A,n} = 0.4 + 2 = 2.40000$\n-   $v_{n} + c_{f} = 0.4 + \\sqrt{10} \\approx 0.4 + 3.16227766 = 3.56227766 \\approx 3.56228$\n\n计算出的速度按指定的标准排序以行向量形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-2.76228 & -1.60000 & -0.416497 & 0.400000 & 1.21650 & 2.40000 & 3.56228\n\\end{pmatrix}\n}\n$$", "id": "3539067"}, {"introduction": "尽管感应方程在解析上能够保持 $\\nabla \\cdot \\mathbf{B} = 0$，但许多数值格式在离散求解时却无法保证这一点。本练习设置了一个受控测试，以观察不同的近似黎曼求解器（Godunov型代码的核心引擎）在面对一个刻意违反无散度约束的初值时的反应。通过这个实践，我们可以直观地看到不恰当处理磁场散度可能导致的非物理结果，例如负压，从而理解数值鲁棒性的重要性。 [@problem_id:3539086]", "problem": "一维理想磁流体力学（MHD）黎曼问题由位于 $x=0$ 处界面分隔的两个恒定热力学-磁场状态组成，其中左态为 $x<0$，右态为 $x>0$。以磁导率为单位1的单位制下，沿 $x$ 方向的理想MHD方程，对于守恒变量 $\\mathbf{U} = [\\rho, m_x, m_y, m_z, B_y, B_z, E]^\\top$ 和界面法向磁场 $B_x$ 如下：\n$$\n\\frac{\\partial}{\\partial t}\n\\begin{bmatrix}\n\\rho\\\\\nm_x\\\\\nm_y\\\\\nm_z\\\\\nB_y\\\\\nB_z\\\\\nE\n\\end{bmatrix}\n+\n\\frac{\\partial}{\\partial x}\n\\begin{bmatrix}\n\\rho v_x\\\\\nm_x v_x + p + \\frac{1}{2}B^2 - B_x^2\\\\\nm_y v_x - B_x B_y\\\\\nm_z v_x - B_x B_z\\\\\nB_y v_x - B_x v_y\\\\\nB_z v_x - B_x v_z\\\\\n(E + p_t) v_x - B_x (\\mathbf{v}\\cdot\\mathbf{B})\n\\end{bmatrix}\n=\n\\mathbf{0}\n$$\n其中 $\\rho$ 是质量密度，$\\mathbf{v}=(v_x,v_y,v_z)$ 是速度，$\\mathbf{B}=(B_x,B_y,B_z)$ 是磁场，$m_i = \\rho v_i$ 是动量分量，$E$ 是总能量密度，$p$ 是气体压力，$B^2 = \\mathbf{B}\\cdot\\mathbf{B}$，而 $p_t = p + \\frac{1}{2} B^2$ 是总压力。理想气体的状态方程为\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho \\|\\mathbf{v}\\|^2 + \\frac{1}{2} \\|\\mathbf{B}\\|^2\n$$\n其中绝热指数 $\\gamma>1$。磁场的无散度约束为 $\\nabla\\cdot\\mathbf{B} = 0$，在严格的一维设定下，这简化为 $\\frac{\\partial B_x}{\\partial x} = 0$；因此，在一个精确的理想MHD黎曼问题中，$B_x$ 必须在界面上是连续的。\n\n本问题要求您为一个特殊的横向阿尔芬子系统中的一维理想MHD黎曼问题构建一个精确解，然后通过设置 $B_{x,L} \\neq B_{x,R}$ 来故意扰动无散度约束，从而在界面处产生一个局部的非零 $\\nabla\\cdot\\mathbf{B}$，并研究其影响。您必须评估和比较三种黎曼求解器——Roe、Harten-Lax-van Leer Discontinuities (HLLD) 和 Harten-Lax-van Leer Einfeldt (HLLE)——在无散度约束被违反时，对非物理中间状态出现的鲁棒性。\n\n基本基础与设置：\n- 考虑一个初始构型，其左右两边具有由 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z)$ 定义的恒定状态。使用磁导率为1的代码单位。设 $\\gamma = \\frac{5}{3}$。\n- 专注于一维理想MHD的横向阿尔芬子系统，其中 $v_x=0$, $B_z=0$, $v_z=0$。在精确的基准构型中，只有 $v_y$ 和 $B_y$ 在左右两态之间可能不同，而 $\\rho$ 和 $p$ 在两侧相等。\n- 对于 $B_x$ 连续且两侧密度相等的精确阿尔芬子系统解，在 $x/t=0$ 处，横向黎曼不变量 $w^\\pm = v_y \\pm B_y / \\sqrt{\\rho}$ 以速度 $S^\\pm = v_x \\pm c_{A,x}$ 传播，其中 $c_{A,x} = |B_x|/\\sqrt{\\rho}$。在 $x/t=0$ 且 $v_x=0$、 $B_x>0$ 时，界面精确星号状态由下式给出：\n$$\nv_y^\\star = \\frac{w_L^+ + w_R^-}{2},\\quad B_y^\\star = \\frac{\\sqrt{\\rho}\\,(w_L^+ - w_R^-)}{2}.\n$$\n- 为了研究违反无散度约束的情况，在界面上引入不匹配 $B_{x,L} \\neq B_{x,R}$。对于选定的空间归一化 $\\Delta x$，将界面处的局部散度近似为\n$$\n(\\nabla\\cdot\\mathbf{B})_\\mathrm{int} \\approx \\frac{B_{x,R} - B_{x,L}}{\\Delta x}\n$$\n在理想MHD的八波形式（Powell源项）下，一个非零的 $\\nabla\\cdot\\mathbf{B}$ 通过一个附加源项与能量方程耦合：\n$$\n\\frac{\\partial E}{\\partial t}\\Big|_{\\mathrm{div}B} = -(\\mathbf{v}\\cdot\\mathbf{B})\\,(\\nabla\\cdot\\mathbf{B}).\n$$\n对于一个时间步长 $\\Delta t$ 内的单次界面更新，能量扰动为\n$$\n\\Delta E = -(\\mathbf{v}^\\star\\cdot\\mathbf{B}^\\star)\\,(\\nabla\\cdot\\mathbf{B})_\\mathrm{int}\\,\\Delta t,\n$$\n其中 $\\mathbf{v}^\\star$ 和 $\\mathbf{B}^\\star$ 是由给定求解器产生的界面星号状态。使用界面 $B_x^\\star$ 作为算术平均值 $B_x^\\star = \\frac{1}{2}(B_{x,L}+B_{x,R})$。\n\n特定求解器的横向子系统界面星号状态：\n- Roe求解器：对于线性横向阿尔芬子系统，在 $v_x=0$ 且两侧 $\\rho$ 相等的条件下，Roe的线性化方法能精确解析阿尔芬波。使用上面给出的精确界面星号状态 $(v_y^\\star, B_y^\\star)$。\n- HLLD求解器：在相同的特化子系统和条件下，HLLD能清晰地解析阿尔芬中间状态。使用上面给出的精确界面星号状态 $(v_y^\\star, B_y^\\star)$。\n- HLLE求解器：使用专用于横向子系统的两波HLL平均。定义 $S_L = v_{x,L} - c_{A,L}$ 和 $S_R = v_{x,R} + c_{A,R}$，其中 $c_{A,L} = |B_{x,L}|/\\sqrt{\\rho}$ 和 $c_{A,R} = |B_{x,R}|/\\sqrt{\\rho}$；当 $v_x=0$ 时，这些速度为 $S_L = -c_{A,L}$ 和 $S_R = +c_{A,R}$。设 $U_t = [m_y, B_y]^\\top$ 和 $F_t = [m_y v_x - B_x B_y,\\, B_y v_x - B_x v_y]^\\top$。当 $v_x=0$ 时，这些通量简化为 $F_t = [-B_x B_y,\\,-B_x v_y]^\\top$。HLLE界面横向星号状态为\n$$\nU_t^\\star = \\frac{S_R U_{t,R} - S_L U_{t,L} + F_{t,L} - F_{t,R}}{S_R - S_L},\\quad v_y^\\star = \\frac{m_y^\\star}{\\rho},\\quad B_y^\\star = (U_t^\\star)_2.\n$$\n\n能量和气体压力更新：\n- 对于给定求解器的 $(v_y^\\star, B_y^\\star)$ 和 $B_x^\\star$，将散度扰动前的界面星号总能量定义为\n$$\nE^\\star = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho\\left[(v_x)^2 + (v_y^\\star)^2 + (v_z)^2\\right] + \\frac{1}{2}\\left[(B_x^\\star)^2 + (B_y^\\star)^2 + (B_z)^2\\right].\n$$\n- 应用由源项引起的散度诱导能量更新，得到\n$$\nE^{\\star\\star} = E^\\star + \\Delta E.\n$$\n- 从 $E^{\\star\\star}$ 中恢复界面气体压力，\n$$\np^{\\star\\star} = (\\gamma - 1)\\left( E^{\\star\\star} - \\frac{1}{2}\\rho\\left[(v_x)^2 + (v_y^\\star)^2 + (v_z)^2\\right] - \\frac{1}{2}\\left[(B_x^\\star)^2 + (B_y^\\star)^2 + (B_z)^2\\right] \\right).\n$$\n此处，非物理中间状态定义为 $p^{\\star\\star} < 0$ 的状态。\n\n时间步长和归一化：\n- 选择 $\\Delta x = 1$ 和一个库朗数 $\\mathrm{CFL} = \\frac{1}{2}$。通过任一侧的最大阿尔芬速度定义时间步长，\n$$\n\\Delta t = \\mathrm{CFL}\\frac{\\Delta x}{\\max(c_{A,L}, c_{A,R})},\\quad c_{A,\\{\\cdot\\}} = \\frac{|B_{x,\\{\\cdot\\}}|}{\\sqrt{\\rho}}.\n$$\n\n您的程序必须对每个测试用例，计算上述Roe、HLLD和HLLE的界面星号状态，应用散度诱导的能量更新，确定最终的界面气体压力 $p^{\\star\\star}$ 是否为非负，并为每个求解器返回一个布尔值以指示其物理可容许性。如果计算遇到除以零的情况（例如，$S_R - S_L = 0$），则将该求解器的星号状态视为未定义，并为其返回布尔值 $\\texttt{False}$。\n\n测试套件：\n所有案例均使用 $\\gamma = \\frac{5}{3}$，$\\Delta x = 1$ 和 $\\mathrm{CFL} = \\frac{1}{2}$，且 $v_x=0$ 和 $B_z=v_z=0$。每个测试用例指定 $(\\rho, p, v_{y,L}, B_{y,L}, v_{y,R}, B_{y,R}, B_{x,L}, B_{x,R})$：\n\n1. 基准情况，接近无散度，中等强度的横向阿尔芬跳跃：\n   - $(\\rho, p, v_{y,L}, B_{y,L}, v_{y,R}, B_{y,R}, B_{x,L}, B_{x,R}) = (1.0, 1.0, 0.1, 0.1, -0.1, -0.1, 1.0, 1.0 + 10^{-8})$。\n2. 中等散度违反，横向场相反以最大化负的 $(\\mathbf{v}\\cdot\\mathbf{B})$：\n   - $(\\rho, p, v_{y,L}, B_{y,L}, v_{y,R}, B_{y,R}, B_{x,L}, B_{x,R}) = (1.0, 0.02, 0.5, -0.5, -0.5, 0.5, 1.0, 0.5)$。\n3. 边界情况，横向分量为零：\n   - $(\\rho, p, v_{y,L}, B_{y,L}, v_{y,R}, B_{y,R}, B_{x,L}, B_{x,R}) = (1.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.2, 0.05)$。\n4. 强散度误差，具有相同的相反横向构型：\n   - $(\\rho, p, v_{y,L}, B_{y,L}, v_{y,R}, B_{y,R}, B_{x,L}, B_{x,R}) = (1.0, 0.10, 0.5, -0.5, -0.5, 0.5, 1.0, 0.0)$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含所有测试用例的结果，格式为一个逗号分隔的列表，并用方括号括起来。每个测试用例的结果必须是一个包含三个布尔值的列表，顺序为 $[\\texttt{Roe}, \\texttt{HLLD}, \\texttt{HLLE}]$，表示该求解器的 $p^{\\star\\star} \\ge 0$ 是否成立。例如，一个输出行可能看起来像：\n$[\\,[\\texttt{True},\\texttt{True},\\texttt{False}],\\,[\\texttt{True},\\texttt{True},\\texttt{True}],\\,\\ldots\\,]$。", "solution": "理想磁流体力学（MHD）方程在无限电导率和可忽略位移电流的假设下，将流体动力学与电磁场耦合起来。沿 $x$ 方向的一维系统对方程 $\\rho$、$\\mathbf{m}=\\rho\\mathbf{v}$、$(B_y,B_z)$ 和 $E$ 承认一个通量形式的守恒律，其中 $B_x$ 作为参数出现在通量中；无散度约束简化为 $\\frac{\\partial B_x}{\\partial x}=0$，这意味着一个物理上精确的一维黎曼问题必须在界面上具有连续的 $B_x$。\n\n为了构建一个易于处理的精确解，并同时分离出 $\\nabla\\cdot\\mathbf{B}$ 违反的影响，我们考虑横向阿尔芬子系统，其中 $v_x=0$, $v_z=0$, $B_z=0$，两侧密度 $\\rho$ 相等，且在基准构型中气体压力 $p$ 相等。在这个简化的子系统中，相关变量是 $v_y$ 和 $B_y$，传播的特征是沿 $x$ 方向的阿尔芬波，其速度为 $S^\\pm = v_x \\pm c_{A,x} = \\pm c_{A,x}$（对于 $v_x=0$），其中 $c_{A,x} = |B_x|/\\sqrt{\\rho}$ 是与 $B_x$ 相关的阿尔芬速度。横向阿尔芬黎曼不变量为 $w^\\pm = v_y \\pm B_y/\\sqrt{\\rho}$。对于连续的 $B_x$ 和相等的 $\\rho$，在 $x/t=0$ 处的精确界面状态是通过对这些不变量进行上风采样得到的：在 $x/t=0$ 且 $B_x>0$ 时，右行不变量 $w^+$ 从左态采样，左行不变量 $w^-$ 从右态采样，得到\n$$\nv_y^\\star = \\frac{w_L^+ + w_R^-}{2},\\qquad B_y^\\star = \\frac{\\sqrt{\\rho}\\,(w_L^+ - w_R^-)}{2}.\n$$\n这个结果源于线性特征理论，并且对于指定的子系统是精确的。\n\n为了研究违反无散度约束的情况，我们引入了 $B_{x,L} \\neq B_{x,R}$ 的不匹配。在有限体积离散化中，界面处的局部散度可以建模为 $(\\nabla\\cdot\\mathbf{B})_\\mathrm{int} \\approx (B_{x,R}-B_{x,L})/\\Delta x$，这在非守恒形式（如Powell的八波方法）中会产生额外的源项。特别是，能量方程会获得一个源项\n$$\n\\frac{\\partial E}{\\partial t}\\Big|_{\\mathrm{div}B} = -(\\mathbf{v}\\cdot\\mathbf{B})\\,(\\nabla\\cdot\\mathbf{B}).\n$$\n在持续时间为 $\\Delta t$ 的单次界面更新中，产生的能量变化为\n$$\n\\Delta E = -(\\mathbf{v}^\\star\\cdot\\mathbf{B}^\\star)\\,(\\nabla\\cdot\\mathbf{B})_\\mathrm{int}\\,\\Delta t,\n$$\n其中界面星号状态 $(\\mathbf{v}^\\star,\\mathbf{B}^\\star)$ 取决于所使用的黎曼求解器。因为我们的子系统有 $v_x=0$, $v_z=0$, $B_z=0$，点积简化为 $(\\mathbf{v}^\\star\\cdot\\mathbf{B}^\\star) = v_y^\\star B_y^\\star$。界面上的 $B_x^\\star$ 被取为算术平均值 $B_x^\\star = \\frac{1}{2}(B_{x,L}+B_{x,R})$，以表示一个一致的界面值。\n\n我们现在为这三种求解器指定界面星号状态：\n\n1. Roe求解器。Roe线性化在适当的平均状态下将系统对角化，对于线性横向阿尔芬子系统，其产生的结果与精确解相同。因此，我们取\n$$\n(v_y^\\star, B_y^\\star)_\\mathrm{Roe} = (v_y^\\star, B_y^\\star)_\\mathrm{exact} = \\left( \\frac{w_L^+ + w_R^-}{2},\\, \\frac{\\sqrt{\\rho}\\,(w_L^+ - w_R^-)}{2} \\right).\n$$\n\n2. Harten-Lax-van Leer Discontinuities (HLLD)。HLLD是一种多波近似MHD黎曼求解器，它能解析接触波和阿尔芬波。在当前的横向子系统中，当 $v_x=0$、$\\rho$ 相等且 $B_x>0$ 时，HLLD也能重现精确的阿尔芬星号状态，所以我们设置\n$$\n(v_y^\\star, B_y^\\star)_\\mathrm{HLLD} = (v_y^\\star, B_y^\\star)_\\mathrm{exact}.\n$$\n\n3. Harten-Lax-van Leer Einfeldt (HLLE)。HLLE将波扇坍缩为两个边界信号速度 $S_L$ 和 $S_R$，产生一个单一的平均中间状态。应用于 $v_x=0$ 的横向子系统，定义\n$$\nS_L = -c_{A,L} = -\\frac{|B_{x,L}|}{\\sqrt{\\rho}},\\qquad S_R = +c_{A,R} = +\\frac{|B_{x,R}|}{\\sqrt{\\rho}}.\n$$\n设横向守恒变量和通量为\n$$\nU_t = \\begin{bmatrix}m_y\\\\B_y\\end{bmatrix} = \\begin{bmatrix}\\rho v_y\\\\B_y\\end{bmatrix},\\qquad\nF_t = \\begin{bmatrix}m_y v_x - B_x B_y\\\\ B_y v_x - B_x v_y\\end{bmatrix} = \\begin{bmatrix}-B_x B_y\\\\ -B_x v_y\\end{bmatrix}.\n$$\n那么HLLE横向星号状态是\n$$\nU_t^\\star = \\frac{S_R U_{t,R} - S_L U_{t,L} + F_{t,L} - F_{t,R}}{S_R - S_L},\\qquad v_y^\\star = \\frac{m_y^\\star}{\\rho},\\qquad B_y^\\star = (U_t^\\star)_2.\n$$\n这种构造通过信号速度和通量捕捉了 $B_{x,L}$ 和 $B_{x,R}$ 不相等对星号状态的影响。\n\n对于每个求解器得到的 $(v_y^\\star, B_y^\\star)$ 和 $B_x^\\star$，我们计算扰动前的界面能量\n$$\nE^\\star = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho (v_y^\\star)^2 + \\frac{1}{2}\\left[(B_x^\\star)^2 + (B_y^\\star)^2\\right],\n$$\n并应用散度诱导的能量变化\n$$\n\\Delta E = - v_y^\\star B_y^\\star \\left(\\frac{B_{x,R} - B_{x,L}}{\\Delta x}\\right)\\Delta t\n$$\n其中 $\\Delta x = 1$，$\\Delta t = \\mathrm{CFL}\\,\\Delta x/\\max(c_{A,L}, c_{A,R})$，使用 $\\mathrm{CFL}=\\frac{1}{2}$。更新后的能量是 $E^{\\star\\star} = E^\\star + \\Delta E$。更新后的气体压力恢复为\n$$\np^{\\star\\star} = (\\gamma - 1)\\left( E^{\\star\\star} - \\frac{1}{2}\\rho (v_y^\\star)^2 - \\frac{1}{2}\\left[(B_x^\\star)^2 + (B_y^\\star)^2\\right] \\right).\n$$\n如果 $p^{\\star\\star} < 0$，则状态被认为是非物理的。\n\n每个测试用例的算法步骤：\n- 输入 $(\\rho, p, v_{y,L}, B_{y,L}, v_{y,R}, B_{y,R}, B_{x,L}, B_{x,R})$，其中 $v_x=0$ 和 $B_z=v_z=0$。\n- 计算 $B_x^\\star = \\frac{1}{2}(B_{x,L}+B_{x,R})$, $c_{A,L} = |B_{x,L}|/\\sqrt{\\rho}$, $c_{A,R} = |B_{x,R}|/\\sqrt{\\rho}$, $\\Delta t = \\frac{1}{2}/\\max(c_{A,L}, c_{A,R})$。\n- 精确/Roe/HLLD 星号状态：\n  - 计算 $w_L^+ = v_{y,L} + B_{y,L}/\\sqrt{\\rho}$ 和 $w_R^- = v_{y,R} - B_{y,R}/\\sqrt{\\rho}$。\n  - 设置 $(v_y^\\star, B_y^\\star) = \\left(\\frac{w_L^+ + w_R^-}{2},\\, \\frac{\\sqrt{\\rho}\\,(w_L^+ - w_R^-)}{2}\\right)$。\n- HLLE 星号状态：\n  - 计算 $S_L = -c_{A,L}$, $S_R = +c_{A,R}$, $U_{t,L}=[\\rho v_{y,L}, B_{y,L}]^\\top$, $U_{t,R}=[\\rho v_{y,R}, B_{y,R}]^\\top$, $F_{t,L}=[-B_{x,L} B_{y,L}, -B_{x,L} v_{y,L}]^\\top$, $F_{t,R}=[-B_{x,R} B_{y,R}, -B_{x,R} v_{y,R}]^\\top$。\n  - 如果 $S_R - S_L \\neq 0$，设置 $U_t^\\star = \\frac{S_R U_{t,R}-S_L U_{t,L}+F_{t,L}-F_{t,R}}{S_R - S_L}$ 和 $(v_y^\\star, B_y^\\star) = (U_t^\\star_1/\\rho, U_t^\\star_2)$；否则，声明HLLE失败。\n- 对每个求解器的 $(v_y^\\star, B_y^\\star)$，计算 $E^\\star$、$\\Delta E$、$E^{\\star\\star}$ 和 $p^{\\star\\star}$；返回一个布尔值，指示 $p^{\\star\\star}\\ge 0$ 是否成立。如果发生除以零或未定义的步骤，则返回 $\\texttt{False}$。\n\n测试套件覆盖范围的理由：\n- 案例1是一个接近无散度的构型，具有适度的横向阿尔芬跳跃；它测试了所有求解器都应保持物理性的“理想情况”。\n- 案例2引入了中等程度的散度违反和相反的横向场，以最大化负的 $(\\mathbf{v}\\cdot\\mathbf{B})$，从而对能量源项施加压力；它测试了对非物理状态的易感性。\n- 案例3是一个横向分量为零的边界情况，使得 $(\\mathbf{v}\\cdot\\mathbf{B})=0$ 并中和了散度引起的能量变化；所有求解器都应具有鲁棒性。\n- 案例4施加了强烈的散度误差，并采用相同的相反横向构型，以探测极端条件。\n\n程序将每个测试用例的结果聚合成 $[\\texttt{Roe}, \\texttt{HLLD}, \\texttt{HLLE}]$ 布尔值，并打印一个列表的列表的单行，从而能够自动化验证求解器在规定的散度违反下的鲁棒性。", "answer": "[[\\texttt{True},\\texttt{True},\\texttt{True}],[\\texttt{False},\\texttt{False},\\texttt{True}],[\\texttt{True},\\texttt{True},\\texttt{True}],[\\texttt{False},\\texttt{False},\\texttt{True}]]", "id": "3539086"}, {"introduction": "为了从根本上解决磁场散度问题，我们需要专门设计的数值方法。约束输运（Constrained Transport, CT）方法是一种前沿技术，它通过在交错网格上精心设计的离散格式，能够在机器精度内严格保持磁场的无散度条件。本练习将指导你在天体物理中常用的柱坐标系下，推导并实现一个CT格式，让你亲身体验如何处理由度规项和坐标轴奇点带来的额外复杂性，从而构建一个更加健壮的MHD求解器。 [@problem_id:3539071]", "problem": "您需要推导并实现在轴对称柱坐标下，理想磁流体力学（MHD）磁感应子系统的度规感知约束输运（CT）更新。您的实现必须是守恒的，即它能够精确保持磁场无散度约束的离散表示，直至机器精度，即使在靠近柱坐标轴的区域也是如此。所涉及的物理学是理想磁流体力学（MHD），其感应方程由 Maxwell–Faraday 定律和理想欧姆定律导出。您的推导必须严格从基本定律开始：Maxwell–Faraday 定律和适用于理想导电流体的理想欧姆定律。\n\n出发点和建模假设：\n- 基本的 Maxwell–Faraday 定律为 $\\partial \\mathbf{B}/\\partial t = - \\nabla \\times \\mathbf{E}$，理想欧姆定律为 $\\mathbf{E} = - \\mathbf{v} \\times \\mathbf{B}$，其中 $\\mathbf{B}$ 是磁场，$\\mathbf{E}$ 是电场，$\\mathbf{v}$ 是流体速度。\n- 使用具有轴对称性的柱坐标 $(r,\\phi,z)$，即 $\\partial/\\partial \\phi = 0$。\n- 仅限于通过 $E_\\phi$ 更新 $B_r$ 和 $B_z$ 的极向感应子系统；您可以保持环向分量 $B_\\phi$ 固定，并且无需更新质量、动量或能量。\n- 需要保持的离散散度算子是 $\\mathbf{B}$ 在柱坐标系下的轴对称散度：$\\nabla\\cdot\\mathbf{B} = \\frac{1}{r}\\frac{\\partial}{\\partial r}(r B_r) + \\frac{\\partial B_z}{\\partial z}$。\n\n您的任务：\n- 从 Maxwell–Faraday 定律和理想欧姆定律出发，推导在轴对称条件下均匀 $(r,z)$ 网格上，针对面心磁场分量 $B_r$ 和 $B_z$ 的半离散、度规感知 CT 更新。您必须用边心 $E_\\phi$ 来表示更新，并展示柱坐标度规因子如何进入更新公式。\n- 推导一个自洽的面心离散散度算子，该算子在径向面上使用 $r B_r$，在轴向面上使用 $B_z$，并证明在假设 $z$ 方向为周期性边界条件且在 $r=0$ 处满足正则性条件下，CT 更新能够精确保持此离散散度（在舍入误差范围内）。\n- 实现一个程序，该程序：\n  - 建立一个均匀网格，在 $r \\in [0,R]$ 范围内有 $N_r$ 个单元格，在 $z \\in [0,Z]$ 范围内有 $N_z$ 个单元格。\n  - 将 $B_r$ 存储在位置为 $(r_{i+1/2}, z_j)$ 的径向面上，将 $B_z$ 存储在位置为 $(r_i, z_{j+1/2})$ 的轴向面上，其中 $i \\in \\{0,\\dots,N_r-1\\}$ 和 $j \\in \\{0,\\dots,N_z-1\\}$ 分别是单元格中心的索引，面的索引范围是显而易见的。这里，$r_i = (i+1/2)\\Delta r$ 和 $z_j = (j+1/2)\\Delta z$，其中 $\\Delta r = R/N_r$ 和 $\\Delta z = Z/N_z$。径向面位于 $r_{i+1/2} = i \\Delta r$，其中 $i \\in \\{0,\\dots,N_r\\}$；轴向面位于 $z_{j+1/2} = j \\Delta z$，其中 $j \\in \\{0,\\dots,N_z\\}$。\n  - 初始化 $B_r=0$ 和 $B_z=B_0$（常数）。\n  - 给定一个不随时间变化的速度场，该速度场具有刚体旋转和一个平滑的、在轴上正则的径向流入/流出：\n    - $v_\\phi(r,z) = \\Omega\\, r$,\n    - $v_r(r,z) = a\\, r \\cos\\!\\big(2\\pi z/Z\\big)$,\n    - $v_z(r,z) = 0$。\n  - 根据理想欧姆定律，使用当前的 $B$ 和给定的 $\\mathbf{v}$，在轴对称条件下计算单元格角点 $(r_{i+1/2}, z_{j+1/2})$ 处的边心 $E_\\phi$。您必须使用 $E_\\phi = -(\\mathbf{v} \\times \\mathbf{B})_\\phi = - (v_r B_z - v_z B_r)$，由于 $v_z=0$，该式简化为 $E_\\phi = - v_r B_z$。\n  - 使用您的度规感知更新，将 $B_r$ 和 $B_z$ 推进一个或多个 CT 时间步。在 $z$ 方向使用周期性边界条件。在柱坐标轴 $r=0$ 处，通过设置 $B_r(r=0,\\cdot)=0$ 来施加正则性条件。位于 $r=R$ 的径向外边界可以使用相同的 CT 公式进行更新（除此之外无需处理流入/流出）。\n  - 使用根据极向流的 Courant–Friedrichs–Lewy (CFL) 条件计算出的时间步长：$\\Delta t = C_{\\mathrm{cfl}} \\min(\\Delta r,\\Delta z)/\\max(|v_r|+|v_z|)$，在网格上进行评估。如果分母的最大值为零，则设置 $\\Delta t = C_{\\mathrm{cfl}} \\min(\\Delta r,\\Delta z)$。\n  - 在指定的步数后，使用度规自洽算子计算所有单元格中心离散散度的最大绝对值：\n    $$D_{i,j} = \\frac{1}{r_i}\\,\\frac{r_{i+1/2} B_{r\\,i+1/2,j} - r_{i-1/2} B_{r\\,i-1/2,j}}{\\Delta r} \\;+\\; \\frac{B_{z\\,i,j+1/2} - B_{z\\,i,j-1/2}}{\\Delta z}.$$\n  - 将此最大绝对离散散度报告为一个浮点数。\n\n数值单位：\n- 全程使用无量纲单位。所有报告的量都必须是无量纲的。\n\n角度单位：\n- 任何关于 $z$ 的三角函数都必须使用弧度。\n\n测试套件：\n实现您的程序以执行以下测试用例，并按如下规定将结果汇总到单行输出。对于每个用例，运行方案 $N_{\\mathrm{steps}}$ 步，并报告最终的最大绝对离散散度。\n\n- 用例 1（正常路径）：\n  - $N_r = 32$, $N_z = 32$, $R = 1$, $Z = 1$, $B_0 = 1$, $a = 0.5$, $\\Omega = 3$, $C_{\\mathrm{cfl}} = 0.4$, $N_{\\mathrm{steps}} = 10$。\n- 用例 2（近轴和强剪切）：\n  - $N_r = 8$, $N_z = 16$, $R = 0.25$, $Z = 1$, $B_0 = 0.7$, $a = 4.0$, $\\Omega = 10$, $C_{\\mathrm{cfl}} = 0.2$, $N_{\\mathrm{steps}} = 20$。\n- 用例 3（纯旋转，无极向流）：\n  - $N_r = 16$, $N_z = 16$, $R = 1$, $Z = 1$, $B_0 = 2.0$, $a = 0.0$, $\\Omega = 5.0$, $C_{\\mathrm{cfl}} = 0.4$, $N_{\\mathrm{steps}} = 5$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的三个浮点数结果按上述用例的顺序排列（例如，$[r_1,r_2,r_3]$）。每个条目都必须是一个浮点数。输出必须是单行，不含任何附加文本。\n\n科学真实性和约束条件：\n- 确保您的推导仅以 Maxwell–Faraday 定律和理想欧姆定律作为出发点。不要假设任何未从这些原理推导出的专门 MHD 公式。\n- 确保您的实现遵守柱坐标度规因子和轴的正则性，并在 $z$ 方向使用周期性边界条件。", "solution": "用户要求在轴对称柱坐标下，为极向磁场分量推导并实现一个度规感知的约束输运（CT）更新。推导必须从基本原理出发，实现必须在数值上保持磁场的无散度条件。\n\n### 第1部分：半离散感应方程的推导\n\n该问题从电磁学的两个基本定律开始：Maxwell-Faraday 定律和适用于理想导电流体的理想欧姆定律。\n\n1.  **Maxwell-Faraday 定律**：\n    $$ \\frac{\\partial \\mathbf{B}}{\\partial t} = - \\nabla \\times \\mathbf{E} $$\n    其中 $\\mathbf{B}$ 是磁场矢量，$\\mathbf{E}$ 是电场矢量。\n\n2.  **理想欧姆定律**：\n    $$ \\mathbf{E} = - \\mathbf{v} \\times \\mathbf{B} $$\n    其中 $\\mathbf{v}$ 是流体速度。\n\n将理想欧姆定律代入 Maxwell-Faraday 定律，得到理想感应方程：\n$$ \\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B}) $$\n该问题设定在柱坐标系 $(r, \\phi, z)$ 中，并假设轴对称，这意味着所有关于方位角 $\\phi$ 的偏导数均为零，即 $\\frac{\\partial}{\\partial \\phi} = 0$。\n\n柱坐标中的旋度算子由下式给出：\n$$ \\nabla \\times \\mathbf{A} = \\left( \\frac{1}{r}\\frac{\\partial A_z}{\\partial \\phi} - \\frac{\\partial A_\\phi}{\\partial z} \\right) \\hat{\\mathbf{r}} + \\left( \\frac{\\partial A_r}{\\partial z} - \\frac{\\partial A_z}{\\partial r} \\right) \\hat{\\mathbf{\\phi}} + \\frac{1}{r} \\left( \\frac{\\partial (r A_\\phi)}{\\partial r} - \\frac{\\partial A_r}{\\partial \\phi} \\right) \\hat{\\mathbf{z}} $$\n应用轴对称性（$\\frac{\\partial}{\\partial \\phi} = 0$），旋度简化为：\n$$ \\nabla \\times \\mathbf{A} = - \\frac{\\partial A_\\phi}{\\partial z} \\hat{\\mathbf{r}} + \\left( \\frac{\\partial A_r}{\\partial z} - \\frac{\\partial A_z}{\\partial r} \\right) \\hat{\\mathbf{\\phi}} + \\frac{1}{r} \\frac{\\partial (r A_\\phi)}{\\partial r} \\hat{\\mathbf{z}} $$\n问题将分析限制在极向感应子系统，该子系统控制极向磁场分量 $B_r$ 和 $B_z$ 的演化。这种演化由电场的环向分量 $E_\\phi$ 驱动。根据轴对称条件下的法拉第定律，极向磁场分量的时间导数为：\n$$ \\frac{\\partial B_r}{\\partial t} = (-\\nabla \\times \\mathbf{E})_r = - \\left( -\\frac{\\partial E_\\phi}{\\partial z} \\right) = \\frac{\\partial E_\\phi}{\\partial z} $$\n$$ \\frac{\\partial B_z}{\\partial t} = (-\\nabla \\times \\mathbf{E})_z = - \\left( \\frac{1}{r} \\frac{\\partial (r E_\\phi)}{\\partial r} \\right) = -\\frac{1}{r} \\frac{\\partial (r E_\\phi)}{\\partial r} $$\n环向电场 $E_\\phi$ 由理想欧姆定律的 $\\hat{\\mathbf{\\phi}}$ 分量给出：\n$$ E_\\phi = (-\\mathbf{v} \\times \\mathbf{B})_\\phi = -(v_r B_z - v_z B_r) = v_z B_r - v_r B_z $$\n这两个偏微分方程构成了需要数值求解的半离散系统。\n\n### 第2部分：离散化与约束输运更新\n\n我们在具有单元格宽度 $\\Delta r$ 和 $\\Delta z$ 的均匀网格上对该域进行离散化。遵循约束输运（CT）方法，磁场分量是交错放置的：\n-   $B_r$ 位于径向面上的位置 $(r_{i+1/2}, z_j)$。\n-   $B_z$ 位于轴向面上的位置 $(r_i, z_{j+1/2})$。\n-   $E_\\phi$ 位于单元格角点，或 $r-z$ 平面中的“边”，位置为 $(r_{i+1/2}, z_{j+1/2})$。\n\n此处，$r_i$ 和 $z_j$ 表示单元格中心位置，而 $r_{i+1/2}$ 和 $z_{j+1/2}$ 表示面/边位置。网格定义如下：\n-   径向单元格中心：$r_i = (i+1/2)\\Delta r$，其中 $i=0, \\dots, N_r-1$。\n-   径向面：$r_{i+1/2} = (i+1)\\Delta r$，其中 $i=-1, \\dots, N_r-1$。问题陈述使用略有不同的索引约定；我们将其映射到标准的有限体积索引。我们定义径向面 $r_f[i] = i \\Delta r$，其中 $i=0, \\dots, N_r$。单元格 $i$ 位于 $r_f[i]$ 和 $r_f[i+1]$ 之间。\n-   轴向面和中心也类似定义。\n\n我们现在使用简单的前向欧拉时间积分步长为半离散方程写出有限差分近似。\n\n$B_r$ 的更新，在 $(r_{i+1/2}, z_j)$ 处离散化：\n$$ \\frac{B_{r, i+1/2, j}^{n+1} - B_{r, i+1/2, j}^{n}}{\\Delta t} = \\frac{E_{\\phi, i+1/2, j+1/2}^{n} - E_{\\phi, i+1/2, j-1/2}^{n}}{\\Delta z} $$\n$$ \\implies B_{r, i+1/2, j}^{n+1} = B_{r, i+1/2, j}^{n} + \\frac{\\Delta t}{\\Delta z} (E_{\\phi, i+1/2, j+1/2}^{n} - E_{\\phi, i+1/2, j-1/2}^{n}) $$\n\n$B_z$ 的更新，在 $(r_i, z_{j+1/2})$ 处离散化：\n$$ \\frac{B_{z, i, j+1/2}^{n+1} - B_{z, i, j+1/2}^{n}}{\\Delta t} = - \\frac{1}{r_i} \\left( \\frac{r_{i+1/2} E_{\\phi, i+1/2, j+1/2}^{n} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}^{n}}{\\Delta r} \\right) $$\n$$ \\implies B_{z, i, j+1/2}^{n+1} = B_{z, i, j+1/2}^{n} - \\frac{\\Delta t}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j+1/2}^{n} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}^{n}) $$\n这些是度规感知的 CT 更新方程。几何度规因子（$r$）被明确地包含在内。\n\n### 第3部分：离散散度的守恒\n\nCT 方法的显著特点是它能够将无散度条件 $\\nabla \\cdot \\mathbf{B} = 0$ 保持到机器精度。$\\mathbf{B}$ 的轴对称散度为：\n$$ \\nabla \\cdot \\mathbf{B} = \\frac{1}{r} \\frac{\\partial (r B_r)}{\\partial r} + \\frac{\\partial B_z}{\\partial z} $$\n在问题陈述中给出了一个在单元格中心 $(i, j)$ 的、自洽的、面心离散散度算子：\n$$ D_{i,j} = \\frac{1}{r_i \\Delta r} (r_{i+1/2} B_{r, i+1/2, j} - r_{i-1/2} B_{r, i-1/2, j}) + \\frac{1}{\\Delta z} (B_{z, i, j+1/2} - B_{z, i, j-1/2}) $$\n为了证明 CT 更新保持这个离散散度，我们考察 $D_{i,j}$ 在一个时间步内的变化 $D_{i,j}^{n+1} - D_{i,j}^{n}$。让我们用 $\\delta B = B^{n+1} - B^n$ 表示。\n$$ D_{i,j}^{n+1} - D_{i,j}^{n} = \\frac{1}{r_i \\Delta r} (r_{i+1/2} \\delta B_{r, i+1/2, j} - r_{i-1/2} \\delta B_{r, i-1/2, j}) + \\frac{1}{\\Delta z} (\\delta B_{z, i, j+1/2} - \\delta B_{z, i, j-1/2}) $$\n从更新方程中代入 $\\delta B$ 的表达式：\n$$ \\delta B_{r, i+1/2, j} = \\frac{\\Delta t}{\\Delta z} (E_{\\phi, i+1/2, j+1/2} - E_{\\phi, i+1/2, j-1/2}) $$\n$$ \\delta B_{z, i, j+1/2} = - \\frac{\\Delta t}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}) $$\n将这些代入散度变化方程并除以 $\\Delta t$：\n\\begin{align*}\n\\frac{D_{i,j}^{n+1} - D_{i,j}^{n}}{\\Delta t} = & \\frac{1}{r_i \\Delta r} \\left[ r_{i+1/2} \\frac{E_{\\phi, i+1/2, j+1/2} - E_{\\phi, i+1/2, j-1/2}}{\\Delta z} - r_{i-1/2} \\frac{E_{\\phi, i-1/2, j+1/2} - E_{\\phi, i-1/2, j-1/2}}{\\Delta z} \\right] \\\\\n& + \\frac{1}{\\Delta z} \\left[ - \\frac{1}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}) \\right. \\\\\n& \\left. - \\left( - \\frac{1}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j-1/2} - r_{i-1/2} E_{\\phi, i-1/2, j-1/2}) \\right) \\right]\n\\end{align*}\n将整个方程乘以 $r_i \\Delta r \\Delta z$ 可以简化表达式：\n\\begin{align*}\n\\text{第1项（来自 } B_r\\text{）：} & (r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i+1/2} E_{\\phi, i+1/2, j-1/2}) - (r_{i-1/2} E_{\\phi, i-1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j-1/2}) \\\\\n\\text{第2项（来自 } B_z\\text{）：} & -(r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}) + (r_{i+1/2} E_{\\phi, i+1/2, j-1/2} - r_{i-1/2} E_{\\phi, i-1/2, j-1/2})\n\\end{align*}\n将这两项相加，我们观察到每一项都精确地相互抵消：\n$$ (+r_{i+1/2}E_{\\dots,j+1/2}) + (-r_{i+1/2}E_{\\dots,j+1/2}) = 0 $$\n$$ (-r_{i+1/2}E_{\\dots,j-1/2}) + (+r_{i+1/2}E_{\\dots,j-1/2}) = 0 $$\n$$ (-r_{i-1/2}E_{\\dots,j+1/2}) + (+r_{i-1/2}E_{\\dots,j+1/2}) = 0 $$\n$$ (+r_{i-1/2}E_{\\dots,j-1/2}) + (-r_{i-1/2}E_{\\dots,j-1/2}) = 0 $$\n和恒等于零。这证明了 $D_{i,j}^{n+1} - D_{i,j}^{n} = 0$，意味着离散散度在每个单元格和每个时间步都守恒至机器精度。即使在坐标轴（$i=0$）处，只要更新公式和散度算子的构造能够正确处理坐标奇点，该性质仍然成立，而它们确实如此。对于轴上的单元格，$r_{i-1/2}$ 项变为零，并且 $1/r_i$ 因子也得到了正确处理。具体来说，在 $r \\to 0$ 时，如果 $A(0)=0$，我们有 $\\frac{1}{r}\\frac{\\partial(rA)}{\\partial r} \\to 2\\frac{\\partial A}{\\partial r}$。我们用于 $i=0$ 处 $B_z$ 更新的有限差分模板正确地逼近了这个极限。\n\n### 第4部分：实现策略\n\n程序将实现所推导的 CT 方案。\n1.  **网格和场**：为 $B_r$、$B_z$ 和 $E_\\phi$ 设置交错网格数组，要特别注意与面和单元格中心相对应的数组维度。\n2.  **初始和边界条件**：初始化 $B_r=0$ 和 $B_z=B_0$。强制执行轴条件 $B_r(r=0)=0$。通过确保 $z=Z$ 边界上的量与 $z=0$ 处的量匹配来处理 $z$ 方向的周期性。\n3.  **时间循环**：在每个时间步：\n    a. 根据网格上极向速度的最大值，通过 CFL 条件计算时间步长 $\\Delta t$。\n    b. 在单元格角点计算电场 $E_\\phi = v_z B_r - v_r B_z$。由于 $v_z=0$，这简化为 $E_\\phi = -v_r B_z$。这需要将 $B_z$（定义在 $r$ 单元格中心）插值到需要 $E_\\phi$ 的 $r$ 面上。简单的线性平均就足够了。在轴 $r=0$ 处，$v_r=0$，因此 $E_\\phi(0,z)=0$。\n    c. 使用推导出的 CT 更新公式来推进 $B_r$ 和 $B_z$。要特别注意轴上的更新。\n4.  **散度计算**：在指定的步数之后，使用度规感知的公式在所有单元格中心计算离散散度 $D_{i,j}$。对于一般情况（$i>0$）和轴上的特殊情况（$i=0$），都必须仔细实现该公式。\n5.  **输出**：报告整个网格上计算出的散度的最大绝对值。对于纯旋转的情况（$a=0$），此时 $E_\\phi=0$，场不应演化，初始的零散度应保持在机器精度内。", "answer": "[3.829910543789038e-15,2.1316282072803006e-13,0.0]", "id": "3539071"}]}