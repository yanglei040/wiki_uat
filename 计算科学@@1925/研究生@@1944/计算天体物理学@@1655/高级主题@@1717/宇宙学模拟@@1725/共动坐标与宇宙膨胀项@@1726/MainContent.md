## 引言
在广阔的宇宙背景下研究星系形成和演化等天体物理过程，面临着一个独特的挑战：如何在一个整体膨胀的时空中精确描述局域的[引力](@entry_id:175476)动力学？为了解决这一问题，宇宙学家们发展出了一套强大的数学工具——[共动坐标系](@entry_id:266800)与宇宙膨胀项。这个框架是现代[计算天体物理学](@entry_id:145768)和观测宇宙学的基石，它允许我们将宇宙的宏观膨胀与物质的微观运动分离开来，从而进行有效的理论分析和[数值模拟](@entry_id:137087)。本文将系统地引导您掌握这一核心概念。在第一章“原理与机制”中，我们将从第一性原理出发，建立坐标、速度和[守恒定律](@entry_id:269268)在[膨胀宇宙](@entry_id:161442)中的数学形式。接下来，在“应用和跨学科联系”一章，我们将展示这一框架如何在结构形成、引力透镜和数值模拟等前沿领域中发挥关键作用。最后，“动手实践”部分将提供具体的编程练习，帮助您将理论知识转化为实践技能。

## 原理与机制

在宇宙学背景下进行天体[物理模拟](@entry_id:144318)，需要一个能够将宇宙的整[体膨胀](@entry_id:144241)与星系、气体等局部动力学过程分离开来的数学框架。本章旨在深入阐述这一框架的基石——[共动坐标系](@entry_id:266800)与[宇宙膨胀](@entry_id:161474)项。我们将从第一性原理出发，系统地建立物理坐标与[共动坐标](@entry_id:271238)之间的运动学关系，推导在膨胀宇宙中[守恒定律](@entry_id:269268)的演化形式，并探讨在[数值模拟](@entry_id:137087)中处理这些方程的不同方法及其意义。

### 膨胀的运动学：坐标、距离与速度

描述一个均匀且各向同性的膨胀宇宙，最通用的工具是弗里德曼-勒梅特-罗伯逊-沃尔克（Friedmann-Lemaître-Robertson-Walker, FLRW）度规。对于一个空间平坦的宇宙（这是当前[标准宇宙学模型](@entry_id:159833)的良好近似），时空[线元](@entry_id:196833) $ds$ 可以写作：
$$
ds^2 = -c^2 dt^2 + a^2(t) (dx^2 + dy^2 + dz^2) = -c^2 dt^2 + a^2(t) \delta_{ij} dx^i dx^j
$$
其中 $c$ 是光速，$t$ 是**宇宙时（cosmic time）**，定义为在时空每一点随哈勃流体静止的观测者所测量到的固有时。$x^i$（或矢量形式的 $\mathbf{x}$）是**[共动坐标](@entry_id:271238)（comoving coordinates）**，它们构成了一个随宇宙膨胀而伸展的网格。**[尺度因子](@entry_id:266678)（scale factor）** $a(t)$ 是一个仅与时间相关的无量纲函数，描述了宇宙的相对大小。按照惯例，我们将现今宇宙的尺度因子归一化为 $a(t_0) = 1$。

#### 物理坐标与共動坐标

在[FLRW度规](@entry_id:265365)中，空间部分的[度规张量](@entry_id:160222)为 $g_{ij} = a^2(t)\delta_{ij}$。这表明，在任意给定的时刻 $t$，任意两点间的**物理距离（proper distance）** $d\mathbf{r}$ 与它们的**[共动坐标](@entry_id:271238)分离（comoving separation）** $d\mathbf{x}$ 之间存在一个简单的缩放关系：$|d\mathbf{r}|^2 = a^2(t)|d\mathbf{x}|^2$。通过对从共同原点开始的路径进行积分，我们可以得到一个质点的**物理位置（physical position）** $\mathbf{r}(t)$ 与其共动位置 $\mathbf{x}$ 之间的基本关系 [@problem_id:3506211]：
$$
\mathbf{r}(t) = a(t) \mathbf{x}
$$
这个关系是理解宇宙膨胀[运动学](@entry_id:173318)的核心。一个仅参与宇宙整[体膨胀](@entry_id:144241)而不相对于周围环境运动的物体，被称为**[共动观测者](@entry_id:158168)（comoving observer）**。根据定义，这样的观测者其[共动坐标](@entry_id:271238) $\mathbf{x}$ 是恒定不变的，即 $\dot{\mathbf{x}} = d\mathbf{x}/dt = \mathbf{0}$。

因此，两个共动的星系之间的[共动距离](@entry_id:158059) $\Delta \chi$ 是不随时间改变的。然而，它们之间的物理距离，即**[固有距离](@entry_id:162052)（proper distance）** $D_p(t)$，则会随着宇宙的膨胀而增加 [@problem_id:3506156]：
$$
D_p(t) = a(t) \Delta \chi
$$
对上式关于时间求导，我们就能得到这两个星系相互远离的速度，即它们的**退行速度（recession velocity）**：
$$
\dot{D}_p(t) = \dot{a}(t) \Delta \chi = \frac{\dot{a}(t)}{a(t)} (a(t) \Delta \chi) = H(t) D_p(t)
$$
这里，我们引入了**哈勃参数（Hubble parameter）** $H(t) \equiv \dot{a}(t)/a(t)$。上式 $\mathbf{v} = H(t)\mathbf{r}$ 正是著名的**哈勃-勒梅特定律（Hubble-Lemaître law）**，它描述了远方星系的退行速度与其物理距离成正比。值得注意的是，这种退行并非星系在空间中的运动，而是空间本身膨胀的结果。反之，如果一个物体的物理速度恰好满足 $\mathbf{v} = H(t)\mathbf{r}$，那么它的[共动坐标](@entry_id:271238)的时间导数必然为零，即 $\dot{\mathbf{x}}=\mathbf{0}$ [@problem_id:3506211]。

需要强调的是，$\mathbf{r} = a(t)\mathbf{x}$ 这一关系只有在[空间曲率](@entry_id:755140)为零（即 $\gamma_{ij} = \delta_{ij}$）的情况下，才能被视为一个全局的[笛卡尔坐标](@entry_id:167698)变换。对于具有非零[空间曲率](@entry_id:755140)的宇宙（如球面或[双曲面](@entry_id:170736)几何），这种简单的[线性缩放](@entry_id:197235)关系在局部仍然成立，但无法构建一个全局的欧几里得[坐标系](@entry_id:156346) $\mathbf{r}$ [@problem_id:3506149]。

#### 速度的分解：哈勃流与[本动速度](@entry_id:157964)

在宇宙学中，一个天体的总物理速度 $\mathbf{v} \equiv \dot{\mathbf{r}}$ 通常可以分解为两部分：由宇宙膨胀引起的**哈勃流（Hubble flow）**速度，以及相对于哈勃流的**[本动速度](@entry_id:157964)（peculiar velocity）**。通过对关系式 $\mathbf{r}(t) = a(t)\mathbf{x}(t)$ 直接求时间导数（注意此时 $\mathbf{x}$ 可能是时间的函数），我们可以精确地推导出这种分解 [@problem_id:3506211]：
$$
\mathbf{v}(t) = \frac{d}{dt}[a(t)\mathbf{x}(t)] = \dot{a}(t)\mathbf{x}(t) + a(t)\dot{\mathbf{x}}(t)
$$
利用哈勃参数的定义 $H = \dot{a}/a$ 和物理位置的定义 $\mathbf{r} = a\mathbf{x}$，第一项可以重写为 $\dot{a}\mathbf{x} = (\dot{a}/a)(a\mathbf{x}) = H\mathbf{r}$。第二项 $a(t)\dot{\mathbf{x}}(t)$ 则代表了质点相对于共动网格的运动在物理空间中的表现。我们将**共动[本动速度](@entry_id:157964)（comoving peculiar velocity）**定义为 $\mathbf{u} \equiv \dot{\mathbf{x}}$，那么物理[本动速度](@entry_id:157964)就是 $\mathbf{v}_{\text{pec}} = a(t)\mathbf{u}$。

于是，总的物理速度可以完美地分解为：
$$
\mathbf{v} = H(t)\mathbf{r} + a(t)\mathbf{u} = H(t)\mathbf{r} + \mathbf{v}_{\text{pec}}
$$
这个恒等式在[计算天体物理学](@entry_id:145768)中至关重要。[数值模拟](@entry_id:137087)通常在[共动坐标系](@entry_id:266800)中求解粒子的运动，计算出共动位置 $\mathbf{x}_i$ 和共动速度 $\dot{\mathbf{x}}_i$。为了与观测进行比较，或理解其物理行为，我们需要将这些量转换到物理[坐标系](@entry_id:156346)中。这个速度分解公式正是执行这种转换和验证的基础 [@problem_id:3506179]。

### [膨胀宇宙](@entry_id:161442)中的[守恒定律](@entry_id:269268)

将物理定律从静态的[惯性参考系](@entry_id:276742)推广到动态的膨胀宇宙背景中，需要仔细考虑坐标变换对体积、密度和导数算子的影响。

#### 体积、密度与粒子数守恒

物理[体积元](@entry_id:267802) $d^3r$ 与共动[体积元](@entry_id:267802) $d^3x$ 之间的关系可以从坐标变换 $\mathbf{r} = a(t)\mathbf{x}$ 直接推得。在[笛卡尔坐标](@entry_id:167698)下，$dr_i = a(t)dx_i$，因此 [@problem_id:3506211] [@problem_id:3506149]：
$$
d^3r = dr_1 dr_2 dr_3 = (a\,dx_1)(a\,dx_2)(a\,dx_3) = a^3(t) d^3x
$$
这意味着一个固定的共动体积 $V_{\text{com}}$，其对应的物理体积 $V_{\text{phys}}$ 会随着宇宙的膨胀而增大，即 $V_{\text{phys}}(t) = a^3(t)V_{\text{com}}$。

考虑一个在共动体积 $V_{\text{com}}$ 内，粒子数守恒的系统。设其中的粒子总数为 $N$。**共动数密度（comoving number density）** $n_{\text{com}}$ 定义为单位共动体积内的粒子数，即 $n_{\text{com}} = N/V_{\text{com}}$。由于 $N$ 和 $V_{\text{com}}$ 都不随时间改变，因此 $n_{\text{com}}$ 是一个常数。而**物理[数密度](@entry_id:268986)（proper number density）** $n_{\text{phys}}$ 则是单位物理体积内的粒子数，$n_{\text{phys}}(t) = N/V_{\text{phys}}(t)$。利用体积变换关系，我们得到 [@problem_id:3506170]：
$$
n_{\text{phys}}(t) = \frac{N}{a^3(t)V_{\text{com}}} = \frac{n_{\text{com}}}{a^3(t)}
$$
这个 $n_{\text{phys}} \propto a^{-3}$ 的关系是宇宙学中的一个基本结论，它表明随着[宇宙膨胀](@entry_id:161474)，任何守恒物质的物理密度都会因体积的增加而被稀释。对于一个均匀的无压物质（尘埃）流体，其物理质量密度 $\rho$ 同样遵循 $\rho(t) \propto a^{-3}$。这可以从[连续性方程](@entry_id:195013) $\dot{\rho} + 3H\rho = 0$ 中解出 [@problem_id:3506211]。

#### 连续性方程的共动形式

更一般地，对于一个存在密度涨落和[本动速度](@entry_id:157964)的流体，其质量守恒由物理[坐标系](@entry_id:156346)中的标准连续性方程描述：
$$
\frac{\partial \rho}{\partial t} + \nabla_{\mathbf{r}} \cdot (\rho \mathbf{v}) = 0
$$
为了在[宇宙学模拟](@entry_id:747928)中使用，我们需要将其转换到[共动坐标系](@entry_id:266800) $(\mathbf{x}, t)$。首先，[梯度算子](@entry_id:275922)的变换关系为 $\nabla_{\mathbf{r}} = a^{-1}\nabla_{\mathbf{x}}$。时间导数的变换则更为复杂，它涉及到从固定物理点 $\mathbf{r}$ 的偏导到固定共动点 $\mathbf{x}$ 的偏导的转换。经过详细的推导（如 [@problem_id:3506162] 中所展示的），可以证明该方程在[共动坐标系](@entry_id:266800)中变为：
$$
\frac{\partial \rho}{\partial t} + 3H\rho + \frac{1}{a} \nabla_{\mathbf{x}} \cdot (\rho \mathbf{u}) = 0
$$
其中 $\mathbf{u}$ 是[本动速度](@entry_id:157964) $d\mathbf{x}/dt$。这个形式虽然正确，但在处理宇宙大尺度结构时并不方便，因为 $\rho$ 同时包含了背景的稀释和局部涨落的增长。

为了分离这两种效应，我们引入**[密度涨落](@entry_id:143540)（density contrast）** $\delta(\mathbf{x}, t) \equiv (\rho(\mathbf{x}, t) - \bar{\rho}(t))/\bar{\rho}(t)$，其中 $\bar{\rho}(t)$ 是宇宙的平均背景密度。我们已知 $\dot{\bar{\rho}} = -3H\bar{\rho}$。将 $\rho = \bar{\rho}(1+\delta)$ 代入上述共动[连续性方程](@entry_id:195013)，背景演化的项会精确地抵消掉，最终得到一个只描述[密度涨落](@entry_id:143540)演化的方程。更进一步，如果我们引入**[共形时间](@entry_id:263727)（conformal time）** $\eta$，其定义为 $d\eta = dt/a(t)$，并重新定义[本动速度](@entry_id:157964)为对[共形时间](@entry_id:263727)的导数 $\mathbf{u} \equiv d\mathbf{x}/d\eta$，方程将变得异常简洁 [@problem_id:3506162]：
$$
\frac{\partial \delta}{\partial \eta} + \nabla_{\mathbf{x}} \cdot [(1+\delta)\mathbf{u}] = 0
$$
这个方程是研究[非线性](@entry_id:637147)[结构形成](@entry_id:158241)理论的基石之一。它表明，在以[共形时间](@entry_id:263727)为时间变量的[共动坐标系](@entry_id:266800)中，密度涨落的演化完全由[本动速度](@entry_id:157964)场及其与密度场的耦合所决定，宇宙的背景膨胀效应被完全吸收到时间变量和速度的定义中了。

### 宇宙演化的时间坐标与动力学

求解宇宙学中的[演化方程](@entry_id:268137)时，选择合适的时间变量至关重要。除了物理的宇宙时 $t$ 外，尺度因子 $a$ 和[共形时间](@entry_id:263727) $\eta$ 也是常用的选择。它们之间的导数关系可以通过链式法则推导得出 [@problem_id:3506160]。
对于任何只依赖于尺度因子 $a$ 的函数 $X(a)$，我们有：
$$
\frac{d}{dt} = \frac{da}{dt} \frac{d}{da} = \dot{a} \frac{d}{da} = aH \frac{d}{da}
$$
$$
\frac{d}{d\eta} = \frac{dt}{d\eta} \frac{d}{dt} = a \frac{d}{dt} = a^2 H \frac{d}{da}
$$
这些关系允许我们在不同时间[坐标系](@entry_id:156346)之间自由切换。例如，我们可以将二阶宇宙时导数 $\ddot{X}$ 完全用关于 $a$ 的导数和[宇宙学参数](@entry_id:161338)来表示 [@problem_id:3506160]。

#### 哈勃阻尼与数值积分

选择不同的时间变量对数值求解有深远影响。例如，考虑一个没有外力作用的[质点](@entry_id:186768)，其[本动速度](@entry_id:157964)在膨胀的宇宙中会如何演化。其[动量方程](@entry_id:197225)可以简化为一个描述**哈勃阻尼（Hubble drag）**的方程。以[共形时间](@entry_id:263727) $\eta$ 为变量，这个方程形式非常简单 [@problem_id:3506202]：
$$
\frac{dv}{d\eta} + \mathcal{H}(\eta) v = 0
$$
其中 $v$ 是[本动速度](@entry_id:157964)的某个分量，$ \mathcal{H}(\eta) = a'/a $ 是共形哈勃参数（$a'$ 表示对 $\eta$ 求导）。这个方程的解表明[本动速度](@entry_id:157964)会随着宇宙的膨胀而衰减，$v \propto a^{-1}$。

在[数值积分](@entry_id:136578)中：
- 以**宇宙时 $t$** 为变量，[早期宇宙](@entry_id:160168)的演化极其迅速，需要极小的时间步长，而晚期则非常缓慢，导致固定步长[积分器](@entry_id:261578)效率低下。
- 以**尺度因子 $a$** 为变量，提供了一个从 $0$ 到 $1$ 的自然演化区间。但如 [@problem_id:3506160] 所示，变换后的[微分方程](@entry_id:264184)系数可能在 $a \to 0$ 时变得奇异，给数值求解带来困难。
- 以**[共形时间](@entry_id:263727) $\eta$** 为变量，往往能使方程形式最简化。它“拉伸”了早期宇宙的快速演化阶段，使得在整个宇宙历史中可以使用更稳定和更大的时间步长，因此在许多[宇宙学模拟](@entry_id:747928)中备受青睐 [@problem_id:3506202]。

### 高级应用视角

#### [拉格朗日与欧拉](@entry_id:270774)绘景

在[流体力学](@entry_id:136788)和宇宙结构形成理论中，我们可以在两种[坐标系](@entry_id:156346)中描述物质的运动：
- **欧拉坐标（Eulerian coordinates）** $\mathbf{x}$：我们观察空间中[固定点](@entry_id:156394)的[流体性质](@entry_id:200256)如何随时间变化。这是我们之前主要使用的[坐标系](@entry_id:156346)。
- **拉格朗日坐标（Lagrangian coordinates）** $\mathbf{q}$：我们跟踪每一个流体元，标记它在某个初始时刻（例如宇宙早期）的共动位置。

物质的演化可以被看作是一个从拉格朗日坐标 $\mathbf{q}$ 到欧拉坐标 $\mathbf{x}$ 的映射：$\mathbf{x} = \mathbf{x}(\mathbf{q}, t)$。在没有发生[壳层穿越](@entry_id:754769)（即物质轨迹没有交叉）的情况下，这个映射是单值的。质量守恒定律此时有了一个非常优美的几何解释。一个初始体积为 $d^3q$、密度为均匀背景密度 $\bar{\rho}_c$ 的流体元，在演化后其欧拉坐标下的体积变为 $d^3x$。根据质量守恒，$\rho_c(\mathbf{x}, t) d^3x = \bar{\rho}_c d^3q$。体积元之间的关系由该映射的[雅可比行列式](@entry_id:137120)给出：$d^3x = \det(\mathbf{J}) d^3q$，其中 $J_{ij} = \partial x_i / \partial q_j$。

将这些关系结合，我们可以直接将密度涨落与雅可比行列式联系起来 [@problem_id:3506178]：
$$
\delta(\mathbf{x}, t) = \frac{\rho_c(\mathbf{x}, t)}{\bar{\rho}_c} - 1 = \frac{1}{\det(\mathbf{J})} - 1
$$
这个强大的关系表明，一个区域的密度涨落完全由其拉格朗日[体积元](@entry_id:267802)在[演化过程](@entry_id:175749)中的压缩或拉伸程度决定。例如，在[泽尔多维奇近似](@entry_id:139227)（Zel'dovich approximation）中，位移是线性的，这使得雅可比矩阵和密度涨落的计算变得非常直接 [@problem_id:3506178]。

#### 数值稳定性：[共动坐标系](@entry_id:266800)下的[CFL条件](@entry_id:178032)

最后，这些理论概念在实际的[计算天体物理学](@entry_id:145768)代码中具有直接的应用。对于使用[显式时间积分](@entry_id:165797)方案的[流体动力学模拟](@entry_id:142279)，时间步长 $\Delta t$ 受到**库朗-弗里德里希斯-路维（[Courant-Friedrichs-Lewy](@entry_id:175598), CFL）**条件的限制。该条件确保数值计算的[依赖域](@entry_id:160270)能够包含物理信息的传播域。

在标准的非膨胀空间中，[CFL条件](@entry_id:178032)通常写作 $\Delta t \le C \frac{\Delta x}{|v| + c_s}$，其中 $\Delta x$ 是网格尺寸，$v$ 是[流体速度](@entry_id:267320)，$c_s$ 是声速，$C$ 是库朗数。在膨胀宇宙的[共动坐标系](@entry_id:266800)中，这个条件需要修正。时间步长 $\Delta t$ 必须小于信号穿过一个网格单元所需的时间。一个共动网格单元的物理尺寸是 $a(t)\Delta x$。信号相对于网格的物理传播速度是流体的**物理[本动速度](@entry_id:157964)** $v_{\text{pec}}$ 与信号自身相对于流体的传播速度（如声速 $c_s$）之和。因此，正确的[共动坐标](@entry_id:271238)CFL[时间步长限制](@entry_id:756010)为 [@problem_id:3506198]：
$$
\Delta t \le C \frac{a(t) \Delta x}{|v_{\text{pec}}| + c_s}
$$
这个结果清晰地展示了[宇宙膨胀](@entry_id:161474)如何通过改变网格的物理尺寸来影响数值模拟的稳定性要求。它完美地融合了本章讨论的多个核心概念——坐标变换、速度分解和[尺度因子](@entry_id:266678)——并将其应用于一个高度实践性的问题中。