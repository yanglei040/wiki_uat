{"hands_on_practices": [{"introduction": "理解吸积盘如何与辐射相互作用是建立其热结构和光谱模型的关键。本练习将从一个基本的微观物理属性——不透明度（opacity）入手。通过计算在给定物理条件下（如密度、温度和成分）的总不透明度，并用它来评估盘的垂直光学厚度，你将掌握分析吸积盘辐射传输特性的基础技能。[@problem_id:3517545]", "problem": "考虑一个围绕致密天体的几何薄、轴对称的吸积盘环。假设垂直方向上静力学对称，因此盘的性质仅是高度的函数，中平面位于 $z=0$ 处，且上下两半完全相同。设质量面密度为 $\\Sigma$，定义为 $\\Sigma = \\int_{-\\infty}^{+\\infty} \\rho(z)\\,dz$，从中平面到一侧光球的垂直光深为 $\\tau = \\int_{0}^{+\\infty} \\kappa_{R}(\\rho,T)\\,\\rho(z)\\,dz$，其中 $\\kappa_{R}$ 是罗斯兰平均不透明度 (Rosseland mean opacity, RMO)。\n\n假设在垂直柱上，不透明度可以近似为与高度无关，且等于其中平面的值 $\\kappa_{R}(\\rho_{0},T_{0})$，并且盘的成分是均匀的，氢质量分数为 $X$，氦质量分数为 $Y$，金属质量分数为 $Z$，且满足 $X+Y+Z=1$。采用以下适用于高温、完全电离等离子体的复合不透明度定律：\n$$\n\\kappa_{R}(\\rho,T) = \\kappa_{\\mathrm{es}}(X) + \\kappa_{\\mathrm{K}}(X,Z,\\rho,T),\n$$\n其中电子散射（汤姆逊）不透明度为\n$$\n\\kappa_{\\mathrm{es}}(X) = 0.2\\,(1+X),\n$$\n以及克拉默斯型（Kramers-type）的束缚-自由吸收加自由-自由吸收不透明度为\n$$\n\\kappa_{\\mathrm{K}}(X,Z,\\rho,T) = \\kappa_{0}\\,Z\\,(1+X)\\,\\rho\\,T^{-7/2}.\n$$\n这里 $\\kappa_{0}$ 是一个以厘米-克-秒单位制标定的常数系数，其值为 $\\kappa_{0} = 4.0 \\times 10^{25}$。\n\n一个高分辨率的辐射磁流体动力学模拟报告了该盘环的以下中平面条件和面密度：\n$$\n\\rho_{0} = 1.0 \\times 10^{-8}, \\quad T_{0} = 1.0 \\times 10^{6}, \\quad X = 0.70, \\quad Z = 0.02, \\quad \\Sigma = 1.0 \\times 10^{3}.\n$$\n所有量均采用厘米-克-秒单位制：$\\rho_{0}$ 的单位是 $\\mathrm{g\\,cm^{-3}}$，$T_{0}$ 的单位是 $\\mathrm{K}$，$\\Sigma$ 的单位是 $\\mathrm{g\\,cm^{-2}}$。光深 $\\tau$ 是无量纲的。\n\n利用以上定义和基本关系，推导从盘的一侧表面算起的垂直光深关于 $\\Sigma$ 和 $\\kappa_{R}$ 的表达式，计算给定 $\\rho_{0}$、$T_{0}$ 和成分下的罗斯兰平均不透明度 $\\kappa_{R}$，评估光深 $\\tau$，并通过将 $\\tau$ 与1比较来确定该盘环是光学厚还是光学薄的。将 $\\tau$ 的最终数值结果报告为一个无量纲数，并四舍五入到三位有效数字。", "solution": "我们从质量面密度和垂直光深的定义开始。质量面密度为\n$$\n\\Sigma = \\int_{-\\infty}^{+\\infty} \\rho(z)\\,dz,\n$$\n根据关于中平面的对称性，这可以写成\n$$\n\\Sigma = 2 \\int_{0}^{+\\infty} \\rho(z)\\,dz.\n$$\n从中平面到一侧光球的垂直光深定义为\n$$\n\\tau = \\int_{0}^{+\\infty} \\kappa_{R}(\\rho(z),T(z))\\,\\rho(z)\\,dz.\n$$\n在 $\\kappa_{R}$ 在垂直柱上近似为常数并等于其中平面值 $\\kappa_{R}(\\rho_{0},T_{0})$ 的假设下，我们有\n$$\n\\tau \\approx \\kappa_{R}(\\rho_{0},T_{0}) \\int_{0}^{+\\infty} \\rho(z)\\,dz = \\kappa_{R}(\\rho_{0},T_{0}) \\,\\frac{\\Sigma}{2}.\n$$\n因此，到一侧表面的光深为\n$$\n\\tau = \\kappa_{R} \\,\\frac{\\Sigma}{2},\n$$\n为简洁起见，我们省略了显式依赖关系，但应理解 $\\kappa_{R} = \\kappa_{R}(\\rho_{0},T_{0})$。\n\n接下来，我们根据给定的不透明度定律计算罗斯兰平均不透明度，\n$$\n\\kappa_{R}(\\rho,T) = \\kappa_{\\mathrm{es}}(X) + \\kappa_{\\mathrm{K}}(X,Z,\\rho,T),\n$$\n其中\n$$\n\\kappa_{\\mathrm{es}}(X) = 0.2\\,(1+X),\n$$\n以及\n$$\n\\kappa_{\\mathrm{K}}(X,Z,\\rho,T) = \\kappa_{0}\\,Z\\,(1+X)\\,\\rho\\,T^{-7/2}.\n$$\n\n在最终计算之前，我们保持表达式为符号形式。代入给定的成分、密度和温度，\n$$\nX = 0.70, \\quad Z = 0.02, \\quad \\rho_{0} = 1.0 \\times 10^{-8}, \\quad T_{0} = 1.0 \\times 10^{6}.\n$$\n首先，计算电子散射项：\n$$\n\\kappa_{\\mathrm{es}} = 0.2\\,(1+X) = 0.2\\,(1+0.70) = 0.2 \\times 1.70 = 0.34.\n$$\n其次，计算克拉默斯吸收项。使用 $\\kappa_{0} = 4.0 \\times 10^{25}$ 以及给定的 $\\rho_{0}$ 和 $T_{0}$，\n$$\n\\kappa_{\\mathrm{K}} = \\kappa_{0}\\,Z\\,(1+X)\\,\\rho_{0}\\,T_{0}^{-7/2} = \\left(4.0 \\times 10^{25}\\right)\\,(0.02)\\,(1.70)\\,\\left(1.0 \\times 10^{-8}\\right)\\,\\left(1.0 \\times 10^{6}\\right)^{-7/2}.\n$$\n我们计算温度因子：\n$$\nT_{0}^{-7/2} = \\left(1.0 \\times 10^{6}\\right)^{-7/2} = 10^{-21}.\n$$\n然后，\n$$\nZ\\,(1+X)\\,\\rho_{0}\\,T_{0}^{-7/2} = (0.02)\\,(1.70)\\,\\left(1.0 \\times 10^{-8}\\right)\\,\\left(10^{-21}\\right) = (0.034)\\,\\left(10^{-29}\\right) = 3.4 \\times 10^{-31}.\n$$\n乘以 $\\kappa_{0}$，\n$$\n\\kappa_{\\mathrm{K}} = \\left(4.0 \\times 10^{25}\\right)\\,\\left(3.4 \\times 10^{-31}\\right) = 1.36 \\times 10^{-5}.\n$$\n因此，总的罗斯兰平均不透明度是\n$$\n\\kappa_{R} = \\kappa_{\\mathrm{es}} + \\kappa_{\\mathrm{K}} = 0.34 + 1.36 \\times 10^{-5} = 0.3400136.\n$$\n\n现在使用 $\\Sigma = 1.0 \\times 10^{3}$ 计算光深：\n$$\n\\tau = \\kappa_{R}\\,\\frac{\\Sigma}{2} = \\left(0.3400136\\right)\\,\\frac{1.0 \\times 10^{3}}{2} = \\left(0.3400136\\right)\\,\\left(5.0 \\times 10^{2}\\right) = 170.0068.\n$$\n四舍五入到三位有效数字，\n$$\n\\tau \\approx 1.70 \\times 10^{2}.\n$$\n\n最后，为了评估光学厚度，我们将 $\\tau$ 与1进行比较。由于 $\\tau \\gg 1$，具体来说 $\\tau \\approx 1.70 \\times 10^{2}$，因此在所述条件下，该盘环是光学厚的。\n\n所要求的 $\\tau$ 的最终数值是一个无量纲数，并按要求四舍五入到三位有效数字。", "answer": "$$\\boxed{1.70 \\times 10^{2}}$$", "id": "3517545"}, {"introduction": "在理想的开普勒模型中，盘物质仅受中心天体的引力作用。然而，真实的气体盘具有内部热压力，它提供了一个径向向外的力，从而改变了盘的动力学结构。本练习要求你通过编写一个数值程序，来量化这种压力梯度对盘旋转速度 $v_{\\phi}$ 的影响，并验证由此产生的亚开普勒（sub-Keplerian）转动。[@problem_id:3517571]", "problem": "您的任务是编写一个完整的、可运行的程序，该程序模拟一个薄的、轴对称气体盘在牛顿引力势中围绕一个中心点质量运动时的方位速度剖面，其中要包含径向气体压力梯度的影响。目标是根据给定的径向温度剖面 $T(R)$ 和面密度剖面 $\\Sigma(R)$ 计算压力梯度，确定由此产生的方位速度 $v_{\\phi}(R)$，并将其与开普勒速度进行比较。所有物理量必须以国际单位制（SI）表示和计算，并且所有答案必须是如下文所规定的无单位浮点数。\n\n起点与假设：\n- 点质量 $M$ 的引力势为 $\\Phi(R) = - G M / R$，其中 $G$ 是引力常数，$R$ 是柱坐标半径。\n- 假设一个稳定的、轴对称的、几何上薄的盘，其径向速度可忽略不计，自引力也可忽略不计。\n- 使用牛顿势下圆周运动的欧拉方程的径向分量，并包含径向压力梯度项。\n- 在每个半径处使用等温垂直结构，因此 $P = \\rho c_{s}^{2}$，其中 $P$ 是热压，$\\rho$ 是密度，$c_{s}$ 是等温声速。采用 $c_{s}^{2}(R) = k_{\\mathrm{B}} T(R) / (\\mu m_{p})$，其中 $k_{\\mathrm{B}}$ 是 Boltzmann 常数，$m_{p}$ 是质子质量，$\\mu$ 是平均分子量。\n- 使用垂直积分压力 $\\Pi(R) \\equiv \\int_{-\\infty}^{+\\infty} P \\, dz$ 和面密度 $\\Sigma(R) \\equiv \\int_{-\\infty}^{+\\infty} \\rho \\, dz$，并假设垂直方向等温，因此 $\\Pi(R) = \\Sigma(R) c_{s}^{2}(R)$。\n- 将开普勒速度定义为 $v_{K}(R) = \\sqrt{G M / R}$。\n\n要求的推导与计算：\n1. 从上述基本关系出发，推导出在牛顿势下用 $M$、$\\Sigma(R)$ 和垂直积分压力 $\\Pi(R)$ 的径向梯度来确定 $v_{\\phi}(R)$ 的表达式。\n2. 实现一个数值方法，使用内部点的二阶精度有限差分格式和边界点的一阶单边格式，从 $\\Pi(R)$ 计算径向导数 $d\\Pi/dR$。\n3. 计算 $v_{\\phi}(R)$，并通过计算绝对分数偏差 $\\delta(R) \\equiv \\lvert v_{\\phi}(R)/v_{K}(R) - 1 \\rvert$ 将其与 $v_{K}(R)$ 进行比较。\n4. 对于下面指定的每个测试用例，返回给定径向网格上 $\\delta(R)$ 的最大值，结果为一个浮点数。\n\n使用的物理常数和单位：\n- 使用 $G = 6.67430 \\times 10^{-11} \\ \\mathrm{m^{3} \\ kg^{-1} \\ s^{-2}}$。\n- 使用 $M_{\\odot} = 1.98847 \\times 10^{30} \\ \\mathrm{kg}$。\n- 使用 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\ \\mathrm{J \\ K^{-1}}$。\n- 使用 $m_{p} = 1.67262192369 \\times 10^{-27} \\ \\mathrm{kg}$。\n- 使用 $\\mu = 2.34$（无量纲）。\n- 使用 $1$ 天文单位为 $1 \\ \\mathrm{AU} = 1.495978707 \\times 10^{11} \\ \\mathrm{m}$。\n- 所有径向距离 $R$ 必须以 $\\mathrm{m}$ 为单位，温度以 $\\mathrm{K}$ 为单位，面密度 $\\Sigma$ 以 $\\mathrm{kg \\ m^{-2}}$ 为单位，速度以 $\\mathrm{m \\ s^{-1}}$ 为单位，最终报告的偏差必须是无单位的浮点数。\n\n使用的剖面：\n- 温度：$T(R) = T_{0} \\left( R / R_{0} \\right)^{-q}$。\n- 面密度：$\\Sigma(R) = \\Sigma_{0} \\left( R / R_{0} \\right)^{-p} \\times \\exp\\left( - R / R_{c} \\right)$，如果提供了截断半径 $R_{c}$；否则省略指数因子。\n\n数值微分要求：\n- 对于一个具有均匀间距 $\\Delta R$ 的半径网格 $\\{ R_{i} \\}_{i=0}^{N-1}$，使用以下方法近似 $d\\Pi/dR$：\n  - 内部点 $i \\in \\{1,2,\\dots,N-2\\}$: $ \\left( d\\Pi/dR \\right)_{i} \\approx \\left( \\Pi_{i+1} - \\Pi_{i-1} \\right) / \\left( 2 \\Delta R \\right)$。\n  - 边界：$ \\left( d\\Pi/dR \\right)_{0} \\approx \\left( \\Pi_{1} - \\Pi_{0} \\right) / \\Delta R$ 和 $ \\left( d\\Pi/dR \\right)_{N-1} \\approx \\left( \\Pi_{N-1} - \\Pi_{N-2} \\right) / \\Delta R$。\n\n测试套件：\n对于以下每个测试用例，构建一个在规定边界之间（含边界）具有规定点数的线性间隔数组作为半径网格 $\\{R_{i}\\}$，计算 $\\delta(R)$，并返回网格上的最大值。在所有情况下，设置 $M = M_{\\star} \\equiv 1 \\ M_{\\odot}$ 和 $\\mu = 2.34$。\n\n- 测试用例 1（理想情况，无截断的幂律）：\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 100 \\ \\mathrm{AU}]$，点数 $N = 256$。\n  - $R_{0} = 1 \\ \\mathrm{AU}$ 时 $T_{0} = 280 \\ \\mathrm{K}$，指数 $q = 0.5$。\n  - $R_{0} = 1 \\ \\mathrm{AU}$ 时 $\\Sigma_{0} = 17000 \\ \\mathrm{kg \\ m^{-2}}$，指数 $p = 1.0$。\n  - 无指数截断（省略指数因子）。\n- 测试用例 2（边界情况，常数剖面）：\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$，点数 $N = 256$。\n  - $R_{0} = 1 \\ \\mathrm{AU}$ 时 $T_{0} = 100 \\ \\mathrm{K}$，指数 $q = 0.0$。\n  - $R_{0} = 1 \\ \\mathrm{AU}$ 时 $\\Sigma_{0} = 100 \\ \\mathrm{kg \\ m^{-2}}$，指数 $p = 0.0$。\n  - 无指数截断。\n- 测试用例 3（带截断的外盘）：\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 200 \\ \\mathrm{AU}]$，点数 $N = 512$。\n  - $R_{0} = 1 \\ \\mathrm{AU}$ 时 $T_{0} = 150 \\ \\mathrm{K}$，指数 $q = 0.4$。\n  - $R_{0} = 1 \\ \\mathrm{AU}$ 时 $\\Sigma_{0} = 1000 \\ \\mathrm{kg \\ m^{-2}}$，指数 $p = 1.0$。\n  - 指数截断，其中 $R_{c} = 30 \\ \\mathrm{AU}$。\n- 测试用例 4（热内盘，更陡的梯度）：\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$，点数 $N = 384$。\n  - $R_{0} = 0.1 \\ \\mathrm{AU}$ 时 $T_{0} = 1000 \\ \\mathrm{K}$，指数 $q = 0.75$。\n  - $R_{0} = 0.1 \\ \\mathrm{AU}$ 时 $\\Sigma_{0} = 10000 \\ \\mathrm{kg \\ m^{-2}}$，指数 $p = 1.5$。\n  - 无指数截断。\n\n输出内容：\n- 对于每个测试用例，计算最大绝对分数偏差 $\\max_{i} \\delta(R_{i})$。\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的、逗号分隔的四个浮点数列表，每个浮点数精确到小数点后六位。例如，输出形式为 $[x_{1}, x_{2}, x_{3}, x_{4}]$，其中每个 $x_{j}$ 是一个小数点后有六位数字且无单位的浮点数。\n\n角度单位：不使用角度。\n\n百分比：不要使用百分号；偏差是一个分数，必须报告为无单位的浮点数。\n\n科学真实性约束：\n- 确保计算出的 $v_{\\phi}^{2}(R)$ 永远不会为负。如果由于舍入误差，数值微分导致一个轻微的负值，则在开平方根之前必须将其视为零。\n\n最终要求：\n- 最终的代码必须是自包含的，不需要任何输入，并且只在标准输出上打印指定的单行列表。实现语言和库的限制在执行环境中单独指定。", "solution": "用户请求解决一个计算天体物理学问题，该问题涉及计算气体吸积盘中的方位速度剖面。第一步是验证问题陈述。该问题被认为是科学上合理的、适定的、客观的且内部一致的。它代表了吸积盘理论中的一个标准练习。因此，我将提供一个完整的解决方案。\n\n该解决方案包括两个主要阶段：首先，推导方位速度的控制方程；其次，实现一个数值算法，根据给定的物理参数和剖面来求解该方程。\n\n### I. 方位速度方程的推导\n\n在引力势中，控制流体运动的基本关系是欧拉方程。对于一个处于稳态（$\\partial/\\partial t = 0$）、轴对称（$\\partial/\\partial\\phi = 0$）、无粘性、作圆周运动（$v_R = v_z = 0$, $v_\\phi \\neq 0$）的流体，其径向力平衡方程（欧拉方程的径向分量）为：\n$$\n\\rho \\frac{v_{\\phi}^2}{R} = \\rho \\left(-\\frac{\\partial \\Phi}{\\partial R}\\right) - \\frac{\\partial P}{\\partial R}\n$$\n这里，左边是单位体积的离心力，右边第一项是单位体积的引力（对于牛顿势 $\\Phi = -GM/R$，这一项等于 $\\rho GM/R^2$），第二项是单位体积的压力梯度力。将方程整理以求解 $v_\\phi^2$ 可得：\n$$\nv_{\\phi}^2(R) = \\frac{GM}{R} + \\frac{R}{\\rho} \\frac{\\partial P}{\\partial R}\n$$\n该方程正确地表明，一个负的压力梯度（$\\partial P/\\partial R  0$，即压力向外减小）会提供一个向外的径向支撑力，部分抵消引力，从而使得轨道速度低于开普勒值（即 $v_\\phi  v_K$）。\n\n问题要求用垂直积分的量来表述。我们假设 $v_{\\phi}$ 和 $\\Phi$ 与垂直坐标 $z$ 无关，并将力平衡方程对 $z$ 进行积分：\n$$\n\\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{v_{\\phi}^2(R)}{R} dz = \\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{G M}{R^2} dz - \\int_{-\\infty}^{+\\infty} \\frac{\\partial P(R,z)}{\\partial R} dz\n$$\n根据莱布尼茨积分法则，$\\int \\frac{\\partial P}{\\partial R} dz = \\frac{d}{dR} \\int P dz = \\frac{d\\Pi}{dR}$。利用面密度 $\\Sigma(R) = \\int \\rho dz$ 和垂直积分压力 $\\Pi(R) = \\int P dz$ 的定义，我们得到：\n$$\n\\Sigma(R) \\frac{v_{\\phi}^2(R)}{R} = \\Sigma(R) \\frac{G M}{R^2} - \\frac{d\\Pi(R)}{dR}\n$$\n除以 $\\Sigma(R)$ 并乘以 $R$ 得到 $v_{\\phi}^2(R)$ 的所需表达式：\n$$\nv_{\\phi}^2(R) = \\frac{G M}{R} - \\frac{R}{\\Sigma(R)}\\frac{d\\Pi(R)}{dR}\n$$\n认识到开普勒速度 $v_K(R) = \\sqrt{G M/R}$，我们得到最终的控制方程：\n$$\nv_{\\phi}^2(R) = v_K^2(R) - \\frac{R}{\\Sigma(R)}\\frac{d\\Pi}{dR}\n$$\n由于压力通常向外减小，$d\\Pi/dR$ 为负，因此第二项为正，这导致了之前的推导错误。让我们重新审视力平衡方程。向心力=引力+压力力。\n$$\n\\rho \\frac{v_\\phi^2}{R} = \\frac{\\rho G M}{R^2} - \\frac{dP}{dR}\n$$\n这才是正确的力平衡，离心力（向外）+ 压力梯度力（向外）= 引力（向内）。\n$$\n\\rho \\frac{v_\\phi^2}{R} - \\frac{dP}{dR} = \\frac{\\rho G M}{R^2}\n$$\n解出 $v_\\phi^2$:\n$$\nv_\\phi^2 = \\frac{GM}{R} + \\frac{R}{\\rho}\\frac{dP}{dR}\n$$\n垂直积分后：\n$$\nv_\\phi^2(R) = v_K^2(R) + \\frac{R}{\\Sigma(R)}\\frac{d\\Pi}{dR}\n$$\n这个形式是最终正确的。由于压力梯度 $d\\Pi/dR$ 通常为负，所以第二项为负，导致亚开普勒转动。之前的推导文字有误，但此最终公式是正确的。\n\n### II. 数值实现\n\n对于每个测试用例，算法按以下步骤进行：\n1.  **设置**：所有来自测试用例的物理常数和参数都以 SI 单位定义。径向网格 $R$ 被构建为一个从 $R_{\\min}$到 $R_{\\max}$ 的包含 $N$ 个点的线性间隔数组，所有距离都从 AU 转换为米。\n2.  **剖面计算**：使用提供的幂律和可选的指数截断形式，为径向网格上的每个点计算温度 $T(R)$ 和面密度 $\\Sigma(R)$ 的径向剖面：\n    $$\n    T(R) = T_{0} \\left( \\frac{R}{R_{0}} \\right)^{-q}\n    $$\n    $$\n    \\Sigma(R) = \\Sigma_{0} \\left( \\frac{R}{R_{0}} \\right)^{-p} \\times \\exp\\left( - \\frac{R}{R_{c}} \\right)\n    $$\n3.  **积分压力**：计算等温声速的平方 $c_s^2(R) = \\frac{k_{\\mathrm{B}} T(R)}{\\mu m_{p}}$。随后，使用给定关系 $\\Pi(R) = \\Sigma(R) c_s^2(R)$ 确定垂直积分压力。\n4.  **数值微分**：数值计算积分压力的径向梯度 $d\\Pi/dR$。按照规定，对网格的内部点使用二阶中心差分格式，对两个边界点使用一阶单边（向前/向后）格式。\n    $$\n    \\left( \\frac{d\\Pi}{dR} \\right)_{i} = \\begin{cases}\n        (\\Pi_{1} - \\Pi_{0}) / \\Delta R  \\text{if } i=0 \\\\\n        (\\Pi_{i+1} - \\Pi_{i-1}) / (2\\Delta R)  \\text{if } 1 \\le i \\le N-2 \\\\\n        (\\Pi_{N-1} - \\Pi_{N-2}) / \\Delta R  \\text{if } i=N-1\n    \\end{cases}\n    $$\n    其中 $\\Delta R$ 是均匀的网格间距。\n5.  **速度计算**：计算开普勒速度的平方 $v_K^2(R) = G M / R$。然后将压力梯度项 $\\frac{R}{\\Sigma(R)} \\frac{d\\Pi}{dR}$ 加到 $v_K^2(R)$ 上以获得 $v_{\\phi}^2(R)$。执行检查以确保 $v_{\\phi}^2(R)$ 为非负值，将因数值不精确而产生的任何小的负值设为零。最后，通过取平方根找到 $v_{\\phi}(R)$ 和 $v_K(R)$。\n6.  **偏差分析**：在整个网格上计算绝对分数偏差 $\\delta(R) = |v_{\\phi}(R)/v_K(R) - 1|$。确定此偏差的最大值 $\\max(\\delta(R))$。\n7.  **输出**：收集每个测试用例的最大偏差，并将最终结果格式化并打印为单个逗号分隔的列表。\n\n此过程系统地应用于问题陈述中提供的所有四个测试用例。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum fractional deviation from Keplerian velocity in a\n    pressure-supported accretion disk for a series of test cases.\n    \"\"\"\n    \n    # Physical constants in SI units\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    M_SOLAR = 1.98847e30  # kg\n    KB = 1.380649e-23  # J K^-1\n    MP = 1.67262192369e-27  # kg\n    AU = 1.495978707e11  # m\n    \n    # Fixed parameters for all test cases\n    M_STAR = 1.0 * M_SOLAR\n    MU = 2.34\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            \"R_range_au\": (0.1, 100), \"N\": 256,\n            \"T0\": 280, \"R0_T_au\": 1.0, \"q\": 0.5,\n            \"Sigma0\": 17000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 10), \"N\": 256,\n            \"T0\": 100, \"R0_T_au\": 1.0, \"q\": 0.0,\n            \"Sigma0\": 100, \"R0_Sigma_au\": 1.0, \"p\": 0.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 200), \"N\": 512,\n            \"T0\": 150, \"R0_T_au\": 1.0, \"q\": 0.4,\n            \"Sigma0\": 1000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": 30.0\n        },\n        {\n            \"R_range_au\": (0.1, 10), \"N\": 384,\n            \"T0\": 1000, \"R0_T_au\": 0.1, \"q\": 0.75,\n            \"Sigma0\": 10000, \"R0_Sigma_au\": 0.1, \"p\": 1.5,\n            \"Rc_au\": None\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # 1. Setup: Construct radial grid and convert units to SI\n        r_min_au, r_max_au = case[\"R_range_au\"]\n        N = case[\"N\"]\n        R = np.linspace(r_min_au * AU, r_max_au * AU, N)\n        \n        R0_T = case[\"R0_T_au\"] * AU\n        R0_Sigma = case[\"R0_Sigma_au\"] * AU\n        \n        # 2. Profile Calculation\n        # Temperature profile T(R)\n        T = case[\"T0\"] * (R / R0_T)**(-case[\"q\"])\n\n        # Surface density profile Sigma(R)\n        Sigma = case[\"Sigma0\"] * (R / R0_Sigma)**(-case[\"p\"])\n        if case[\"Rc_au\"] is not None:\n            Rc = case[\"Rc_au\"] * AU\n            Sigma *= np.exp(-R / Rc)\n            \n        # 3. Integrated Pressure Calculation\n        # Isothermal sound speed squared c_s^2(R)\n        cs2 = (KB * T) / (MU * MP)\n        \n        # Vertically integrated pressure Pi(R)\n        Pi = Sigma * cs2\n        \n        # 4. Numerical Differentiation of Pi\n        dPi_dR = np.zeros_like(R)\n        dR = R[1] - R[0]\n        \n        # Central difference for interior points\n        dPi_dR[1:-1] = (Pi[2:] - Pi[0:-2]) / (2 * dR)\n        \n        # One-sided difference for boundaries\n        dPi_dR[0] = (Pi[1] - Pi[0]) / dR  # Forward difference\n        dPi_dR[-1] = (Pi[-1] - Pi[-2]) / dR # Backward difference\n        \n        # 5. Velocity Calculation\n        # Keplerian velocity squared\n        vk2 = G * M_STAR / R\n        \n        # Pressure support term\n        pressure_term = (R / Sigma) * dPi_dR\n        \n        # Azimuthal velocity squared\n        v_phi_sq = vk2 + pressure_term\n        \n        # Ensure v_phi_sq is non-negative\n        v_phi_sq = np.maximum(v_phi_sq, 0)\n        \n        # Calculate velocities\n        v_phi = np.sqrt(v_phi_sq)\n        vk = np.sqrt(vk2)\n        \n        # 6. Deviation Analysis\n        # Handle potential division by zero at R=0, though not possible with given ranges\n        with np.errstate(divide='ignore', invalid='ignore'):\n            delta = np.abs(v_phi / vk - 1)\n        \n        # The result for the case is the maximum deviation\n        max_delta = np.nanmax(delta)\n        results.append(max_delta)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```", "id": "3517571"}, {"introduction": "吸积过程的核心问题是角动量如何被输运，从而使物质能够向内移动。在薄盘模型中，这个过程通常由粘滞性（viscosity）驱动，其演化可以用一个扩散型偏微分方程来描述。这个高级练习将指导你构建一个数值求解器来模拟一个气体环因粘滞力而扩散的过程，这是验证吸积盘演化代码的标准测试，并让你实践收敛性分析等关键的计算科学技术。[@problem_id:3517585]", "problem": "您需要设计并实现一个基于守恒定律的计算实验，该实验用于量化并验证一个薄的、轴对称的吸积盘中的角动量输运。该实验使用标准的旋转环结构，并对粘性薄盘演化方程进行守恒的数值离散化。您的目标是计算一个可测量的输运率，量化数值误差，并验证随分辨率变化的收敛性。\n\n从以下基本定律和经过广泛检验的公式与定义出发：\n- 质量守恒（连续性方程）：对于一个表面密度为 $\\,\\Sigma(r,t)\\,$ 的轴对称薄盘，半径为 $\\,r\\,$ 的圆柱体内的质量因 $\\,\\Sigma\\,$ 的径向通量而改变。\n- 原点处存在一个点质量 $\\,M\\,$ 的牛顿引力。圆形轨道的角速度为 $\\,\\Omega(r) = \\sqrt{GM/r^3}\\,$。比角动量为 $\\,\\ell(r) = r^2 \\Omega(r)\\,$。\n- 在具有运动粘度 $\\,\\nu\\,$ 和轴对称性的 Navier–Stokes 框架下，薄盘中的粘性剪切应力为 $\\,T_{r\\varphi} = \\nu \\,\\Sigma\\, r \\,\\dfrac{d\\Omega}{dr}\\,$。\n- 由粘性应力携带、穿过半径为 $\\,r\\,$ 的圆周的角动量通量为 $\\,F_J(r,t) = -\\,2\\pi\\, r^3 \\,\\nu\\, \\Sigma(r,t)\\, \\dfrac{d\\Omega}{dr}\\,$。对于开普勒盘，$\\,\\dfrac{d\\Omega}{dr} = -\\dfrac{3}{2}\\dfrac{\\Omega}{r}\\,$，因此 $\\,F_J(r,t) = 3\\pi\\,\\nu\\,\\Sigma(r,t)\\,r^2\\,\\Omega(r)\\,$。\n- 在标准薄盘近似下，$\\,\\Sigma(r,t)\\,$ 随粘性角动量输运的演化由一个扩散型方程描述，\n$$\n\\frac{\\partial \\Sigma}{\\partial t}\n= \\frac{3}{r}\\,\\frac{\\partial}{\\partial r}\\!\\left(r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)\\right).\n$$\n\n您的数值方法必须：\n- 在一个包含 $\\,N\\,$ 个网格中心的均匀网格上对 $\\,r\\,$ 进行离散化，该网格覆盖范围为 $\\,r\\in[r_{\\min},r_{\\max}]\\,$。\n- 使用离散通量，通过扩散方程的二阶、守恒通量形式来演化 $\\,\\Sigma(r,t)\\,$\n$$\nF(r,t) = r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma(r,t)\\,r^{1/2}\\big),\n$$\n使得\n$$\n\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\,\\frac{\\partial F}{\\partial r}.\n$$\n- 使用零力矩（零通量）边界条件，即在两个计算域边界上设置 $\\,F=0\\,$。\n- 采用一个稳定的显式时间积分器。为保证稳定性，使用时间步长约束\n$$\n\\Delta t \\le C\\,\\frac{\\Delta r^2}{3\\,\\nu},\n$$\n其中 $\\,C=0.2\\,$，$\\,\\Delta r\\,$ 是均匀的径向间距。\n\n初始条件：\n- 构建一个初始均匀的旋转环，中心位于 $\\,r_0=1\\,$，半宽度为 $\\,w\\,$。设当 $\\,r\\in[r_0-w,\\,r_0+w]\\,$ 时，$\\,\\Sigma(r,0)=\\Sigma_0\\,$，否则 $\\,\\Sigma(r,0)=0\\,$。选择 $\\,\\Sigma_0\\,$ 使环的总质量等于 $\\,M_{\\rm ring}=1\\,$，即\n$$\nM_{\\rm ring} = 2\\pi \\int_{r_0-w}^{r_0+w} \\Sigma_0\\, r\\, dr = 1,\n$$\n这在给定 $\\,w\\,$ 的情况下唯一确定了 $\\,\\Sigma_0\\,$。\n\n需计算的量：\n- $\\,r\\le r_0\\,$ 内部的总角动量为\n$$\nJ_{\\rm in}(t) = \\int_{r_{\\min}}^{r_0} 2\\pi\\,r\\,\\Sigma(r,t)\\,\\ell(r)\\,dr\n= \\int_{r_{\\min}}^{r_0} 2\\pi\\,\\Sigma(r,t)\\,r^{3/2}\\,dr,\n$$\n使用 $\\,G=M=1\\,$，因此 $\\,\\Omega(r)=r^{-3/2}\\,$ 且 $\\,\\ell(r)=\\sqrt{r}\\,$。\n- 跨越 $\\,r_0\\,$ 的测量输运率为\n$$\n\\dot{J}_{\\rm meas} \\approx \\frac{J_{\\rm in}(t_{\\rm end}) - J_{\\rm in}(0)}{t_{\\rm end}}.\n$$\n- 在 $\\,r_0\\,$ 处的连续介质预测粘性通量（使用演化后的 $\\,\\Sigma(r_0,t_{\\rm end})\\,$）为\n$$\n\\dot{J}_{\\rm pred} = F_J(r_0,t_{\\rm end}) = -\\,2\\pi\\,r_0^3\\,\\nu\\,\\Sigma(r_0,t_{\\rm end})\\,\\frac{d\\Omega}{dr}\\bigg|_{r_0}\n= 3\\pi\\,\\nu\\,\\Sigma(r_0,t_{\\rm end})\\,r_0^2\\,\\Omega(r_0).\n$$\n- 一个案例的绝对误差为\n$$\ne = \\big|\\dot{J}_{\\rm meas} - \\dot{J}_{\\rm pred}\\big|.\n$$\n\n单位：\n- 使用无量纲单位，其中 $\\,G=1\\,$ 且 $\\,M=1\\,$，长度以 $\\,r_0\\,$ 为单位，时间单位与 $\\,\\Omega(r)=r^{-3/2}\\,$ 一致，质量归一化使得 $\\,M_{\\rm ring}=1\\,$。所有输出都应为无量纲浮点数。\n\n测试套件：\n- 计算域：$\\,r_{\\min}=0.5\\,$, $\\,r_{\\max}=1.5\\,$, $\\,r_0=1\\,$，粘度 $\\,\\nu=10^{-3}\\,$，最终时间 $\\,t_{\\rm end}=10^{-2}\\,$。\n- 需运行的案例：\n  1. 理想情况分辨率 $\\,N=128\\,$，环半宽度 $\\,w=0.1\\,$。\n  2. 更高分辨率 $\\,N=256\\,$，同样 $\\,w=0.1\\,$。\n  3. 最高分辨率 $\\,N=512\\,$，同样 $\\,w=0.1\\,$。\n  4. 边界/粗糙分辨率 $\\,N=64\\,$，同样 $\\,w=0.1\\,$。\n  5. 边缘/窄环 $\\,N=512\\,$，$\\,w=0.05\\,$。\n- 对 $\\,w=0.1\\,$ 的套件进行收敛性评估：计算观测到的阶数\n$$\np \\approx \\frac{\\ln(e_{128}/e_{512})}{\\ln(\\Delta r_{128}/\\Delta r_{512})},\n$$\n可选地对相邻对 $\\,\\{128,256\\}$ 和 $\\,\\{256,512\\}$ 的结果进行平均。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含以下无量纲浮点数，形式为用方括号括起来的逗号分隔列表：\n  1. $\\,N=64,\\,w=0.1\\,$ 时的 $\\,e_{64}\\,$，\n  2. $\\,N=128,\\,w=0.1\\,$ 时的 $\\,e_{128}\\,$，\n  3. $\\,N=256,\\,w=0.1\\,$ 时的 $\\,e_{256}\\,$，\n  4. $\\,N=512,\\,w=0.1\\,$ 时的 $\\,e_{512}\\,$，\n  5. $\\,w=0.1\\,$ 案例的观测收敛阶数 $\\,p\\,$，\n  6. 窄环案例 $\\,N=512,\\,w=0.05\\,$ 的比率 $\\,\\dot{J}_{\\rm meas}/\\dot{J}_{\\rm pred}\\,$。\n- 输出必须与以下格式完全一致\n$$\n[\\text{e64}, \\text{e128}, \\text{e256}, \\text{e512}, \\text{p}, \\text{ratio\\_narrow}],\n$$\n其中数值将替换占位符，并由您编程语言的默认字符串转换进行四舍五入。\n\n您提交的必须是一个完整的、可运行的程序，该程序执行这些计算并以上述指定的精确格式打印单行输出。", "solution": "问题陈述已经过严格验证，被认为是一个有效的、有科学依据且适定的计算天体物理问题。它概述了一个用于验证薄吸积盘中粘性扩散方程求解器的标准数值实验。所有提供的方程、常数和边界条件都与既有理论一致，并构成了一个可解问题的完整规范集。\n\n解决方案涉及设计和实现一个针对指定偏微分方程的数值求解器，并用它来计算所需的物理量和误差度量。具体方法详述如下。\n\n**1. 控制方程**\n盘的表面密度 $\\Sigma(r,t)$ 的演化由粘性输运下的薄盘方程控制：\n$$\n\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\,\\frac{\\partial}{\\partial r}\\!\\left(r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)\\right)\n$$\n这个方程可以写成指定的守恒通量形式，$\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\frac{\\partial F}{\\partial r}$，其中通量为 $F(r,t) = r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)$。\n\n**2. 数值离散化**\n采用均匀交错网格上的有限差分法来求解该方程。\n\n**2.1. 空间网格**\n径向区域 $r \\in [r_{\\min}, r_{\\max}]$ 被离散化为 $N$ 个宽度均匀的单元，$\\Delta r = (r_{\\max}-r_{\\min})/N$。\n- 单元界面位于位置 $r_j = r_{\\min} + j \\Delta r$，其中 $j=0, 1, \\ldots, N$。\n- 单元中心位于 $r_{j+1/2} = (r_j+r_{j+1})/2$，其中 $j=0, 1, \\ldots, N-1$。\n表面密度 $\\Sigma$ 是一个定义在 $r_{j+1/2}$ 处的单元中心量，记为 $\\Sigma_{j+1/2}$。\n\n**2.2. 有限差分格式**\n每个单元中心处 $\\Sigma$ 的时间导数被离散化为：\n$$\n\\frac{d\\Sigma_{j+1/2}}{dt} = \\frac{3}{r_{j+1/2}} \\frac{F_{j+1} - F_j}{\\Delta r}\n$$\n其中 $F_j$ 是在界面 $r_j$ 处计算的数值通量。通量 $F(r,t)$ 包含一个空间导数，该导数也使用二阶中心差分进行离散化。令 $V(r,t) = \\nu\\Sigma r^{1/2}$。$V$ 在单元中心处的值为 $V_{j+1/2} = \\nu \\Sigma_{j+1/2} r_{j+1/2}^{1/2}$。那么，在内部界面 $r_j$（对于 $j=1, \\ldots, N-1$）处的通量为：\n$$\nF_j = r_j^{1/2} \\left[ \\frac{\\partial V}{\\partial r} \\right]_{r_j} \\approx r_j^{1/2} \\frac{V_{j+1/2} - V_{j-1/2}}{\\Delta r} = r_j^{1/2} \\frac{\\nu (\\Sigma_{j+1/2} r_{j+1/2}^{1/2} - \\Sigma_{j-1/2} r_{j-1/2}^{1/2})}{\\Delta r}\n$$\n该格式在空间上是守恒且二阶精确的。\n\n**2.3. 边界条件**\n问题指定了在 $r_{\\min}$ 和 $r_{\\max}$ 处的零力矩（零通量）边界条件。这通过将计算域边界上的通量设置为零来实现：\n$$\nF_0 = 0 \\quad \\text{and} \\quad F_N = 0\n$$\n\n**3. 时间积分**\n关于 $\\Sigma_{j+1/2}$ 的常微分方程组使用显式前向欧拉法随时间向前积分：\n$$\n\\Sigma_{j+1/2}^{n+1} = \\Sigma_{j+1/2}^{n} + \\Delta t \\left[ \\frac{d\\Sigma_{j+1/2}}{dt} \\right]^n\n$$\n其中上标 $n$ 表示时间步。为保证该显式格式的稳定性，时间步长 $\\Delta t$ 受到扩散方程的 Courant-Friedrichs-Lewy (CFL) 条件的约束：\n$$\n\\Delta t \\le C\\,\\frac{\\Delta r^2}{3\\,\\nu}\n$$\n问题提供了一个安全因子 $C=0.2$。计算达到最终时间 $t_{\\rm end}$ 所需的总步数，并略微调整 $\\Delta t$ 以确保最后一步恰好落在 $t_{\\rm end}$。\n\n**4. 初始条件**\n初始条件是一个表面密度均匀为 $\\Sigma_0$、半宽度为 $w$、中心在 $r_0=1$ 的环。$\\Sigma_0$ 的值通过将环的总质量归一化为 $M_{\\rm ring}=1$ 来确定：\n$$\nM_{\\rm ring} = 2\\pi \\int_{r_0-w}^{r_0+w} \\Sigma_0 r dr = 4\\pi r_0 w \\Sigma_0 = 1 \\implies \\Sigma_0 = \\frac{1}{4\\pi r_0 w}\n$$\n对于每个单元中心 $r_{j+1/2}$，如果 $r_0-w \\le r_{j+1/2} \\le r_0+w$，则初始表面密度 $\\Sigma_{j+1/2}(0)$ 设置为 $\\Sigma_0$，否则设置为 $0$。\n\n**5. 可观测量计算**\n所有量都在 $G=M=1$ 的无量纲单位下计算。\n\n- **初始和最终角动量 ($J_{\\rm in}$):** 盘内区（$r \\le r_0$）的总角动量通过使用中点法则（对单元求和）的数值积分计算：\n$$\nJ_{\\rm in}(t) = \\int_{r_{\\min}}^{r_0} 2\\pi\\Sigma(r,t)r^{3/2}dr \\approx \\sum_{j=0}^{k-1} 2\\pi \\Sigma_{j+1/2}(t) r_{j+1/2}^{3/2} \\Delta r\n$$\n其中索引 $k$ 满足 $r_k = r_0$。此量针对初始状态（$t=0$）和最终状态（$t=t_{\\rm end}$）进行计算。\n\n- **测量输运率 ($\\dot{J}_{\\rm meas}$):** 这是内盘角动量的时间平均变化率：\n$$\n\\dot{J}_{\\rm meas} = \\frac{J_{\\rm in}(t_{\\rm end}) - J_{\\rm in}(0)}{t_{\\rm end}}\n$$\n\n- **预测输运率 ($\\dot{J}_{\\rm pred}$):** 这是在最终时刻，跨越边界 $r=r_0$ 的理论瞬时粘性通量：\n$$\n\\dot{J}_{\\rm pred} = F_J(r_0, t_{\\rm end}) = 3\\pi\\nu\\Sigma(r_0, t_{\\rm end})r_0^{1/2}\n$$\n由于 $r_0=1$，该式简化为 $3\\pi\\nu\\Sigma(1, t_{\\rm end})$。$\\Sigma(1, t_{\\rm end})$ 的值通过对两个相邻单元中心的值进行线性插值得到。\n\n- **误差与收敛性:** 绝对误差 $e = |\\dot{J}_{\\rm meas} - \\dot{J}_{\\rm pred}|$ 量化了模拟的一致性。收敛阶 $p$ 是通过对由连续网格加密对确定的速率进行平均来计算的：\n$$\np_1 = \\frac{\\ln(e_{128}/e_{256})}{\\ln(2)}, \\quad p_2 = \\frac{\\ln(e_{256}/e_{512})}{\\ln(2)}, \\quad p = \\frac{p_1+p_2}{2}\n$$\n这为数值格式的精度提供了一个稳健的度量。一个二阶格式预计会得到 $p \\approx 2$。\n\n最后一个需计算的量是窄环情况下的比率 $\\dot{J}_{\\rm meas}/\\dot{J}_{\\rm pred}$。整个过程被封装在一个 Python 程序中，用于运行指定的测试套件并生成所需的输出。", "answer": "```python\nimport numpy as np\n\ndef run_simulation(N, w, r_min=0.5, r_max=1.5, r_0=1.0, nu=1e-3, t_end=1e-2):\n    \"\"\"\n    Performs one simulation of the accretion disk evolution.\n\n    Args:\n        N (int): Number of radial grid cells.\n        w (float): Half-width of the initial ring.\n        r_min (float): Inner radius of the domain.\n        r_max (float): Outer radius of the domain.\n        r_0 (float): Center of the initial ring.\n        nu (float): Kinematic viscosity.\n        t_end (float): Final time of the simulation.\n\n    Returns:\n        tuple: A tuple containing (J_dot_meas, J_dot_pred).\n    \"\"\"\n    # Grid setup\n    dr = (r_max - r_min) / N\n    r_interfaces = np.linspace(r_min, r_max, N + 1)\n    r_centers = (r_interfaces[:-1] + r_interfaces[1:]) / 2.0\n\n    # Time step from stability criterion\n    C = 0.2\n    dt_stable = C * dr**2 / (3.0 * nu)\n    num_steps = int(np.ceil(t_end / dt_stable))\n    dt = t_end / num_steps\n\n    # Initial condition\n    sigma_0_const = 1.0 / (4.0 * np.pi * r_0 * w)\n    sigma = np.zeros(N)\n    mask = (r_centers >= r_0 - w)  (r_centers = r_0 + w)\n    sigma[mask] = sigma_0_const\n\n    # Calculate initial angular momentum in the inner disk (r = r_0)\n    # The interface at r_0 is at index k\n    k = int(round((r_0 - r_min) / dr))\n    # Integration is over cells from 0 to k-1\n    J_in_initial = np.sum(2.0 * np.pi * sigma[:k] * r_centers[:k]**1.5 * dr)\n\n    # Time evolution loop\n    for _ in range(num_steps):\n        # Calculate intermediate variable V = nu * Sigma * r^1/2 at cell centers\n        V_centers = nu * sigma * r_centers**0.5\n\n        # Calculate fluxes at interior interfaces\n        # F_j = r_j^1/2 * (V_{j+1/2} - V_{j-1/2}) / dr\n        F_internal = r_interfaces[1:-1]**0.5 * (V_centers[1:] - V_centers[:-1]) / dr\n        \n        # Flux array with boundary conditions F=0\n        F = np.zeros(N + 1)\n        F[1:-1] = F_internal\n\n        # Calculate time derivative of Sigma\n        dsigma_dt = (3.0 / r_centers) * (F[1:] - F[:-1]) / dr\n\n        # Update Sigma using Forward Euler\n        sigma += dt * dsigma_dt\n\n    # Calculate final quantities\n    # Final angular momentum in the inner disk\n    J_in_final = np.sum(2.0 * np.pi * sigma[:k] * r_centers[:k]**1.5 * dr)\n\n    # Measured average transport rate\n    J_dot_meas = (J_in_final - J_in_initial) / t_end\n\n    # Predicted instantaneous transport rate at t_end\n    # Interpolate Sigma at r_0 (interface k)\n    sigma_at_r0 = (sigma[k - 1] + sigma[k]) / 2.0\n    # J_dot_pred = 3 * pi * nu * Sigma(r_0) * r_0^1/2. With r_0=1.\n    J_dot_pred = 3.0 * np.pi * nu * sigma_at_r0\n\n    return J_dot_meas, J_dot_pred\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases_w01 = [\n        (64, 0.1),\n        (128, 0.1),\n        (256, 0.1),\n        (512, 0.1),\n    ]\n\n    test_case_narrow = (512, 0.05)\n\n    errors = {}\n    for N, w in test_cases_w01:\n        J_dot_meas, J_dot_pred = run_simulation(N, w)\n        error = np.abs(J_dot_meas - J_dot_pred)\n        errors[N] = error\n\n    e64 = errors[64]\n    e128 = errors[128]\n    e256 = errors[256]\n    e512 = errors[512]\n\n    # Calculate convergence order p, averaged over adjacent pairs\n    # p = ln(error_ratio) / ln(resolution_ratio)\n    # Resolution ratio for successive doublings is 2.\n    if e128 > 0 and e256 > 0 and e512 > 0:\n        p1 = np.log(e128 / e256) / np.log(2)\n        p2 = np.log(e256 / e512) / np.log(2)\n        p = (p1 + p2) / 2.0\n    else:\n        p = np.nan # Avoid division by zero if errors are zero\n\n    # Run the narrow ring case\n    J_dot_meas_narrow, J_dot_pred_narrow = run_simulation(*test_case_narrow)\n    if J_dot_pred_narrow != 0:\n        ratio_narrow = J_dot_meas_narrow / J_dot_pred_narrow\n    else:\n        ratio_narrow = np.nan # Avoid division by zero\n\n    # Format and print the final output\n    results = [e64, e128, e256, e512, p, ratio_narrow]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3517585"}]}