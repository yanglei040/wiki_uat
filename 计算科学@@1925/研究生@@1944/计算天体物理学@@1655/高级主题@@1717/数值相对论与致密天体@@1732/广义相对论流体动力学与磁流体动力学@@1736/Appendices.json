{"hands_on_practices": [{"introduction": "在模拟流体之前，我们必须理解如何在弯曲时空中描述运动。这个练习让你实践使用3+1分解——数值相对论的语言——来将抽象的四维时空与模拟中实际演化的速度和洛伦兹因子等量联系起来。这项实践 [@problem_id:3512023] 是一项解读模拟数据和理解广义相对论（磁）流体动力学（GR(M)HD）代码中变量的基本技能。", "problem": "考虑在内行 Kerr–Schild 球坐标下的史瓦西时空，其线元为\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{4M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right).\n$$\n采用 $3+1$ 分解，其中 lapse 函数为 $\\alpha$，shift 矢量为 $\\beta^{i}$，空间度规为 $\\gamma_{ij}$，定义如下\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right),\n$$\n并令欧拉观测者为空间超曲面的单位法向量。在由 $M=1$、$r=8$ 和 $\\theta = \\frac{\\pi}{2}$ 指定的事件处，假设一个流体元具有如下的逆变四维速度分量\n$$\nu^{t} = \\frac{10}{\\sqrt{71}}, \\quad u^{r} = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}, \\quad u^{\\theta} = 0, \\quad u^{\\phi} = 0.\n$$\n从 $3+1$ 分解的定义和归一化条件 $u^{\\mu} u_{\\mu} = -1$ 出发，执行以下操作：\n\n- 在指定事件处，推导 $\\alpha$、$\\beta^{r}$ 和 $\\gamma_{rr}$。\n- 仅使用这些几何量和给定的 $u^{\\mu}$，计算洛伦兹因子 $W = \\alpha u^{t}$ 和由欧拉观测者测量的三维速度分量 $v^{i}$，其中 $v^{i}$ 满足 $u^{\\mu} = W\\left(n^{\\mu} + v^{\\mu}\\right)$，$n^{\\mu}$ 是欧拉观测者的四维速度，$v^{\\mu}$ 是纯空间的。\n- 从第一性原理出发，验证\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}.\n$$\n\n将洛伦兹因子 $W$ 的最终值表示为一个四舍五入到四位有效数字的实数。$W$ 无需单位。", "solution": "该问题是适定的，其科学基础是广义相对论的原理和 $3+1$ 形式体系。所有给定的数据和定义都是自洽的，并且足以得到唯一解。\n\n首先，我们通过将给定的内行 Kerr–Schild 坐标下的史瓦西度规与通用的 $3+1$ 线元进行比较，来推导 $3+1$ 的各个量（lapse 函数 $\\alpha$、shift 矢量 $\\beta^i$ 和空间度规 $\\gamma_{ij}$）。\n\n给定的度规是：\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{4M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right)\n$$\n通用的 $3+1$ 线元是：\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right) = (-\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j)dt^2 + 2\\gamma_{ij}\\beta^i dx^j dt + \\gamma_{ij}dx^i dx^j\n$$\n令空间坐标为 $(x^1, x^2, x^3) = (r, \\theta, \\phi)$。通过比较两个线元中微分项的系数，我们可以确定度规张量 $g_{\\mu\\nu}$ 的分量。\n\n度规的空间部分给出了空间度规 $\\gamma_{ij}$：\n$g_{ij} = \\gamma_{ij}$。\n从给定的线元，我们得到一个对角空间度规：\n$$\n\\gamma_{rr} = g_{rr} = 1 + \\frac{2M}{r}\n$$\n$$\n\\gamma_{\\theta\\theta} = g_{\\theta\\theta} = r^2\n$$\n$$\n\\gamma_{\\phi\\phi} = g_{\\phi\\phi} = r^2 \\sin^2\\theta\n$$\n所有非对角分量 $\\gamma_{ij}$ 均为零。\n\n混合时空分量 $g_{ti}$ 给出了 shift 矢量 $\\beta^i$：\n$g_{ti} = \\gamma_{ij}\\beta^j$。\n在我们的例子中，唯一的非零分量是 $g_{tr} = \\frac{2M}{r}$。因为 $\\gamma_{ij}$ 是对角的，对于 $i=r$ 的关系简化为：\n$g_{tr} = \\gamma_{rr}\\beta^r$。\n解出 $\\beta^r$：\n$$\n\\beta^r = \\frac{g_{tr}}{\\gamma_{rr}} = \\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}} = \\frac{2M}{r+2M}\n$$\n由于 $g_{t\\theta}=0$ 和 $g_{t\\phi}=0$，shift 矢量的其他分量为 $\\beta^\\theta = 0$ 和 $\\beta^\\phi = 0$。\n\n时间-时间分量 $g_{tt}$ 给出了 lapse 函数 $\\alpha$：\n$g_{tt} = -\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j$。\n由于只有 $\\beta^r$ 非零，这变为：\n$g_{tt} = -\\alpha^2 + \\gamma_{rr}(\\beta^r)^2$。\n解出 $\\alpha^2$：\n$$\n\\alpha^2 = -g_{tt} + \\gamma_{rr}(\\beta^r)^2 = -\\left[-\\left(1 - \\frac{2M}{r}\\right)\\right] + \\left(1 + \\frac{2M}{r}\\right)\\left(\\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}}\\right)^2\n$$\n$$\n\\alpha^2 = \\left(1 - \\frac{2M}{r}\\right) + \\frac{\\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{\\left(1 - \\frac{2M}{r}\\right)\\left(1 + \\frac{2M}{r}\\right) + \\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{1 - \\left(\\frac{2M}{r}\\right)^2 + \\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{1}{1 + \\frac{2M}{r}}\n$$\n因此，lapse 函数为 $\\alpha = \\frac{1}{\\sqrt{1 + \\frac{2M}{r}}}$。\n\n现在我们在指定的事件处计算这些量的值：$M=1$、$r=8$、$\\theta = \\frac{\\pi}{2}$。\n首先，计算公共项 $\\frac{2M}{r} = \\frac{2(1)}{8} = \\frac{1}{4}$。\n$$\n\\alpha = \\frac{1}{\\sqrt{1 + \\frac{1}{4}}} = \\frac{1}{\\sqrt{\\frac{5}{4}}} = \\frac{2}{\\sqrt{5}} = \\frac{2\\sqrt{5}}{5}\n$$\n$$\n\\beta^r = \\frac{\\frac{1}{4}}{1 + \\frac{1}{4}} = \\frac{\\frac{1}{4}}{\\frac{5}{4}} = \\frac{1}{5}\n$$\n$$\n\\gamma_{rr} = 1 + \\frac{1}{4} = \\frac{5}{4}\n$$\n\n接下来，我们计算洛伦兹因子 $W$ 和三维速度 $v^i$。\n洛伦兹因子定义为 $W = \\alpha u^t$。使用给定的值 $u^t = \\frac{10}{\\sqrt{71}}$：\n$$\nW = \\alpha u^t = \\frac{2}{\\sqrt{5}} \\cdot \\frac{10}{\\sqrt{71}} = \\frac{20}{\\sqrt{355}} = \\frac{20}{\\sqrt{5}\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\n三维速度 $v^i$ 通过分解 $u^{\\mu} = W(n^{\\mu} + v^{\\mu})$ 定义，其中 $n^\\mu = (\\frac{1}{\\alpha}, -\\frac{\\beta^i}{\\alpha})$ 是欧拉观测者的四维速度，而 $v^\\mu = (0, v^i)$ 在此坐标系中是一个纯空间矢量。\n从分解的空间分量 $u^i = W(n^i + v^i) = W(-\\frac{\\beta^i}{\\alpha} + v^i)$，我们解出 $v^i$：\n$$\nv^i = \\frac{u^i}{W} + \\frac{\\beta^i}{\\alpha}\n$$\n唯一非零的分量是 $i=r$。我们有 $u^r = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}$。\n$$\nv^r = \\frac{u^r}{W} + \\frac{\\beta^r}{\\alpha} = \\left(\\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}\\right) \\left(\\frac{\\sqrt{5}\\sqrt{71}}{20}\\right) + \\frac{\\frac{1}{5}}{\\frac{2}{\\sqrt{5}}}\n$$\n$$\nv^r = \\frac{(6\\sqrt{5} - 10)\\sqrt{5}}{100} + \\frac{\\sqrt{5}}{10} = \\frac{6(5) - 10\\sqrt{5}}{100} + \\frac{\\sqrt{5}}{10} = \\frac{30 - 10\\sqrt{5}}{100} + \\frac{10\\sqrt{5}}{100} = \\frac{30}{100} = \\frac{3}{10}\n$$\n由于 $u^\\theta=0$、$u^\\phi=0$、$\\beta^\\theta=0$ 和 $\\beta^\\phi=0$，其他分量为 $v^\\theta=0$ 和 $v^\\phi=0$。\n\n最后，我们从第一性原理出发验证关系式 $W = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}$，然后用我们计算出的值进行验证。\n四维速度的归一化条件是 $u^\\mu u_\\mu = -1$。代入分解式 $u^\\mu = W(n^\\mu + v^\\mu)$：\n$$\n-1 = g_{\\mu\\nu}u^\\mu u^\\nu = W^2 g_{\\mu\\nu}(n^\\mu+v^\\mu)(n^\\nu+v^\\nu) = W^2(g_{\\mu\\nu}n^\\mu n^\\nu + 2g_{\\mu\\nu}n^\\mu v^\\nu + g_{\\mu\\nu}v^\\mu v^\\nu)\n$$\n我们知道 $n^\\mu n_\\mu = g_{\\mu\\nu}n^\\mu n^\\nu = -1$。\n项 $g_{\\mu\\nu}n^\\mu v^\\nu = n_\\nu v^\\nu = n_t v^t + n_i v^i$。由于我们使用 ADM 坐标系，其中 $n_i=0$，并且根据定义 $v^t=0$，所以该乘积为 $n_\\nu v^\\nu = 0$。\n最后一项是 $g_{\\mu\\nu}v^\\mu v^\\nu$。由于 $v^t=0$，这变为 $g_{ij}v^i v^j = \\gamma_{ij}v^i v^j$。\n将这些代回归一化条件：\n$$\n-1 = W^2(-1 + 0 + \\gamma_{ij}v^i v^j)\n$$\n$$\n1 = W^2(1 - \\gamma_{ij}v^i v^j) \\implies W^2 = \\frac{1}{1 - \\gamma_{ij}v^i v^j}\n$$\n对洛伦兹因子取正平方根，得到所求的表达式：\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij}v^i v^j}}\n$$\n这就从第一性原理验证了该公式。\n\n现在我们进行数值验证。我们使用 $\\gamma_{rr}$ 和 $v^r$ 的值计算右侧：\n$$\n\\gamma_{ij}v^i v^j = \\gamma_{rr}(v^r)^2 = \\left(\\frac{5}{4}\\right)\\left(\\frac{3}{10}\\right)^2 = \\frac{5}{4} \\cdot \\frac{9}{100} = \\frac{45}{400} = \\frac{9}{80}\n$$\n将此代入公式：\n$$\n\\frac{1}{\\sqrt{1-\\gamma_{ij}v^i v^j}} = \\frac{1}{\\sqrt{1 - \\frac{9}{80}}} = \\frac{1}{\\sqrt{\\frac{71}{80}}} = \\sqrt{\\frac{80}{71}} = \\frac{\\sqrt{16 \\cdot 5}}{\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\n这个结果与我们之前计算的 $W = \\alpha u^t = \\frac{4\\sqrt{5}}{\\sqrt{71}}$ 相符。验证成功。\n\n问题要求 $W$ 的数值，并四舍五入到四位有效数字。\n$$\nW = \\frac{4\\sqrt{5}}{\\sqrt{71}} \\approx 1.06149000...\n$$\n四舍五入到四位有效数字得到 $1.061$。", "answer": "$$\n\\boxed{1.061}\n$$", "id": "3512023"}, {"introduction": "相对论流体的行为由其热力学性质决定，这些性质被封装在状态方程（Equation of State, EOS）中。这个练习 [@problem_id:3512082] 演示了如何从一个表格化的EOS中提取关键物理信息，如声速。你将看到这个信息如何决定了控制方程的数学特性（双曲性），这对于一个适定的（well-posed）数值模拟至关重要。", "problem": "设计并实现一个完整的、可运行的程序。对于一个给定的、以表格形式表示的状态方程（EOS）片段，该程序需计算相对论比焓 $h$、绝热声速 $c_s$，并通过检查沿某一选定方向的所有特征速度均为实数且严格亚光速来验证广义相对论流体动力学（GRHD）系统的双曲性。程序必须仅使用下文陈述的定义和第一性原理，计算需基于所提供的表格进行数值计算，不得依赖任何闭合形式的简便方法。\n\n假设和物理单位：\n- 在平直时空（Minkowski度规）中进行计算，光速设为 $c = 1$。因此，所有速度都是无量纲的，并且必须满足 $|v|  1$。\n- 采用单位静质量的静质量能为 $1$ 的单位制，因此，单位体积的总能量密度为 $e = \\rho (1 + \\epsilon)$，其中 $\\rho$ 是静质量密度，$\\epsilon$ 是比内能。\n\n使用的基本原理：\n- 单位静质量的比焓定义为\n$$\nh \\equiv \\frac{e + p}{\\rho} \\, ,\n$$\n其中 $e = \\rho (1 + \\epsilon)$，因此\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho} \\, .\n$$\n- 绝热声速的热力学定义为等熵导数\n$$\nc_s^2 \\equiv \\left(\\frac{\\partial p}{\\partial e}\\right)_s \\, .\n$$\n由于表格化的EOS片段位于一条等熵线上，您必须通过在表格曲线上使用有限差分来数值计算查询状态下的 $c_s^2$。沿等熵线使用链式法则可写为\n$$\nc_s^2 = \\frac{\\mathrm{d}p/\\mathrm{d}\\rho}{\\mathrm{d}e/\\mathrm{d}\\rho} \\, ,\n$$\n其中的导数从表格中数值计算得出。在内部点使用中心差分，在端点使用单边差分。\n- 对于平直时空中沿 $x$ 方向的一维传播，特征速度是在实验室参考系中观察到的声波速度，通过相对论运动学获得：声波在流体静止系中以 $\\pm c_s$ 的速度移动，并且必须通过 Einstein 速度加法律与流体的输运速度相结合，以获得实验室参考系中的传播速度。熵/接触模随流体平流。使用这些原理来获得沿 $x$ 方向的特征速度集合，并验证它们是实数且其绝对值严格小于光速。\n\n插值和微分要求：\n- EOS 以表格形式给出，为在单调递增的 $\\rho_i$ 处的一系列 $(\\rho_i,\\epsilon_i,p_i)$ 值。要在查询密度 $\\rho_\\star$ 处计算 $h$，首先通过对 $\\rho$ 进行分段线性插值来获得 $\\epsilon(\\rho_\\star)$ 和 $p(\\rho_\\star)$。然后根据其定义计算 $h(\\rho_\\star)$。对于声速，使用表格数据中 $p(\\rho)$ 和 $e(\\rho) = \\rho (1 + \\epsilon(\\rho))$ 的有限差分来计算 $c_s^2(\\rho_\\star)$；在可能的情况下使用中心差分格式，否则使用单边差分格式。然后，如果 $c_s^2(\\rho_\\star) \\ge 0$，则设 $c_s(\\rho_\\star) = \\sqrt{c_s^2(\\rho_\\star)}$；否则将该情况视为非双曲的。\n\nEOS表格：\n- 表格化的 EOS 片段沿单一等熵线，并以在以下密度处的 $9$ 个三元组 $(\\rho_i,\\epsilon_i,p_i)$ 的形式提供。在 $c=1$ 的单位制下，所有量都是无量纲的。\n  - $(\\rho, \\epsilon, p) = ($$0.05$$, $$0.007368062997280766$$, $$0.00012280104995467942$$)$\n  - $(\\rho, \\epsilon, p) = ($$0.1$$, $$0.009283177667225558$$, $$0.00030943925557418527$$)$\n  - $(\\rho, \\epsilon, p) = ($$0.2$$, $$0.011696070952851467$$, $$0.0007797380635234311$$)$\n  - $(\\rho, \\epsilon, p) = ($$0.5$$, $$0.015874010519681995$$, $$0.0026456684199469994$$)$\n  - $(\\rho, \\epsilon, p) = ($$1.0$$, $$0.02$$, $$0.006666666666666667$$)$\n  - $(\\rho, \\epsilon, p) = ($$2.0$$, $$0.025198420997897465$$, $$0.016798947331931643$$)$\n  - $(\\rho, \\epsilon, p) = ($$5.0$$, $$0.03419951893353394$$, $$0.05699919822255657$$)$\n  - $(\\rho, \\epsilon, p) = ($$10.0$$, $$0.04308869380063768$$, $$0.143628979335459$$)$\n  - $(\\rho, \\epsilon, p) = ($$20.0$$, $$0.05428835233189813$$, $$0.36192234887932087$$)$\n\n特征速度检查：\n- 对于每个满足 $|v_x|  1$ 的查询状态 $(\\rho_\\star, v_x)$，构建沿 $x$ 方向的完整一维特征速度集合，并检查它们是否全部为实数且绝对值严格亚光速。当且仅当所有特征速度都满足这些条件时，判定系统在该状态下是双曲的。\n\n测试套件：\n- 使用以下 $5$ 个测试用例，每个用例以 $(\\rho_\\star, v_x)$ 的形式给出：\n  - 用例 A: $(\\rho_\\star, v_x) = ($$1.0$$, $$0.3$$)$\n  - 用例 B: $(\\rho_\\star, v_x) = ($$0.1$$, $$0.0$$)$\n  - 用例 C: $(\\rho_\\star, v_x) = ($$10.0$$, $$0.9$$)$\n  - 用例 D: $(\\rho_\\star, v_x) = ($$20.0$$, $$0.5$$)$\n  - 用例 E: $(\\rho_\\star, v_x) = ($$0.05$$, $$0.2$$)$\n\n程序要求：\n- 对每个测试用例，计算并返回一个列表 $[h, c_s, \\mathrm{hyper}]$，其中 $h$ 和 $c_s$ 是浮点数，四舍五入到小数点后恰好八位，而 $\\mathrm{hyper}$ 是一个整数，如果所有特征速度均为实数且严格亚光速，则其值为 $1$，否则为 $0$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，列表中的每个元素是对应于一个测试用例的三元素列表，顺序为 A, B, C, D, E。例如，输出必须如下所示：\n$$\n[\\,[h_A,c_{s,A},\\mathrm{hyper}_A],\\,[h_B,c_{s,B},\\mathrm{hyper}_B],\\,[h_C,c_{s,C},\\mathrm{hyper}_C],\\,[h_D,c_{s,D},\\mathrm{hyper}_D],\\,[h_E,c_{s,E},\\mathrm{hyper}_E]\\,]\n$$\n其中 $h_\\cdot$ 和 $c_{s,\\cdot}$ 打印到小数点后恰好八位，$\\mathrm{hyper}_\\cdot$ 为 $1$ 或 $0$。", "solution": "该问题要求计算相对论流体动力学中的几个关键量——相对论比焓 $h$、绝热声速 $c_s$ 以及双曲性检查——针对一组状态，使用提供的表格化状态方程（EOS）。整个过程必须遵循第一性原理和指定的数值方法。\n\n首先，确认问题陈述的有效性。它在科学上基于狭义相对论流体动力学的既定原理。诸如比焓 $h=1+\\epsilon+p/\\rho$ 和总能量密度 $e=\\rho(1+\\epsilon)$ 等热力学量的定义是标准的。绝热声速的热力学定义 $c_s^2 = (\\partial p / \\partial e)_s$ 以及通过链式法则 $c_s^2 = (\\mathrm{d}p/\\mathrm{d}\\rho)/(\\mathrm{d}e/\\mathrm{d}\\rho)$ 沿给定等熵线进行的数值计算是正确的。从 Einstein 速度加法律推导特征速度也是一个标准的教科书程序。问题是适定的（well-posed），提供了所有必要的数据（EOS表格）和清晰、明确的数值计算指令（有限差分、端点处理）。所提供的数据在物理上看起来是一致的。因此，该问题被认为是有效的，可以制定解决方案。\n\n解决方案如下：对于每个给定的测试用例，由静质量密度 $\\rho_\\star$ 和流体速度 $v_x$ 指定，我们计算所需的量。\n\n**1. 数据表示和预计算**\n\n提供的 EOS 是沿单一等熵线的 $N=9$ 个离散点 $(\\rho_i, \\epsilon_i, p_i)$ 的表格。对于涉及总能量密度 $e$ 的数值微分，首先预先计算所有 $i \\in \\{1, \\dots, N\\}$ 的 $e_i = \\rho_i(1+\\epsilon_i)$ 列表是高效的。测试用例提供的查询密度 $\\rho_\\star$ 都存在于表格化的 $\\rho_i$ 值中。这简化了任务，因为不需要插值；我们可以直接识别索引 $i$ 使得 $\\rho_i = \\rho_\\star$，并使用相应的 $(\\epsilon_i, p_i)$ 值。\n\n**2. 比焓 ($h$) 的计算**\n\n单位静质量的相对论比焓 $h$ 定义为 $h \\equiv (e+p)/\\rho$。代入 $e=\\rho(1+\\epsilon)$ 的定义，可得：\n$$\nh = \\frac{\\rho(1+\\epsilon) + p}{\\rho} = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\n对于与网格点 $i$ 对应的查询密度 $\\rho_\\star$，焓可以直接使用表格中的值计算：\n$$\nh(\\rho_i) = 1 + \\epsilon_i + \\frac{p_i}{\\rho_i}\n$$\n\n**3. 绝热声速 ($c_s$) 的计算**\n\n绝热声速的平方 $c_s^2$ 是从表格数据中数值计算的。问题指定使用沿等熵曲线的链式法则导出的公式：\n$$\nc_s^2 = \\frac{\\mathrm{d}p/\\mathrm{d}\\rho}{\\mathrm{d}e/\\mathrm{d}\\rho}\n$$\n导数使用有限差分进行近似。\n设表格数据点的索引为从 $i=0$ 到 $N-1=8$。\n\n对于内部点（$0  i  N-1$），我们使用二阶中心差分格式：\n$$\n\\left(\\frac{\\mathrm{d}p}{\\mathrm{d}\\rho}\\right)_i \\approx \\frac{p_{i+1} - p_{i-1}}{\\rho_{i+1} - \\rho_{i-1}} \\quad \\text{和} \\quad \\left(\\frac{\\mathrm{d}e}{\\mathrm{d}\\rho}\\right)_i \\approx \\frac{e_{i+1} - e_{i-1}}{\\rho_{i+1} - \\rho_{i-1}}\n$$\n将这些代入 $c_s^2$ 的表达式中可得：\n$$\nc_s^2(\\rho_i) \\approx \\frac{(p_{i+1} - p_{i-1})/(\\rho_{i+1} - \\rho_{i-1})}{(e_{i+1} - e_{i-1})/(\\rho_{i+1} - \\rho_{i-1})} = \\frac{p_{i+1} - p_{i-1}}{e_{i+1} - e_{i-1}}\n$$\n\n对于左端点（$i=0$），我们使用一阶向前差分格式：\n$$\nc_s^2(\\rho_0) \\approx \\frac{(p_1 - p_0)/(\\rho_1 - \\rho_0)}{(e_1 - e_0)/(\\rho_1 - \\rho_0)} = \\frac{p_1 - p_0}{e_1 - e_0}\n$$\n\n对于右端点（$i=N-1$），我们使用一阶向后差分格式：\n$$\nc_s^2(\\rho_{N-1}) \\approx \\frac{(p_{N-1} - p_{N-2})/(\\rho_{N-1} - \\rho_{N-2})}{(e_{N-1} - e_{N-2})/(\\rho_{N-1} - \\rho_{N-2})} = \\frac{p_{N-1} - p_{N-2}}{e_{N-1} - e_{N-2}}\n$$\n\n在获得 $c_s^2$ 的值后，我们计算声速 $c_s$。对于一个物理上有效的系统，我们期望 $c_s^2 \\ge 0$。那么声速为 $c_s = \\sqrt{c_s^2}$。如果 $c_s^2  0$，声速为虚数，这是不稳定的一个条件，并且控制方程的双曲性被破坏。\n\n**4. 双曲性验证**\n\n狭义相对论流体动力学方程组是双曲的，当且仅当其特征波速均为实数且互不相同。对于沿 $x$ 方向的一维流动，在流体的静止系中，存在三种特征模式：两个以速度 $\\pm c_s$ 传播的声波和一个以速度 $0$ 传播的接触/熵波。\n\n为了找到实验室参考系中的速度（其中流体以速度 $v_x$ 移动），我们使用 Einstein 速度加法律。这些速度是：\n1.  接触/熵模： $\\lambda_0 = v_x$\n2.  前向传播声模： $\\lambda_+ = \\frac{v_x + c_s}{1 + v_x c_s}$\n3.  后向传播声模： $\\lambda_- = \\frac{v_x - c_s}{1 - v_x c_s}$\n\n为使系统是双曲的并尊重因果性，所有特征速度 $\\lambda_k$ 都必须是实数且严格亚光速，即 $|\\lambda_k|  1$（因为 $c=1$）。\n- 条件 $|\\lambda_0|  1$ 要求 $|v_x|1$，这对于所有测试用例都是给定的。\n- 为使 $\\lambda_{\\pm}$ 是实数， $c_s$ 必须是实数，这意味着 $c_s^2 \\ge 0$。\n- 可以证明，在给定 $|v_x|1$ 的情况下，条件 $|\\lambda_{\\pm}|  1$ 等价于条件 $c_s^2  1$。推导过程如下：\n  $$ \\left| \\frac{v_x \\pm c_s}{1 \\pm v_x c_s} \\right|  1 \\iff (v_x \\pm c_s)^2  (1 \\pm v_x c_s)^2 $$\n  $$ \\iff v_x^2 \\pm 2v_x c_s + c_s^2  1 \\pm 2v_x c_s + v_x^2 c_s^2 $$\n  $$ \\iff v_x^2 + c_s^2  1 + v_x^2 c_s^2 \\iff v_x^2 - v_x^2 c_s^2 - 1 + c_s^2  0 $$\n  $$ \\iff (v_x^2 - 1)(1 - c_s^2)  0 $$\n由于 $|v_x|1$，项 $(v_x^2 - 1)$ 是负的。为使不等式成立，项 $(1-c_s^2)$ 必须是正的，这意味着 $c_s^2  1$。\n\n因此，在这种情况下，双曲性的完整条件集简化为要求绝热声速是实数且亚光速：\n$$\n0 \\le c_s^2  1\n$$\n程序将评估此条件。如果满足条件，双曲性标志 `hyper` 设置为 $1$；否则，设置为 $0$。\n\n实现将处理每个测试用例 $(\\rho_\\star, v_x)$，首先在 EOS 表格中找到对应的索引，然后依次计算 $h$、$c_s^2$、$c_s$ 和双曲性标志，最后按要求格式化结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes specific enthalpy, sound speed, and verifies hyperbolicity for GRHD\n    states based on a tabulated equation of state.\n    \"\"\"\n    \n    # EOS table provided in the problem statement.\n    # Columns: rho, epsilon, p\n    eos_data = [\n        (0.05, 0.007368062997280766, 0.00012280104995467942),\n        (0.1,  0.009283177667225558, 0.00030943925557418527),\n        (0.2,  0.011696070952851467, 0.0007797380635234311),\n        (0.5,  0.015874010519681995, 0.0026456684199469994),\n        (1.0,  0.02,                   0.006666666666666667),\n        (2.0,  0.025198420997897465, 0.016798947331931643),\n        (5.0,  0.03419951893353394,  0.05699919822255657),\n        (10.0, 0.04308869380063768,  0.143628979335459),\n        (20.0, 0.05428835233189813,  0.36192234887932087),\n    ]\n\n    rho = np.array([row[0] for row in eos_data])\n    epsilon = np.array([row[1] for row in eos_data])\n    p = np.array([row[2] for row in eos_data])\n\n    # Pre-compute total energy density e = rho * (1 + epsilon)\n    e = rho * (1 + epsilon)\n    \n    # Map rho values to their indices for quick lookup\n    rho_to_index = {val: i for i, val in enumerate(rho)}\n    \n    # Test suite provided in the problem statement.\n    test_cases = [\n        (1.0,  0.3),  # Case A\n        (0.1,  0.0),  # Case B\n        (10.0, 0.9),  # Case C\n        (20.0, 0.5),  # Case D\n        (0.05, 0.2),  # Case E\n    ]\n\n    results = []\n    for rho_star, vx in test_cases:\n        if rho_star not in rho_to_index:\n            # This case should not occur based on the problem statement\n            # but is good practice to handle.\n            raise ValueError(f\"Queried density rho_star={rho_star} not in EOS table.\")\n        \n        idx = rho_to_index[rho_star]\n        \n        # 1. Calculate specific enthalpy h = 1 + epsilon + p/rho\n        h_val = 1 + epsilon[idx] + p[idx] / rho[idx]\n        \n        # 2. Calculate sound speed squared (cs2)\n        cs2 = 0.0\n        if idx == 0:\n            # Forward difference for the first point\n            dp = p[idx+1] - p[idx]\n            de = e[idx+1] - e[idx]\n            cs2 = dp / de if de != 0 else float('inf')\n        elif idx == len(rho) - 1:\n            # Backward difference for the last point\n            dp = p[idx] - p[idx-1]\n            de = e[idx] - e[idx-1]\n            cs2 = dp / de if de != 0 else float('inf')\n        else:\n            # Centered difference for interior points\n            dp = p[idx+1] - p[idx-1]\n            de = e[idx+1] - e[idx-1]\n            cs2 = dp / de if de != 0 else float('inf')\n            \n        # 3. Calculate sound speed (cs) and check hyperbolicity\n        cs_val = 0.0\n        is_hyperbolic = 0 # Corresponds to the 'hyper' flag\n        \n        if 0 = cs2  1:\n            # Condition for hyperbolicity: 0 = cs^2  1 (since c=1)\n            is_hyperbolic = 1\n            cs_val = np.sqrt(cs2)\n        elif cs2 >= 1:\n            # Subluminal sound speed is violated\n            is_hyperbolic = 0\n            cs_val = np.sqrt(cs2)\n        else: # cs2  0\n            # Real sound speed is violated (stability issue)\n            is_hyperbolic = 0\n            cs_val = 0.0 # Cannot compute real sqrt, return 0 as per robust plan\n\n        # Format and append results\n        # h and cs are rounded to exactly 8 decimal places\n        # hyper is an integer (1 or 0)\n        h_formatted = f\"{h_val:.8f}\"\n        cs_formatted = f\"{cs_val:.8f}\"\n        \n        results.append([float(h_formatted), float(cs_formatted), is_hyperbolic])\n\n    # Format the final output string exactly as required\n    # e.g., [[1.0, 2.0, 1], [3.0, 4.0, 0]]\n    list_of_strs = [str(item) for item in results]\n    final_output = f\"[{','.join(list_of_strs)}]\"\n    \n    # Custom formatting to remove spaces for stricter compliance.\n    # This generates output like [[1.0,2.0,1],[3.0,4.0,0]]\n    sublist_strs = []\n    for res in results:\n        h_str = f\"{res[0]:.8f}\"\n        cs_str = f\"{res[1]:.8f}\"\n        hyper_str = str(res[2])\n        sublist_strs.append(f\"[{h_str},{cs_str},{hyper_str}]\")\n    final_output_no_space = f\"[{','.join(sublist_strs)}]\"\n\n    print(final_output_no_space)\n\nsolve()\n```", "id": "3512082"}, {"introduction": "磁流体动力学的一个核心挑战是在数值上强制执行麦克斯韦方程 $\\nabla\\cdot\\mathbf{B}=0$。这个练习 [@problem_id:3512085] 介绍了约束输运（constrained transport, CT）方法，这是一种通过巧妙的设计将此约束维持在机器精度内的强大技术。你将在弯曲背景上实现一个CT格式，并将其与一个简易方法进行比较，从而掌握现代GRMHD代码的一个基石。", "problem": "请为齐次麦克斯韦方程组在弯曲时空（对应于以内行 Kerr-Schild 球极坐标表示的史瓦西黑洞）中实现一个离散约束输运格式。在不依赖于时间、轴对称的设定下进行，因此只需验证空间散度约束。目标有两方面：一是通过数值方法表明磁场的离散散度在整个计算域（包括跨越事件视界的单元）内均在舍入误差范围内为零；二是在此基础上，测量一种非守恒的朴素散度估计值如何随分辨率变化。\n\n从广义相对论标准 $3+1$ 分解下的齐次麦克斯韦方程组开始，其中空间磁场由其逆变分量 $B^i$ 表示，空间度规的行列式为 $\\gamma$。磁场满足散度约束\n$$\n\\partial_i\\left(\\sqrt{\\gamma}\\,B^i\\right)=0,\n$$\n其中 $\\partial_i$ 表示对空间坐标的偏导数。在约束输运中，我们将面心磁通量密度（也称为磁感应密度）\n$$\n\\Phi^i \\equiv \\sqrt{\\gamma}\\,B^i\n$$\n表示为以 Levi-Civita 符号密度 $\\,\\varepsilon^{ijk}$ 定义的边心矢势 $A_i$ 的离散旋度：\n$$\n\\Phi^i = \\varepsilon^{ijk}\\,\\partial_j A_k,\n$$\n因此，根据“旋度的散度为零”这一矢量恒等式的离散类比，$\\Phi^i$ 的离散散度将在舍入误差范围内恒为零。\n\n使用几何化单位制（其中引力常数 $G$ 和光速 $c$ 均设为 1），在内行 Kerr-Schild 球极坐标 $(t,r,\\theta,\\phi)$ 下的史瓦西时空。设黑洞质量为 $M=1$，因此事件视界半径为 $r_H=2M=2$。在该坐标系中，$t=\\text{constant}$ 切片上的空间度规是对角的，其分量为\n$$\n\\gamma_{rr} = 1 + \\frac{2M}{r},\\quad \\gamma_{\\theta\\theta} = r^2,\\quad \\gamma_{\\phi\\phi} = r^2\\sin^2\\theta,\n$$\n其行列式为\n$$\n\\gamma = \\left(1+\\frac{2M}{r}\\right) r^4 \\sin^2\\theta,\\quad \\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+\\frac{2M}{r}}.\n$$\n\n在 $r\\in[r_{\\min},r_{\\max}]$ 和 $\\theta\\in[\\theta_{\\min},\\theta_{\\max}]$ 上构建一个均匀球极网格，分别包含 $N_r$ 和 $N_\\theta$ 个单元。使用\n$$\nr_{\\min}=1.6,\\quad r_{\\max}=10.0,\\quad \\theta_{\\min}=0.05,\\quad \\theta_{\\max}=\\pi-0.05,\n$$\n以确保计算域严格包含事件视界两侧的区域，同时避开两极的坐标奇点。假设轴对称并忽略 $\\phi$ 方向（等效于 $N_\\phi=1$ 且无变化）。\n\n定义矢势唯一非零的分量为协变方位角分量 $A_\\phi$，其采样点位于沿 $\\phi$ 方向的边上。将这些边放置在 $r$ 方向和 $\\theta$ 方向的面交点处，即 $(r_{i+\\frac{1}{2}},\\theta_{j+\\frac{1}{2}})$，其中 $i=0,\\dots,N_r-1$，$j=0,\\dots,N_\\theta-1$。使用以下平滑、局域且跨越视界的场\n$$\nA_\\phi(r,\\theta) = A_0\\, r^2 \\sin^2\\theta \\,\\exp\\!\\left(-\\left(\\frac{r}{r_0}\\right)^2\\right),\n$$\n其中 $A_0=1$，$r_0=4$。\n\n通过定义面心通量密度，在这些坐标下实现离散约束输运\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta},\n$$\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\,\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r},\n$$\n以及 $\\Phi^\\phi=0$。此处 $\\Delta r=(r_{\\max}-r_{\\min})/N_r$ 和 $\\Delta\\theta=(\\theta_{\\max}-\\theta_{\\min})/N_\\theta$，索引 $i$ 和 $j$ 分别指代 $r$ 和 $\\theta$ 方向上的单元中心索引。这是在轴对称假设下，$\\Phi^i = \\varepsilon^{ijk}\\partial_j A_k$ 在球极坐标中的离散表示。\n\n将单元中心 $(i,j)$ 处的通量密度离散散度定义为\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}.\n$$\n根据约束输运的构造，该离散散度预计在任何地方（包括与视界相交的单元）都将在舍入误差范围内为零。\n\n作为对比，我们还计算一个非守恒的、朴素的弯曲空间散度估计，它模仿了一种常见的非交错离散化方法。首先，使用在相应面位置处计算的 $\\sqrt{\\gamma}$ 值，恢复面心磁场分量 $B^r=\\Phi^r/\\sqrt{\\gamma}$ 和 $B^\\theta=\\Phi^\\theta/\\sqrt{\\gamma}$，然后将它们平均到单元中心，得到 $B^r_{c}$ 和 $B^\\theta_{c}$。接下来，计算以下表达式的单元中心近似值\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive}} \\equiv \\frac{1}{\\sqrt{\\gamma}}\\left[\\partial_r\\left(\\sqrt{\\gamma}\\,B^r\\right) + \\partial_\\theta\\left(\\sqrt{\\gamma}\\,B^\\theta\\right)\\right]\n$$\n在单元中心数组上使用二阶中心有限差分计算导数，并在单元中心处使用 $\\sqrt{\\gamma}$。将此朴素散度估计限制在内部单元，以确保中心差分格式可用。\n\n在相同的网格上实现这两种估计器，并报告每种分辨率下的以下两种标量误差度量：\n- 在所有单元上约束输运离散散度的最大绝对值，\n$$\nE_{\\mathrm{CT}} \\equiv \\max_{i,j} \\left|\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij}\\right|.\n$$\n- 在内部单元上朴素散度的均方根，\n$$\nE_{\\mathrm{naive}} \\equiv \\sqrt{\\frac{1}{N_{\\mathrm{int}}}\\sum_{\\text{interior }(i,j)} \\left(\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive},ij}\\right)^2 },\n$$\n其中 $N_{\\mathrm{int}}$ 是中心差分格式所使用的内部单元数量。在所用的代码单位中，这些是无量纲数。\n\n测试套件。针对以下三种分辨率运行程序：\n- 情况 A（正常路径）：$N_r=48$, $N_\\theta=48$。\n- 情况 B（加密）：$N_r=96$, $N_\\theta=96$。\n- 情况 C（进一步加密）：$N_r=192$, $N_\\theta=192$。\n\n您的程序应生成单行输出，按以下顺序包含六个结果\n$$\n\\left[E_{\\mathrm{CT}}^{(A)},\\,E_{\\mathrm{naive}}^{(A)},\\,E_{\\mathrm{CT}}^{(B)},\\,E_{\\mathrm{naive}}^{(B)},\\,E_{\\mathrm{CT}}^{(C)},\\,E_{\\mathrm{naive}}^{(C)}\\right],\n$$\n以方括号括起，并以逗号分隔列表的形式打印，每个浮点数使用包含六位有效数字的科学记数法表示。不应打印任何其他文本。所有计算都应在几何化单位制中进行，角度使用弧度制。预期的定性行为是，对于所有分辨率，$E_{\\mathrm{CT}}$ 都处于舍入误差水平，而随着分辨率的提高，$E_{\\mathrm{naive}}$ 大致按网格间距的平方递减。", "solution": "该问题要求在史瓦西黑洞的弯曲时空中，为齐次麦克斯韦方程组实现并验证一个离散约束输运（CT）格式。其目标是证明 CT 格式能够将磁场的无散度约束维持在机器精度水平，并将其精度与一种更直接的非守恒数值方法进行比较。背景设定为轴对称，因此我们考虑在球极坐标 $(r, \\theta)$ 下的二维网格。\n\n其控制性物理原理是磁场 $\\mathbf{B}$ 的散度约束，在广义相对论的 $3+1$ 形式体系中，它通过空间度规行列式 $\\gamma$ 和磁场的逆变分量 $B^i$ 表示为：\n$$\n\\partial_i \\left( \\sqrt{\\gamma} B^i \\right) = 0\n$$\n此处默认对重复索引 $i \\in \\{r, \\theta, \\phi\\}$ 求和。量 $\\Phi^i \\equiv \\sqrt{\\gamma} B^i$ 是磁通量密度。\n\n为了在数值上强制执行此约束，约束输运方法将磁通量密度表示为矢势 $A_k$ 的旋度。在本问题中，我们给定一个受连续关系 $\\Phi^i = \\varepsilon^{ijk} \\partial_j A_k$ 启发的离散表示，其中 $\\varepsilon^{ijk}$ 是 Levi-Civita 符号密度。其核心思想是旋度的散度恒为零。一个能正确模仿此属性的离散实现，将在浮点舍入误差的水平上保持无散度条件。\n\n数值实现是在一个交错网格上进行的。我们在域 $(r, \\theta)$ 中定义一个 $N_r \\times N_\\theta$ 单元的均匀网格。基本物理量的位置如下：\n-   单元中心位于 $(r_i, \\theta_j)$，其中 $i \\in \\{0, \\dots, N_r-1\\}, j \\in \\{0, \\dots, N_\\theta-1\\}$。\n-   垂直面（$r$ 恒定）位于 $r_{i \\pm 1/2}$，水平面（$\\theta$ 恒定）位于 $\\theta_{j \\pm 1/2}$。\n-   矢势 $A_\\phi$ 定义在单元角点（或沿 $\\phi$ 方向的边）上，坐标为 $(r_{i+1/2}, \\theta_{j+1/2})$。\n\n给定在单元角点采样的矢势 $A_\\phi(r, \\theta)$，面心磁通量密度 $\\Phi^r$ 和 $\\Phi^\\theta$ 通过离散旋度运算计算得出。\n径向通量 $\\Phi^r$ 位于 $r$ 面上（位置在 $(r_{i+1/2}, \\theta_j)$），通过对 $A_\\phi$ 在 $\\theta$ 方向上进行有限差分计算：\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\n极向通量 $\\Phi^\\theta$ 位于 $\\theta$ 面上（位置在 $(r_i, \\theta_{j+1/2})$），通过对 $A_\\phi$ 在 $r$ 方向上进行有限差分计算：\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r}\n$$\n由于轴对称性，$\\Phi^\\phi = 0$。\n\n然后通过对面心通量进行有限差分，计算单元中心 $(r_i, \\theta_j)$ 处的离散散度：\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\n将通量的定义代入散度表达式，可以发现各项完全抵消：\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} = \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} \\right) - \\left( A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] \\\\\n- \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} \\right) - \\left( A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] = 0\n$$\n这种代数上的抵消保证了计算出的散度将在机器精度内为零。该方法的误差度量是此离散散度在所有网格单元上的最大绝对值 $E_{\\mathrm{CT}}$。\n\n作为对比，我们还实现了一种非守恒的“朴素”方法。这种方法在离散层面上无法保持无散度属性。其步骤如下：\n1.  使用在相应面位置处计算的 $\\sqrt{\\gamma}$ 值，计算面心物理磁场分量 $B^r = \\Phi^r / \\sqrt{\\gamma}$ 和 $B^\\theta = \\Phi^\\theta / \\sqrt{\\gamma}$。度规行列式为 $\\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+2M/r}$。\n2.  将面心分量 $B^r$ 和 $B^\\theta$ 平均到单元中心，得到单元中心场 $B^r_c$ 和 $B^\\theta_c$。例如，$B^r_{c,ij} = \\frac{1}{2}(B^r_{i+1/2,j} + B^r_{i-1/2,j})$。\n3.  使用单元中心的场和单元中心的度规行列式值，重构单元中心通量密度：$F^r_c = (\\sqrt{\\gamma} B^r)_c$ 和 $F^\\theta_c = (\\sqrt{\\gamma} B^\\theta)_c$。\n4.  在内部单元网格上，使用二阶中心有限差分计算 $F^r_c$ 和 $F^\\theta_c$ 的导数，从而近似散度 $\\frac{1}{\\sqrt{\\gamma}}[\\partial_r(\\sqrt{\\gamma}B^r) + \\partial_\\theta(\\sqrt{\\gamma}B^\\theta)]$。\n\n这种朴素方法在每一步（平均和求导）都会引入截断误差。由于解析场的真实散度为零，数值计算出的散度将与截断误差同阶，预计为网格间距的二阶，即 $O(\\Delta r^2, \\Delta \\theta^2)$。误差度量 $E_{\\mathrm{naive}}$ 是此朴素散度在内部网格单元上的均方根。我们预计，每次分辨率加倍时，$E_{\\mathrm{naive}}$ 将大约减小 4 倍。\n\n计算在三种网格分辨率（$48 \\times 48$、$96 \\times 96$ 和 $192 \\times 192$）下进行，计算域跨越了位于 $r=2M=2$ 的黑洞事件视界，这证明了 CT 方法即使在这种强引力区域也具有鲁棒性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares constrained transport and naive divergence schemes\n    for the magnetic field in Schwarzschild spacetime.\n    \"\"\"\n\n    def run_case(Nr, Nth):\n        \"\"\"\n        Runs the simulation for a single resolution (Nr, Nth).\n\n        Returns:\n            E_ct (float): Maximum absolute error for the CT method.\n            E_naive (float): RMS error for the naive method.\n        \"\"\"\n        # Physical and domain constants\n        M = 1.0\n        A0 = 1.0\n        r0 = 4.0\n        rmin, rmax = 1.6, 10.0\n        th_min, th_max = 0.05, np.pi - 0.05\n\n        # Grid setup\n        dr = (rmax - rmin) / Nr\n        dth = (th_max - th_min) / Nth\n        \n        r_faces = np.linspace(rmin, rmax, Nr + 1, dtype=np.float64)\n        th_faces = np.linspace(th_min, th_max, Nth + 1, dtype=np.float64)\n        r_centers = rmin + (np.arange(Nr, dtype=np.float64) + 0.5) * dr\n        th_centers = th_min + (np.arange(Nth, dtype=np.float64) + 0.5) * dth\n\n        # Vector potential A_phi defined at grid corners (intersections of faces)\n        R_corners, TH_corners = np.meshgrid(r_faces, th_faces, indexing='ij')\n        A_phi_corners = A0 * R_corners**2 * np.sin(TH_corners)**2 * np.exp(-(R_corners/r0)**2)\n\n        # ---- Constrained Transport (CT) Divergence Calculation ----\n\n        # Magnetic flux densities at faces from discrete curl of A_phi\n        # Phi_r is located at (r-faces, theta-centers), size (Nr+1, Nth)\n        Phi_r = (A_phi_corners[:, 1:] - A_phi_corners[:, :-1]) / dth\n        # Phi_theta is located at (r-centers, theta-faces), size (Nr, Nth+1)\n        Phi_theta = - (A_phi_corners[1:, :] - A_phi_corners[:-1, :]) / dr\n\n        # Discrete divergence at cell centers, size (Nr, Nth)\n        divB_CT = (Phi_r[1:, :] - Phi_r[:-1, :]) / dr \\\n                + (Phi_theta[:, 1:] - Phi_theta[:, :-1]) / dth\n        \n        # Maximum absolute error for the CT method\n        E_ct = np.max(np.abs(divB_CT))\n\n        # ---- Naive Divergence Calculation ----\n\n        def sqrt_gamma(r, th, mass):\n            r_safe = np.maximum(r, 1e-15) # Avoid r=0 issues, though domain prevents it.\n            return r_safe**2 * np.sin(th) * np.sqrt(1.0 + 2.0 * mass / r_safe)\n\n        # sqrt(gamma) on r-faces grid (locations of Phi_r)\n        R_rf, TH_rf = np.meshgrid(r_faces, th_centers, indexing='ij')\n        sg_rf = sqrt_gamma(R_rf, TH_rf, M)\n\n        # sqrt(gamma) on theta-faces grid (locations of Phi_theta)\n        R_thf, TH_thf = np.meshgrid(r_centers, th_faces, indexing='ij')\n        sg_thf = sqrt_gamma(R_thf, TH_thf, M)\n\n        # Physical magnetic field components B at faces\n        Br_face = Phi_r / sg_rf\n        Bth_face = Phi_theta / sg_thf\n\n        # Average B fields to cell centers\n        Br_c = 0.5 * (Br_face[1:, :] + Br_face[:-1, :])\n        Bth_c = 0.5 * (Bth_face[:, 1:] + Bth_face[:, :-1])\n        \n        # Cell-centered fluxes for naive method\n        R_c, TH_c = np.meshgrid(r_centers, th_centers, indexing='ij')\n        sg_c = sqrt_gamma(R_c, TH_c, M)\n        \n        Fr_c = sg_c * Br_c\n        Fth_c = sg_c * Bth_c\n\n        # Derivatives of fluxes at interior cell centers using 2nd order centered stencil\n        # Interior indices i in [1, Nr-2] and j in [1, Nth-2]\n        d_dr_Fr = (Fr_c[2:, 1:-1] - Fr_c[:-2, 1:-1]) / (2 * dr)\n        d_dth_Fth = (Fth_c[1:-1, 2:] - Fth_c[1:-1, :-2]) / (2 * dth)\n\n        # Naive divergence at interior cells\n        divB_naive_interior = (d_dr_Fr + d_dth_Fth) / sg_c[1:-1, 1:-1]\n        \n        # RMS error for naive method\n        N_int = (Nr - 2) * (Nth - 2)\n        E_naive = np.sqrt(np.sum(divB_naive_interior**2) / N_int)\n\n        return E_ct, E_naive\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (48, 48),    # Case A\n        (96, 96),    # Case B\n        (192, 192),  # Case C\n    ]\n\n    results = []\n    for Nr, Nth in test_cases:\n        E_ct, E_naive = run_case(Nr, Nth)\n        results.extend([E_ct, E_naive])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.6e}' for x in results)}]\")\n\nsolve()\n```", "id": "3512085"}]}