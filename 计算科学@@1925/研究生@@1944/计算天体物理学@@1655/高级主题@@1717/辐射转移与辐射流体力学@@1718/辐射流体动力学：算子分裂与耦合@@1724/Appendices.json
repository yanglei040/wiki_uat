{"hands_on_practices": [{"introduction": "在辐射流体力学（RHD）中，物质与辐射之间的能量交换过程往往是数值上最“刚性”的环节，这意味着它发生在比流体动力学演化快得多的时间尺度上，因此必须采用隐式方法处理以保证数值稳定性。本实践聚焦于解决这一挑战的核心数值引擎：牛顿-拉弗森（Newton-Raphson）迭代法。通过为一个计算单元内的辐射能量密度和气体温度计算单步更新量，您将亲身体验支撑鲁棒耦合算法的线性化和矩阵求解过程 [@problem_id:3530860]。", "problem": "在算子分裂下的灰色辐射流体力学 (RHD) 中，单个计算网格内的刚性物质-辐射能量交换在一个时间步内被隐式推进。设耦合未知数为辐射能量密度 $E_{r}$ 和气体温度 $T$。在隐式源项求解的第 $k$ 次牛顿-拉夫逊 (NR) 迭代中，非线性残差向量 $\\mathbf{R}(E_{r},T)$ 及其雅可比矩阵 $\\mathbf{J}(E_{r},T)$ 已经在当前迭代值 $(E_{r}^{(k)},T^{(k)})$ 处组装完成。\n\n假设在某个特定的网格和迭代中，给定\n$$\n\\mathbf{R}\\big(E_{r}^{(k)},T^{(k)}\\big)\n=\n\\begin{pmatrix}\n2.0\\times 10^{10} \\\\\n-1.0\\times 10^{11}\n\\end{pmatrix}\n\\quad\\text{和}\\quad\n\\mathbf{J}\\big(E_{r}^{(k)},T^{(k)}\\big)\n=\n\\begin{pmatrix}\n101  & -3.024\\times 10^{6} \\\\\n-100 & 1.3024\\times 10^{7}\n\\end{pmatrix},\n$$\n当前迭代值为\n$$\nE_{r}^{(k)} = 1.0\\times 10^{12}, \\qquad T^{(k)} = 1.0\\times 10^{6}.\n$$\n此处，$\\mathbf{R}$ 的所有分量的单位为 $\\mathrm{erg}\\,\\mathrm{cm}^{-3}$，$\\mathbf{J}$ 的第一列的单位与 $\\partial \\mathbf{R}/\\partial E_{r}$ 一致，第二列的单位与 $\\partial \\mathbf{R}/\\partial T$ 一致。\n\n使用隐式源项方程的牛顿-拉夫逊线性化，计算一个牛顿步更新向量 $\\Delta \\mathbf{U} = \\big(\\Delta E_{r},\\,\\Delta T\\big)$，它将 $(E_{r}^{(k)},T^{(k)})$ 推进到 $(E_{r}^{(k+1)},T^{(k+1)}) = (E_{r}^{(k)},T^{(k)}) + \\Delta \\mathbf{U}$。报告两个分量 $\\Delta E_{r}$ 和 $\\Delta T$ 的值，四舍五入到四位有效数字。$\\Delta E_{r}$ 以 $\\mathrm{erg}\\,\\mathrm{cm}^{-3}$ 为单位表示，$\\Delta T$ 以 $\\mathrm{K}$ 为单位表示。\n\n然后，陈述适用于 RHD 中刚性源项耦合的数学上精确的收敛准则，该准则使用具有物理动机的缩放来同时控制残差和更新步长，并强制保持 $E_{r}^{(k+1)}$ 和 $T^{(k+1)}$ 的正值性。您的准则应该用范数来表述，并明确指出绝对和相对容差，但您不需要为这些容差指定数值。\n\n按照要求，将报告的 $\\Delta E_{r}$ 和 $\\Delta T$ 四舍五入到四位有效数字。", "solution": "牛顿-拉夫逊方法是一个迭代过程，用于寻找非线性方程组 $\\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$ 的根。给定一个迭代值 $\\mathbf{U}^{(k)}$，下一个迭代值 $\\mathbf{U}^{(k+1)}$ 通过求解在 $\\mathbf{U}^{(k)}$ 处对 $\\mathbf{F}$ 进行切线近似的线性系统得到。在隐式时间积分方案的背景下，需要归零的函数是残差 $\\mathbf{R}(\\mathbf{U}) = \\mathbf{0}$。更新步 $\\Delta \\mathbf{U} = \\mathbf{U}^{(k+1)} - \\mathbf{U}^{(k)}$ 通过求解以下线性系统得到：\n$$\n\\mathbf{J}(\\mathbf{U}^{(k)}) \\Delta \\mathbf{U} = -\\mathbf{R}(\\mathbf{U}^{(k)})\n$$\n其中 $\\mathbf{J}$ 是在 $\\mathbf{U}^{(k)}$ 处求值的 $\\mathbf{R}$ 的雅可比矩阵。状态向量为 $\\mathbf{U} = (E_r, T)^T$。\n\n我们被要求计算更新向量 $\\Delta \\mathbf{U} = (\\Delta E_r, \\Delta T)^T$。\n该线性系统为：\n$$\n\\begin{pmatrix}\n101  & -3.024\\times 10^{6} \\\\\n-100 & 1.3024\\times 10^{7}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\Delta E_{r} \\\\\n\\Delta T\n\\end{pmatrix}\n=\n-\n\\begin{pmatrix}\n2.0\\times 10^{10} \\\\\n-1.0\\times 10^{11}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-2.0\\times 10^{10} \\\\\n1.0\\times 10^{11}\n\\end{pmatrix}\n$$\n为了求解这个 $2 \\times 2$ 系统，我们可以使用矩阵求逆的公式。对于一个矩阵 $\\mathbf{A} = \\begin{pmatrix} a  & b \\\\ c  & d \\end{pmatrix}$，其逆矩阵为 $\\mathbf{A}^{-1} = \\frac{1}{\\det(\\mathbf{A})} \\begin{pmatrix} d  & -b \\\\ -c  & a \\end{pmatrix}$。\n首先，我们计算雅可比矩阵 $\\mathbf{J}$ 的行列式：\n$$\n\\det(\\mathbf{J}) = (101)(1.3024\\times 10^{7}) - (-3.024\\times 10^{6})(-100)\n$$\n$$\n\\det(\\mathbf{J}) = 1.315424\\times 10^{9} - 3.024\\times 10^{8}\n$$\n$$\n\\det(\\mathbf{J}) = 13.15424\\times 10^{8} - 3.024\\times 10^{8} = 10.13024\\times 10^{8} = 1.013024\\times 10^{9}\n$$\n由于行列式非零，该矩阵是可逆的，因此 $\\Delta\\mathbf{U}$ 存在唯一解。\n现在我们可以求解更新向量 $\\Delta \\mathbf{U} = \\mathbf{J}^{-1} (-\\mathbf{R})$：\n$$\n\\begin{pmatrix}\n\\Delta E_{r} \\\\\n\\Delta T\n\\end{pmatrix}\n=\n\\frac{1}{1.013024\\times 10^{9}}\n\\begin{pmatrix}\n1.3024\\times 10^{7}  & 3.024\\times 10^{6} \\\\\n100  & 101\n\\end{pmatrix}\n\\begin{pmatrix}\n-2.0\\times 10^{10} \\\\\n1.0\\times 10^{11}\n\\end{pmatrix}\n$$\n我们分别计算分量 $\\Delta E_r$ 和 $\\Delta T$。\n对于 $\\Delta E_r$：\n$$\n\\Delta E_r = \\frac{ (1.3024\\times 10^{7})(-2.0\\times 10^{10}) + (3.024\\times 10^{6})(1.0\\times 10^{11}) }{1.013024\\times 10^{9}}\n$$\n$$\n\\Delta E_r = \\frac{ -2.6048\\times 10^{17} + 3.024\\times 10^{17} }{1.013024\\times 10^{9}}\n$$\n$$\n\\Delta E_r = \\frac{ 0.4192\\times 10^{17} }{1.013024\\times 10^{9}} = \\frac{ 4.192\\times 10^{16} }{1.013024\\times 10^{9}} \\approx 4.13813 \\times 10^7\n$$\n四舍五入到四位有效数字，我们得到 $\\Delta E_r \\approx 4.138 \\times 10^{7} \\, \\mathrm{erg}\\,\\mathrm{cm}^{-3}$。\n\n对于 $\\Delta T$：\n$$\n\\Delta T = \\frac{ (100)(-2.0\\times 10^{10}) + (101)(1.0\\times 10^{11}) }{1.013024\\times 10^{9}}\n$$\n$$\n\\Delta T = \\frac{ -2.0\\times 10^{12} + 10.1\\times 10^{12} }{1.013024\\times 10^{9}}\n$$\n$$\n\\Delta T = \\frac{ 8.1\\times 10^{12} }{1.013024\\times 10^{9}} \\approx 7995.89 \\, \\mathrm{K}\n$$\n四舍五入到四位有效数字，我们得到 $\\Delta T \\approx 7996 \\, \\mathrm{K}$，或 $7.996 \\times 10^{3} \\, \\mathrm{K}$。\n\n问题的第二部分要求给出适用于此背景的数学上精确的收敛准则。对于一个刚性的耦合系统，收敛准则必须是鲁棒的。它们通常涉及监测残差的大小（方程被满足的程度）和更新步的大小（解仍在变化的程度）。具有物理动机的缩放至关重要，因为变量（$E_r$ 和 $T$）具有不同的单位，并且可能跨越多个数量级。正值性是一个关键的物理约束。\n\n令 $\\mathbf{U}^{(k)} = (E_r^{(k)}, T^{(k)})^T$ 为第 $k$ 次迭代时的状态，$\\Delta\\mathbf{U}^{(k)} = \\mathbf{U}^{(k+1)} - \\mathbf{U}^{(k)}$ 为更新量。令 $\\epsilon_{r}$ 为用户定义的相对容差，$\\epsilon_{abs,E_r}$、$\\epsilon_{abs,T}$ 和 $\\epsilon_{abs,R}$ 为用户定义的绝对容差。当以下条件同时满足时，迭代过程被认为收敛：\n\n1.  **更新步长准则：** 每个变量的变化与其值相比很小。这表明解已经稳定。混合的相对-绝对误差准则是鲁棒的：\n    $$\n    |\\Delta E_r^{(k)}| \\le \\epsilon_{r} E_r^{(k+1)} + \\epsilon_{abs,E_r}\n    $$\n    $$\n    |\\Delta T^{(k)}| \\le \\epsilon_{r} T^{(k+1)} + \\epsilon_{abs,T}\n    $$\n    对解向量的每个分量都进行此项检查。绝对容差项可防止当解的某个分量接近零时迭代停滞。\n\n2.  **残差大小准则：** 残差向量 $\\mathbf{R}(\\mathbf{U}^{(k+1)})$ 接近于零，表明新状态 $\\mathbf{U}^{(k+1)}$ 近似地求解了非线性方程。由于 $\\mathbf{R}$ 的分量（例如 $R_{E_r}$ 和 $R_T$）具有能量密度的单位，它们应该与网格中的一个特征能量密度进行比较。一个合适的尺度是辐射能量密度 $E_r$ 或辐射与气体能量密度之和。将 $E_r$ 作为两者的尺度是一个常见的简化方法。\n    $$\n    |R_{E_r}(\\mathbf{U}^{(k+1)})| \\le \\epsilon_{r} E_r^{(k+1)} + \\epsilon_{abs,R}\n    $$\n    $$\n    |R_T(\\mathbf{U}^{(k+1)})| \\le \\epsilon_{r} E_r^{(k+1)} + \\epsilon_{abs,R}\n    $$\n    对更新准则和残差准则使用相同的相对容差 $\\epsilon_r$ 是常见做法，但也可以使用不同的容差。\n\n3.  **正值性强制：** 物理量 $E_r$ 和 $T$ 必须保持为正。牛顿-拉夫逊步可能会过冲并产生负的、非物理的值。这不是一个收敛测试，而是一个必须在每次迭代中强制执行的约束。这通常通过阻尼牛顿步来实现。如果完整的牛顿步 $\\Delta\\mathbf{U}_{NR} = -\\mathbf{J}^{-1}\\mathbf{R}$ 导致负状态，即 $E_r^{(k)} + \\Delta E_{r,NR} \\le 0$ 或 $T^{(k)} + \\Delta T_{NR} \\le 0$，则更新量会乘以一个因子 $\\alpha \\in (0, 1)$，使得 $\\Delta \\mathbf{U}^{(k)} = \\alpha \\Delta \\mathbf{U}_{NR}$。因子 $\\alpha$ 被选为能在所有分量上保持正值的最大值，通常带有一个小的安全裕度：\n    $$\n    E_r^{(k+1)} = E_r^{(k)} + \\Delta E_r^{(k)} > 0\n    $$\n    $$\n    T^{(k+1)} = T^{(k)} + \\Delta T^{(k)} > 0\n    $$\n    一个收敛的解必须内在地满足这种正值性。只有对于物理上有效的状态，才能宣布收敛。", "answer": "$$\n\\boxed{\\begin{pmatrix} 4.138 \\times 10^{7} & 7.996 \\times 10^{3} \\end{pmatrix}}\n$$", "id": "3530860"}, {"introduction": "虽然隐式方法对于稳定性至关重要，但简化的线性近似（尤其是在使用较大时间步长时）可能会导致非物理的结果，例如温度变为负值。本练习 [@problem_id:3530807] 旨在从分析层面探讨这种被称为“冷却灾难”的失效模式。您将推导出现这种失效的条件，并设计一个保证正定性的限制器——这是构建稳健、可靠的模拟程序的一项关键技能。", "problem": "考虑一个单区辐射流体力学（RHD）的算子分裂更新，其中流体力学平流步已经完成，在时间 $t^{n}$ 产生了一个临时温度 $T^{n}$。在随后的源项步中，单位质量内能 $e$ 在一个时间增量 $\\Delta t$ 内仅因光学薄辐射冷却而演化，该冷却过程由温度的幂律定律建模。假设存在以下物理上标准的关系式和闭合关系：\n- 单位质量内能通过 $e = c_{v}\\,T$ 与温度成线性正比，其中 $c_{v}$ 是一个严格为正的定容比热常数。\n- 单位质量的冷却源项为 $S(T) = C\\,T^{\\alpha}$，其中 $C>0$ 且指数 $\\alpha$ 为实数，因此在源项步中有 $\\mathrm{d}e/\\mathrm{d}t = -S(T)$。\n- 在源项步中，密度和组分保持不变（这与算子分裂方法一致），因此 $c_{v}$ 和 $C$ 是常数。\n\n为避免高代价的非线性求解，许多实际应用的代码使用隐式后向欧拉离散方法，并对 $S(T)$ 在 $T^{n}$ 处进行一阶泰勒线性化来更新源项步：\n$$\nc_{v}\\,T^{n+1} = c_{v}\\,T^{n} - \\Delta t\\,\\big(S(T^{n}) + S'(T^{n})\\,(T^{n+1}-T^{n})\\big),\n$$\n其中 $S'(T)$ 表示 $S(T)$ 对 $T$ 的导数。此更新以分裂方式使用：首先是流体力学步，然后是上述源项步。\n\n从基本能量演化定律和给定的模型假设出发，完成以下任务：\n1. 用 $\\alpha$、$c_{v}$、$C$、$\\Delta t$ 和 $T^{n}$ 来确定线性化隐式源项步在何种情况下会产生负的更新温度 $T^{n+1} < 0$（即“冷却灾难”过冲），并解释此失效模式的物理和数学根源。\n2. 提出一个保正限制器，它仅重新缩放源项步内的冷却减量，与分裂更新兼容（即不改变流体力学阶段），并在步长足够小时恢复为未经修改的隐式更新。具体来说，定义一个标量限制器因子 $\\varphi \\in (0,1]$，应用于冷却减量，使得 $T^{n+1}_{\\mathrm{lim}} = T^{n} - \\varphi\\,\\delta T$，其中 $\\delta T$ 是由线性化隐式源项步预测的温度下降。推导出一个关于 $\\alpha$、$c_{v}$、$C$、$\\Delta t$ 和 $T^{n}$ 的 $\\varphi$ 的闭式表达式，以保证 $T^{n+1}_{\\mathrm{lim}} \\ge 0$，同时在 $\\Delta t \\to 0$ 时保持一阶相容性。\n\n你的最终答案必须仅为限制器因子 $\\varphi(\\alpha,c_{v},C,\\Delta t,T^{n})$ 的单一闭式解析表达式。最终的方框结果中不要包含任何不等式或方程。不需要进行数值计算。", "solution": "### 步骤 1：分析负温度过冲的条件\n\n出发点是给定的线性化隐式更新方程：\n$$\nc_{v}\\,T^{n+1} = c_{v}\\,T^{n} - \\Delta t\\,\\big(S(T^{n}) + S'(T^{n})\\,(T^{n+1}-T^{n})\\big)\n$$\n这是一个关于未知更新温度 $T^{n+1}$ 的线性方程。我们首先解出 $T^{n+1}$ 以分析其性质。\n$$\nc_{v}\\,T^{n+1} = c_{v}\\,T^{n} - \\Delta t\\,S(T^{n}) - \\Delta t\\,S'(T^{n})\\,T^{n+1} + \\Delta t\\,S'(T^{n})\\,T^{n}\n$$\n将包含 $T^{n+1}$ 的项收集到左侧：\n$$\nT^{n+1}\\,(c_{v} + \\Delta t\\,S'(T^{n})) = T^{n}\\,(c_{v} + \\Delta t\\,S'(T^{n})) - \\Delta t\\,S(T^{n})\n$$\n解出 $T^{n+1}$：\n$$\nT^{n+1} = T^{n} - \\frac{\\Delta t\\,S(T^{n})}{c_{v} + \\Delta t\\,S'(T^{n})}\n$$\n问题描述的是冷却过程，因此我们预期 $T^{n+1} \\le T^{n}$。“冷却灾难”发生在更新后的温度变为非物理的负值时，即 $T^{n+1} < 0$。使用上面的表达式，这个条件是：\n$$\nT^{n} - \\frac{\\Delta t\\,S(T^{n})}{c_{v} + \\Delta t\\,S'(T^{n})} < 0 \\implies T^{n} < \\frac{\\Delta t\\,S(T^{n})}{c_{v} + \\Delta t\\,S'(T^{n})}\n$$\n假设分母为正（这是该方法稳定性的要求，可防止冷却导致温度升高），我们可以将不等式两边同乘以它：\n$$\nT^{n}\\,(c_{v} + \\Delta t\\,S'(T^{n})) < \\Delta t\\,S(T^{n})\n$$\n$$\nc_{v}\\,T^{n} + \\Delta t\\,T^{n}\\,S'(T^{n}) < \\Delta t\\,S(T^{n})\n$$\n$$\nc_{v}\\,T^{n} < \\Delta t\\,(S(T^{n}) - T^{n}\\,S'(T^{n}))\n$$\n现在，我们代入 $S(T)$ 及其导数 $S'(T)$ 的给定形式：\n$S(T^{n}) = C\\,(T^{n})^{\\alpha}$\n$S'(T^{n}) = \\frac{\\mathrm{d}}{\\mathrm{d}T}\\left(C\\,T^{\\alpha}\\right)\\bigg|_{T=T^{n}} = \\alpha\\,C\\,(T^{n})^{\\alpha-1}$\n括号中的项变为：\n$$\nS(T^{n}) - T^{n}\\,S'(T^{n}) = C\\,(T^{n})^{\\alpha} - T^{n}\\,(\\alpha\\,C\\,(T^{n})^{\\alpha-1}) = C\\,(T^{n})^{\\alpha} - \\alpha\\,C\\,(T^{n})^{\\alpha} = C\\,(T^{n})^{\\alpha}\\,(1-\\alpha)\n$$\n将此代回不等式，过冲的条件是：\n$$\nc_{v}\\,T^{n} < \\Delta t\\,C\\,(T^{n})^{\\alpha}\\,(1-\\alpha)\n$$\n为使此不等式可能成立，其右侧必须为正，因为左侧是严格为正的（$c_{v}>0, T^{n}>0$）。由于 $\\Delta t>0$、$C>0$ 和 $(T^{n})^{\\alpha}>0$，这要求 $(1-\\alpha) > 0$，即 $\\alpha < 1$。如果 $\\alpha \\ge 1$，则右侧为非正数，不等式永远不能满足，意味着不会发生过冲。\n\n因此，线性化隐式格式产生负温度的条件是 $\\alpha < 1$ 并且时间步长 $\\Delta t$ 足够大：\n$$\n\\Delta t > \\frac{c_{v}\\,T^{n}}{C\\,(T^{n})^{\\alpha}\\,(1-\\alpha)} = \\frac{c_{v}}{C\\,(T^{n})^{\\alpha-1}\\,(1-\\alpha)}\n$$\n**物理和数学根源：**\n失败源于使用一阶泰勒级数在可能很大的区间上近似一个非线性函数。线性化更新为 $c_{v}(T^{n+1} - T^{n})/\\Delta t = -S_{\\mathrm{lin}}(T^{n+1})$，其中 $S_{\\mathrm{lin}}(T) = S(T^n) + S'(T^n)(T-T^n)$。这种近似仅在 $T^{n+1}$ 非常接近 $T^n$ 时才准确。当使用大的时间步长 $\\Delta t$ 时，得到的 $T^{n+1}$ 可能远非 $T^n$。\n\n对于 $\\alpha < 1$ 的冷却定律，函数 $S(T)$ 随 $T$ 亚线性增长或减少。具体来说，对于 $0 < \\alpha < 1$，冷却函数 $S(T)$ 是凹函数（$S''(T) = \\alpha(\\alpha-1)CT^{\\alpha-2} < 0$）。其切线 $S_{\\mathrm{lin}}(T)$ 位于 $S(T)$ 曲线的上方，这意味着线性化模型高估了真实的冷却率。对于 $\\alpha \\leq 0$，函数是凸函数，但随着 $T \\to 0$，冷却率非常急剧地增加。在 $\\alpha < 1$ 的任何一种情况下，基于 $T^n$ 状态外推冷却的线性模型，都未能考虑到随着温度下降冷却会减弱这一事实。这种对 $\\Delta t$ 时间内积分冷却效应的高估，可能消耗掉比物理上可用的内能（$c_v T^n$）更多的能量，从而导致 $T^{n+1} < 0$。\n\n### 步骤 2：保正限制器的推导\n\n问题提出了一个形式为 $T^{n+1}_{\\mathrm{lim}} = T^{n} - \\varphi\\,\\delta T$ 的受限更新，其中 $\\delta T$ 是原始不受限格式的温度下降量。根据我们在第 1 部分的分析，我们确定：\n$$\n\\delta T = T^{n} - T^{n+1} = \\frac{\\Delta t\\,S(T^{n})}{c_{v} + \\Delta t\\,S'(T^{n})}\n$$\n我们要求受限温度为非负：\n$$\nT^{n+1}_{\\mathrm{lim}} \\ge 0 \\implies T^{n} - \\varphi\\,\\delta T \\ge 0\n$$\n假设发生冷却，则 $\\delta T > 0$。因此，对限制器 $\\varphi$ 的条件是：\n$$\n\\varphi \\le \\frac{T^{n}}{\\delta T}\n$$\n此外，限制器的设计必须能在原始格式已经安全时恢复到原始格式。对应于 $\\varphi = 1$ 的原始格式，如果 $T^{n+1} \\ge 0$ 则是安全的，这等价于 $\\delta T \\le T^{n}$。\n一个满足所有要求——正性、$\\varphi \\in (0,1]$ 以及对于小 $\\Delta t$ 的相容性——的限制器由下式给出：\n$$\n\\varphi = \\min\\left(1, \\frac{T^{n}}{\\delta T}\\right)\n$$\n这个选择保证了如果步长是安全的（$T^{n}/\\delta T \\ge 1$），我们使用 $\\varphi=1$（原始方法）。如果步长是不安全的（$T^{n}/\\delta T < 1$），我们将 $\\varphi$ 减小到恰好能使最终温度为非负所需的值（在最极端的情况下，它会使 $T^{n+1}_{\\mathrm{lim}} = 0$）。\n\n为了得到最终表达式，我们代入 $\\delta T$、$S(T^n)$ 和 $S'(T^n)$ 的公式：\n$$\n\\frac{T^{n}}{\\delta T} = T^{n} \\left( \\frac{c_{v} + \\Delta t\\,S'(T^{n})}{\\Delta t\\,S(T^{n})} \\right) = \\frac{c_{v}\\,T^{n} + \\Delta t\\,T^{n}\\,S'(T^{n})}{\\Delta t\\,S(T^{n})}\n$$\n代入 $S(T^{n}) = C\\,(T^{n})^{\\alpha}$ 和 $S'(T^{n}) = \\alpha\\,C\\,(T^{n})^{\\alpha-1}$：\n$$\n\\frac{T^{n}}{\\delta T} = \\frac{c_{v}\\,T^{n} + \\Delta t\\,T^{n}\\,\\left(\\alpha\\,C\\,(T^{n})^{\\alpha-1}\\right)}{\\Delta t\\,C\\,(T^{n})^{\\alpha}} = \\frac{c_{v}\\,T^{n} + \\Delta t\\,\\alpha\\,C\\,(T^{n})^{\\alpha}}{\\Delta t\\,C\\,(T^{n})^{\\alpha}}\n$$\n将分数拆分为两项：\n$$\n\\frac{T^{n}}{\\delta T} = \\frac{c_{v}\\,T^{n}}{\\Delta t\\,C\\,(T^{n})^{\\alpha}} + \\frac{\\Delta t\\,\\alpha\\,C\\,(T^{n})^{\\alpha}}{\\Delta t\\,C\\,(T^{n})^{\\alpha}} = \\frac{c_{v}}{\\Delta t\\,C\\,(T^{n})^{\\alpha-1}} + \\alpha\n$$\n因此，限制器 $\\varphi$ 的最终表达式是：\n$$\n\\varphi = \\min\\left(1, \\alpha + \\frac{c_{v}}{\\Delta t\\,C\\,(T^{n})^{\\alpha-1}}\\right)\n$$\n该表达式仅依赖于所要求的参数，并满足所有陈述的条件。当 $\\Delta t \\to 0$ 时，$\\min$ 函数中的第二项趋于无穷大，因此 $\\varphi \\to \\min(1, \\infty) = 1$，这保证了该方法能恢复到未经修改的一阶隐式格式，满足相容性的要求。", "answer": "$$\\boxed{\\min\\left(1, \\alpha + \\frac{c_{v}}{\\Delta t\\,C\\,(T^{n})^{\\alpha-1}}\\right)}$$", "id": "3530807"}, {"introduction": "算符分裂之所以会引入误差，其根本原因在于所分离的物理过程（例如，流体动力学与辐射耦合）是不可交换的，这意味着算符的应用顺序会影响最终结果。本实践 [@problem_id:3530870] 提供了一个具体的编程练习来探究这一基本问题。通过比较“气体优先”与“辐射优先”两种分裂方案，您将量化一个关键热力学量（熵）的差异，并识别出分裂误差变得不可忽略的物理区间。", "problem": "考虑一个单一均匀的计算单元，它代表球形膨胀冲击波内的一个局部区域，在该区域中，压缩气体动力学和辐射冷却都十分重要。在无量纲单位制下进行计算，其中光速、辐射常数和定容比热均为1，即取 $c=1$，$a_{\\mathrm{r}}=1$，$c_{\\mathrm{v}}=1$。假设一种绝热指数为 $\\gamma$ 的理想气体，其压力为 $p=(\\gamma-1)e$，其中 $e$ 是气体內能密度，比熵（单位质量的熵）为\n$$\ns(\\rho,e)=c_{\\mathrm{v}}\\ln\\left(\\frac{T}{\\rho^{\\gamma-1}}\\right)=\\ln e-\\gamma \\ln \\rho,\n$$\n在这些无量纲单位中，使用了 $T=e/(\\rho c_{\\mathrm{v}})=e/\\rho$。忽略辐射通量和空间输运；仅在局部热动平衡（LTE）耦合下，模拟局部压缩功和局部物质-辐射能量交换。\n\n从以下在共动坐标系中适用于一个在时间步内速度散度恒定的均匀单元的基本且经过充分检验的定律出发：\n- 在均匀速度散度 $\\theta=\\nabla\\cdot \\mathbf{u}$ 下的质量守恒：$\\frac{d\\rho}{dt}=-\\rho\\,\\theta$。\n- 压缩功作用下的气体內能密度（无外部加热）：$\\frac{de}{dt}=-(e+p)\\,\\theta=-\\gamma e\\,\\theta$。\n- 在各向同性辐射压力 $P_{\\mathrm{r}}=\\frac{1}{3}E_{\\mathrm{r}}$ 下，压缩功作用下的辐射能量密度：$\\frac{dE_{\\mathrm{r}}}{dt}=-\\frac{4}{3}E_{\\mathrm{r}}\\,\\theta$。\n- 灰体物质-辐射能量交换（LTE），其中普朗克平均不透明度为 $\\kappa_{\\mathrm{P}}$ 且 $T=e/\\rho$：\n$$\n\\frac{de}{dt}=-c\\,\\kappa_{\\mathrm{P}}\\rho\\left(a_{\\mathrm{r}} T^{4}-E_{\\mathrm{r}}\\right),\\qquad\n\\frac{dE_{\\mathrm{r}}}{dt}=+c\\,\\kappa_{\\mathrm{P}}\\rho\\left(a_{\\mathrm{r}} T^{4}-E_{\\mathrm{r}}\\right).\n$$\n\n在单个时长为 $\\Delta t$ 的时间步上采用算子分裂法，其中压缩（流体动力学）算子和物质-辐射耦合算子按以下两种顺序之一，在整个 $\\Delta t$ 上依次施加：\n- 气体优先（GF）：首先施加压缩更新（对气体和辐射），然后在压缩后的密度下施加物质-辐射耦合更新。\n- 辐射优先（RF）：首先施加物质-辐射耦合更新（在初始密度下），然后施加对气体和辐射的压缩更新。\n\n假设在时间步内散度 $\\theta$ 恒定，并定义无量纲压缩参数 $\\kappa\\equiv -\\theta\\,\\Delta t$。压缩对应 $\\kappa>0$。定义无量纲耦合强度 $\\chi\\equiv c\\,\\kappa_{\\mathrm{P}}\\,\\Delta t$，因此，在耦合子步中，刚度因子为 $K=\\chi\\,\\rho$，且在该子步中 $\\rho$ 保持不变。对耦合子步使用后向欧拉隐式更新，以保证 $e$ 和 $E_{\\mathrm{r}}$ 之间的能量守恒并保持正性。\n\n你的任务：\n- 在恒定 $\\theta$ 的条件下，推导在时长 $\\Delta t$ 内 $\\rho$、$e$ 和 $E_{\\mathrm{r}}$ 的压缩更新的闭式表达式。\n- 为耦合子步建立后向欧拉隐式方程组，并在给定耦合子步期间守恒的总能量密度 $E_{\\mathrm{tot}}\\equiv e^{n}+E_{\\mathrm{r}}^{n}$ 以及在该子步中使用的恒定密度的情况下，将其简化为关于 $e^{n+1}$ 的一维非线性方程。为二分法求解器指定一个稳健的区间。\n- 实现两种分裂顺序（GF 和 RF），计算步骤结束后的比熵 $s_{\\mathrm{GF}}$ 和 $s_{\\mathrm{RF}}$，然后计算相对于初始状态的熵变 $\\Delta s_{\\mathrm{GF}}=s_{\\mathrm{GF}}-s_{0}$ 和 $\\Delta s_{\\mathrm{RF}}=s_{\\mathrm{RF}}-s_{0}$，其中 $s_{0}=\\ln e_{0}-\\gamma \\ln \\rho_{0}$。\n- 使用归一化度量来量化顺序依赖性\n$$\n\\mathcal{M}\\equiv \\frac{\\left|\\Delta s_{\\mathrm{GF}}-\\Delta s_{\\mathrm{RF}}\\right|}{\\left|\\Delta s_{\\mathrm{GF}}\\right|+\\left|\\Delta s_{\\mathrm{RF}}\\right|+\\varepsilon},\n$$\n其中 $\\varepsilon=10^{-14}$ 以避免除以零。定义当 $\\mathcal{M}\\ge 0.5$ 时，顺序依赖性为“单位量级”。所有量均为无量纲。\n\n除非另有说明，所有测试均使用以下固定参数：$\\gamma=\\frac{5}{3}$，$\\Delta t=1$，$\\rho_{0}=1$，$e_{0}=1$。对于每个测试，使用指定的比率 $r=E_{\\mathrm{r},0}/e_{0}$ 来设置初始辐射能量密度 $E_{\\mathrm{r},0}=r\\,e_{0}$。在一个测试用例中，对两种分裂顺序使用相同的 $\\kappa$ 和 $\\chi$。\n\n测试套件：\n- 用例 1：$(r,\\chi,\\kappa)=\\left(10^{-6},\\,0.5,\\,1\\right)$。\n- 用例 2：$(r,\\chi,\\kappa)=\\left(10^{-1},\\,0.5,\\,1\\right)$。\n- 用例 3：$(r,\\chi,\\kappa)=\\left(1,\\,0.5,\\,1\\right)$。\n- 用例 4：$(r,\\chi,\\kappa)=\\left(10,\\,0.5,\\,1\\right)$。\n- 用例 5：$(r,\\chi,\\kappa)=\\left(1,\\,10^{-2},\\,1\\right)$。\n- 用例 6：$(r,\\chi,\\kappa)=\\left(1,\\,10,\\,1\\right)$。\n- 用例 7：$(r,\\chi,\\kappa)=\\left(1,\\,0.5,\\,0\\right)$。\n- 用例 8：$(r,\\chi,\\kappa)=\\left(0,\\,0.5,\\,1\\right)$。\n- 用例 9：$(r,\\chi,\\kappa)=\\left(10^{2},\\,0.5,\\,1\\right)$。\n\n你的程序必须：\n- 忠实地实现上述模型。\n- 对每个测试用例，计算 $\\mathcal{M}$ 和指示符 $I$（定义为当 $\\mathcal{M}\\ge 0.5$ 时 $I=1$，否则 $I=0$）。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按顺序交替显示 9 个用例的 $\\mathcal{M}$（四舍五入到六位小数）和 $I$：例如，$\\left[\\mathcal{M}_{1},I_{1},\\mathcal{M}_{2},I_{2},\\ldots,\\mathcal{M}_{9},I_{9}\\right]$。\n\n所有输出均为无量纲（无单位）。不使用角度。不使用百分比；任何分数量必须以小数形式表示。", "solution": "我们从均匀速度散度下的质量、气体內能密度和辐射能量密度的演化开始。质量守恒方程 $\\frac{d\\rho}{dt}=-\\rho\\,\\theta$ 在恒定 $\\theta$ 的条件下，在时长为 $\\Delta t$ 的时间步上精确积分得到\n$$\n\\rho^{n+1}=\\rho^{n}\\,\\exp\\left(-\\theta\\,\\Delta t\\right).\n$$\n定义 $\\kappa\\equiv -\\theta\\,\\Delta t$，因此压缩对应 $\\kappa>0$。于是\n$$\n\\rho^{n+1}=\\rho^{n}\\,\\exp\\left(\\kappa\\right).\n$$\n\n对于气体內能密度 $e$，均匀单元中无源项的压缩功遵循 $\\frac{de}{dt}=-(e+p)\\,\\theta= -\\gamma e\\,\\theta$ （使用 $p=(\\gamma-1)e$）。在恒定 $\\theta$ 下，这积分得到\n$$\ne^{n+1}=e^{n}\\,\\exp\\left(-\\gamma\\,\\theta\\,\\Delta t\\right)=e^{n}\\,\\exp\\left(\\gamma\\,\\kappa\\right).\n$$\n\n辐射能量密度 $E_{\\mathrm{r}}$ 在各向同性辐射压力 $P_{\\mathrm{r}}=\\frac{1}{3}E_{\\mathrm{r}}$ 的压缩功作用下演化，得到 $\\frac{dE_{\\mathrm{r}}}{dt}=-\\left(E_{\\mathrm{r}}+P_{\\mathrm{r}}\\right)\\theta=-\\frac{4}{3}E_{\\mathrm{r}}\\theta$。在恒定 $\\theta$ 下，\n$$\nE_{\\mathrm{r}}^{n+1}=E_{\\mathrm{r}}^{n}\\,\\exp\\left(-\\frac{4}{3}\\,\\theta\\,\\Delta t\\right)=E_{\\mathrm{r}}^{n}\\,\\exp\\left(\\frac{4}{3}\\,\\kappa\\right).\n$$\n\n这三个精确关系定义了分裂步骤的压缩（流体动力学）算子。\n\n对于灰体介质中局部热动平衡（LTE）下的物质-辐射能量交换，在普朗克平均不透明度为 $\\kappa_{\\mathrm{P}}$ 且无量纲单位制 $c=1$，$a_{\\mathrm{r}}=1$，$c_{\\mathrm{v}}=1$ 下，交换项为\n$$\n\\frac{de}{dt}=-K\\left(T^{4}-E_{\\mathrm{r}}\\right),\\qquad \\frac{dE_{\\mathrm{r}}}{dt}=+K\\left(T^{4}-E_{\\mathrm{r}}\\right),\n$$\n其中 $K=c\\,\\kappa_{\\mathrm{P}}\\,\\rho=\\chi\\,\\rho$ 在耦合子步中成立，且 $T=e/\\rho$。在 $\\Delta t$ 上的后向欧拉隐式更新强制执行以下离散系统\n\\begin{align*}\ne^{n+1}=e^{n}-K\\,\\Delta t\\left(\\left(\\frac{e^{n+1}}{\\rho}\\right)^{4}-E_{\\mathrm{r}}^{n+1}\\right),\\\\\nE_{\\mathrm{r}}^{n+1}=E_{\\mathrm{r}}^{n}+K\\,\\Delta t\\left(\\left(\\frac{e^{n+1}}{\\rho}\\right)^{4}-E_{\\mathrm{r}}^{n+1}\\right).\n\\end{align*}\n将这两个方程相加表明，后向欧拉离散化保持了总能量密度守恒，\n$$\ne^{n+1}+E_{\\mathrm{r}}^{n+1}=e^{n}+E_{\\mathrm{r}}^{n}\\equiv E_{\\mathrm{tot}}.\n$$\n因此 $E_{\\mathrm{r}}^{n+1}=E_{\\mathrm{tot}}-e^{n+1}$。将其代入第一个方程并使用 $\\Delta t=1$ 可得到一个关于 $e^{n+1}$ 的单非线性标量方程，\n$$\ne^{n+1}=e^{n}-K\\left(\\left(\\frac{e^{n+1}}{\\rho}\\right)^{4}-\\left(E_{\\mathrm{tot}}-e^{n+1}\\right)\\right).\n$$\n整理后得到一个关于 $e^{n+1}$ 的四次多项式：\n$$\n(1+K)\\,e^{n+1}+K\\,\\frac{(e^{n+1})^{4}}{\\rho^{4}}=e^{n}+K\\,E_{\\mathrm{tot}}.\n$$\n定义\n$$\n\\alpha\\equiv \\frac{K}{\\rho^{4}},\\qquad \\beta\\equiv e^{n}+K\\,E_{\\mathrm{tot}},\n$$\n于是方程变为\n$$\nf(e^{n+1})\\equiv (1+K)\\,e^{n+1}+\\alpha\\,(e^{n+1})^{4}-\\beta=0.\n$$\n因为 $e^{n+1}\\ge 0$ 且 $E_{\\mathrm{r}}^{n+1}=E_{\\mathrm{tot}}-e^{n+1}\\ge 0$，物理上允许的解满足 $0\\le e^{n+1}\\le E_{\\mathrm{tot}}$。在此区间内，\n$$\nf(0)=-\\beta < 0,\\qquad f(E_{\\mathrm{tot}})=(1+K)\\,E_{\\mathrm{tot}}+\\alpha\\,E_{\\mathrm{tot}}^{4}-\\beta=E_{\\mathrm{tot}}-e^{n}\\;+\\;\\alpha\\,E_{\\mathrm{tot}}^{4}\\;\\ge\\;0,\n$$\n因此存在唯一根，且位于区间 $\\left[0,E_{\\mathrm{tot}}\\right]$ 内。因此，可以使用稳健的二分法求解 $e^{n+1}$，之后可得 $E_{\\mathrm{r}}^{n+1}=E_{\\mathrm{tot}}-e^{n+1}$。\n\n一个时间步上的算子分裂序列：\n- 气体优先（GF）：使用 $\\kappa$ 施加压缩算子得到 $\\rho^{\\star}=\\rho^{n}e^{\\kappa}$，$e^{\\star}=e^{n}e^{\\gamma\\kappa}$，$E_{\\mathrm{r}}^{\\star}=E_{\\mathrm{r}}^{n}e^{\\frac{4}{3}\\kappa}$。然后在密度 $\\rho^{\\star}$ 下，以刚度 $K=\\chi\\,\\rho^{\\star}$ 对 $(e^{\\star},E_{\\mathrm{r}}^{\\star})$ 施加耦合算子，产生 $(e^{n+1},E_{\\mathrm{r}}^{n+1})$ 且 $\\rho^{n+1}=\\rho^{\\star}$。\n- 辐射优先（RF）：在初始密度 $\\rho^{n}$ 下，以刚度 $K=\\chi\\,\\rho^{n}$ 对 $(e^{n},E_{\\mathrm{r}}^{n})$ 施加耦合算子，产生 $(\\tilde e,\\tilde E_{\\mathrm{r}})$ 且 $\\rho$ 保持不变。然后使用 $\\kappa$ 施加压缩算子得到 $e^{n+1}=\\tilde e\\,e^{\\gamma\\kappa}$，$E_{\\mathrm{r}}^{n+1}=\\tilde E_{\\mathrm{r}}\\,e^{\\frac{4}{3}\\kappa}$，以及 $\\rho^{n+1}=\\rho^{n}e^{\\kappa}$。\n\n比熵与顺序依赖性度量：\n在这些无量纲单位下，比熵为 $s(\\rho,e)=\\ln e-\\gamma \\ln \\rho$，且 $s_{0}=\\ln e_{0}-\\gamma \\ln \\rho_{0}$，则熵变为 $\\Delta s_{\\mathrm{GF}}=s(\\rho_{\\mathrm{GF}},e_{\\mathrm{GF}})-s_{0}$ 和 $\\Delta s_{\\mathrm{RF}}=s(\\rho_{\\mathrm{RF}},e_{\\mathrm{RF}})-s_{0}$。定义\n$$\n\\mathcal{M}=\\frac{\\left|\\Delta s_{\\mathrm{GF}}-\\Delta s_{\\mathrm{RF}}\\right|}{\\left|\\Delta s_{\\mathrm{GF}}\\right|+\\left|\\Delta s_{\\mathrm{RF}}\\right|+\\varepsilon},\n$$\n其中 $\\varepsilon=10^{-14}$。根据构造，$0\\le \\mathcal{M}\\le 1$。如果 $\\mathcal{M}\\ge 0.5$，我们将其顺序依赖性归类为“单位量级”。\n\n每个测试用例的算法步骤：\n- 从 $\\rho_{0}=1$，$e_{0}=1$ 和 $E_{\\mathrm{r},0}=r\\,e_{0}$ 初始化 $(\\rho_{0},e_{0},E_{\\mathrm{r},0})$。\n- 气体优先：\n  1. 压缩：$\\rho^{\\star}=\\rho_{0}e^{\\kappa}$，$e^{\\star}=e_{0}e^{\\gamma\\kappa}$，$E_{\\mathrm{r}}^{\\star}=E_{\\mathrm{r},0}e^{\\frac{4}{3}\\kappa}$。\n  2. 在 $\\rho^{\\star}$ 处，以 $K=\\chi\\,\\rho^{\\star}$ 进行耦合，对 $f(e^{n+1})$ 使用二分法得到 $e_{\\mathrm{GF}}$，$E_{\\mathrm{r},\\mathrm{GF}}=E_{\\mathrm{tot}}^{\\star}-e_{\\mathrm{GF}}$，其中 $E_{\\mathrm{tot}}^{\\star}=e^{\\star}+E_{\\mathrm{r}}^{\\star}$；设置 $\\rho_{\\mathrm{GF}}=\\rho^{\\star}$。\n- 辐射优先：\n  1. 在 $\\rho_{0}$ 处，以 $K=\\chi\\,\\rho_{0}$ 进行耦合，对 $f(e^{n+1})$ 使用二分法得到 $\\tilde e$ 和 $\\tilde E_{\\mathrm{r}}=E_{\\mathrm{tot}}^{0}-\\tilde e$，其中 $E_{\\mathrm{tot}}^{0}=e_{0}+E_{\\mathrm{r},0}$。\n  2. 压缩：$e_{\\mathrm{RF}}=\\tilde e\\,e^{\\gamma\\kappa}$，$E_{\\mathrm{r},\\mathrm{RF}}=\\tilde E_{\\mathrm{r}}\\,e^{\\frac{4}{3}\\kappa}$，$\\rho_{\\mathrm{RF}}=\\rho_{0}e^{\\kappa}$。\n- 计算 $\\Delta s_{\\mathrm{GF}}=\\ln e_{\\mathrm{GF}}-\\gamma \\ln \\rho_{\\mathrm{GF}}-s_{0}$ 和 $\\Delta s_{\\mathrm{RF}}=\\ln e_{\\mathrm{RF}}-\\gamma \\ln \\rho_{\\mathrm{RF}}-s_{0}$，其中 $s_{0}=\\ln e_{0}-\\gamma \\ln \\rho_{0}=0$。\n- 计算 $\\mathcal{M}$ 和指示符 $I$（如果 $\\mathcal{M}\\ge 0.5$ 则 $I=1$，否则 $I=0$）。\n\n边缘和边界情况的考虑：\n- 如果 $\\kappa=0$，压缩算子为恒等算子；两种顺序都简化为在相同密度下的相同耦合更新，因此 $\\mathcal{M}=0$。\n- 如果 $\\chi=0$，则不存在耦合；两种顺序都简化为纯压缩，因此 $\\mathcal{M}=0$。\n- 如果 $r\\ll 1$，辐射库可以忽略不计，顺序效应很小。\n- 如果 $r\\gg 1$ 和/或 $\\chi\\gg 1$，耦合很强，辐射库占主导地位，因此在压缩之前或之后进行耦合会使用显著不同的密度和辐射库状态，使得 $\\mathcal{M}$ 接近单位量级。\n\n实现细节：\n- 对耦合子步，在区间 $[0,E_{\\mathrm{tot}}]$ 上对 $f(e)$ 使用二分法，并进行足够次数的迭代（例如，60次）以确保收敛到机器精度。\n- 使用问题陈述中指定的九个测试用例。\n- 对于每个测试，报告四舍五入到六位小数的 $\\mathcal{M}$ 和指示符 $I$，并按要求以一个平坦列表形式交替输出 $\\mathcal{M}$ 和 $I$。\n\n这种构造清晰地分离了因以不同顺序执行压缩功和辐射耦合而产生的算子分裂顺序效应，并将其效应用物理上有意义的比熵来表示。度量 $\\mathcal{M}$ 直接诊断了顺序依赖性何时达到单位量级，尤其是在比率 $E_{\\mathrm{r}}/e$ 和耦合强度 $\\chi$ 增加时。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compress_step(rho, e, Er, kappa, gamma):\n    \"\"\"\n    Exact compressional update over one timestep with constant divergence:\n    rho *= exp(kappa)\n    e   *= exp(gamma * kappa)\n    Er  *= exp((4/3) * kappa)\n    \"\"\"\n    factor_rho = np.exp(kappa)\n    rho_new = rho * factor_rho\n    e_new = e * np.exp(gamma * kappa)\n    Er_new = Er * np.exp((4.0/3.0) * kappa)\n    return rho_new, e_new, Er_new\n\ndef couple_step_BE(e, Er, rho, chi, tol_iters=60):\n    \"\"\"\n    Backward Euler implicit matter-radiation coupling over one timestep (Delta t = 1),\n    with K = chi * rho, c = a_r = c_v = 1.\n    Solve for e_{n+1} using bisection on:\n        f(x) = (1+K) x + (K / rho^4) x^4 - (e + K * E_tot) = 0,\n    where E_tot = e + Er is conserved during the coupling substep.\n    Returns (e_new, Er_new).\n    \"\"\"\n    E_tot = e + Er\n    K = chi * rho\n    alpha = K / (rho**4)\n    beta = e + K * E_tot\n\n    # Bracket: [0, E_tot]\n    lo = 0.0\n    hi = E_tot\n    # Evaluate f at bounds\n    def f(x):\n        return (1.0 + K) * x + alpha * (x**4) - beta\n\n    f_lo = f(lo)  # should be -beta  0\n    f_hi = f(hi)  # should be >= 0\n    # Numerical safety: if f_hi  0 due to extreme roundoff with E_tot ~ 0, set hi to max(hi, 1)\n    if f_hi  0.0:\n        # If total energy is extremely small, solution is near zero.\n        hi = max(1.0, E_tot + 1.0)\n        f_hi = f(hi)\n\n    # Bisection iterations\n    for _ in range(tol_iters):\n        mid = 0.5 * (lo + hi)\n        f_mid = f(mid)\n        # Decide interval\n        if f_mid = 0.0:\n            lo = mid\n            f_lo = f_mid\n        else:\n            hi = mid\n            f_hi = f_mid\n    e_new = 0.5 * (lo + hi)\n    # Enforce positivity and bounds\n    if e_new  0.0:\n        e_new = 0.0\n    if e_new > E_tot:\n        e_new = E_tot\n    Er_new = E_tot - e_new\n    return e_new, Er_new\n\ndef entropy(e, rho, gamma):\n    # s = ln e - gamma ln rho; initial s0 = ln e0 - gamma ln rho0\n    return np.log(e) - gamma * np.log(rho)\n\ndef run_case(r, chi, kappa, gamma):\n    # Initial conditions in nondimensional units\n    rho0 = 1.0\n    e0 = 1.0\n    Er0 = r * e0\n    s0 = np.log(e0) - gamma * np.log(rho0)  # equals 0\n\n    # Gas-first (GF): compress then couple at compressed density\n    rho_gf, e_gf_star, Er_gf_star = compress_step(rho0, e0, Er0, kappa, gamma)\n    e_gf, Er_gf = couple_step_BE(e_gf_star, Er_gf_star, rho_gf, chi)\n    s_gf = entropy(e_gf, rho_gf, gamma)\n    ds_gf = s_gf - s0\n\n    # Radiation-first (RF): couple at initial density then compress\n    e_rf_tilde, Er_rf_tilde = couple_step_BE(e0, Er0, rho0, chi)\n    rho_rf, e_rf, Er_rf = compress_step(rho0, e_rf_tilde, Er_rf_tilde, kappa, gamma)\n    s_rf = entropy(e_rf, rho_rf, gamma)\n    ds_rf = s_rf - s0\n\n    # Normalized order-dependence measure\n    eps = 1e-14\n    M = abs(ds_gf - ds_rf) / (abs(ds_gf) + abs(ds_rf) + eps)\n    I = 1 if M >= 0.5 else 0\n    return M, I\n\ndef solve():\n    gamma = 5.0/3.0\n    test_cases = [\n        (1e-6, 0.5, 1.0),   # Case 1\n        (1e-1, 0.5, 1.0),   # Case 2\n        (1.0,  0.5, 1.0),   # Case 3\n        (10.0, 0.5, 1.0),   # Case 4\n        (1.0,  1e-2, 1.0),  # Case 5\n        (1.0,  10.0, 1.0),  # Case 6\n        (1.0,  0.5, 0.0),   # Case 7\n        (0.0,  0.5, 1.0),   # Case 8\n        (1e2,  0.5, 1.0),   # Case 9\n    ]\n\n    results = []\n    for r, chi, kappa in test_cases:\n        M, I = run_case(r, chi, kappa, gamma)\n        results.append(f\"{M:.6f}\")\n        results.append(str(int(I)))\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3530870"}]}