{"hands_on_practices": [{"introduction": "掌握辐射转移理论的第一步是为简单而富有洞察力的情景解析地求解方程。这个基础练习 [@problem_id:3540918] 要求你推导当源函数随光学深度线性变化时介质的出射强度，这是一个常用且有效的一阶近似。该练习将磨练你处理形式解的技巧，这是在解决更复杂的数值问题之前必须掌握的关键技能。", "problem": "考虑一个平面平行的静态介质，频率为固定的 $\\nu$。光学深度 $\\tau_{\\nu}$ 从表面向内朝远边界测量，因此在出射表面处 $\\tau_{\\nu}=0$，在射线的远端处 $\\tau_{\\nu}=T$。沿着一条方向余弦为 $\\mu=1$ 的向外传播的射线，比强度 $I_{\\nu}(\\tau_{\\nu})$ 服从辐射转移方程 (RTE)，用光学深度表示为 $d I_{\\nu}/d \\tau_{\\nu} = I_{\\nu} - S_{\\nu}$，其中 $S_{\\nu}(\\tau_{\\nu})$ 是源函数。假设远端的边界条件为 $I_{\\nu}(T)=0$（即没有从该方向入射的辐射）。源函数随光学深度线性变化，即 $S_{\\nu}(\\tau_{\\nu})=a+b\\,\\tau_{\\nu}$，其中 $a$ 和 $b$ 是不依赖于 $\\tau_{\\nu}$ 的常数。\n\n仅从光学深度的定义和辐射转移方程出发，推导出相应的形式解，并进行积分，以获得用 $a$、$b$ 和 $T$ 表示的出射比强度 $I_{\\nu}(0)$ 的闭式解析表达式。最终结果需以符号形式表示，无需进行数值计算或四舍五入。你的最终答案必须是单个闭式表达式。", "solution": "首先对问题进行验证。\n\n### 第1步：提取已知条件\n- **介质**：一个平面平行的静态介质，频率为固定的 $\\nu$。\n- **光学深度坐标**：$\\tau_{\\nu}$ 从表面向内测量。\n- **表面条件**：在出射表面处 $\\tau_{\\nu}=0$。\n- **远边界条件**：在射线的远端处 $\\tau_{\\nu}=T$。\n- **射线方向**：射线向外传播，方向余弦为 $\\mu=1$。\n- **辐射转移方程 (RTE)**：比强度 $I_{\\nu}(\\tau_{\\nu})$ 服从 $\\frac{d I_{\\nu}}{d \\tau_{\\nu}} = I_{\\nu} - S_{\\nu}$。\n- **远端边界条件**：$I_{\\nu}(T)=0$。\n- **源函数**：$S_{\\nu}(\\tau_{\\nu})$ 随光学深度线性变化，即 $S_{\\nu}(\\tau_{\\nu})=a+b\\,\\tau_{\\nu}$。\n- **常数**：$a$ 和 $b$ 是不依赖于 $\\tau_{\\nu}$ 的常数。\n- **目标**：推导用 $a$、$b$ 和 $T$ 表示的出射比强度 $I_{\\nu}(0)$ 的闭式解析表达式。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据、适定且客观。\n1.  **科学合理性**：该问题描述了辐射转移理论中的一个典型情景。给定的辐射转移方程 $\\frac{dI_{\\nu}}{d\\tau_{\\nu}} = I_{\\nu} - S_{\\nu}$ 是在平面平行大气中，对于光学深度 $\\tau_{\\nu}$ 定义为向介质内部增加的情况下，向外传播射线（$\\mu=1$）的正确形式。线性源函数 $S_{\\nu}(\\tau_{\\nu}) = a+b\\,\\tau_{\\nu}$ 是一个标准且有用的近似（源函数的一阶泰勒展开）。\n2.  **适定性**：该问题提供了一个带有单个明确定义的边界条件（$I_{\\nu}(T)=0$）的一阶线性常微分方程。这构成了一个适定的初值问题（或边值问题），存在唯一解。\n3.  **完备性**：所有必要组成部分——控制方程、源函数形式、边界条件和坐标系——都已明确定义。该问题是自洽的。\n4.  **清晰性**：所用术语在天体物理学和物理学中是标准的。定义或目标均无歧义。\n\n### 第3步：结论与行动\n问题有效。将推导完整的解。\n\n方向余弦为 $\\mu=1$ 的射线的辐射转移方程如下：\n$$\n\\frac{d I_{\\nu}}{d \\tau_{\\nu}} = I_{\\nu} - S_{\\nu}\n$$\n这是一个一阶线性非齐次常微分方程。我们可以将其改写为标准形式：\n$$\n\\frac{d I_{\\nu}}{d \\tau_{\\nu}} - I_{\\nu} = -S_{\\nu}(\\tau_{\\nu})\n$$\n为了求解该方程，我们使用积分因子法。积分因子 $P(\\tau_{\\nu})$ 是：\n$$\nP(\\tau_{\\nu}) = \\exp\\left(\\int (-1) d\\tau_{\\nu}\\right) = \\exp(-\\tau_{\\nu})\n$$\n将整个方程乘以积分因子 $\\exp(-\\tau_{\\nu})$ 得：\n$$\n\\exp(-\\tau_{\\nu})\\frac{d I_{\\nu}}{d \\tau_{\\nu}} - \\exp(-\\tau_{\\nu}) I_{\\nu} = -S_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu})\n$$\n左侧可以看作是一个乘积的导数，根据乘法求导法则：\n$$\n\\frac{d}{d \\tau_{\\nu}} \\left(I_{\\nu}(\\tau_{\\nu}) \\exp(-\\tau_{\\nu})\\right) = -S_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu})\n$$\n为求得形式解，我们将此方程从边界 $\\tau'_{\\nu}=T$ 积分到一个任意点 $\\tau_{\\nu}$。我们使用 $\\tau'_{\\nu}$ 作为积分变量，以避免与积分上限 $\\tau_{\\nu}$ 混淆。\n$$\n\\int_{T}^{\\tau_{\\nu}} \\frac{d}{d \\tau'_{\\nu}} \\left(I_{\\nu}(\\tau'_{\\nu}) \\exp(-\\tau'_{\\nu})\\right) d\\tau'_{\\nu} = \\int_{T}^{\\tau_{\\nu}} -S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\n对左侧应用微积分基本定理：\n$$\n\\left[ I_{\\nu}(\\tau'_{\\nu}) \\exp(-\\tau'_{\\nu}) \\right]_{T}^{\\tau_{\\nu}} = I_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu}) - I_{\\nu}(T)\\exp(-T)\n$$\n将其与右侧相等，可得：\n$$\nI_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu}) - I_{\\nu}(T)\\exp(-T) = -\\int_{T}^{\\tau_{\\nu}} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\n我们应用给定的边界条件 $I_{\\nu}(T)=0$：\n$$\nI_{\\nu}(\\tau_{\\nu})\\exp(-\\tau_{\\nu}) = \\int_{\\tau_{\\nu}}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\n这里我们交换了积分限来消去负号。解出 $I_{\\nu}(\\tau_{\\nu})$：\n$$\nI_{\\nu}(\\tau_{\\nu}) = \\exp(\\tau_{\\nu}) \\int_{\\tau_{\\nu}}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\int_{\\tau_{\\nu}}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-(\\tau'_{\\nu}-\\tau_{\\nu})) d\\tau'_{\\nu}\n$$\n这就是形式解。我们需要求解的是出射比强度，即 $I_{\\nu}(0)$。我们令 $\\tau_{\\nu}=0$：\n$$\nI_{\\nu}(0) = \\int_{0}^{T} S_{\\nu}(\\tau'_{\\nu})\\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\n现在，我们代入给定的线性源函数 $S_{\\nu}(\\tau'_{\\nu}) = a + b\\,\\tau'_{\\nu}$：\n$$\nI_{\\nu}(0) = \\int_{0}^{T} (a + b\\,\\tau'_{\\nu}) \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\n我们可以将此积分分为两部分：\n$$\nI_{\\nu}(0) = a \\int_{0}^{T} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} + b \\int_{0}^{T} \\tau'_{\\nu} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\n第一个积分很简单：\n$$\n\\int_{0}^{T} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\left[ -\\exp(-\\tau'_{\\nu}) \\right]_{0}^{T} = -\\exp(-T) - (-\\exp(0)) = 1 - \\exp(-T)\n$$\n第二个积分需要使用分部积分法，$\\int u \\, dv = uv - \\int v \\, du$。令 $u = \\tau'_{\\nu}$ 且 $dv = \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}$。则 $du = d\\tau'_{\\nu}$ 且 $v = -\\exp(-\\tau'_{\\nu})$。\n$$\n\\int \\tau'_{\\nu} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\tau'_{\\nu} (-\\exp(-\\tau'_{\\nu})) - \\int (-\\exp(-\\tau'_{\\nu})) d\\tau'_{\\nu} = -\\tau'_{\\nu}\\exp(-\\tau'_{\\nu}) + \\int \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu}\n$$\n完成最后的积分，得到不定积分：\n$$\n-\\tau'_{\\nu}\\exp(-\\tau'_{\\nu}) - \\exp(-\\tau'_{\\nu}) = -(\\tau'_{\\nu}+1)\\exp(-\\tau'_{\\nu})\n$$\n现在，我们计算从 $0$ 到 $T$ 的定积分：\n$$\n\\int_{0}^{T} \\tau'_{\\nu} \\exp(-\\tau'_{\\nu}) d\\tau'_{\\nu} = \\left[ -(\\tau'_{\\nu}+1)\\exp(-\\tau'_{\\nu}) \\right]_{0}^{T}\n$$\n$$\n= \\left( -(T+1)\\exp(-T) \\right) - \\left( -(0+1)\\exp(0) \\right)\n$$\n$$\n= -(T+1)\\exp(-T) + 1 = 1 - (T+1)\\exp(-T)\n$$\n结合两部分的结果，我们有：\n$$\nI_{\\nu}(0) = a(1 - \\exp(-T)) + b(1 - (T+1)\\exp(-T))\n$$\n展开并合并同类项，得到一个简化表达式：\n$$\nI_{\\nu}(0) = a - a\\exp(-T) + b - b\\exp(-T) - bT\\exp(-T)\n$$\n$$\nI_{\\nu}(0) = a + b - (a + b + bT)\\exp(-T)\n$$\n这就是出射比强度的最终闭式表达式。", "answer": "$$\n\\boxed{a+b - (a+b+bT)\\exp(-T)}\n$$", "id": "3540918"}, {"introduction": "在天体物理学中，我们常常依赖巧妙的近似，但理解它们的局限性至关重要。这个练习 [@problem_id:3540949] 将你从纯理论带入计算分析，要求你通过数值方法来检验著名的 Eddington-Barbier 关系。通过将精确的形式解与针对各种挑战性源函数的近似解进行比较，你将为这些简化假设何时以及为何成功或失败建立起一种实用的直觉。", "problem": "您的任务是检验爱丁顿-巴比尔关系的近似质量。该关系指出，从平面平行大气中出射的比强度 $I_\\nu(\\mu)$ 近似等于在光学深度等于角度余弦处计算的源函数 $S_\\nu(\\tau_\\nu)$，即 $I_\\nu(\\mu) \\approx S_\\nu(\\tau_\\nu = \\mu)$。目标是量化并理解该近似在何时以及在多大程度上偏离辐射转移方程的形式解。\n\n从静态、平面平行介质中，顶部边界无入射辐射的辐射转移方程出发：\n$$\n\\mu \\frac{d I_\\nu(\\tau_\\nu, \\mu)}{d \\tau_\\nu} = I_\\nu(\\tau_\\nu, \\mu) - S_\\nu(\\tau_\\nu),\n$$\n推导出在表面 $\\tau_\\nu = 0$ 处，出射比强度 $I_\\nu(0, \\mu)$ 关于源函数 $S_\\nu(\\tau_\\nu)$ 和光学深度 $\\tau_\\nu$ 的形式解。使用该形式解，对几个具有尖锐特征的源函数 $S_\\nu(\\tau_\\nu)$ 进行数值计算 $I_\\nu(\\mu)$，并将其与 $S_\\nu(\\tau_\\nu=\\mu)$ 进行比较。\n\n您的程序必须实现：\n- 在表面处，$I_\\nu(\\mu)$ 作为 $\\tau_\\nu$ 上的积分的推导出的形式解。\n- 一组包含尖锐特征（不连续点、窄峰和快速振荡分量）的源函数 $S_\\nu(\\tau_\\nu)$。\n- 爱丁顿-巴比尔近似 $S_\\nu(\\tau_\\nu=\\mu)$。\n- 每个测试用例的绝对偏差 $\\Delta(\\mu) = \\left| I_\\nu(\\mu) - S_\\nu(\\tau_\\nu=\\mu) \\right|$。\n\n此问题中的所有量均可视为无量纲，无需物理单位。角度由其余弦 $\\mu$ 表示，$\\mu$ 是在区间 $[0, 1]$ 内的无量纲数。\n\n实现以下测试套件。对于每种情况，计算如上定义的绝对偏差 $\\Delta(\\mu)$。\n\n- 情况 $1$（线性基线，精确场景）：\n  $$\n  S(\\tau) = a + b \\tau,\\quad a = 1.0,\\quad b = 0.5,\\quad \\mu = 0.7.\n  $$\n- 情况 $2$（阶跃不连续，$\\mu  \\tau_0$）：\n  $$\n  S(\\tau) =\n  \\begin{cases}\n  s_0  \\text{ if } \\tau  \\tau_0,\\\\\n  s_1  \\text{ if } \\tau \\ge \\tau_0,\n  \\end{cases}\n  \\quad s_0 = 1.0,\\quad s_1 = 2.0,\\quad \\tau_0 = 0.2,\\quad \\mu = 0.1.\n  $$\n- 情况 $3$（阶跃不连续，$\\mu = \\tau_0$）：\n  $$\n  S(\\tau) =\n  \\begin{cases}\n  s_0  \\text{ if } \\tau  \\tau_0,\\\\\n  s_1  \\text{ if } \\tau \\ge \\tau_0,\n  \\end{cases}\n  \\quad s_0 = 1.0,\\quad s_1 = 2.0,\\quad \\tau_0 = 0.2,\\quad \\mu = 0.2,\n  $$\n  并且在不连续点进行 $S(\\mu)$ 求值时，使用 $S(\\tau \\ge \\tau_0)$。\n- 情况 $4$（近地表窄高斯峰）：\n  $$\n  S(\\tau) = a + A \\exp\\left( - \\frac{(\\tau - \\tau_c)^2}{2 \\sigma^2} \\right),\\quad a = 1.0,\\quad A = 3.0,\\quad \\tau_c = 0.05,\\quad \\sigma = 0.01,\\quad \\mu = 0.1.\n  $$\n- 情况 $5$（快速振荡的指数衰减分量）：\n  $$\n  S(\\tau) = a + A \\exp\\left( - \\frac{\\tau}{\\tau_d} \\right) \\cos(\\omega \\tau),\\quad a = 1.0,\\quad A = 1.0,\\quad \\tau_d = 0.2,\\quad \\omega = 30.0,\\quad \\mu = 0.5.\n  $$\n\n您的程序应：\n- 基于辐射转移方程，推导并实现表面处 $I_\\nu(\\mu)$ 的形式解。\n- 使用稳健的求积法，对每个源函数将形式解数值积分到机器精度。\n- 对每个测试用例，计算绝对偏差 $\\Delta(\\mu)$。\n- 生成一行输出，其中包含一个逗号分隔的列表，列表用方括号括起来，每个浮点数四舍五入到六位小数，顺序与上面列出的情况一致。例如，输出格式必须完全像\n$$\n[0.000000,0.123456,0.654321,0.111111,0.222222].\n$$", "solution": "已根据指定的验证协议分析了用户提供的问题。\n\n### 步骤 1：提取已知条件\n- **控制方程**：静态、平面平行介质中的辐射转移方程：$\\mu \\frac{d I_\\nu(\\tau_\\nu, \\mu)}{d \\tau_\\nu} = I_\\nu(\\tau_\\nu, \\mu) - S_\\nu(\\tau_\\nu)$。\n- **边界条件**：顶部边界（$\\tau_\\nu=0$）无入射辐射。介质被视为半无限。\n- **待检验的近似**：爱丁顿-巴比尔关系，$I_\\nu(\\mu) \\approx S_\\nu(\\tau_\\nu = \\mu)$。这里的 $I_\\nu(\\mu)$ 表示表面的出射比强度，$I_\\nu(0, \\mu)$。\n- **待计算量**：绝对偏差 $\\Delta(\\mu) = \\left| I_\\nu(\\mu) - S_\\nu(\\tau_\\nu=\\mu) \\right|$。\n- **测试用例**：\n    - **情况 1**：$S(\\tau) = a + b \\tau$，其中 $a = 1.0$，$b = 0.5$，$\\mu = 0.7$。\n    - **情况 2**：$S(\\tau) = \\begin{cases} s_0  \\text{ if } \\tau  \\tau_0, \\\\ s_1  \\text{ if } \\tau \\ge \\tau_0, \\end{cases}$ 其中 $s_0 = 1.0$，$s_1 = 2.0$，$\\tau_0 = 0.2$，$\\mu = 0.1$。\n    - **情况 3**：与情况 2 相同的 $S(\\tau)$，其中 $s_0 = 1.0$，$s_1 = 2.0$，$\\tau_0 = 0.2$，$\\mu = 0.2$。对于 $S(\\mu)$ 的求值，使用 $S(\\tau \\ge \\tau_0)$。\n    - **情况 4**：$S(\\tau) = a + A \\exp\\left( - \\frac{(\\tau - \\tau_c)^2}{2 \\sigma^2} \\right)$，其中 $a = 1.0$，$A = 3.0$，$\\tau_c = 0.05$，$\\sigma = 0.01$，$\\mu = 0.1$。\n    - **情况 5**：$S(\\tau) = a + A \\exp\\left( - \\frac{\\tau}{\\tau_d} \\right) \\cos(\\omega \\tau)$，其中 $a = 1.0$，$A = 1.0$，$\\tau_d = 0.2$，$\\omega = 30.0$，$\\mu = 0.5$。\n\n### 步骤 2：使用提取的已知条件进行验证\n问题评估如下：\n- **科学基础扎实**：该问题基于基本的辐射转移方程，这是天体物理学的基石。爱丁顿-巴比尔关系是一个标准的、广为人知的近似。所要求的分析是一个典型的教科书练习，旨在理解此近似的局限性。所有概念在科学上都是合理的。\n- **适定的**：问题定义清晰。控制方程、边界条件和源函数都已指定，从而可以得到出射强度的唯一解。数值任务定义明确。\n- **客观的**：问题以精确的数学和物理术语陈述，没有主观性或歧义。\n- **完整的**：每个测试用例的所有必要参数都已提供。\n- **无其他无效缺陷**被检测到。\n\n### 步骤 3：结论与行动\n问题是**有效的**。将提供一个解决方案。\n\n### 基于原理的求解设计\n问题的核心是将出射比强度的精确形式解 $I_\\nu(\\mu)$ 与其爱丁顿-巴比尔近似 $S_\\nu(\\tau_\\nu=\\mu)$ 进行比较。我们首先推导形式解。\n\n**形式解的推导**\n\n辐射转移方程给出为：\n$$\n\\mu \\frac{d I_\\nu(\\tau_\\nu, \\mu)}{d \\tau_\\nu} = I_\\nu(\\tau_\\nu, \\mu) - S_\\nu(\\tau_\\nu)\n$$\n为简洁起见，我们省略下标 $\\nu$。这是一个一阶线性常微分方程，可以整理成标准形式 $\\frac{dI}{d\\tau} + P(\\tau)I = Q(\\tau)$：\n$$\n\\frac{d I}{d \\tau} - \\frac{1}{\\mu} I = -\\frac{1}{\\mu} S(\\tau)\n$$\n积分因子是 $M(\\tau) = \\exp\\left(\\int -\\frac{1}{\\mu} d\\tau\\right) = e^{-\\tau/\\mu}$。将方程乘以 $M(\\tau)$ 得：\n$$\ne^{-\\tau/\\mu} \\frac{d I}{d \\tau} - \\frac{1}{\\mu} e^{-\\tau/\\mu} I = -\\frac{1}{\\mu} e^{-\\tau/\\mu} S(\\tau)\n$$\n左侧是乘积 $I(\\tau, \\mu) e^{-\\tau/\\mu}$ 的导数：\n$$\n\\frac{d}{d \\tau} \\left( I(\\tau, \\mu) e^{-\\tau/\\mu} \\right) = -\\frac{1}{\\mu} S(\\tau) e^{-\\tau/\\mu}\n$$\n为了找到向外辐射（$\\mu  0$）的出射强度 $I(0, \\mu)$，我们从一个很大的深度（$\\tau \\to \\infty$）积分到表面（$\\tau = 0$）。\n$$\n\\int_{\\infty}^0 \\frac{d}{dt} \\left( I(t, \\mu) e^{-t/\\mu} \\right) dt = \\int_{\\infty}^0 \\left( -\\frac{1}{\\mu} S(t) e^{-t/\\mu} \\right) dt\n$$\n$$\n\\left[ I(t, \\mu) e^{-t/\\mu} \\right]_{\\infty}^0 = \\frac{1}{\\mu} \\int_0^{\\infty} S(t) e^{-t/\\mu} dt\n$$\n计算左侧得到 $I(0, \\mu) e^0 - \\lim_{t \\to \\infty} I(t, \\mu) e^{-t/\\mu}$。对于半无限大气，极限项消失，因为恒星深处的任何物理上真实的强度源都将被无限的光学深度完全衰减。因此，表面出射强度的形式解是：\n$$\nI(\\mu) \\equiv I(0, \\mu) = \\int_0^\\infty S(\\tau) e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu}\n$$\n这个方程表明，出射强度是源函数在所有深度上的加权平均。权重函数 $\\frac{1}{\\mu}e^{-\\tau/\\mu}$ 被称为贡献函数。它的平均深度为 $\\int_0^\\infty \\tau \\frac{e^{-\\tau/\\mu}}{\\mu} d\\tau = \\mu$。这是爱丁顿-巴比尔近似的基础：如果 $S(\\tau)$ 是一个缓慢变化的函数，它可以从积分中提出，并在该平均深度处求值，即 $I(\\mu) \\approx S(\\tau=\\mu) \\int_0^\\infty e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu} = S(\\tau=\\mu)$。\n\n**数值实现**\n\n程序将使用 `scipy.integrate.quad` 函数（一个稳健的数值求积工具）通过数值积分形式解来计算 $I(\\mu)$。对于每个测试用例，我们定义特定的源函数 $S(\\tau)$ 和参数。然后计算绝对偏差 $\\Delta(\\mu) = |I(\\mu) - S(\\tau=\\mu)|$。\n\n- **情况 1（线性）**：$S(\\tau) = a + b\\tau$。对于任何线性源函数，爱丁顿-巴比尔关系是精确的。形式解给出 $I(\\mu) = \\int_0^\\infty (a+b\\tau) e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu} = a+b\\mu$，这与 $S(\\tau=\\mu)$ 完全相同。因此，$\\Delta(\\mu)$ 必须为 $0$（在机器精度内）。这可以作为对数值积分器的验证。\n\n- **情况 2 和 3（阶跃不连续）**：源函数有一个突然的跳变。$I(\\mu)$ 的积分提供了一个平滑值，对跳变前后的贡献进行加权平均，权重由指数核决定。然而，近似 $S(\\tau=\\mu)$ 在 $\\mu$ 穿过 $\\tau_0$ 时会突然从 $s_0$ 切换到 $s_1$。偏差 $\\Delta(\\mu)$ 将会很大，尤其是在不连续点附近。对于情况 3，$\\mu = \\tau_0$，近似被定义为 $S(\\mu) = s_1$。然而，积分包含了 $\\tau  \\tau_0$ 的贡献，其中 $S(\\tau)=s_0$。由此产生的偏差很大：$I(\\mu) = s_0 + (s_1-s_0)e^{-\\tau_0/\\mu} = 1+(2-1)e^{-1} \\approx 1.368$，而 $S(\\mu)=2$，给出 $\\Delta \\approx 0.632$。\n\n- **情况 4（窄高斯峰）**：源函数有一个非常尖锐、局域化的特征。核 $e^{-\\tau/\\mu}$ 的有效宽度为 $\\mu$。这里 $\\mu=0.1$ 远大于峰的宽度 $\\sigma=0.01$。$I(\\mu)$ 的积分将“平滑掉”这个峰，得到一个接近基线 $a=1.0$ 并带有峰值微小贡献的值。然而，近似 $S(\\tau=\\mu)=S(0.1)$ 在高斯函数的远尾部评估源函数，导致一个非常接近 $a=1.0$ 的值。偏差来自于峰值的积分（但被衰减的）贡献，而简单的点评估无法捕捉到这一点。\n\n- **情况 5（快速振荡）**：源函数快速振荡。积分对这些振荡进行平均，有效地抑制了它们。$I(\\mu)$ 的结果将接近源函数的平均值，即 $a=1.0$。然而，近似 $S(\\mu)$ 在余弦函数的特定相位处取值，这可能远离平均值。这导致了显著的偏差。对于 $\\mu=0.5$ 和 $\\omega=30$，$S(0.5)$ 计算 $\\cos(15)$，这与其平均值 $0$ 有显著不同。\n\n实现将定义每个源函数及其参数，计算 $I(\\mu)$ 的数值积分，评估 $S(\\mu)$，计算绝对偏差 $\\Delta(\\mu)$，并按要求格式化结果。对于不连续源函数的情况，积分将在不连续点 $\\tau_0$ 处分开，以确保数值准确性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes the absolute deviation of the Eddington-Barbier approximation\n    for several test cases of source functions.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"id\": 1,\n            \"type\": \"linear\",\n            \"params\": {\"a\": 1.0, \"b\": 0.5},\n            \"mu\": 0.7\n        },\n        {\n            \"id\": 2,\n            \"type\": \"step\",\n            \"params\": {\"s0\": 1.0, \"s1\": 2.0, \"tau0\": 0.2},\n            \"mu\": 0.1\n        },\n        {\n            \"id\": 3,\n            \"type\": \"step\",\n            \"params\": {\"s0\": 1.0, \"s1\": 2.0, \"tau0\": 0.2},\n            \"mu\": 0.2\n        },\n        {\n            \"id\": 4,\n            \"type\": \"gaussian\",\n            \"params\": {\"a\": 1.0, \"A\": 3.0, \"tau_c\": 0.05, \"sigma\": 0.01},\n            \"mu\": 0.1\n        },\n        {\n            \"id\": 5,\n            \"type\": \"oscillating\",\n            \"params\": {\"a\": 1.0, \"A\": 1.0, \"tau_d\": 0.2, \"omega\": 30.0},\n            \"mu\": 0.5\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        mu = case[\"mu\"]\n        params = case[\"params\"]\n        \n        # Define source function S(tau) based on the case type\n        if case[\"type\"] == \"linear\":\n            def s_func(tau):\n                return params[\"a\"] + params[\"b\"] * tau\n        elif case[\"type\"] == \"step\":\n            def s_func(tau):\n                return params[\"s0\"] if tau  params[\"tau0\"] else params[\"s1\"]\n        elif case[\"type\"] == \"gaussian\":\n            def s_func(tau):\n                return params[\"a\"] + params[\"A\"] * np.exp(\n                    -((tau - params[\"tau_c\"])**2) / (2 * params[\"sigma\"]**2)\n                )\n        elif case[\"type\"] == \"oscillating\":\n            def s_func(tau):\n                return params[\"a\"] + params[\"A\"] * np.exp(\n                    -tau / params[\"tau_d\"]\n                ) * np.cos(params[\"omega\"] * tau)\n        \n        # Integrand for the formal solution of I(mu)\n        integrand = lambda tau: s_func(tau) * np.exp(-tau / mu) / mu\n        \n        # Compute the formal solution I(mu) via numerical integration\n        if case[\"type\"] == \"step\":\n            # For discontinuous functions, split the integral at the point of\n            # discontinuity for better accuracy.\n            tau0 = params[\"tau0\"]\n            integral1, _ = integrate.quad(integrand, 0, tau0)\n            integral2, _ = integrate.quad(integrand, tau0, np.inf)\n            i_formal = integral1 + integral2\n        else:\n            i_formal, _ = integrate.quad(integrand, 0, np.inf, limit=200)\n\n        # Compute the Eddington-Barbier approximation S(tau=mu)\n        # Special handling for case 3 at the discontinuity\n        if case[\"id\"] == 3:\n            s_approx = params[\"s1\"] # As specified: S(tau >= tau0)\n        else:\n            s_approx = s_func(mu)\n            \n        # Compute the absolute deviation\n        deviation = abs(i_formal - s_approx)\n        results.append(deviation)\n\n    # Format the final output string as required\n    output_str = f\"[{','.join(f'{r:.6f}' for r in results)}]\"\n    print(output_str)\n\nsolve()\n\n```", "id": "3540949"}, {"introduction": "现在，让我们将所学知识应用于一个动态且真实的天体物理场景：大质量恒星的膨胀星风。这项高级实践 [@problem_id:3540922] 要求你在运动介质中模拟谱线的形成，这是理解恒星质量损失的核心问题。你将实现一个完整的数值解，并将其与强大的 Sobolev 近似进行比较，从而亲身体验这一解读恒星光谱必不可少的分析技术。", "problem": "您需要设计并实现一个计算天体物理学领域的数值实验，用以评估索博列夫近似（Sobolev approximation）在处理球对称、单调加速的恒星风中形成的单条孤立共振线问题时的准确性。实验目标是，将通过完整辐射转移方程计算出的出射比辐射强度，与使用索博列夫近似计算出的结果进行比较，并为几个精心挑选的测试案例报告一个无量纲的误差度量。\n\n其基本依据必须是沿一条射线的一维辐射转移方程：\n$$\n\\frac{d I_\\nu}{d s} = - \\chi_\\nu(\\nu, r) I_\\nu + \\eta_\\nu(\\nu, r),\n$$\n其中源函数定义为 $S_\\nu(\\nu,r) \\equiv \\eta_\\nu(\\nu,r) / \\chi_\\nu(\\nu,r)$。在此任务中，谱线是纯共振线，具有恒定的源函数 $S_\\nu(\\nu,r) = S_0$（与 $r$ 和 $\\nu$ 无关），并且没有背景连续谱（即在内边界处的 $I_\\nu$ 为零）。\n\n几何与运动学：\n- 恒星风是球对称的，恒星半径为 $R_\\star$，并延伸至外半径 $R_{\\max}$。\n- 沿着一条径向射线（碰撞参数 $p=0$），半径为 $r = s$，视线方向上的速度投影等于径向速度，即 $v_{\\parallel}(r) = v(r)$。\n- 速度定律遵循标准的“β律”：\n$$\nv(r) = v_\\infty \\left(1 - \\frac{R_\\star}{r}\\right)^\\beta,\n$$\n对于 $r \\ge R_\\star$，其中 $v_\\infty$ 是终端速度，$\\beta$ 是一个正指数。\n\n谱线不透明度：\n- 谱线频率为 $\\nu_0$。\n- 对于以速度 $v_\\parallel(r)$ 运动的物质，其在共动坐标系中看到的频率可非相对论性地近似为：\n$$\n\\nu'(\\nu, r) = \\nu \\left(1 - \\frac{v_\\parallel(r)}{c}\\right),\n$$\n其中 $c$ 是光速。\n- 沿射线的频率相关消光系数采用以 $\\nu_0$ 为中心并在谱线中心处归一化为1的高斯函数进行建模：\n$$\n\\chi_\\nu(\\nu, r) = \\chi_0 \\exp\\left(-\\left[\\frac{\\nu'(\\nu,r) - \\nu_0}{\\Delta \\nu_D}\\right]^2\\right),\n$$\n其中 $\\chi_0$ 是谱线中心消光系数（单位为长度的倒数），$\\Delta \\nu_D = \\nu_0 v_{\\mathrm{th}}/c$ 是与热速度 $v_{\\mathrm{th}}$ 相关的多普勒宽度。\n\n您必须为指定的频率 $\\nu$ 计算在外边界 $r = R_{\\max}$ 处的两个出射强度估计值：\n1. 一个“完全形式解”，通过从 $r=R_\\star$ 到 $r=R_{\\max}$ 对辐射转移方程进行数值积分得到，边界条件为 $I_\\nu(R_\\star) = 0$。在每个空间步长上，假设 $\\chi_\\nu$ 和 $S_\\nu$ 在该步长内局部恒定，并使用一阶精确更新方法。换言之，将路径离散化为多个小段，并在每段上应用精确的衰减-发射更新来推进 $I_\\nu$ 的计算。\n2. 一个“索博列夫近似”强度，通过在共振点（如果射线上存在此点）评估局部索博列夫光学深度来计算。此计算需使用上述的单调速度梯度和高斯线型，然后将相互作用视为一个具有恒定源函数 $S_0$ 的局部吸收-发射事件。如果在 $[R_\\star, R_{\\max}]$ 区间内不存在共振点，则索博列夫强度应视为零。\n\n您的程序必须以科学上一致的单位实现以下组件：\n- 单位：全过程使用国际单位制（SI units）。频率 $\\nu$ 和 $\\nu_0$ 以 $\\mathrm{Hz}$ 为单位，距离以 $\\mathrm{m}$ 为单位，速度以 $\\mathrm{m/s}$ 为单位，消光系数 $\\chi_0$ 以 $\\mathrm{m}^{-1}$ 为单位。通过报告以 $S_0$ 归一化的强度，源函数 $S_0$ 可被视为无量纲。\n- 形式解：对 $I_\\nu(R_{\\max})$ 进行数值路径积分，采用分段精确的衰减-发射更新方法，并使用足够精细的空间网格以确保收敛。\n- 索博列夫近似：通过求解 $\\nu'(r) = \\nu_0$ 来定位射线上的共振点，这等价于：\n$$\nv(r_{\\mathrm{res}}) = c \\left(1 - \\frac{\\nu_0}{\\nu}\\right),\n$$\n此式适用于近侧径向射线上的 $\\nu  \\nu_0$。如果 $r_{\\mathrm{res}} \\notin [R_\\star, R_{\\max}]$，则恒星风内部没有共振。使用球对称β律的导数：\n$$\n\\frac{d v}{d r} = v_\\infty \\beta \\frac{R_\\star}{r^2} \\left(1 - \\frac{R_\\star}{r}\\right)^{\\beta - 1},\n$$\n以及上面指定的高斯线型模型来构建共振点处的索博列夫光学深度。然后计算恒定源函数情况下的索博列夫强度。\n\n误差度量规范：\n- 对每个测试案例，计算一个无量纲的对称相对误差：\n$$\n\\varepsilon = \\frac{2 \\left| I_{\\nu,\\mathrm{Sob}} - I_{\\nu,\\mathrm{full}} \\right|}{\\left| I_{\\nu,\\mathrm{Sob}} \\right| + \\left| I_{\\nu,\\mathrm{full}} \\right|},\n$$\n并约定当两个强度都恰好为零时 $\\varepsilon = 0$。报告误差时使用由 $S_0$ 归一化的强度，以使误差无量纲。\n\n测试套件：\n使用以下三个科学上合理的测试案例，它们探测了不同的物理情况：\n- 案例A（典型情况，恒星风内部有单一共振点）：\n  $v_\\infty = 2.0 \\times 10^{6}\\ \\mathrm{m/s}$, $\\beta = 1.0$, $R_\\star = 7.0 \\times 10^{9}\\ \\mathrm{m}$, $R_{\\max} = 3.5 \\times 10^{11}\\ \\mathrm{m}$, \n  $\\chi_0 = 3.0 \\times 10^{-8}\\ \\mathrm{m}^{-1}$, $v_{\\mathrm{th}} = 1.0 \\times 10^{4}\\ \\mathrm{m/s}$, \n  $S_0 = 1.0$ (无量纲归一化), $\\nu_0 = 1.0 \\times 10^{15}\\ \\mathrm{Hz}$, \n  $\\nu = 1.001 \\times 10^{15}\\ \\mathrm{Hz}$。\n- 案例B（近终端速度共振，大索博列夫深度）：\n  参数同上，除了 $\\nu = 1.0065 \\times 10^{15}\\ \\mathrm{Hz}$。\n- 案例C（恒星风内部无共振）：\n  参数同上，除了 $\\nu = 1.008 \\times 10^{15}\\ \\mathrm{Hz}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[resultA,resultB,resultC]”），其中每个条目是相应测试案例的 $\\varepsilon$ 值（一个十进制浮点数），顺序为A、B、C。强度被隐式地以 $S_0$ 归一化，因此误差是无量纲的。输出中不应打印任何单位。", "solution": "该问题被评估为有效。它在科学上基于天体物理学中的辐射转移原理，其定义和参数完整且一致，问题阐述清晰，并以客观、正式的语言表达。该任务要求直接比较辐射转移方程的数值解与广泛使用的索博列夫近似，这在计算天体物理学中构成了一个标准且有意义的问题。\n\n在此，我们制定一个详细的解决方案，概述执行指定计算所需的物理原理和数值算法。\n\n### 控制原理与模型设置\n\n所考虑的物理系统是一个球对称、加速的恒星风。辐射穿过此介质的转移过程由沿视线（射线）的一维辐射转移方程（RTE）描述：\n$$\n\\frac{d I_\\nu}{d s} = \\eta_\\nu - \\chi_\\nu I_\\nu\n$$\n其中 $s$ 是沿射线的路径长度，$I_\\nu$ 是频率 $\\nu$ 处的比辐射强度，$\\eta_\\nu$ 是发射率，$\\chi_\\nu$ 是消光系数。定义源函数 $S_\\nu = \\eta_\\nu / \\chi_\\nu$ 很方便。问题指定对于纯共振线，源函数为常数 $S_\\nu = S_0$，且没有背景连续谱辐射，这意味着在恒星风底部的强度为零（$I_\\nu(r=R_\\star) = 0$）。为简单起见并按要求，我们用 $S_0$ 归一化所有强度，实际上就是设置 $S_0=1$。\n\n问题被简化为来自观测者的径向射线，因此路径长度坐标 $s$ 与径向坐标 $r$ 相同。气体的视线速度 $v_\\parallel(r)$ 就是径向风速 $v(r)$。该速度遵循标准的β律：\n$$\nv(r) = v_\\infty \\left(1 - \\frac{R_\\star}{r}\\right)^\\beta\n$$\n对于 $r \\ge R_\\star$，其中 $v_\\infty$ 是终端速度，$R_\\star$ 是恒星半径，$\\beta$ 是一个模型参数。\n\n辐射与物质之间的相互作用仅限于静止频率为 $\\nu_0$ 的单条谱线。由于气体的运动，观测者坐标系中频率为 $\\nu$ 的光子在气体的共动坐标系中被看作是多普勒频移后的频率 $\\nu'$：\n$$\n\\nu'(\\nu, r) = \\nu \\left(1 - \\frac{v(r)}{c}\\right)\n$$\n消光系数 $\\chi_\\nu$ 由以 $\\nu_0$ 为中心的高斯分布给出，代表热致增宽：\n$$\n\\chi_\\nu(\\nu, r) = \\chi_0 \\exp\\left(-\\left[\\frac{\\nu'(\\nu,r) - \\nu_0}{\\Delta \\nu_D}\\right]^2\\right)\n$$\n其中 $\\chi_0$ 是谱线中心的不透明度，$\\Delta \\nu_D = \\nu_0 v_{\\mathrm{th}}/c$ 是对应于热速度 $v_{\\mathrm{th}}$ 的多普勒宽度。\n\n### 通过数值积分的完全形式解\n\n第一种方法是直接对RTE进行数值积分。我们将从 $r=R_\\star$ 到 $r=R_{\\max}$ 的径向路径离散化为一系列小段。对于每个从 $r_i$ 到 $r_{i+1}$、长度为 $\\Delta r_i = r_{i+1} - r_i$ 的段，我们假设消光系数 $\\chi_\\nu$ 和源函数 $S_0$ 是恒定的。该段的光学深度为 $\\Delta \\tau_{\\nu,i} = \\chi_\\nu(\\tilde{r}_i) \\Delta r_i$，其中 $\\tilde{r}_i$ 是中点半径。\n\nRTE方程 $dI_\\nu/d\\tau_\\nu = -I_\\nu + S_0$ 在性质恒定的段上有一个精确解：\n$$\nI_\\nu(r_{i+1}) = I_\\nu(r_i) e^{-\\Delta \\tau_{\\nu,i}} + S_0 \\left(1 - e^{-\\Delta \\tau_{\\nu,i}}\\right)\n$$\n从边界条件 $I_\\nu(R_\\star) = 0$ 开始，我们对每个段迭代应用此更新规则，直到到达外边界 $R_{\\max}$。最终的强度 $I_\\nu(R_{\\max})$ 就是“完全形式解” $I_{\\nu,\\mathrm{full}}$。为了确保准确性，特别是在物理性质变化迅速的区域（即靠近恒星处），我们使用对数空间网格，它在较小半径处提供更高的分辨率。\n\n### 索博列夫近似\n\n索博列夫（或大速度梯度，LVG）近似通过假设速度梯度 $|dv/dr|$ 很大来简化辐射转移问题。这意味着气块能够与给定频率的光子相互作用的区域非常小（“共振区”）。然后，光学深度积分在此共振点 $r_{\\mathrm{res}}$ 处进行局部评估。\n\n当共动坐标系中的频率 $\\nu'$ 与谱线的静止频率 $\\nu_0$ 匹配时，在半径 $r_{\\mathrm{res}}$ 处发生共振：\n$$\n\\nu'\\left(\\nu, r_{\\mathrm{res}}\\right) = \\nu_0 \\implies v(r_{\\mathrm{res}}) = c \\left(1 - \\frac{\\nu_0}{\\nu}\\right)\n$$\n通过反演β律速度剖面来求解该方程以得到 $r_{\\mathrm{res}}$。对于 $\\beta=1$ 的情况：\n$$\nr_{\\mathrm{res}} = R_\\star \\left(1 - \\frac{v(r_{\\mathrm{res}})}{v_\\infty}\\right)^{-1}\n$$\n一个物理上有意义的共振点必须满足 $R_\\star \\le r_{\\mathrm{res}} \\le R_{\\max}$ 和 $0  v(r_{\\mathrm{res}})  v_\\infty$。如果不满足这些条件，则风中没有发生共振，索博列夫近似预测没有相互作用，因此 $I_{\\nu,\\mathrm{Sob}} = 0$。\n\n如果存在有效的共振点，则计算索博列夫光学深度 $\\tau_{\\mathrm{Sob}}$。通过以速度重新参数化光学深度积分，并假设速度梯度在狭窄的共振区内是恒定的，可以推导出：\n$$\n\\tau_{\\mathrm{Sob}} = \\int \\chi_\\nu ds \\approx \\frac{1}{|dv/dr|_{r_{\\mathrm{res}}}} \\int_{-\\infty}^{\\infty} \\chi_0 \\exp\\left(-\\left(\\frac{\\delta v}{v_{\\mathrm{th}}}\\right)^2\\right) d(\\delta v) = \\frac{\\sqrt{\\pi} \\, \\chi_0 v_{\\mathrm{th}}}{|dv/dr|_{r_{\\mathrm{res}}}}\n$$\n其中β律的速度梯度由下式给出：\n$$\n\\frac{dv}{dr} = v_\\infty \\beta \\frac{R_\\star}{r^2} \\left(1 - \\frac{R_\\star}{r}\\right)^{\\beta - 1}\n$$\n利用索博列夫光学深度，出射强度（对于零背景强度）为：\n$$\nI_{\\nu,\\mathrm{Sob}} = S_0 \\left(1 - e^{-\\tau_{\\mathrm{Sob}}}\\right)\n$$\n\n### 误差度量\n\n索博列夫近似的准确性由两种方法得到的归一化强度之间的无量纲对称相对误差 $\\varepsilon$ 来量化：\n$$\n\\varepsilon = \\frac{2 \\left| I_{\\nu,\\mathrm{Sob}} - I_{\\nu,\\mathrm{full}} \\right|}{\\left| I_{\\nu,\\mathrm{Sob}} \\right| + \\left| I_{\\nu,\\mathrm{full}} \\right|}\n$$\n该度量的范围从0（完全一致）到2（最大不一致，例如一个值为零而另一个非零）。按照惯例，如果两个强度都为零，则 $\\varepsilon=0$。", "answer": "```python\nimport numpy as np\nfrom scipy.constants import c\n\ndef solve():\n    \"\"\"\n    Main function to solve the radiative transfer problem for the specified test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"case\": \"A\",\n            \"v_inf\": 2.0e6,  # m/s\n            \"beta\": 1.0,\n            \"R_star\": 7.0e9,  # m\n            \"R_max\": 3.5e11,  # m\n            \"chi_0\": 3.0e-8,  # m^-1\n            \"v_th\": 1.0e4,  # m/s\n            \"S_0\": 1.0,  # Dimensionless\n            \"nu_0\": 1.0e15,  # Hz\n            \"nu\": 1.001e15,  # Hz\n        },\n        {\n            \"case\": \"B\",\n            \"v_inf\": 2.0e6,\n            \"beta\": 1.0,\n            \"R_star\": 7.0e9,\n            \"R_max\": 3.5e11,\n            \"chi_0\": 3.0e-8,\n            \"v_th\": 1.0e4,\n            \"S_0\": 1.0,\n            \"nu_0\": 1.0e15,\n            \"nu\": 1.0065e15,\n        },\n        {\n            \"case\": \"C\",\n            \"v_inf\": 2.0e6,\n            \"beta\": 1.0,\n            \"R_star\": 7.0e9,\n            \"R_max\": 3.5e11,\n            \"chi_0\": 3.0e-8,\n            \"v_th\": 1.0e4,\n            \"S_0\": 1.0,\n            \"nu_0\": 1.0e15,\n            \"nu\": 1.008e15,\n        },\n    ]\n\n    def v_law(r, p):\n        \"\"\"Beta-velocity law.\"\"\"\n        # Prevent division by zero or negative arguments for r  R_star\n        # The problem statement guarantees r >= R_star.\n        term = 1.0 - p[\"R_star\"] / r\n        return p[\"v_inf\"] * (term**p[\"beta\"])\n\n    def dv_dr_law(r, p):\n        \"\"\"Derivative of the beta-velocity law.\"\"\"\n        term1 = p[\"v_inf\"] * p[\"beta\"] * p[\"R_star\"] / (r**2)\n        # Handle the case where beta=1 and r=R_star to avoid 0^0\n        if p[\"beta\"] == 1.0 and np.isclose(r, p[\"R_star\"]):\n            term2 = 1.0\n        else:\n            term2 = (1.0 - p[\"R_star\"] / r)**(p[\"beta\"] - 1.0)\n        return term1 * term2\n\n    def calculate_full_intensity(p, n_steps=200000):\n        \"\"\"\n        Calculates the emergent intensity using the full formal solution.\n        A fine logarithmic grid is used for numerical stability and accuracy.\n        \"\"\"\n        r_grid = np.logspace(np.log10(p[\"R_star\"]), np.log10(p[\"R_max\"]), n_steps)\n        dr = np.diff(r_grid)\n        r_mid = r_grid[:-1] + dr / 2.0\n\n        delta_nu_D = p[\"nu_0\"] * p[\"v_th\"] / c\n        intensity = 0.0\n\n        # Vectorized calculation for efficiency\n        vel_mid = v_law(r_mid, p)\n        nu_prime = p[\"nu\"] * (1.0 - vel_mid / c)\n        \n        exponent = -((nu_prime - p[\"nu_0\"]) / delta_nu_D)**2\n        chi_nu_mid = p[\"chi_0\"] * np.exp(exponent)\n        \n        delta_tau = chi_nu_mid * dr\n        \n        # Iterative update (cannot be fully vectorized due to sequential dependency)\n        for d_tau in delta_tau:\n            exp_neg_dtau = np.exp(-d_tau)\n            intensity = intensity * exp_neg_dtau + p[\"S_0\"] * (1.0 - exp_neg_dtau)\n\n        return intensity\n\n    def calculate_sobolev_intensity(p):\n        \"\"\"Calculates the emergent intensity using the Sobolev approximation.\"\"\"\n        v_req = c * (1.0 - p[\"nu_0\"] / p[\"nu\"])\n\n        if not (0  v_req  p[\"v_inf\"]):\n            return 0.0\n\n        # Invert the velocity law to find r_res\n        # v_req = v_inf * (1 - R_star/r_res)^beta\n        # (v_req/v_inf)^(1/beta) = 1 - R_star/r_res\n        # r_res = R_star / (1 - (v_req/v_inf)^(1/beta))\n        r_res = p[\"R_star\"] / (1.0 - (v_req / p[\"v_inf\"])**(1.0 / p[\"beta\"]))\n\n        if not (p[\"R_star\"] = r_res = p[\"R_max\"]):\n            return 0.0\n\n        dv_dr = dv_dr_law(r_res, p)\n        \n        # The velocity gradient must be positive for the wind to be accelerating.\n        if dv_dr = 0:\n            return 0.0\n\n        tau_sob = (np.sqrt(np.pi) * p[\"chi_0\"] * p[\"v_th\"]) / dv_dr\n        \n        intensity_sob = p[\"S_0\"] * (1.0 - np.exp(-tau_sob))\n        return intensity_sob\n\n    results = []\n    for params in test_cases:\n        I_full = calculate_full_intensity(params)\n        I_sob = calculate_sobolev_intensity(params)\n\n        numerator = 2.0 * abs(I_sob - I_full)\n        denominator = abs(I_sob) + abs(I_full)\n\n        if denominator == 0.0:\n            error = 0.0\n        else:\n            error = numerator / denominator\n        \n        results.append(error)\n\n    # Format the final output as specified.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```", "id": "3540922"}]}