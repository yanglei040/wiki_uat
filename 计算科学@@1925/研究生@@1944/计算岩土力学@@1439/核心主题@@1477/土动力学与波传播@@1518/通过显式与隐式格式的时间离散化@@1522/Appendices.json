{"hands_on_practices": [{"introduction": "我们实践的第一步是深入研究时间积分格式的理论核心——精度。通过为经典的线性振子推导局部截断误差，我们将精确地量化显式中心差分法和隐式Newmark平均加速度法在每个时间步引入的误差[@problem_id:3566460]。这个练习将帮助你理解“二阶精度”的真正含义，并为评估更复杂问题中数值格式的性能奠定坚实的理论基础。", "problem": "考虑一个无阻尼单自由度线性振子，该模型可用于（例如）模拟计算岩土力学中集总土体质量-弹簧理想化的基频振动模式。根据牛顿第二定律推导出的控制方程为\n$$\nm\\,\\ddot{u}(t) + k\\,u(t) = 0,\\quad m0,\\ k0,\n$$\n其中 $u(t)$ 是广义位移。定义圆自然频率为 $\\omega^{2} = k/m$，并将方程写为归一化形式\n$$\n\\ddot{u}(t) + \\omega^{2}\\,u(t) = 0.\n$$\n设 $t_{n} = t_{0} + n\\,\\Delta t$，其中时间步长 $\\Delta t0$ 为常数，并记 $u_{n} = u(t_{n})$，$v_{n} = \\dot{u}(t_{n})$，$a_{n} = \\ddot{u}(t_{n})$。\n\n任务 A（中心差分（CD）法，显式）。针对该振子的中心差分法可写作\n$$\n\\frac{u_{n+1} - 2\\,u_{n} + u_{n-1}}{\\Delta t^{2}} + \\omega^{2}\\,u_{n} = 0.\n$$\n将在 $t_{n}$ 处的局部截断误差定义为如下余项\n$$\n\\tau^{\\mathrm{CD}}_{n} := \\frac{u(t_{n+1}) - 2\\,u(t_{n}) + u(t_{n-1})}{\\Delta t^{2}} + \\omega^{2}\\,u(t_{n}),\n$$\n该余项通过将精确解 $u(t)$ 代入数值格式得到。仅使用关于 $t_{n}$ 的基本泰勒展开和控制微分方程，推导 $\\tau^{\\mathrm{CD}}_{n}$ 中关于 $\\Delta t$ 幂次的首个非零项。\n\n任务 B（Newmark 平均加速度（AA）法，隐式）。Newmark 平均加速度法由一对更新公式定义，其平均加速度参数为 $\\beta = 1/4$ 和 $\\gamma = 1/2$：\n$$\nu_{n+1} = u_{n} + \\Delta t\\,v_{n} + \\frac{\\Delta t^{2}}{4}\\,\\big(a_{n} + a_{n+1}\\big),\\qquad\nv_{n+1} = v_{n} + \\frac{\\Delta t}{2}\\,\\big(a_{n} + a_{n+1}\\big),\n$$\n并结合线性振子关系式 $a_{n} = -\\omega^{2}\\,u_{n}$ 和 $a_{n+1} = -\\omega^{2}\\,u_{n+1}$。将在 $t_{n}$ 处的局部截断误差定义为将精确解的值代入这些更新公式后得到的一对余项：\n$$\n\\tau^{\\mathrm{N}}_{u,n} := u(t_{n+1}) - u(t_{n}) - \\Delta t\\,v(t_{n}) - \\frac{\\Delta t^{2}}{4}\\,\\big(a(t_{n}) + a(t_{n+1})\\big),\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} := v(t_{n+1}) - v(t_{n}) - \\frac{\\Delta t}{2}\\,\\big(a(t_{n}) + a(t_{n+1})\\big).\n$$\n仅使用关于 $t_{n}$ 的基本泰勒展开和控制微分方程，推导 $\\tau^{\\mathrm{N}}_{u,n}$ 和 $\\tau^{\\mathrm{N}}_{v,n}$ 中关于 $\\Delta t$ 幂次的首个非零项。\n\n任务 C（全局精度阶）。利用局部截断误差所揭示的相容性阶，以及两种格式对于线性振子已知的零点稳定性，推断中心差分法和 Newmark 平均加速度法关于 $u(t)$ 的全局精度阶。将最终答案表示为一个行矩阵，其中包含位移的两个全局精度阶，顺序为 [中心差分法, Newmark 平均加速度法]。最终答案无需单位。如果在推导过程中需要陈述任何数值常数，请保持其精确的有理数形式。最终答案必须是包含两个整数的单个行矩阵。", "solution": "在尝试任何解答之前，需对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   **控制方程**：$m\\,\\ddot{u}(t) + k\\,u(t) = 0$，其中质量 $m0$，刚度 $k0$。\n-   **归一化形式**：$\\ddot{u}(t) + \\omega^{2}\\,u(t) = 0$，其中圆自然频率为 $\\omega = \\sqrt{k/m}$。\n-   **时间离散化**：$t_{n} = t_{0} + n\\,\\Delta t$，其中时间步长 $\\Delta t0$ 为常数。\n-   **离散变量**：$u_{n} = u(t_{n})$，$v_{n} = \\dot{u}(t_{n})$，$a_{n} = \\ddot{u}(t_{n})$。\n-   **任务 A：中心差分（CD）法**：\n    -   格式：$\\frac{u_{n+1} - 2\\,u_{n} + u_{n-1}}{\\Delta t^{2}} + \\omega^{2}\\,u_{n} = 0$。\n    -   局部截断误差 (LTE)：$\\tau^{\\mathrm{CD}}_{n} := \\frac{u(t_{n+1}) - 2\\,u(t_{n}) + u(t_{n-1})}{\\Delta t^{2}} + \\omega^{2}\\,u(t_{n})$。\n    -   目标：推导 $\\tau^{\\mathrm{CD}}_{n}$ 的首个非零项。\n-   **任务 B：Newmark 平均加速度（AA）法**：\n    -   参数：$\\beta = 1/4$，$\\gamma = 1/2$。\n    -   更新公式：\n        $u_{n+1} = u_{n} + \\Delta t\\,v_{n} + \\frac{\\Delta t^{2}}{4}\\,\\big(a_{n} + a_{n+1}\\big)$\n        $v_{n+1} = v_{n} + \\frac{\\Delta t}{2}\\,\\big(a_{n} + a_{n+1}\\big)$\n    -   控制方程的强制执行：$a_{n} = -\\omega^{2}\\,u_{n}$ 和 $a_{n+1} = -\\omega^{2}\\,u_{n+1}$。\n    -   局部截断误差 (LTEs)：\n        $\\tau^{\\mathrm{N}}_{u,n} := u(t_{n+1}) - u(t_{n}) - \\Delta t\\,v(t_{n}) - \\frac{\\Delta t^{2}}{4}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)$\n        $\\tau^{\\mathrm{N}}_{v,n} := v(t_{n+1}) - v(t_{n}) - \\frac{\\Delta t}{2}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)$\n    -   目标：推导 $\\tau^{\\mathrm{N}}_{u,n}$ 和 $\\tau^{\\mathrm{N}}_{v,n}$ 的首个非零项。\n-   **任务 C：全局精度阶**：\n    -   前提：已知两种格式都是零点稳定的。\n    -   目标：使用任务 A 和 B 中的相容性阶，确定中心差分法和 Newmark 平均加速度法对位移 $u(t)$ 的全局精度阶。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题定义明确且科学上合理。\n-   **科学基础**：该问题探讨了针对线性振子（物理学和工程学中的一个基本模型）的标准且广泛使用的时间积分格式（中心差分法和 Newmark 法）的分析。这些方法和概念是计算动力学的基石。\n-   **适定的**：这些任务是具体且数学化的，要求基于泰勒级数展开和标准数值分析理论的解释进行推导。该问题有唯一且有意义的解。\n-   **目标**：问题以精确的数学语言陈述，没有歧义或主观内容。\n-   **完整且一致**：所有必要的方程、定义和条件都已提供。没有内部矛盾。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 求解推导\n\n求解需要通过将控制微分方程 $\\ddot{u}(t) + \\omega^2 u(t) = 0$ 的精确解 $u(t)$ 代入数值格式来评估局部截断误差 (LTEs)。精确解的各阶导数之间通过以下关系关联：$\\ddot{u}(t) = -\\omega^2 u(t)$，$\\dddot{u}(t) = -\\omega^2 \\dot{u}(t)$，$u^{(4)}(t) = -\\omega^2 \\ddot{u}(t) = \\omega^4 u(t)$，依此类推。\n\n**任务 A：中心差分（CD）法的局部截断误差**\n\nCD 法的 LTE 由下式给出：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\frac{u(t_{n+1}) - 2\\,u(t_{n}) + u(t_{n-1})}{\\Delta t^{2}} + \\omega^{2}\\,u(t_{n})\n$$\n我们对 $u(t_{n+1})$ 和 $u(t_{n-1})$ 在时间 $t_{n}$ 处进行泰勒级数展开。为简洁起见，令 $u_{n} = u(t_{n})$，$\\dot{u}_{n} = \\dot{u}(t_{n})$ 等。\n$$\nu(t_{n+1}) = u_{n} + \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2!}\\,\\ddot{u}_{n} + \\frac{\\Delta t^3}{3!}\\,\\dddot{u}_{n} + \\frac{\\Delta t^4}{4!}\\,u^{(4)}_{n} + O(\\Delta t^5)\n$$\n$$\nu(t_{n-1}) = u_{n} - \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2!}\\,\\ddot{u}_{n} - \\frac{\\Delta t^3}{3!}\\,\\dddot{u}_{n} + \\frac{\\Delta t^4}{4!}\\,u^{(4)}_{n} - O(\\Delta t^5)\n$$\n将这些代入 $\\tau^{\\mathrm{CD}}_{n}$ 第一项的分子中：\n$$\nu(t_{n+1}) - 2\\,u_{n} + u(t_{n-1}) = \\left(2\\,\\frac{\\Delta t^2}{2!}\\,\\ddot{u}_{n}\\right) + \\left(2\\,\\frac{\\Delta t^4}{4!}\\,u^{(4)}_{n}\\right) + O(\\Delta t^6)\n$$\n$$\nu(t_{n+1}) - 2\\,u_{n} + u(t_{n-1}) = \\Delta t^2\\,\\ddot{u}_{n} + \\frac{\\Delta t^4}{12}\\,u^{(4)}_{n} + O(\\Delta t^6)\n$$\n现在，将此结果代回 $\\tau^{\\mathrm{CD}}_{n}$ 的表达式中：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\frac{\\Delta t^2\\,\\ddot{u}_{n} + \\frac{\\Delta t^4}{12}\\,u^{(4)}_{n} + O(\\Delta t^6)}{\\Delta t^2} + \\omega^{2}\\,u_{n}\n$$\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\left(\\ddot{u}_{n} + \\frac{\\Delta t^2}{12}\\,u^{(4)}_{n} + O(\\Delta t^4)\\right) + \\omega^{2}\\,u_{n}\n$$\n重新整理各项，将控制方程组合在一起：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\big(\\ddot{u}_{n} + \\omega^{2}\\,u_{n}\\big) + \\frac{\\Delta t^2}{12}\\,u^{(4)}_{n} + O(\\Delta t^4)\n$$\n由于 $u(t)$ 是精确解，$\\ddot{u}_{n} + \\omega^2 u_{n} = 0$。因此，表达式简化为：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\frac{\\Delta t^2}{12}\\,u^{(4)}_{n} + O(\\Delta t^4)\n$$\n局部截断误差的首个非零项是 $\\frac{\\Delta t^2}{12}\\,u^{(4)}(t_{n})$。\n\n**任务 B：Newmark 平均加速度法的局部截断误差**\n\n我们分别推导位移和速度更新的 LTE。\n\n对于位移更新，LTE 为：\n$$\n\\tau^{\\mathrm{N}}_{u,n} = u(t_{n+1}) - u(t_{n}) - \\Delta t\\,v(t_{n}) - \\frac{\\Delta t^{2}}{4}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)\n$$\n我们使用关于 $t_{n}$ 的 $u(t_{n+1})$ 和 $a(t_{n+1})$ 的泰勒展开。我们回顾 $v_n=\\dot{u}_n$，$a_n=\\ddot{u}_n$，$\\dot{a}_n=\\dddot{u}_n$。\n$$\nu(t_{n+1}) = u_{n} + \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{u}_{n} + \\frac{\\Delta t^3}{6}\\,\\dddot{u}_{n} + O(\\Delta t^4)\n$$\n$$\na(t_{n+1}) = a_{n} + \\Delta t\\,\\dot{a}_{n} + O(\\Delta t^2)\n$$\n将这些代入 $\\tau^{\\mathrm{N}}_{u,n}$ 的表达式中：\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(u_{n} + \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{u}_{n} + \\frac{\\Delta t^3}{6}\\,\\dddot{u}_{n} + \\dots\\right) - u_{n} - \\Delta t\\,\\dot{u}_{n} - \\frac{\\Delta t^2}{4}\\,\\big(a_{n} + (a_{n} + \\Delta t\\,\\dot{a}_{n} + \\dots)\\big)\n$$\n注意到 $\\dot{u}_n=v_n$ 和 $\\ddot{u}_n=a_n$，我们简化得：\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(\\frac{\\Delta t^2}{2}\\,a_{n} + \\frac{\\Delta t^3}{6}\\,\\dot{a}_{n} + \\dots\\right) - \\frac{\\Delta t^2}{4}\\,\\big(2\\,a_{n} + \\Delta t\\,\\dot{a}_{n} + \\dots\\big)\n$$\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(\\frac{\\Delta t^2}{2}\\,a_{n} + \\frac{\\Delta t^3}{6}\\,\\dot{a}_{n}\\right) - \\left(\\frac{\\Delta t^2}{2}\\,a_{n} + \\frac{\\Delta t^3}{4}\\,\\dot{a}_{n}\\right) + O(\\Delta t^4)\n$$\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(\\frac{1}{6} - \\frac{1}{4}\\right)\\Delta t^3\\,\\dot{a}_{n} + O(\\Delta t^4) = -\\frac{1}{12}\\,\\dot{a}_{n}\\,\\Delta t^3 + O(\\Delta t^4)\n$$\n首项为 $-\\frac{1}{12}\\,\\dddot{u}(t_{n})\\,\\Delta t^3$。\n\n对于速度更新，LTE 为：\n$$\n\\tau^{\\mathrm{N}}_{v,n} = v(t_{n+1}) - v(t_{n}) - \\frac{\\Delta t}{2}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)\n$$\n我们使用关于 $t_n$ 的 $v(t_{n+1})$ 和 $a(t_{n+1})$ 的泰勒展开。我们回顾 $\\dot{v}_n=a_n$，$\\ddot{v}_n=\\dot{a}_n$，$\\dddot{v}_n=\\ddot{a}_n$。\n$$\nv(t_{n+1}) = v_{n} + \\Delta t\\,\\dot{v}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{v}_{n} + \\frac{\\Delta t^3}{6}\\,\\dddot{v}_{n} + O(\\Delta t^4)\n$$\n$$\na(t_{n+1}) = a_{n} + \\Delta t\\,\\dot{a}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{a}_{n} + O(\\Delta t^3)\n$$\n将这些代入 $\\tau^{\\mathrm{N}}_{v,n}$ 的表达式中：\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(v_{n} + \\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{6}\\,\\ddot{a}_{n} + \\dots\\right) - v_{n} - \\frac{\\Delta t}{2}\\,\\big(a_{n} + (a_{n} + \\Delta t\\,\\dot{a}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{a}_{n} + \\dots)\\big)\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(\\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{6}\\,\\ddot{a}_{n}\\right) - \\frac{\\Delta t}{2}\\,\\big(2\\,a_{n} + \\Delta t\\,\\dot{a}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{a}_{n}\\big) + O(\\Delta t^4)\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(\\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{6}\\,\\ddot{a}_{n}\\right) - \\left(\\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{4}\\,\\ddot{a}_{n}\\right) + O(\\Delta t^4)\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(\\frac{1}{6} - \\frac{1}{4}\\right)\\Delta t^3\\,\\ddot{a}_{n} + O(\\Delta t^4) = -\\frac{1}{12}\\,\\ddot{a}_{n}\\,\\Delta t^3 + O(\\Delta t^4)\n$$\n首项为 $-\\frac{1}{12}\\,u^{(4)}(t_{n})\\,\\Delta t^3$。\n\n**任务 C：全局精度阶**\n\n一个数值方法的全局精度阶即为其收敛阶。对于一个零点稳定的方法，其收敛阶等于其相容性阶。问题陈述了两种格式都是零点稳定的。\n\n对于中心差分法，LTE 被定义为将精确解代入离散化的微分方程后得到的残差：$\\tau^{\\mathrm{CD}}_n = O(\\Delta t^p)$ 意味着相容性阶为 $p$。从任务 A 中，我们得到 $\\tau^{\\mathrm{CD}}_n = O(\\Delta t^2)$。因此，相容性阶为 $p=2$。所以中心差分法的全局精度阶为 $2$。\n\n对于 Newmark 平均加速度法，这是一个针对状态向量 $[u, v]^T$ 的单步格式，其 LTEs $\\tau^{\\mathrm{N}}_{u,n}$ 和 $\\tau^{\\mathrm{N}}_{v,n}$ 表示在单步中累积的误差（单步误差）。如果一个单步格式的单步误差为 $O(\\Delta t^{p+1})$ 阶，则称其具有 $p$ 阶相容性。从任务 B 中可知，位移和速度的 LTE 均为 $O(\\Delta t^3)$。这意味着 $p+1=3$，即相容性阶为 $p=2$。因此，Newmark 平均加速度法的全局精度阶为 $2$。\n\n两种方法对于位移 $u(t)$ 的全局精度阶均为 $2$。最终答案是包含这两个阶数的行矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2   2\n\\end{pmatrix}\n}\n$$", "id": "3566460"}, {"introduction": "理论精度在实际的波传播模拟中是如何体现的？在本练习中，我们将从抽象的精度阶数转向更具体的物理量：数值频散（相位误差）和数值耗散（幅值误差）[@problem_id:3566418]。通过对一维弹性杆的半离散化波动方程进行编程分析，你将亲眼观察到不同的时间积分格式如何影响波的传播速度和振幅，尤其是在时间步长接近显式格式稳定性极限时，这种对比会变得格外清晰。", "problem": "一个横截面积为A的均匀、等截面一维线弹性杆，其运动由一维线性动量守恒和Hooke定律控制，两者共同导出位移$u(x,t)$的标量波动方程$\\rho\\,\\partial^2 u/\\partial t^2 = E\\,\\partial^2 u/\\partial x^2$，其中$\\rho$是质量密度，$E$是Young模量。考虑一个长度为$L$的周期性域，该域通过由$N$个尺寸为$h=L/N$的线性有限元组成的均匀网格进行离散化，并采用一致质量矩阵。设半离散方程写作$M\\,\\ddot{\\mathbf{u}}(t) + K\\,\\mathbf{u}(t) = \\mathbf{0}$。在短时冲击下，响应可以表示为空间Fourier模态的叠加；我们关注一个整数索引为$m$的单色模态，其波数为$k = 2\\pi m/L$。在节点处假设一个模态ansatz（假设），$U_j \\propto e^{i j q}$，其中$q = k h = 2 \\pi m / N$，以便将沿该模态的半离散系统简化为标量模态振子形式 $\\ddot{u}_m(t) + \\omega_h^2\\,u_m(t)=0$，其中$\\omega_h$是由空间离散化引起的半离散角频率。使用以下基本依据：波动方程、两节点线性单元的标准一致质量和刚度矩阵，以及周期性ansatz（假设）。对于时间积分，考虑将中心差分格式（显式）和Newmark平均加速度格式（隐式）应用于模态方程。对于每种时间积分格式，不要借助任何预先引用的色散或放大公式，而是从第一性原理出发，推导无阻尼模态振子的数值角频率和每步放大因子。基于这些，为所选模态定义时间相速度相对误差和幅值误差如下：\n- 时间相速度相对误差为 $(\\omega_{\\text{num}}/\\omega_h)-1$，其中 $\\omega_{\\text{num}}$ 是时间积分格式对具有精确半离散角频率 $\\omega_h$ 的模态振子所产生的数值角频率。\n- 幅值误差为单步放大因子的模减去 $1$，即 $|g|-1$，其中 $g$ 是应用于模态振子的格式的单步放大因子。\n\n在整个过程中，所有三角函数的参数必须以弧度为单位。所有物理参数均以国际单位制（SI）表示。最终的误差数值答案是无量纲的，并且必须以浮点数形式返回。\n\n测试套件与要求输出：\n对于以下三个测试用例中的每一个，为比较两种时间积分格式，将空间网格和时间步长视为固定。对于每个案例，根据空间离散化计算所选模态的半离散角频率 $\\omega_h$，然后计算中心差分格式和Newmark平均加速度格式的时间相速度相对误差和幅值误差。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序如下：\n[phase_error_central_difference_case1, amplitude_error_central_difference_case1, phase_error_newmark_average_acceleration_case1, amplitude_error_newmark_average_acceleration_case1, phase_error_central_difference_case2, amplitude_error_central_difference_case2, phase_error_newmark_average_acceleration_case2, amplitude_error_newmark_average_acceleration_case2, phase_error_central_difference_case3, amplitude_error_central_difference_case3, phase_error_newmark_average_acceleration_case3, amplitude_error_newmark_average_acceleration_case3]\n每个条目必须是十进制形式的浮点数。\n\n每个测试用例使用以下数据：\n- 案例1（理想路径）：$E = 70\\times 10^9\\,\\mathrm{Pa}$，$\\rho = 2700\\,\\mathrm{kg/m^3}$，$N=100$，$h = 0.02\\,\\mathrm{m}$，$m=3$，$\\Delta t = 8.0\\times 10^{-6}\\,\\mathrm{s}$。\n- 案例2（接近显式稳定性边界）：$E = 70\\times 10^9\\,\\mathrm{Pa}$，$\\rho = 2700\\,\\mathrm{kg/m^3}$，$N=100$，$h = 0.02\\,\\mathrm{m}$，$m=20$，$\\Delta t = 5.8336\\times 10^{-6}\\,\\mathrm{s}$。\n- 案例3（小时间步长边缘案例）：$E = 30\\times 10^9\\,\\mathrm{Pa}$，$\\rho = 2000\\,\\mathrm{kg/m^3}$，$N=100$，$h = 0.02\\,\\mathrm{m}$，$m=1$，$\\Delta t = 1.0\\times 10^{-7}\\,\\mathrm{s}$。\n\n注释与要求：\n- 取波速为 $c = \\sqrt{E/\\rho}$。\n- 使用通过对均匀网格进行模态缩减得到的一致质量线性有限元色散来计算波数为$k=2\\pi m/L$（其中$L=Nh$）的模态的$\\omega_h$。不要假设任何集总质量简化。\n- 三角函数和反三角函数的角度必须以弧度为单位。\n- 最终程序不得要求任何用户输入，并且必须仅以上述确切格式打印单行结果。", "solution": "该问题是有效的。它具有科学依据、适定且客观。它提供了一套完整的数据和定义，可以根据计算力学的既定原理（特别是有限元法和时间离散格式）推导出唯一解。\n\n目标是从第一性原理出发，推导应用于半离散一维波动方程的两种时间积分格式（中心差分和Newmark平均加速度）的数值角频率和放大因子。这些将被用来计算特定测试用例的时间相速度和幅值误差。\n\n### 1. 半离散模态方程与角频率 ($\\omega_h$)\n\n一维弹性杆的控制偏微分方程是波动方程：\n$$\n\\rho \\frac{\\partial^2 u}{\\partial t^2} = E \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其中$\\rho$是质量密度，$E$是Young模量，$u(x,t)$是轴向位移。\n\n我们用$N$个尺寸为$h = L/N$的线性有限元来离散化一个长度为$L$的周期性域。对于单个两节点单元，刚度矩阵$K_e$和一致质量矩阵$M_e$为：\n$$\nK_e = \\frac{AE}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}, \\quad M_e = \\frac{\\rho A h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n其中$A$是横截面积。\n\n半离散方程组为$M\\ddot{\\mathbf{u}} + K\\mathbf{u} = \\mathbf{0}$。对于均匀周期性网格上的一个通用内部节点$j$，组装相邻单元$(j-1, j)$和$(j, j+1)$的贡献，得到方程：\n$$\n\\frac{\\rho A h}{6}(\\ddot{U}_{j-1} + 4\\ddot{U}_j + \\ddot{U}_{j+1}) + \\frac{AE}{h}(-U_{j-1} + 2U_j - U_{j+1}) = 0\n$$\n其中$U_j(t)$是节点$j$的位移。\n\n我们代入一个整数索引为$m$的单一Fourier模态的模态ansatz（假设），$U_j(t) = u_m(t)e^{ijq}$，其中$u_m(t)$是随时间变化的模态幅值，$q = kh = (2\\pi m/L)h = 2\\pi m/N$是无量纲波数。这得到$\\ddot{U}_j(t) = \\ddot{u}_m(t)e^{ijq}$。代入节点方程并除以公因子$Ae^{ijq}$，得到：\n$$\n\\frac{\\rho h}{6}\\ddot{u}_m(t)(e^{-iq} + 4 + e^{iq}) + \\frac{E}{h}u_m(t)(-e^{-iq} + 2 - e^{iq}) = 0\n$$\n使用Euler恒等式$e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$：\n$$\n\\frac{\\rho h}{6}\\ddot{u}_m(t)(2\\cos q + 4) + \\frac{E}{h}u_m(t)(-2\\cos q + 2) = 0\n$$\n重新整理得到标量模态振子方程$\\ddot{u}_m(t) + \\omega_h^2 u_m(t) = 0$，其中$\\omega_h^2$是半离散角频率的平方：\n$$\n\\omega_h^2 = \\frac{2E/h(1 - \\cos q)}{\\rho h/3(2 + \\cos q)} = \\frac{6E}{\\rho h^2} \\frac{1 - \\cos q}{2 + \\cos q}\n$$\n定义波速$c = \\sqrt{E/\\rho}$，半离散角频率$\\omega_h$为：\n$$\n\\omega_h = \\frac{c}{h} \\sqrt{6 \\frac{1 - \\cos(2\\pi m/N)}{2 + \\cos(2\\pi m/N)}}\n$$\n\n### 2. 中心差分格式分析\n\n应用于模态方程$\\ddot{u} + \\omega_h^2 u = 0$的中心差分格式为：\n$$\n\\frac{u^{n+1} - 2u^n + u^{n-1}}{\\Delta t^2} + \\omega_h^2 u^n = 0\n$$\n其中$u^n = u_m(n\\Delta t)$。我们寻求$u^n = g^n u^0$形式的解，其中$g$是单步放大因子。代入后得到关于$g$的特征方程：\n$$\ng^2 - (2 - \\omega_h^2 \\Delta t^2)g + 1 = 0\n$$\n令$\\Omega = \\omega_h \\Delta t$。方程为$g^2 - (2-\\Omega^2)g + 1 = 0$。其根为：\n$$\ng = \\frac{(2-\\Omega^2) \\pm \\sqrt{(2-\\Omega^2)^2 - 4}}{2} = 1 - \\frac{\\Omega^2}{2} \\pm \\sqrt{\\left(1-\\frac{\\Omega^2}{2}\\right)^2 - 1}\n$$\n对于稳定、振荡的响应，根必须是单位圆上的复共轭对。这发生在判别式非正时，即$(2-\\Omega^2)^2 - 4 \\le 0$，简化后得到Courant-Friedrichs-Lewy (CFL) 稳定性条件$\\Omega \\le 2$。\n\n**幅值误差：**对于$\\Omega \\le 2$，根是复共轭对，其乘积为$1$，因此$|g|=1$。定义为$|g|-1$的幅值误差因此为$0$。所有测试用例都满足此条件。\n\n**时间相速度相对误差：**对于稳定响应，我们可以写出$g = e^{i\\omega_{\\text{num}}\\Delta t} = \\cos(\\omega_{\\text{num}}\\Delta t) + i\\sin(\\omega_{\\text{num}}\\Delta t)$。根的和为$g+\\bar{g} = 2\\Re(g) = 2\\cos(\\omega_{\\text{num}}\\Delta t)$。根据特征方程的Vieta定理，根的和为$2-\\Omega^2$。因此：\n$$\n2\\cos(\\omega_{\\text{num}}\\Delta t) = 2 - \\Omega^2 \\implies \\cos(\\omega_{\\text{num}}\\Delta t) = 1 - \\frac{\\Omega^2}{2}\n$$\n数值角频率为$\\omega_{\\text{num}} = \\frac{1}{\\Delta t}\\arccos\\left(1 - \\frac{(\\omega_h\\Delta t)^2}{2}\\right)$。相误差为：\n$$\n\\left(\\frac{\\omega_{\\text{num}}}{\\omega_h}\\right) - 1 = \\frac{1}{\\omega_h\\Delta t}\\arccos\\left(1 - \\frac{(\\omega_h\\Delta t)^2}{2}\\right) - 1\n$$\n\n### 3. Newmark平均加速度格式分析\n\n这个应用于$\\ddot{u} + \\omega_h^2 u = 0$的隐式格式($\\beta=1/4, \\gamma=1/2$)是无条件稳定的。可以通过分析系统的放大矩阵找到单步放大因子$g$。一个更直接的方法得出复放大因子：\n$$\ng = \\frac{1 - (\\omega_h\\Delta t)^2/4}{1 + (\\omega_h\\Delta t)^2/4} + i \\frac{\\omega_h\\Delta t}{1 + (\\omega_h\\Delta t)^2/4}\n$$\n\n**幅值误差：**$g$的模为：\n$$\n|g|^2 = \\frac{(1-\\Omega^2/4)^2 + \\Omega^2}{(1+\\Omega^2/4)^2} = \\frac{1 - \\Omega^2/2 + \\Omega^4/16 + \\Omega^2}{1 + \\Omega^2/2 + \\Omega^4/16} = \\frac{1 + \\Omega^2/2 + \\Omega^4/16}{1 + \\Omega^2/2 + \\Omega^4/16} = 1\n$$\n因此，对于所有$\\Omega$值，$|g|=1$，证实了其无条件稳定性。幅值误差为$|g|-1 = 0$。\n\n**时间相速度相对误差：**我们通过$g = e^{i\\omega_{\\text{num}}\\Delta t}$将$g$与$\\omega_{\\text{num}}$关联起来。一个方便的关系式涉及半角正切：\n$$\n\\tan\\left(\\frac{\\omega_{\\text{num}}\\Delta t}{2}\\right) = \\frac{\\sin(\\omega_{\\text{num}}\\Delta t)}{1+\\cos(\\omega_{\\text{num}}\\Delta t)} = \\frac{\\Im(g)}{1+\\Re(g)}\n$$\n代入$g$的实部和虚部：\n$$\n\\tan\\left(\\frac{\\omega_{\\text{num}}\\Delta t}{2}\\right) = \\frac{\\Omega/(1+\\Omega^2/4)}{1 + (1-\\Omega^2/4)/(1+\\Omega^2/4)} = \\frac{\\Omega}{1+\\Omega^2/4 + 1-\\Omega^2/4} = \\frac{\\Omega}{2}\n$$\n数值角频率为$\\omega_{\\text{num}} = \\frac{2}{\\Delta t}\\arctan\\left(\\frac{\\omega_h\\Delta t}{2}\\right)$。相误差为：\n$$\n\\left(\\frac{\\omega_{\\text{num}}}{\\omega_h}\\right) - 1 = \\frac{2}{\\omega_h\\Delta t}\\arctan\\left(\\frac{\\omega_h\\Delta t}{2}\\right) - 1\n$$\n\n### 4. 测试用例计算总结\n对于每个测试用例$(E, \\rho, N, h, m, \\Delta t)$：\n1. 计算 $c = \\sqrt{E/\\rho}$。\n2. 计算 $\\omega_h = \\frac{c}{h} \\sqrt{6 \\frac{1 - \\cos(2\\pi m/N)}{2 + \\cos(2\\pi m/N)}}$。\n3. 计算 $\\Omega = \\omega_h \\Delta t$。\n4. 中心差分误差：\n   - 幅值误差： $0.0$\n   - 相位误差： $\\frac{1}{\\Omega}\\arccos(1 - \\Omega^2/2) - 1$\n5. Newmark平均加速度误差：\n   - 幅值误差： $0.0$\n   - 相位误差： $\\frac{2}{\\Omega}\\arctan(\\Omega/2) - 1$", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the phase and amplitude errors for Central Difference and\n    Newmark Average Acceleration schemes for given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path)\n        {'E': 70e9, 'rho': 2700, 'N': 100, 'h': 0.02, 'm': 3, 'dt': 8.0e-6},\n        # Case 2 (near explicit stability boundary)\n        {'E': 70e9, 'rho': 2700, 'N': 100, 'h': 0.02, 'm': 20, 'dt': 5.8336e-6},\n        # Case 3 (small time step edge case)\n        {'E': 30e9, 'rho': 2000, 'N': 100, 'h': 0.02, 'm': 1, 'dt': 1.0e-7},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        E = case['E']\n        rho = case['rho']\n        N = case['N']\n        h = case['h']\n        m = case['m']\n        dt = case['dt']\n\n        # 1. Calculate semi-discrete angular frequency (omega_h)\n        c = np.sqrt(E / rho)\n        q = 2 * np.pi * m / N\n        \n        # This is the derived formula for omega_h squared\n        omega_h_sq = (6 * c**2 / h**2) * (1 - np.cos(q)) / (2 + np.cos(q))\n        omega_h = np.sqrt(omega_h_sq)\n\n        # Dimensionless time step\n        Omega = omega_h * dt\n\n        # 2. Central Difference (Explicit) Scheme Analysis\n        # Amplitude error is 0 for stable cases (Omega = 2)\n        # All test cases are designed to be stable.\n        amp_err_cd = 0.0\n        \n        # Phase speed relative error\n        # Formula: (arccos(1 - Omega^2/2) / Omega) - 1\n        # np.arccos expects argument in [-1, 1]. All cases satisfy this.\n        phase_err_cd = np.arccos(1 - Omega**2 / 2) / Omega - 1\n\n        # 3. Newmark Average Acceleration (Implicit) Scheme Analysis\n        # Amplitude error is 0 unconditionally\n        amp_err_naa = 0.0\n\n        # Phase speed relative error\n        # Formula: (2 * arctan(Omega/2) / Omega) - 1\n        phase_err_naa = (2 / Omega) * np.arctan(Omega / 2) - 1\n        \n        results.extend([phase_err_cd, amp_err_cd, phase_err_naa, amp_err_naa])\n\n    # Format the output as a single comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3566418"}, {"introduction": "隐式格式虽然具有优越的稳定性，但当系统存在非线性时，其求解过程本身就是一个挑战。这个实践将带你攻克在非线性动力学中应用隐式Newmark法的核心难题：求解非线性代数方程组[@problem_id:3566474]。你将从零开始推导并实现一个Newton-Raphson求解器，并理解如何通过静态凝聚（static condensation）得到高效的有效切线刚度$K_{\\mathrm{eff}}$，这是实现快速收敛和高效计算的关键所在。", "problem": "考虑一个单自由度动力系统，其代表一个集总的岩土力学离散化，由线性动量平衡的强形式控制：\n$$\nm\\,\\ddot{u}(t) + c\\,\\dot{u}(t) + f_{\\mathrm{int}}(u(t)) = f_{\\mathrm{ext}}(t),\n$$\n其中 $m$ 是质量，$c$ 是粘性阻尼系数，$u(t)$ 是位移，$f_{\\mathrm{int}}(u)$ 是由材料响应产生的非线性内力，$f_{\\mathrm{ext}}(t)$ 是给定的外力。假设一个由标量势表征的非线性材料响应，其导致的内力为\n$$\nf_{\\mathrm{int}}(u) = k\\,u + \\alpha\\,u^3,\n$$\n其中 $k  0$ 且 $\\alpha \\ge 0$。\n\n使用隐式 Newmark 族方法对时间进行离散化，时间步长为 $\\Delta t$，参数为 $\\beta$ 和 $\\gamma$。运动学更新如下：\n$$\nu_{n+1} = u_n + \\Delta t\\,v_n + \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n + \\beta\\,\\Delta t^2\\,a_{n+1},\n$$\n$$\nv_{n+1} = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1},\n$$\n在 $t_{n+1}$ 时刻的动力学平衡为\n$$\nm\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) = f_{\\mathrm{ext}}(t_{n+1}).\n$$\n\n任务 1 (推导)：从线性动量平衡和隐式 Newmark 更新出发，通过写出残差\n$$\nR_m(u_{n+1}, v_{n+1}, a_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1}),\n$$\n$$\nR_v(u_{n+1}, v_{n+1}, a_{n+1}) = v_{n+1} - v_n - \\Delta t\\,(1 - \\gamma)\\,a_n - \\gamma\\,\\Delta t\\,a_{n+1},\n$$\n$$\nR_u(u_{n+1}, v_{n+1}, a_{n+1}) = u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n - \\beta\\,\\Delta t^2\\,a_{n+1},\n$$\n为未知向量 $\\left[u_{n+1},\\,v_{n+1},\\,a_{n+1}\\right]^\\top$ 构建 Newton–Raphson 迭代，并推导关于 $\\left[u_{n+1},\\,v_{n+1},\\,a_{n+1}\\right]^\\top$ 的 $3\\times 3$ 偏导数雅可比矩阵。明确指出每个雅可比块，并展示一致性线性化如何产生二次收敛。\n\n任务 2 (缩聚)：展示如何通过 Newmark 约束消除 $v_{n+1}$ 和 $a_{n+1}$，以获得关于 $u_{n+1}$ 的标量牛顿更新，其有效切线为\n$$\nK_{\\mathrm{eff}}(u_{n+1}) = K_t(u) = \\dfrac{df_{\\mathrm{int}}}{du}(u) + a_0\\,m + a_1\\,c,\n$$\n其中 $K_t(u) = \\dfrac{df_{\\mathrm{int}}}{du}(u)$ 且 $a_0 = \\dfrac{1}{\\beta\\,\\Delta t^2}$，$a_1 = \\dfrac{\\gamma}{\\beta\\,\\Delta t}$。通过适当的 Schur 补直接从 $3\\times 3$ 雅可比矩阵推导出此结果。\n\n任务 3 (实现)：为单个隐式 Newmark 步骤实现一个 Newton–Raphson 求解器，该求解器使用针对 $u_{n+1}$ 的缩聚标量更新，其中\n$$\na_{n+1} = \\frac{1}{\\beta\\,\\Delta t^2}\\left(u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n\\right),\n$$\n$$\nv_{n+1} = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1},\n$$\n残差为\n$$\nr(u_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1}),\n$$\n更新为\n$$\n\\Delta u = -\\frac{r(u_{n+1})}{K_{\\mathrm{eff}}(u_{n+1})},\\quad u_{n+1}^{(k+1)} = u_{n+1}^{(k)} + \\Delta u.\n$$\n使用停止准则 $\\lvert r(u_{n+1})\\rvert \\le \\varepsilon$，其中 $\\varepsilon = 10^{-12}$。\n\n此外，构建完整的 $3\\times 3$ 雅可比矩阵，并数值验证其关于 $u_{n+1}$ 的 Schur 补在指定公差范围内与 $K_{\\mathrm{eff}}(u_{n+1})$ 匹配。将此验证报告为布尔值。\n\n初始化：从 $t_n$ 时刻的平衡状态计算 $a_n$，\n$$\na_n = \\frac{f_{\\mathrm{ext}}(t_n) - c\\,v_n - f_{\\mathrm{int}}(u_n)}{m}.\n$$\n\n测试套件：对于以下每种情况，计算 $u_{n+1}$ 和雅可比一致性布尔值。将 $u_{n+1}$ 以米为单位表示为浮点数。\n\n- 情况 A (一般非线性，有阻尼)：$m = 1.0\\,\\mathrm{kg}$，$c = 0.05\\,\\mathrm{N\\,s/m}$，$k = 100.0\\,\\mathrm{N/m}$，$\\alpha = 500.0\\,\\mathrm{N/m^3}$，$\\Delta t = 0.01\\,\\mathrm{s}$，$\\beta = 0.25$，$\\gamma = 0.5$，$u_n = 0.01\\,\\mathrm{m}$，$v_n = 0.0\\,\\mathrm{m/s}$，$f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$，$f_{\\mathrm{ext}}(t_{n+1}) = 1.0\\,\\mathrm{N}$。\n- 情况 B (无阻尼)：$m = 2.0\\,\\mathrm{kg}$，$c = 0.0\\,\\mathrm{N\\,s/m}$，$k = 200.0\\,\\mathrm{N/m}$，$\\alpha = 1000.0\\,\\mathrm{N/m^3}$，$\\Delta t = 0.01\\,\\mathrm{s}$，$\\beta = 0.25$，$\\gamma = 0.5$，$u_n = 0.0\\,\\mathrm{m}$，$v_n = 0.0\\,\\mathrm{m/s}$，$f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$，$f_{\\mathrm{ext}}(t_{n+1}) = 0.5\\,\\mathrm{N}$。\n- 情况 C (小时间步长)：$m = 1.0\\,\\mathrm{kg}$，$c = 0.05\\,\\mathrm{N\\,s/m}$，$k = 100.0\\,\\mathrm{N/m}$，$\\alpha = 500.0\\,\\mathrm{N/m^3}$，$\\Delta t = 0.001\\,\\mathrm{s}$，$\\beta = 0.25$，$\\gamma = 0.5$，$u_n = 0.01\\,\\mathrm{m}$，$v_n = 0.0\\,\\mathrm{m/s}$，$f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$，$f_{\\mathrm{ext}}(t_{n+1}) = 1.0\\,\\mathrm{N}$。\n- 情况 D (刚性非线性，中等阻尼)：$m = 0.5\\,\\mathrm{kg}$，$c = 0.2\\,\\mathrm{N\\,s/m}$，$k = 1000.0\\,\\mathrm{N/m}$，$\\alpha = 100000.0\\,\\mathrm{N/m^3}$，$\\Delta t = 0.01\\,\\mathrm{s}$，$\\beta = 0.25$，$\\gamma = 0.5$，$u_n = 0.002\\,\\mathrm{m}$，$v_n = 0.0\\,\\mathrm{m/s}$，$f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$，$f_{\\mathrm{ext}}(t_{n+1}) = 2.0\\,\\mathrm{N}$。\n\n最终输出格式：您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。对于每个测试用例，输出两个条目：首先是收敛后的位移 $u_{n+1}$（以米为单位的浮点数），然后是一个布尔值，指示缩聚的有效切线 $K_{\\mathrm{eff}}$ 是否在公差范围内与完整雅可比矩阵的 Schur 补匹配。例如，一个有四个案例的输出应如下所示\n$$\n[ u_A, \\mathrm{bool}_A, u_B, \\mathrm{bool}_B, u_C, \\mathrm{bool}_C, u_D, \\mathrm{bool}_D ].\n$$", "solution": "该问题要求为单自由度 (SDOF) 非线性动力系统制定并实现数值解。该系统的行为由运动方程描述，这是一个二阶非线性常微分方程：\n$$\nm\\,\\ddot{u}(t) + c\\,\\dot{u}(t) + f_{\\mathrm{int}}(u(t)) = f_{\\mathrm{ext}}(t)\n$$\n非线性源于内力，它由一个三次关系给出：$f_{\\mathrm{int}}(u) = k\\,u + \\alpha\\,u^3$，这是 Duffing 振子的特征。参数 $m$、$c$、$k$ 和 $\\alpha$ 分别是质量、阻尼系数、线性刚度和非线性刚度，其中 $k  0$ 且 $\\alpha \\ge 0$。\n\n时间域使用隐式 Newmark 族方法进行离散化。系统在时间 $t_{n+1} = t_n + \\Delta t$ 的状态是根据在 $t_n$ 的状态，使用位移 $u_{n+1}$ 和速度 $v_{n+1}$ 的运动学更新规则确定的：\n$$\nu_{n+1} = u_n + \\Delta t\\,v_n + \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n + \\beta\\,\\Delta t^2\\,a_{n+1}\n$$\n$$\nv_{n+1} = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1}\n$$\n以及在时间 $t_{n+1}$ 强制执行动力学平衡：\n$$\nm\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) = f_{\\mathrm{ext}}(t_{n+1})\n$$\n由于这些方程在未知数 $u_{n+1}$、$v_{n+1}$ 和 $a_{n+1}$ 中是隐式和非线性的，因此需要一个迭代数值方案（如 Newton-Raphson 方法）来找到每个时间步的解。\n\n### 任务 1：完整系统的 Newton-Raphson 公式\n\nNewton-Raphson 方法通过迭代地从线性系统 $\\mathbf{J}(\\mathbf{x}^{(k)}) \\Delta \\mathbf{x} = -\\mathbf{R}(\\mathbf{x}^{(k)})$ 中寻找对猜测值 $\\mathbf{x}^{(k)}$ 的修正量 $\\Delta \\mathbf{x}$ 来求解非线性方程组 $\\mathbf{R}(\\mathbf{x}) = \\mathbf{0}$，其中 $\\mathbf{J}$ 是 $\\mathbf{R}$ 的雅可比矩阵。\n\n对于我们的问题，在时间 $t_{n+1}$ 的未知向量是 $\\mathbf{x}_{n+1} = \\left[u_{n+1}, v_{n+1}, a_{n+1}\\right]^\\top$。方程组由提供的三个残差函数构成：\n$$\nR_m(u_{n+1}, v_{n+1}, a_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1}) = 0\n$$\n$$\nR_v(u_{n+1}, v_{n+1}, a_{n+1}) = v_{n+1} - v_n - \\Delta t\\,(1 - \\gamma)\\,a_n - \\gamma\\,\\Delta t\\,a_{n+1} = 0\n$$\n$$\nR_u(u_{n+1}, v_{n+1}, a_{n+1}) = u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n - \\beta\\,\\Delta t^2\\,a_{n+1} = 0\n$$\n雅可比矩阵 $\\mathbf{J}$ 是残差向量 $\\mathbf{R} = [R_m, R_v, R_u]^\\top$ 相对于未知向量 $\\mathbf{x}_{n+1}$ 的偏导数矩阵。分量 $J_{ij}$ 由 $J_{ij} = \\partial R_i / \\partial x_j$ 给出。\n\n所需的偏导数如下：\n- 对于 $R_m$：\n  - $\\frac{\\partial R_m}{\\partial u_{n+1}} = \\frac{d}{du_{n+1}}f_{\\mathrm{int}}(u_{n+1}) = K_t(u_{n+1}) = k + 3\\alpha u_{n+1}^2$\n  - $\\frac{\\partial R_m}{\\partial v_{n+1}} = c$\n  - $\\frac{\\partial R_m}{\\partial a_{n+1}} = m$\n- 对于 $R_v$：\n  - $\\frac{\\partial R_v}{\\partial u_{n+1}} = 0$\n  - $\\frac{\\partial R_v}{\\partial v_{n+1}} = 1$\n  - $\\frac{\\partial R_v}{\\partial a_{n+1}} = -\\gamma\\,\\Delta t$\n- 对于 $R_u$：\n  - $\\frac{\\partial R_u}{\\partial u_{n+1}} = 1$\n  - $\\frac{\\partial R_u}{\\partial v_{n+1}} = 0$\n  - $\\frac{\\partial R_u}{\\partial a_{n+1}} = -\\beta\\,\\Delta t^2$\n\n将这些分量组合起来，得到 $3 \\times 3$ 雅可比矩阵：\n$$\n\\mathbf{J}(u_{n+1}) = \\frac{\\partial(R_m, R_v, R_u)}{\\partial(u_{n+1}, v_{n+1}, a_{n+1})} = \n\\begin{bmatrix}\nK_t(u_{n+1})   c  m \\\\\n0  1  -\\gamma\\,\\Delta t \\\\\n1  0  -\\beta\\,\\Delta t^2\n\\end{bmatrix}\n$$\n该雅可比矩阵是残差向量的精确导数，这一特性被称为一致性线性化。在 Newton-Raphson 更新中使用此矩阵可确保该方法在解附近达到其特有的二次收敛速度。\n\n### 任务 2：静力缩聚与有效切线刚度\n\n这个 $3 \\times 3$ 系统可以简化为关于主未知数 $u_{n+1}$ 的单个标量方程。这个过程称为静力缩聚，可以得到一个更高效的求解器。推导依赖于雅可比矩阵的 Schur 补。我们将线性系统 $\\mathbf{J} \\Delta \\mathbf{x} = -\\mathbf{R}$ 对应于主未知数 $\\Delta u$ 和次未知数 $\\left[\\Delta v, \\Delta a\\right]^\\top$ 进行划分：\n$$\n\\begin{bmatrix}\n\\mathbf{J}_{11}   \\mathbf{J}_{12} \\\\\n\\mathbf{J}_{21}   \\mathbf{J}_{22}\n\\end{bmatrix}\n\\begin{Bmatrix}\n\\Delta u \\\\\n\\Delta \\mathbf{x}_2\n\\end{Bmatrix}\n= -\n\\begin{Bmatrix}\nR_1 \\\\\n\\mathbf{R}_2\n\\end{Bmatrix}\n$$\n其中 $\\Delta \\mathbf{x}_2 = \\left[\\Delta v, \\Delta a\\right]^\\top$，$\\mathbf{J}$ 的分块为：\n$$\n\\mathbf{J}_{11} = K_t(u_{n+1}), \\quad \\mathbf{J}_{12} = \\begin{bmatrix} c   m \\end{bmatrix}, \\quad \\mathbf{J}_{21} = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}, \\quad \\mathbf{J}_{22} = \\begin{bmatrix} 1   -\\gamma\\,\\Delta t \\\\ 0   -\\beta\\,\\Delta t^2 \\end{bmatrix}\n$$\n从划分后系统的第二行，我们求解 $\\Delta \\mathbf{x}_2$：$\\mathbf{J}_{21} \\Delta u + \\mathbf{J}_{22} \\Delta \\mathbf{x}_2 = -\\mathbf{R}_2 \\implies \\Delta \\mathbf{x}_2 = -\\mathbf{J}_{22}^{-1}(\\mathbf{R}_2 + \\mathbf{J}_{21} \\Delta u)$。\n将此代入第一行得到：\n$$\n\\left(\\mathbf{J}_{11} - \\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} \\mathbf{J}_{21}\\right) \\Delta u = -R_1 + \\mathbf{J}_{12}\\mathbf{J}_{22}^{-1}\\mathbf{R}_2\n$$\n乘以 $\\Delta u$ 的项是 $\\mathbf{J}_{11}$ 的 Schur 补，即有效切线刚度 $K_{\\mathrm{eff}}$。我们来计算它。首先，求 $\\mathbf{J}_{22}$ 的逆：\n$$\n\\mathbf{J}_{22}^{-1} = \\frac{1}{\\det(\\mathbf{J}_{22})} \\begin{bmatrix} -\\beta\\,\\Delta t^2   \\gamma\\,\\Delta t \\\\ 0   1 \\end{bmatrix} = \\frac{1}{-\\beta\\,\\Delta t^2} \\begin{bmatrix} -\\beta\\,\\Delta t^2   \\gamma\\,\\Delta t \\\\ 0   1 \\end{bmatrix} = \\begin{bmatrix} 1   -\\frac{\\gamma}{\\beta\\,\\Delta t} \\\\ 0   -\\frac{1}{\\beta\\,\\Delta t^2} \\end{bmatrix}\n$$\n现在，计算三元积 $\\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} \\mathbf{J}_{21}$：\n$$\n\\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} = \\begin{bmatrix} c   m \\end{bmatrix} \\begin{bmatrix} 1   -\\frac{\\gamma}{\\beta\\,\\Delta t} \\\\ 0   -\\frac{1}{\\beta\\,\\Delta t^2} \\end{bmatrix} = \\begin{bmatrix} c   -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2} \\end{bmatrix}\n$$\n$$\n(\\mathbf{J}_{12} \\mathbf{J}_{22}^{-1}) \\mathbf{J}_{21} = \\begin{bmatrix} c   -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2} \\end{bmatrix} \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix} = -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2}\n$$\n最后，有效切线刚度为：\n$$\nK_{\\mathrm{eff}} = \\mathbf{J}_{11} - \\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} \\mathbf{J}_{21} = K_t(u_{n+1}) - \\left( -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2} \\right)\n$$\n$$\nK_{\\mathrm{eff}}(u_{n+1}) = K_t(u_{n+1}) + \\frac{1}{\\beta\\,\\Delta t^2} m + \\frac{\\gamma}{\\beta\\,\\Delta t} c\n$$\n这与给定的表达式 $K_{\\mathrm{eff}} = K_t + a_0 m + a_1 c$ 相匹配，其中常数 $a_0 = \\frac{1}{\\beta\\,\\Delta t^2}$ 和 $a_1 = \\frac{\\gamma}{\\beta\\,\\Delta t}$。\n\n### 任务 3：算法设计与实现原理\n\n缩聚公式允许我们使用标量 Newton-Raphson 迭代求解 $u_{n+1}$。算法的核心是解标量残差方程 $r(u_{n+1})=0$，其中：\n$$\nr(u_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1})\n$$\n在此方程中，$a_{n+1}$ 和 $v_{n+1}$ 不是独立未知数，而是通过 Newmark 运动学关系成为 $u_{n+1}$ 的函数：\n$$\na_{n+1}(u_{n+1}) = \\frac{1}{\\beta\\,\\Delta t^2}\\left(u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n\\right)\n$$\n$$\nv_{n+1}(u_{n+1}) = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1}(u_{n+1})\n$$\n请注意，在开始时间步之前，必须计算 $a_n$ 以满足时间 $t_n$ 的平衡：$a_n = (f_{\\mathrm{ext}}(t_n) - c v_n - f_{\\mathrm{int}}(u_n)) / m$。\n\n$u_{n+1}$ 的 Newton-Raphson 迭代过程如下：\n1.  初始化迭代计数器 $k=0$ 和猜测值 $u_{n+1}^{(0)} = u_n$。\n2.  循环 $k=0, 1, 2, \\dots$ 直至收敛：\n    a. 设当前猜测值为 $u_{\\text{curr}} = u_{n+1}^{(k)}$。\n    b. 使用 $u_{\\text{curr}}$ 和上述运动学表达式计算 $a_{n+1}$ 和 $v_{n+1}$。\n    c. 评估残差 $r(u_{\\text{curr}})$。\n    d. 检查收敛性：如果 $\\lvert r(u_{\\text{curr}}) \\rvert \\le \\varepsilon$（其中 $\\varepsilon=10^{-12}$），则循环终止。\n    e. 评估有效切线刚度 $K_{\\mathrm{eff}}(u_{\\text{curr}}) = \\frac{dr}{du_{n+1}}|_{u_{n+1}=u_{\\text{curr}}} = K_t(u_{\\text{curr}}) + a_0 m + a_1 c$。\n    f. 计算更新量：$\\Delta u = -r(u_{\\text{curr}}) / K_{\\mathrm{eff}}(u_{\\text{curr}})$。\n    g. 更新猜测值：$u_{n+1}^{(k+1)} = u_{\\text{curr}} + \\Delta u$。\n3. 收敛解是 $u_{n+1}$ 的最终值。\n\n最后，实现需要进行数值验证，以证明 $K_{\\mathrm{eff}}$ 的解析表达式等价于完整 $3 \\times 3$ 雅可比矩阵的 Schur 补。这通过以下步骤实现：\n1.  在收敛解 $u_{n+1}$ 处构建数值雅可比矩阵 $\\mathbf{J}$。\n2.  将 $\\mathbf{J}$ 划分为其 $\\mathbf{J}_{11}$、$\\mathbf{J}_{12}$、$\\mathbf{J}_{21}$ 和 $\\mathbf{J}_{22}$ 块。\n3.  数值计算 Schur 补 $S = \\mathbf{J}_{11} - \\mathbf{J}_{12} (\\mathbf{J}_{22})^{-1} \\mathbf{J}_{21}$。\n4.  将此数值 $S$ 与根据解析公式计算的 $K_{\\mathrm{eff}}(u_{n+1})$ 的值进行比较。比较在小的数值公差内完成，产生一个布尔结果。", "answer": "```python\nimport numpy as np\n\ndef solve_newmark_step(params):\n    \"\"\"\n    Solves for the state at time t_{n+1} for a single time step using the\n    implicit Newmark method with a condensed Newton-Raphson scheme.\n\n    Args:\n        params (tuple): A tuple containing all problem parameters:\n                        (m, c, k, alpha, dt, beta, gamma, u_n, v_n, \n                         f_ext_n, f_ext_n1)\n\n    Returns:\n        tuple: A tuple containing the converged displacement u_{n+1} (float)\n               and a boolean indicating if the Jacobian verification passed.\n    \"\"\"\n    m, c, k, alpha, dt, beta, gamma, u_n, v_n, f_ext_n, f_ext_n1 = params\n\n    # --- Helper Functions ---\n    def f_int(u):\n        \"\"\"Internal force.\"\"\"\n        return k * u + alpha * u**3\n\n    def K_t(u):\n        \"\"\"Tangent stiffness from the internal force.\"\"\"\n        return k + 3 * alpha * u**2\n\n    # --- Initialization ---\n    # Compute acceleration at step n, assuming equilibrium.\n    a_n = (f_ext_n - c * v_n - f_int(u_n)) / m\n\n    # Newmark constants for the condensed system.\n    a0 = 1.0 / (beta * dt**2)\n    a1 = gamma / (beta * dt)\n\n    # --- Newton-Raphson Iteration for the Condensed System ---\n    u_n1 = u_n  # Initial guess for the displacement at t_{n+1}.\n    \n    epsilon = 1e-12\n    max_iter = 20\n\n    for _ in range(max_iter):\n        # Calculate kinematics (a_{n+1}, v_{n+1}) based on the current guess for u_{n+1}.\n        # The equation for a_{n+1} is derived from the Newmark displacement update:\n        # u_{n+1} = u_n + dt*v_n + dt^2*(1/2 - beta)*a_n + beta*dt^2*a_{n+1}\n        # Rearranging gives:\n        a_n1 = a0 * (u_n1 - u_n - dt * v_n) - (1/(2*beta) - 1) * a_n\n        \n        # The velocity v_{n+1} is updated using the computed a_{n+1}.\n        v_n1 = v_n + dt * (1 - gamma) * a_n + gamma * dt * a_n1\n\n        # Calculate the residual of the dynamic equilibrium equation at t_{n+1}.\n        residual = m * a_n1 + c * v_n1 + f_int(u_n1) - f_ext_n1\n\n        # Check for convergence.\n        if np.abs(residual) = epsilon:\n            break\n\n        # Calculate the effective tangent stiffness K_eff.\n        K_eff = K_t(u_n1) + a0 * m + a1 * c\n\n        # Compute the update to the displacement.\n        delta_u = -residual / K_eff\n        u_n1 += delta_u\n    else:\n        # This block executes if the loop completes without converging.\n        # In a real application, an error should be raised.\n        # For this problem, convergence is expected.\n        pass\n    \n    final_u_n1 = u_n1\n\n    # --- Jacobian Verification ---\n    # 1. Calculate K_eff using the analytical condensed formula at the converged solution.\n    K_eff_condensed = K_t(final_u_n1) + a0 * m + a1 * c\n\n    # 2. Build the full 3x3 Jacobian matrix at the converged solution.\n    # The order of residuals is (R_m, R_v, R_u) and variables is (u, v, a).\n    J = np.array([\n        [K_t(final_u_n1), c, m],\n        [0.0, 1.0, -gamma * dt],\n        [1.0, 0.0, -beta * dt**2]\n    ])\n    \n    # 3. Partition the Jacobian matrix.\n    J11 = J[0, 0]\n    J12 = J[0, 1:].reshape(1, 2)\n    J21 = J[1:, 0].reshape(2, 1)\n    J22 = J[1:, 1:]\n\n    # 4. Calculate the Schur complement: S = J11 - J12 @ inv(J22) @ J21\n    try:\n        J22_inv = np.linalg.inv(J22)\n        schur_complement = (J11 - J12 @ J22_inv @ J21).item()\n    except np.linalg.LinAlgError:\n        schur_complement = np.nan # In case of singular J22\n\n    # 5. Compare the analytical K_eff with the numerical Schur complement.\n    is_consistent = np.isclose(schur_complement, K_eff_condensed)\n\n    return final_u_n1, is_consistent\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (general nonlinear, damped)\n        (1.0, 0.05, 100.0, 500.0, 0.01, 0.25, 0.5, 0.01, 0.0, 0.0, 1.0),\n        # Case B (undamped)\n        (2.0, 0.0, 200.0, 1000.0, 0.01, 0.25, 0.5, 0.0, 0.0, 0.0, 0.5),\n        # Case C (small time step)\n        (1.0, 0.05, 100.0, 500.0, 0.001, 0.25, 0.5, 0.01, 0.0, 0.0, 1.0),\n        # Case D (stiff nonlinear, moderate damping)\n        (0.5, 0.2, 1000.0, 100000.0, 0.01, 0.25, 0.5, 0.002, 0.0, 0.0, 2.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        u_final, is_consistent_bool = solve_newmark_step(case)\n        results.append(u_final)\n        results.append(str(is_consistent_bool))\n\n    # The problem asks for the boolean to be represented as a string like 'bool_A'.\n    # Python's str(True) is 'True', which fits this representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3566474"}]}