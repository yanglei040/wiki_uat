{"hands_on_practices": [{"introduction": "本构模型是计算岩土力学的基石，但其实际应用始于根据实验数据确定材料参数。本实践将指导您完成一个基本过程：使用统计学原理，从三轴压缩试验数据中识别各向同性硬化模量 $H$。通过拟合偏应力 $q$ 和等效塑性应变 $\\bar\\varepsilon^p$ 之间的关系，并量化您估计值的不确定性，您将在塑性理论与实际模型校准之间架起一座桥梁。", "problem": "给定由偏应力 $q$ 作为等效塑性应变 $\\bar\\varepsilon^p$ 函数的测量值组成的单调三轴压缩数据。假设一个关联 von Mises（也称为 $J_2$）塑性模型，该模型具有线性各向同性硬化，其中偏应力空间中的屈服应力随塑性应变而演化。从第二偏应力不变量和关联流动的等效塑性应变的常规定义，以及塑性加载的一致性条件出发，构建一个统计学上合理的程序，以从单调三轴压缩下 $q$ 与 $\\bar\\varepsilon^p$ 的测量值中识别各向同性硬化模量 $H$。将 $q$ 中的测量误差视为具有未知方差的独立同分布正态偏差。仅使用塑性力学和最大似然推断的基本概念，推导您将实现的参数估计量，以及在置信水平为 $0.95$ 时 $H$ 的置信区间。您的实现必须能够处理截距（初始屈服水平）的存在，并为 $H$ 提供不确定性量化。\n\n将您的程序实现为一个完整的、可运行的程序，该程序：\n- 使用以下数据集测试套件，每个数据集均以成对列表 $(\\bar\\varepsilon^p_i, q_i)$ 的形式给出。\n- 将 $\\bar\\varepsilon^p$ 解释为无量纲，将 $q$ 的单位解释为千帕 (kPa)。\n- 对于每个数据集，估计 $H$（单位为 kPa）并计算 $H$ 的双边 $0.95$ 置信区间（单位为 kPa）。\n- 汇总所有数据集的结果，并将其打印在单行上，格式为 JSON 风格的列表之列表，每个内部列表的顺序为 $[H_{\\text{estimate}}, H_{\\text{lower}}, H_{\\text{upper}}]$，所有值均以 kPa 为单位，不带任何附加文本。\n\n您可以使用的基本原理：\n- 在具有线性各向同性硬化的关联 $J_2$ 塑性模型下，屈服由屈服函数 $f(q, \\bar\\varepsilon^p) \\le 0$ 控制，该函数对其参数是平滑的，塑性加载的特征是 $f = 0$ 和一致性条件 $\\dot f = 0$。\n- 对于单调塑性加载，应力状态保持在屈服面上。\n- 在 $J_2$ 塑性模型中，等效塑性应变 $\\bar\\varepsilon^p$ 是与各向同性硬化变量共轭的功量。\n- 对于具有未知方差的加性独立高斯测量噪声下的参数估计，最大似然估计量与线性模型的普通最小二乘法一致。\n\n测试套件（为您的程序提供这些确切的数据）：\n- 情况 A（典型噪声水平，良态）：\n  - $\\bar\\varepsilon^p$: $[0.0, 0.01, 0.02, 0.03, 0.04, 0.05]$\n  - $q$（单位 kPa）: $[118.8, 152.1, 179.3, 211.5, 238.0, 270.3]$\n- 情况 B（接近无噪声，估计方差的最小样本）：\n  - $\\bar\\varepsilon^p$: $[0.0, 0.025, 0.05]$\n  - $q$（单位 kPa）: $[80.0, 130.0, 180.0]$\n- 情况 C（低信噪比）：\n  - $\\bar\\varepsilon^p$: $[0.0, 0.01, 0.02, 0.03, 0.04, 0.05]$\n  - $q$（单位 kPa）: $[100.8, 100.9, 104.6, 105.1, 109.0, 109.6]$\n- 情况 D（存在一个轻微的异常值）：\n  - $\\bar\\varepsilon^p$: $[0.0, 0.01, 0.02, 0.03, 0.06]$\n  - $q$（单位 kPa）: $[150.0, 180.0, 196.0, 228.0, 320.0]$\n\n算法要求：\n- 将塑性加载期间 $q$ 和 $\\bar\\varepsilon^p$ 之间的关系建模为 $\\bar\\varepsilon^p$ 的一个仿射函数，其截距和斜率未知，该模型基于 $J_2$ 塑性下各向同性硬化的一致性条件。\n- 设参数向量为 $\\boldsymbol\\theta = [q_0, H]^\\top$，其中 $q_0$ 是截距（单位为 kPa），$H$ 是各向同性硬化模量（单位为 kPa）。\n- 假设观测模型为 $q_i = q(\\bar\\varepsilon^p_i; \\boldsymbol\\theta) + \\varepsilon_i$，其中 $\\varepsilon_i$ 是独立同分布的正态随机变量，均值为 $0$，方差为未知的 $\\sigma^2$。\n- 使用最大似然估计获得 $\\widehat{\\boldsymbol\\theta}$ 和 $H$ 在置信水平为 $0.95$ 时的双边置信区间，基于正态误差模型下估计量的抽样分布。\n- 如果残差平方和恰好为零，则报告 $H$ 的一个零宽度置信区间。\n\n最终输出格式：\n- 您的程序应产生单行输出，包含形如 $[[H_A, L_A, U_A],[H_B, L_B, U_B],[H_C, L_C, U_C],[H_D, L_D, U_D]]$ 的无逗号、紧凑的列表之列表形式的结果，其中下标表示情况 A到D，所有值均以千帕 (kPa) 为单位。所有数字均使用普通十进制表示法。\n\n所有关于 $H$ 及其置信界限的量均以千帕 (kPa) 回答。不涉及角度。输出中不要打印任何单位；数值必须隐含地以千帕 (kPa) 为单位。置信水平必须解释为 $0.95$（一个小数），而不是百分比。", "solution": "该问题要求制定并实施一个程序，从单调三轴压缩数据中估计各向同性硬化模量 $H$。这一过程是在关联 von Mises ($J_2$) 塑性与线性各向同性硬化的框架内进行的。该估计必须在统计学上是合理的，包括最大似然估计，并为估计量提供置信区间。\n\n**1. 塑性力学理论基础**\n\nvon Mises 屈服准则在应力空间中定义了一个屈服面。对于各向同性材料，该屈服面取决于偏应力张量的第二不变量 $J_2$。在三轴试验的背景下，使用偏应力 $q$ 来表示更为方便，其定义为 $q = \\sqrt{3J_2}$。屈服函数 $f$ 由下式给出：\n$$\nf(\\boldsymbol{\\sigma}, \\kappa) = q - q_y(\\kappa) \\le 0\n$$\n其中 $\\boldsymbol{\\sigma}$ 是柯西应力张量，$q_y$ 是当前的偏应力空间中的屈服应力，它依赖于一个内部状态变量 $\\kappa$。对于各向同性硬化，$\\kappa$ 是累积塑性变形的标量度量，对于关联 $J_2$ 塑性，它就是等效塑性应变 $\\bar\\varepsilon^p$。\n\n问题指定了*线性*各向同性硬化。这意味着屈服应力 $q_y$ 与等效塑性应变 $\\bar\\varepsilon^p$ 之间存在线性关系：\n$$\nq_y(\\bar\\varepsilon^p) = q_0 + H \\bar\\varepsilon^p\n$$\n这里，$q_0$ 是初始屈服应力（$\\bar\\varepsilon^p=0$ 时的 $q_y$ 值），$H$ 是各向同性硬化模量，它是一个材料常数，表示屈服应力随塑性应变的增加率。\n\n在塑性加载过程中，必须满足两个条件：应力状态必须位于屈服面上 ($f=0$)，并且在持续加载时必须保持在该面上。后者由一致性条件 $\\dot f = 0$ 强制执行。对于发生塑性变形的单调加载，条件 $f=0$ 持续成立。将线性硬化定律代入屈服函数，得到：\n$$\nf(q, \\bar\\varepsilon^p) = q - (q_0 + H\\bar\\varepsilon^p) = 0\n$$\n这可以重新排列，以表达在单调塑性加载阶段，测量的偏应力 $q$ 与等效塑性应变 $\\bar\\varepsilon^p$ 之间的理论关系：\n$$\nq = q_0 + H\\bar\\varepsilon^p\n$$\n该方程为使用仿射函数对实验数据 $(\\bar\\varepsilon^p_i, q_i)$ 进行建模提供了物理基础。\n\n**2. 统计模型与参数估计**\n\n我们得到 $n$ 对数据 $(\\bar\\varepsilon^p_i, q_i)$。问题陈述，$q$ 的测量值服从独立同分布 (i.i.d.) 的正态误差。因此，观测模型为：\n$$\nq_i = q_0 + H\\bar\\varepsilon^p_i + \\varepsilon_i, \\quad \\text{for } i = 1, \\dots, n\n$$\n其中误差 $\\varepsilon_i$ 假定来自均值为 $0$、方差未知的正态分布，即 $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。这是一个标准的简单线性回归模型，其中响应变量是 $q$，预测变量是 $\\bar\\varepsilon^p$。需要估计的参数是截距 $q_0$ 和斜率 $H$。\n\n如问题所述，对于此模型，参数 $(q_0, H)$ 的最大似然估计量 (MLE) 与普通最小二乘 (OLS) 估计量一致。OLS 估计量通过最小化残差平方和 (SSE) 来找到：\n$$\nS(q_0, H) = \\sum_{i=1}^n (q_i - (q_0 + H\\bar\\varepsilon^p_i))^2\n$$\n最小化 $S(q_0, H)$ 的估计量 $\\hat{q}_0$ 和 $\\hat{H}$ 由众所周知的 OLS 公式给出：\n$$\n\\hat{H} = \\frac{\\sum_{i=1}^n (\\bar\\varepsilon^p_i - \\bar{\\bar\\varepsilon}^p)(q_i - \\bar{q})}{\\sum_{i=1}^n (\\bar\\varepsilon^p_i - \\bar{\\bar\\varepsilon}^p)^2} = \\frac{S_{\\varepsilon q}}{S_{\\varepsilon \\varepsilon}}\n$$\n$$\n\\hat{q}_0 = \\bar{q} - \\hat{H}\\bar{\\bar\\varepsilon}^p\n$$\n其中 $\\bar{\\bar\\varepsilon}^p = \\frac{1}{n} \\sum_{i=1}^n \\bar\\varepsilon^p_i$ 和 $\\bar{q} = \\frac{1}{n} \\sum_{i=1}^n q_i$ 是样本均值。\n\n**3. 硬化模量 H 的置信区间**\n\n为了量化估计量 $\\hat{H}$ 的不确定性，我们构造一个置信区间。在假定的正态误差模型下，估计量 $\\hat{H}$ 的抽样分布为：\n$$\n\\hat{H} \\sim \\mathcal{N}\\left(H, \\frac{\\sigma^2}{\\sum_{i=1}^n (\\bar\\varepsilon^p_i - \\bar{\\bar\\varepsilon}^p)^2}\\right)\n$$\n由于误差方差 $\\sigma^2$ 未知，必须从数据中估计。$\\sigma^2$ 的一个无偏估计量是均方误差 (MSE)，记为 $s^2$：\n$$\ns^2 = \\frac{SSE}{n-p} = \\frac{\\sum_{i=1}^n (q_i - \\hat{q}_i)^2}{n-2}\n$$\n其中 $\\hat{q}_i = \\hat{q}_0 + \\hat{H}\\bar\\varepsilon^p_i$ 是拟合值，$p=2$ 是估计参数（$q_0$ 和 $H$）的数量。分母 $n-2$ 表示残差的自由度。\n\n$\\hat{H}$ 的估计标准误则是：\n$$\nSE(\\hat{H}) = \\sqrt{\\frac{s^2}{\\sum_{i=1}^n (\\bar\\varepsilon^p_i - \\bar{\\bar\\varepsilon}^p)^2}}\n$$\n用估计方差 $s^2$ 代替真实方差 $\\sigma^2$，标准化统计量服从自由度为 $n-2$ 的学生 t-分布：\n$$\n\\frac{\\hat{H} - H}{SE(\\hat{H})} \\sim t_{n-2}\n$$\n具有置信水平 $1-\\alpha$（此处为 $0.95$，因此 $\\alpha=0.05$）的 $H$ 的双边置信区间构造如下：\n$$\n\\left[ \\hat{H} - t_{\\alpha/2, n-2} \\cdot SE(\\hat{H}), \\quad \\hat{H} + t_{\\alpha/2, n-2} \\cdot SE(\\hat{H}) \\right]\n$$\n其中 $t_{\\alpha/2, n-2}$ 是来自 t-分布的临界值，其上尾面积为 $\\alpha/2$。对于 $0.95$ 的置信水平，我们需要 $t_{0.025, n-2}$。\n\n如果数据点完全共线，则会出现一种特殊情况，导致 $SSE=0$。在这种情况下，估计的误差方差 $s^2$ 为 $0$，因此 $SE(\\hat{H})=0$。模型完美拟合数据。根据问题的指示， $H$ 的置信区间将收缩为一个零宽度区间 $[\\hat{H}, \\hat{H}]$。这表示在数据确实无噪声的（强）假设下，对估计的斜率有完全的信心。\n\n**4. 算法步骤**\n\n对于每个给定的数据集 $(\\bar{\\boldsymbol{\\varepsilon}}^p, \\mathbf{q})$：\n1.  将 $\\bar{\\boldsymbol{\\varepsilon}}^p$ 视为预测变量向量，将 $\\mathbf{q}$ 视为响应变量向量。设 $n$ 为数据点数。\n2.  计算样本均值 $\\bar{\\bar\\varepsilon}^p$ 和 $\\bar{q}$。\n3.  计算预测变量的平方和 $S_{\\varepsilon \\varepsilon} = \\sum (\\bar\\varepsilon^p_i - \\bar{\\bar\\varepsilon}^p)^2$ 和交叉乘积和 $S_{\\varepsilon q} = \\sum (\\bar\\varepsilon^p_i - \\bar{\\bar\\varepsilon}^p)(q_i - \\bar{q})$。\n4.  计算硬化模量的估计值：$\\hat{H} = S_{\\varepsilon q} / S_{\\varepsilon \\varepsilon}$。\n5.  计算初始屈服应力的估计值：$\\hat{q}_0 = \\bar{q} - \\hat{H}\\bar{\\bar\\varepsilon}^p$。\n6.  使用残差 $e_i = q_i - (\\hat{q}_0 + \\hat{H}\\bar\\varepsilon^p_i)$ 计算残差平方和 ($SSE$)。\n7.  如果 $SSE$ 在数值上为零（或低于一个很小的容差），则置信区间的下限和上限都等于 $\\hat{H}$。\n8.  如果 $SSE  0$：\n    a. 确定自由度 $df = n-2$。\n    b. 计算估计的误差方差 $s^2 = SSE / df$。\n    c. 计算斜率的标准误 $SE(\\hat{H}) = \\sqrt{s^2 / S_{\\varepsilon \\varepsilon}}$。\n    d. 使用统计库函数找到临界 t-值 $t_{0.025, df}$。\n    e. 计算误差范围 $ME = t_{0.025, df} \\cdot SE(\\hat{H})$。\n    f. 置信区间为 $[\\hat{H} - ME, \\hat{H} + ME]$。\n9.  为当前数据集存储三元组 $[\\hat{H}, \\text{下限}, \\text{上限}]$。\n10. 处理完所有数据集后，将结果汇总成一个列表之列表，并按最终输出要求的格式进行格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import t\n\ndef solve():\n    \"\"\"\n    Performs linear regression to estimate the isotropic hardening modulus H\n    and its 95% confidence interval from provided experimental data, based on\n    a von Mises plasticity model with linear isotropic hardening.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"ep_p\": [0.0, 0.01, 0.02, 0.03, 0.04, 0.05],\n            \"q_kPa\": [118.8, 152.1, 179.3, 211.5, 238.0, 270.3]\n        },\n        {\n            \"name\": \"Case B\",\n            \"ep_p\": [0.0, 0.025, 0.05],\n            \"q_kPa\": [80.0, 130.0, 180.0]\n        },\n        {\n            \"name\": \"Case C\",\n            \"ep_p\": [0.0, 0.01, 0.02, 0.03, 0.04, 0.05],\n            \"q_kPa\": [100.8, 100.9, 104.6, 105.1, 109.0, 109.6]\n        },\n        {\n            \"name\": \"Case D\",\n            \"ep_p\": [0.0, 0.01, 0.02, 0.03, 0.06],\n            \"q_kPa\": [150.0, 180.0, 196.0, 228.0, 320.0]\n        }\n    ]\n\n    all_results = []\n    \n    # Per-problem requirement for confidence level alpha\n    alpha = 0.05\n\n    for case in test_cases:\n        # Assign predictor (x) and response (y) variables\n        # x: equivalent plastic strain (bar_epsilon^p), dimensionless\n        # y: deviatoric stress (q), in kPa\n        x = np.array(case[\"ep_p\"])\n        y = np.array(case[\"q_kPa\"])\n        \n        n = len(x)\n        if n  3:\n            # Degrees of freedom would be = 0, cannot estimate variance.\n            # This case is not in the test suite but is a good practice check.\n            # For n=2, we have df=0, t-dist is undefined.\n            # OLS estimate is possible, but uncertainty is not quantifiable this way.\n            # For the purpose of this problem, we assume n>=3.\n            pass\n\n        # Calculate means\n        x_mean = np.mean(x)\n        y_mean = np.mean(y)\n\n        # Calculate sum of squares S_xx and sum of products S_xy\n        s_xx = np.sum((x - x_mean)**2)\n        s_xy = np.sum((x - x_mean) * (y - y_mean))\n\n        # Estimate H (slope) and q0 (intercept)\n        # H is the isotropic hardening modulus in kPa.\n        # q0 is the initial yield stress in kPa.\n        h_estimate = s_xy / s_xx if s_xx != 0 else 0.0\n        q0_estimate = y_mean - h_estimate * x_mean\n\n        # Calculate fitted values and residuals\n        y_fit = q0_estimate + h_estimate * x\n        residuals = y - y_fit\n        \n        # Calculate Sum of Squared Errors (SSE)\n        sse = np.sum(residuals**2)\n\n        # Degrees of freedom for the residuals (n - number of parameters)\n        df = n - 2\n        \n        # Handle the special case of a perfect fit (SSE = 0)\n        # using a small tolerance for floating point comparison.\n        if df = 0 or sse  1e-12:\n            h_lower = h_estimate\n            h_upper = h_estimate\n        else:\n            # Estimate the variance of the error term\n            error_variance = sse / df\n            \n            # Calculate the standard error of the H estimate\n            se_h = np.sqrt(error_variance / s_xx)\n            \n            # Find the critical t-value for a two-sided 95% CI\n            t_crit = t.ppf(1 - alpha/2, df)\n            \n            # Margin of error\n            margin_of_error = t_crit * se_h\n            \n            # Calculate confidence interval\n            h_lower = h_estimate - margin_of_error\n            h_upper = h_estimate + margin_of_error\n\n        # Format the inner list as a string, e.g., \"[H,L,U]\", without spaces.\n        result_string = f\"[{h_estimate},{h_lower},{h_upper}]\"\n        all_results.append(result_string)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```", "id": "3536081"}, {"introduction": "一旦确定了模型参数，下一步就是在计算框架内实现本构法则。本实践聚焦于计算塑性力学的核心算法：返回映射算法。您将为一个带有组合硬化效应的非关联Drucker-Prager模型（一个广泛用于岩土材料的模型）实现一个“弹性预测-塑性修正”步骤。该练习将让您具体地理解当材料发生塑性屈服时，其应力和应变状态是如何更新的。", "problem": "考虑一个摩擦性岩土材料的小应变平面应变压缩步骤，该材料由各向同性线弹性和具有组合各向同性与运动硬化的非关联 Drucker–Prager 型塑性描述。使用拉伸应力和应变为正的符号约定，并定义平均应力不变量（压为正）为 $p = -\\frac{1}{3} \\operatorname{tr}(\\boldsymbol{\\sigma})$，偏应力不变量为 $q = \\sqrt{\\frac{3}{2}} \\lVert \\mathbf{s} \\rVert$，其中 $\\mathbf{s} = \\boldsymbol{\\sigma} - \\frac{1}{3}\\operatorname{tr}(\\boldsymbol{\\sigma})\\mathbf{I}$ 且 $\\mathbf{I}$ 是单位张量。弹性模量为体积模量 $K$ 和剪切模量 $G$，小应变下的弹性应力-应变算子为 $\\boldsymbol{\\sigma} = 2G \\boldsymbol{\\epsilon}^{e}_{\\mathrm{dev}} + K \\epsilon^{e}_{v}\\mathbf{I}$，其中 $\\epsilon^{e}_{v} = \\operatorname{tr}(\\boldsymbol{\\epsilon}^{e})$ 且 $\\boldsymbol{\\epsilon}^{e}_{\\mathrm{dev}} = \\boldsymbol{\\epsilon}^{e} - \\frac{1}{3}\\epsilon^{e}_{v}\\mathbf{I}$。具有组合硬化的屈服函数在 $p$–$q$ 空间中由下式给出\n$$\nf = (q - a) - \\eta\\, p - (q_{y0} + R),\n$$\n其中 $a$ 是运动硬化背应力（单位为应力），$R$ 是各向同性硬化变量（单位为应力），$\\eta$ 是摩擦斜率参数（无量纲），$q_{y0}$ 是屈服面在 $q$ 方向上的初始尺寸（单位为应力）。塑性加载满足标准的 Karush–Kuhn–Tucker 条件、$f \\le 0$、$\\lambda \\ge 0$、$\\lambda f = 0$、弹性域条件以及发生塑性加载时的一致性条件。非关联塑性势函数定义为\n$$\ng = q + \\beta\\, p,\n$$\n其中 $\\beta$ 是剪胀参数（无量綱），控制剪切作用下的体积塑性应变增量。塑性流动法则是 $\\mathrm{d}\\boldsymbol{\\epsilon}^{p} = \\lambda\\, \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$，硬化定律为\n$$\n\\mathrm{d}R = H_{\\mathrm{iso}}\\, \\mathrm{d}\\bar{\\epsilon}^{p}, \\quad \\mathrm{d}a = H_{\\mathrm{kin}}\\, \\mathrm{d}\\bar{\\epsilon}^{p}, \\quad \\mathrm{d}\\bar{\\epsilon}^{p} = \\lambda,\n$$\n其中 $H_{\\mathrm{iso}}$ 和 $H_{\\mathrm{kin}}$ 是分别控制各向同性硬化和运动硬化的模量（单位为应力），$\\mathrm{d}\\bar{\\epsilon}^{p}$ 是等效塑性应变增量，在此模型中等同于塑性乘子 $\\lambda$。计算任务是，在平面应变条件下，针对给定的总应变增量，执行从弹性试探状态到屈服面的一致性返回映射步，并计算：\n- 塑性应变增量张量分量 $\\mathrm{d}\\epsilon^{p}_{xx}$、$\\mathrm{d}\\epsilon^{p}_{yy}$ 和 $\\mathrm{d}\\epsilon^{p}_{zz}$（无量纲），以及\n- 更新后的平均应力不变量 $p$（单位为 MPa）和更新后的偏应力不变量 $q$（单位为 MPa），\n展示剪胀参数 $\\beta$ 如何影响体积塑性应变和平均应力更新。\n\n从零初始应力、零初始塑性应变、零背应力 $a=0$ 和零各向同性硬化变量 $R=0$ 开始。假设平面应变下的总应变增量形式如下\n$$\n\\mathrm{d}\\boldsymbol{\\epsilon} = \\begin{bmatrix}\n\\mathrm{d}\\epsilon_{xx}  0  0 \\\\\n0  \\mathrm{d}\\epsilon_{yy}  0 \\\\\n0  0  0\n\\end{bmatrix},\n$$\n没有剪切分量且 $\\mathrm{d}\\epsilon_{zz} = 0$。\n\n您的程序必须实现以下科学上一致的步骤：\n1. 使用各向同性线弹性算子和给定的总应变增量（在试探状态下，增量内的 $\\boldsymbol{\\epsilon}^{p}$ 保持不变）构建弹性试探应力 $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$。由 $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ 计算 $p^{\\mathrm{tr}}$ 和 $q^{\\mathrm{tr}}$。\n2. 评估屈服函数 $f^{\\mathrm{tr}}$。如果 $f^{\\mathrm{tr}} \\le 0$，则该步为弹性：将塑性应变增量设为零，并将 $p$ 和 $q$ 更新为其试探值。\n3. 如果 $f^{\\mathrm{tr}}  0$，则强制执行一致性条件并执行返回映射，以计算塑性乘子、塑性应变增量分量，并更新 $p$ 和 $q$，同时考虑各向同性硬化、运动硬化以及由 $g$ 的梯度决定的非关联流动方向。\n4. 为保证数值鲁棒性，确保当 $q^{\\mathrm{tr}}$ 非常小时，处理任何通过 $q^{\\mathrm{tr}}$进行的归一化操作。\n\n使用以下参数集和平面应变增量的测试套件，其中应力以兆帕（MPa）表示，应变为无量纲：\n- 测试 1 (弹性基线): $K = 100$ MPa, $G = 40$ MPa, $\\eta = 0.3$, $H_{\\mathrm{iso}} = 20$ MPa, $H_{\\mathrm{kin}} = 10$ MPa, $q_{y0} = 3.0$ MPa, $\\beta = 0.1$, $\\mathrm{d}\\epsilon_{xx} = -5\\times 10^{-6}$, $\\mathrm{d}\\epsilon_{yy} = -1\\times 10^{-6}$。\n- 测试 2 (塑性, 剪胀): $K = 100$ MPa, $G = 40$ MPa, $\\eta = 0.3$, $H_{\\mathrm{iso}} = 20$ MPa, $H_{\\mathrm{kin}} = 10$ MPa, $q_{y0} = 0.02$ MPa, $\\beta = -0.2$, $\\mathrm{d}\\epsilon_{xx} = -5\\times 10^{-4}$, $\\mathrm{d}\\epsilon_{yy} = -1\\times 10^{-4}$。\n- 测试 3 (塑性, 压缩): $K = 100$ MPa, $G = 40$ MPa, $\\eta = 0.3$, $H_{\\mathrm{iso}} = 20$ MPa, $H_{\\mathrm{kin}} = 10$ MPa, $q_{y0} = 0.02$ MPa, $\\beta = 0.2$, $\\mathrm{d}\\epsilon_{xx} = -5\\times 10^{-4}$, $\\mathrm{d}\\epsilon_{yy} = -1\\times 10^{-4}$。\n- 测试 4 (近屈服, 中性剪胀): $K = 100$ MPa, $G = 40$ MPa, $\\eta = 0.3$, $H_{\\mathrm{iso}} = 20$ MPa, $H_{\\mathrm{kin}} = 10$ MPa, $q_{y0} = 0.02$ MPa, $\\beta = 0.0$, $\\mathrm{d}\\epsilon_{xx} = -2\\times 10^{-4}$, $\\mathrm{d}\\epsilon_{yy} = -1\\times 10^{-4}$。\n\n最终输出格式要求：\n您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表形式的结果，每个测试用例一个列表，每个内部列表按 $[\\mathrm{d}\\epsilon^{p}_{xx}, \\mathrm{d}\\epsilon^{p}_{yy}, \\mathrm{d}\\epsilon^{p}_{zz}, p, q]$ 的顺序列出，例如 $[[e_{xx},e_{yy},e_{zz},p,q],[\\dots],\\dots]$。所有应力值必须以 MPa 为单位，所有应变值均为无量綱。", "solution": "用户提供了一个计算岩土力学问题，要求为具有组合各向同性与运动硬化的非关联 Drucker-Prager 塑性模型实现一个返回映射算法。\n\n问题陈述的验证如下：\n\n### 步骤 1：提取给定条件\n- **模型**：小应变、平面应变、各向同性线弹性、具有组合各向同性与运动硬化的非关联 Drucker-Prager 塑性。\n- **符号约定**：拉伸应力和应变为正。\n- **应力不变量**：平均应力 $p = -\\frac{1}{3} \\operatorname{tr}(\\boldsymbol{\\sigma})$ (压为正)，偏应力 $q = \\sqrt{\\frac{3}{2}} \\lVert \\mathbf{s} \\rVert$，其中 $\\mathbf{s} = \\boldsymbol{\\sigma} - \\frac{1}{3}\\operatorname{tr}(\\boldsymbol{\\sigma})\\mathbf{I}$。\n- **弹性定律**：$\\boldsymbol{\\sigma} = 2G \\boldsymbol{\\epsilon}^{e}_{\\mathrm{dev}} + K \\epsilon^{e}_{v}\\mathbf{I}$，具有体积模量 $K$ 和剪切模量 $G$。$\\epsilon^{e}_{v} = \\operatorname{tr}(\\boldsymbol{\\epsilon}^{e})$，$\\boldsymbol{\\epsilon}^{e}_{\\mathrm{dev}} = \\boldsymbol{\\epsilon}^{e} - \\frac{1}{3}\\epsilon^{e}_{v}\\mathbf{I}$。\n- **屈服函数**：$f = (q - a) - \\eta\\, p - (q_{y0} + R)$，其中 $\\eta$ 是摩擦斜率，$q_{y0}$ 是初始屈服应力，$a$ 是背应力，$R$ 是各向同性硬化变量。\n- **塑性势**：$g = q + \\beta\\, p$，其中 $\\beta$ 是剪胀参数。\n- **流动法则**：$\\mathrm{d}\\boldsymbol{\\epsilon}^{p} = \\lambda\\, \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$，其中 $\\lambda$ 是塑性乘子。\n- **硬化定律**：$\\mathrm{d}R = H_{\\mathrm{iso}}\\, \\mathrm{d}\\bar{\\epsilon}^{p}$，$\\mathrm{d}a = H_{\\mathrm{kin}}\\, \\mathrm{d}\\bar{\\epsilon}^{p}$，具有硬化模量 $H_{\\mathrm{iso}}$ 和 $H_{\\mathrm{kin}}$。\n- **等效塑性应变**：$\\mathrm{d}\\bar{\\epsilon}^{p} = \\lambda$。\n- **初始条件**：$\\boldsymbol{\\sigma}_0 = \\mathbf{0}$，$\\boldsymbol{\\epsilon}^{p}_0 = \\mathbf{0}$，$a_0 = 0$，$R_0 = 0$。\n- **加载**：平面应变增量 $\\mathrm{d}\\boldsymbol{\\epsilon} = \\operatorname{diag}(\\mathrm{d}\\epsilon_{xx}, \\mathrm{d}\\epsilon_{yy}, 0)$。\n- **任务**：计算塑性应变增量分量 $\\mathrm{d}\\epsilon^{p}_{xx}, \\mathrm{d}\\epsilon^{p}_{yy}, \\mathrm{d}\\epsilon^{p}_{zz}$ 和更新后的应力不变量 $p, q$。\n- **测试数据**：提供了四组材料参数和应变增量。\n\n### 步驟 2：使用提取的给定条件进行验证\n- **科学基础（关键）**：该问题牢固地基于弹塑性力学的标准理论，特别是广泛应用于岩土力学领域的 Drucker-Prager 模型。返回映射、非关联流动和组合硬化等概念都是计算塑性力学中的既定原则。该公式具有科学合理性。\n- **适定性**：该问题是适定的。所有必需的方程、材料参数、初始条件和加载增量都已指定，从而可以推导和计算出状态更新的唯一解。\n- **客观性（关键）**：该问题使用精确的数学定义和客观的语言陈述，没有任何主观或模糊的术语。\n- **结论**：该问题完整、一致、有科学依据且适定。因此，判定其为 **有效**。\n\n### 步骤 3：判定与行动\n该问题有效。我将继续进行求解。\n\n### 基于原理的求解推导\n\n该求解需要实现率无关塑性模型的单个时间步，从一个已知状态（此处为零应力状态）开始，并施加一个总应变增量 $\\mathrm{d}\\boldsymbol{\\epsilon}$。该过程涉及一个弹性预测步和一个塑性校正步，通常称为返回映射算法。\n\n#### 1. 弹性预测（试探状态）\n首先，我们假设整个应变增量 $\\mathrm{d}\\boldsymbol{\\epsilon}$ 是纯弹性的。试探状态基于此假设进行计算。\n初始应力 $\\boldsymbol{\\sigma}_0$ 和塑性应变 $\\boldsymbol{\\epsilon}^p_0$ 均为零。\n试探弹性应变增量为 $\\mathrm{d}\\boldsymbol{\\epsilon}^e = \\mathrm{d}\\boldsymbol{\\epsilon}$。\n试探应力增量由弹性定律给出：$\\mathrm{d}\\boldsymbol{\\sigma} = \\mathbf{C} : \\mathrm{d}\\boldsymbol{\\epsilon}$，因此试探应力为 $\\boldsymbol{\\sigma}^{\\mathrm{tr}} = \\boldsymbol{\\sigma}_0 + \\mathrm{d}\\boldsymbol{\\sigma} = \\mathbf{C} : \\mathrm{d}\\boldsymbol{\\epsilon}$。\n\n对于给定的平面应变增量 $\\mathrm{d}\\boldsymbol{\\epsilon} = \\operatorname{diag}(\\mathrm{d}\\epsilon_{xx}, \\mathrm{d}\\epsilon_{yy}, 0)$，体积应变增量为：\n$$ \\mathrm{d}\\epsilon_v = \\operatorname{tr}(\\mathrm{d}\\boldsymbol{\\epsilon}) = \\mathrm{d}\\epsilon_{xx} + \\mathrm{d}\\epsilon_{yy} $$\n偏应变增量张量分量为：\n$$ \\mathrm{d}\\boldsymbol{\\epsilon}_{\\mathrm{dev}} = \\mathrm{d}\\boldsymbol{\\epsilon} - \\frac{1}{3}\\mathrm{d}\\epsilon_v \\mathbf{I} \\implies \\begin{cases} \\mathrm{d}\\epsilon_{\\mathrm{dev},xx} = \\mathrm{d}\\epsilon_{xx} - \\frac{1}{3}\\mathrm{d}\\epsilon_v \\\\ \\mathrm{d}\\epsilon_{\\mathrm{dev},yy} = \\mathrm{d}\\epsilon_{yy} - \\frac{1}{3}\\mathrm{d}\\epsilon_v \\\\ \\mathrm{d}\\epsilon_{\\mathrm{dev},zz} = -\\frac{1}{3}\\mathrm{d}\\epsilon_v \\end{cases} $$\n试探应力张量为 $\\boldsymbol{\\sigma}^{\\mathrm{tr}} = 2G \\mathrm{d}\\boldsymbol{\\epsilon}_{\\mathrm{dev}} + K \\mathrm{d}\\epsilon_v \\mathbf{I}$。\n试探应力不变量为：\n试探平均应力 $p^{\\mathrm{tr}}$：\n根据定义 $p = -\\frac{1}{3} \\operatorname{tr}(\\boldsymbol{\\sigma})$，我们有 $p^{\\mathrm{tr}} = -K \\mathrm{d}\\epsilon_v$。\n试探偏应力张量为 $\\mathbf{s}^{\\mathrm{tr}} = 2G \\mathrm{d}\\boldsymbol{\\epsilon}_{\\mathrm{dev}}$。\n试探偏应力不变量 $q^{\\mathrm{tr}}$：\n$$ q^{\\mathrm{tr}} = \\sqrt{\\frac{3}{2} \\mathbf{s}^{\\mathrm{tr}} : \\mathbf{s}^{\\mathrm{tr}}} = 2G \\sqrt{\\frac{3}{2} (\\mathrm{d}\\epsilon_{\\mathrm{dev},xx}^2 + \\mathrm{d}\\epsilon_{\\mathrm{dev},yy}^2 + \\mathrm{d}\\epsilon_{\\mathrm{dev},zz}^2)} $$\n代入 $\\mathrm{d}\\boldsymbol{\\epsilon}_{\\mathrm{dev}}$ 的分量并化简得到：\n$$ q^{\\mathrm{tr}} = 2G \\sqrt{\\mathrm{d}\\epsilon_{xx}^2 - \\mathrm{d}\\epsilon_{xx}\\mathrm{d}\\epsilon_{yy} + \\mathrm{d}\\epsilon_{yy}^2} $$\n\n#### 2. 屈服检查\n我们在试探状态下评估屈服函数。由于初始状态下 $a_0 = 0$ 和 $R_0 = 0$：\n$$ f^{\\mathrm{tr}} = q^{\\mathrm{tr}} - \\eta p^{\\mathrm{tr}} - q_{y0} $$\n如果 $f^{\\mathrm{tr}} \\le 0$，则该步为弹性。最终状态即为试探状态：\n- $\\mathrm{d}\\boldsymbol{\\epsilon}^p = \\mathbf{0}$\n- $p = p^{\\mathrm{tr}}$，$q = q^{\\mathrm{tr}}$\n\n#### 3. 塑性校正（返回映射）\n如果 $f^{\\mathrm{tr}} > 0$，则发生塑性变形。最终状态 $(\\boldsymbol{\\sigma}, a, R)$ 必须位于屈服面上，满足一致性条件 $f=0$。\n塑性体积应变增量为 $\\mathrm{d}\\epsilon_v^p = \\lambda \\operatorname{tr}(\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}})$. 由于 $p = -\\frac{1}{3}\\operatorname{tr}(\\boldsymbol{\\sigma})$, $\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = -\\frac{1}{3}\\mathbf{I}$. 那么 $\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\mathbf{s} + \\beta(-\\frac{1}{3}\\mathbf{I})$, 其迹为 $\\operatorname{tr}(\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}) = \\beta(-1) = -\\beta$. 因此 $\\mathrm{d}\\epsilon_v^p = -\\lambda\\beta$.\n应力不变量的更新为：\n$$ q = q^{\\mathrm{tr}} - 3G\\lambda $$\n$$ p = p^{\\mathrm{tr}} + K \\mathrm{d}\\epsilon_v^p = p^{\\mathrm{tr}} - K\\beta\\lambda $$\n硬化变量更新如下：\n$$ R = R_0 + H_{\\mathrm{iso}}\\lambda = H_{\\mathrm{iso}}\\lambda $$\n$$ a = a_0 + H_{\\mathrm{kin}}\\lambda = H_{\\mathrm{kin}}\\lambda $$\n将这些代入一致性条件 $f = (q-a) - \\eta p - (q_{y0} + R) = 0$：\n$$ (q^{\\mathrm{tr}} - 3G\\lambda - H_{\\mathrm{kin}}\\lambda) - \\eta(p^{\\mathrm{tr}} - K\\beta\\lambda) - (q_{y0} + H_{\\mathrm{iso}}\\lambda) = 0 $$\n重新整理以求解塑性乘子 $\\lambda$：\n$$ (q^{\\mathrm{tr}} - \\eta p^{\\mathrm{tr}} - q_{y0}) = \\lambda (3G + H_{\\mathrm{iso}} + H_{\\mathrm{kin}} - \\eta K\\beta) $$\n$$ \\lambda = \\frac{f^{\\mathrm{tr}}}{3G + H_{\\mathrm{iso}} + H_{\\mathrm{kin}} - \\eta K\\beta} $$\n已知 $\\lambda$ 后，可以使用它们的更新方程计算最终的应力不变量 $p$ 和 $q$。\n\n#### 4. 塑性应变增量计算\n需要计算塑性应变增量张量。使用返回映射近似 $\\mathbf{s}/q = \\mathbf{s}^{\\mathrm{tr}}/q^{\\mathrm{tr}}$ 并回顾 $\\mathbf{s}^{\\mathrm{tr}} = 2G \\mathrm{d}\\boldsymbol{\\epsilon}_{\\mathrm{dev}}$：\n$$ \\mathrm{d}\\boldsymbol{\\epsilon}^p = \\lambda \\left( \\frac{3}{2q^{\\mathrm{tr}}}\\mathbf{s}^{\\mathrm{tr}} - \\frac{\\beta}{3}\\mathbf{I} \\right) = \\lambda \\left( \\frac{3G}{q^{\\mathrm{tr}}}\\mathrm{d}\\boldsymbol{\\epsilon}_{\\mathrm{dev}} - \\frac{\\beta}{3}\\mathbf{I} \\right) $$\n其分量为：\n$$ \\mathrm{d}\\epsilon^p_{xx} = \\lambda \\left( \\frac{3G}{q^{\\mathrm{tr}}} \\mathrm{d}\\epsilon_{\\mathrm{dev}, xx} - \\frac{\\beta}{3} \\right) $$\n$$ \\mathrm{d}\\epsilon^p_{yy} = \\lambda \\left( \\frac{3G}{q^{\\mathrm{tr}}} \\mathrm{d}\\epsilon_{\\mathrm{dev}, yy} - \\frac{\\beta}{3} \\right) $$\n$$ \\mathrm{d}\\epsilon^p_{zz} = \\lambda \\left( \\frac{3G}{q^{\\mathrm{tr}}} \\mathrm{d}\\epsilon_{\\mathrm{dev}, zz} - \\frac{\\beta}{3} \\right) $$\n对该公式的一个检验是体积塑性应变：$\\mathrm{d}\\epsilon^p_v = \\operatorname{tr}(\\mathrm{d}\\boldsymbol{\\epsilon}^p) = \\lambda (0 - 3\\frac{\\beta}{3}) = -\\lambda\\beta$。这正确地表明 $\\beta$ 控制塑性体积变化（正 $\\beta$ 对应压缩，负 $\\beta$ 对应剪胀）。计算算法将为每个测试用例实现这些推导出的公式。\n问题警告了关于用小的 $q^{\\mathrm{tr}}$ 进行归一化的情况。这对应于接近纯静水压力的试探状态。对于给定的测试用例，$\\mathrm{d}\\epsilon_{xx}$ 和 $\\mathrm{d}\\epsilon_{yy}$ 是不同的，确保了 $q^{\\mathrm{tr}}$ 不为零，因此不需要对顶点奇点进行特殊处理。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the return mapping problem for a Drucker-Prager model\n    with combined hardening for given test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Test 1 (elastic baseline)\n        {\n            \"K\": 100.0, \"G\": 40.0, \"eta\": 0.3, \"H_iso\": 20.0, \n            \"H_kin\": 10.0, \"q_y0\": 3.0, \"beta\": 0.1, \n            \"deps_xx\": -5e-6, \"deps_yy\": -1e-6\n        },\n        # Test 2 (plastic, dilation)\n        {\n            \"K\": 100.0, \"G\": 40.0, \"eta\": 0.3, \"H_iso\": 20.0, \n            \"H_kin\": 10.0, \"q_y0\": 0.02, \"beta\": -0.2, \n            \"deps_xx\": -5e-4, \"deps_yy\": -1e-4\n        },\n        # Test 3 (plastic, contraction)\n        {\n            \"K\": 100.0, \"G\": 40.0, \"eta\": 0.3, \"H_iso\": 20.0, \n            \"H_kin\": 10.0, \"q_y0\": 0.02, \"beta\": 0.2, \n            \"deps_xx\": -5e-4, \"deps_yy\": -1e-4\n        },\n        # Test 4 (near-yield, neutral dilatancy)\n        {\n            \"K\": 100.0, \"G\": 40.0, \"eta\": 0.3, \"H_iso\": 20.0, \n            \"H_kin\": 10.0, \"q_y0\": 0.02, \"beta\": 0.0,\n            \"deps_xx\": -2e-4, \"deps_yy\": -1e-4\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        result = compute_step(params)\n        results.append(result)\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join([f\"[{r[0]},{r[1]},{r[2]},{r[3]},{r[4]}]\" for r in results]) + \"]\"\n    print(output_str)\n\ndef compute_step(params):\n    \"\"\"\n    Performs a single return-mapping step for one set of parameters.\n    \"\"\"\n    K, G, eta, H_iso, H_kin = params[\"K\"], params[\"G\"], params[\"eta\"], params[\"H_iso\"], params[\"H_kin\"]\n    q_y0, beta = params[\"q_y0\"], params[\"beta\"]\n    deps_xx, deps_yy = params[\"deps_xx\"], params[\"deps_yy\"]\n    deps_zz = 0.0  # Plane strain condition\n\n    # Step 1: Elastic Predictor (Trial State)\n    # Volumetric strain increment\n    deps_v = deps_xx + deps_yy + deps_zz\n\n    # Deviatoric strain increment components\n    deps_dev_xx = deps_xx - deps_v / 3.0\n    deps_dev_yy = deps_yy - deps_v / 3.0\n    deps_dev_zz = deps_zz - deps_v / 3.0\n\n    # Trial stress invariants (p_tr, q_tr)\n    # p is positive for compression\n    p_tr = -K * deps_v\n    \n    # Using the simplified formula for plane strain q_tr\n    q_tr_term = deps_xx**2 - deps_xx * deps_yy + deps_yy**2\n    q_tr = 2.0 * G * np.sqrt(q_tr_term)\n\n    # Step 2: Yield Check\n    # Since initial state has R=0, a=0\n    # Corrected yield function f = q - eta*p - q_y0\n    f_tr = q_tr - eta * p_tr - q_y0\n\n    if f_tr = 0:\n        # Elastic step\n        d_eps_p_xx = 0.0\n        d_eps_p_yy = 0.0\n        d_eps_p_zz = 0.0\n        p_final = p_tr\n        q_final = q_tr\n    else:\n        # Plastic step\n        # Step 3: Compute plastic multiplier lambda\n        denominator = 3.0 * G + H_iso + H_kin - eta * K * beta\n        if abs(denominator)  1e-12:\n            # Avoid division by zero in case of perfect plasticity or softening models\n            # This case is not expected with the given parameters\n            raise ValueError(\"Denominator for lambda is zero or near-zero.\")\n        \n        plastic_multiplier = f_tr / denominator\n\n        # Step 4: Update stress invariants\n        p_final = p_tr - K * beta * plastic_multiplier\n        q_final = q_tr - 3.0 * G * plastic_multiplier\n        \n        # In case of numerical noise, ensure q is non-negative\n        q_final = max(0.0, q_final)\n\n        # Step 5: Compute plastic strain increment components\n        # A small tolerance to avoid division by zero if q_tr is very small\n        q_tr_safe = q_tr if q_tr > 1e-12 else 1e-12\n        \n        common_factor = 3.0 * G / q_tr_safe\n        # Note: In the problem setup g = q + beta*p. With p = -tr(sigma)/3,\n        # d(eps_v_p) = -lambda * beta. So the beta_term here is correct.\n        beta_term = beta / 3.0\n\n        d_eps_p_xx = plastic_multiplier * (common_factor * deps_dev_xx - beta_term)\n        d_eps_p_yy = plastic_multiplier * (common_factor * deps_dev_yy - beta_term)\n        d_eps_p_zz = plastic_multiplier * (common_factor * deps_dev_zz - beta_term)\n\n    return [d_eps_p_xx, d_eps_p_yy, d_eps_p_zz, p_final, q_final]\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3536010"}, {"introduction": "虽然一些简单的模型允许塑性乘子有显式解，但更一般和复杂的情况需要稳健的迭代求解器。这个高级实践将介绍使用牛顿-拉弗森（Newton-Raphson）方法来求解应力更新过程中产生的非线性方程组。您将为一个非关联Drucker-Prager模型构建残差方程和雅可比矩阵，并实现一个迭代求解器。这将锻炼您在有限元软件中创建功能强大且通用的本构程序所必需的关键技能。", "problem": "考虑一个使用 Drucker–Prager 屈服准则建模的压力敏感材料的小应变弹塑性本构更新。令柯西应力张量表示为 $\\boldsymbol{\\sigma}$，其平均（静水）应力为 $p = \\frac{1}{3} \\operatorname{tr}(\\boldsymbol{\\sigma})$（压缩为正），von Mises 等效应力为 $q = \\sqrt{3 J_2}$，其中 $J_2 = \\tfrac{1}{2} \\boldsymbol{s} : \\boldsymbol{s}$，$\\boldsymbol{s} = \\boldsymbol{\\sigma} - p \\boldsymbol{I}$ 为偏应力。线性弹性刚度是各向同性的，具有体积模量 $K$ 和剪切模量 $G$，因此对于任何应变增量 $\\Delta \\boldsymbol{\\varepsilon}$，试探应力为 $\\boldsymbol{\\sigma}^{\\text{trial}} = \\boldsymbol{\\sigma}_n + \\boldsymbol{C} : \\Delta \\boldsymbol{\\varepsilon}$，其中 $\\boldsymbol{C}$ 是四阶各向同性弹性张量。Drucker–Prager 屈服函数定义为\n$$\nf(p, q, k) = q - a\\, p - k,\n$$\n其中 $a$ 是材料摩擦参数，$k$ 是一个各向同性硬化类应力变量。塑性势是非关联的，取为\n$$\ng(p, q) = q + b\\, p,\n$$\n其中 $b$ 是剪胀参数（通常 $b \\neq a$）。塑性流动法则是非关联的，由下式给出\n$$\n\\Delta \\boldsymbol{\\varepsilon}^{p} = \\Delta \\lambda \\, \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}},\n$$\n其中 $\\Delta \\lambda \\ge 0$ 是塑性乘子增量。Kuhn–Tucker 条件要求 $f \\le 0$，$\\Delta \\lambda \\ge 0$ 和 $\\Delta \\lambda \\, f = 0$。\n\n假设为各向同性硬化，硬化变量根据累积塑性乘子的线性法则演化，即\n$$\nk = k_0 + H \\, \\xi,\n$$\n其中 $k_0$ 是 $k$ 的初始值，$H \\ge 0$ 是各向同性硬化模量，$\\xi$ 是累积塑性乘子。在单个增量步内，取 $d\\xi = \\Delta \\lambda$，因此更新后的 $k$ 满足 $k = k_0 + H \\, \\Delta \\lambda$。\n\n你的任务是为此 Drucker–Prager 模型（具有 $k$ 的各向同性硬化和非关联塑性势 $g$）构建一个局部 Newton–Raphson (NR) 应力更新，并推导迭代中使用的残差。从上述基本定义出发，并利用各向同性弹性中的弹性修正量可以在流动方向与 $\\partial g / \\partial \\boldsymbol{\\sigma}$ 对齐时用不变量 $p$ 和 $q$ 表示的事实。推导一个以由更新后的不变量和塑性乘子 $\\Delta \\lambda$ 组成的未知向量表示的残差系统。残差必须强制执行屈服条件和不变量形式的流动法则的一致性。\n\n然后，实现一个完整的程序，该程序：\n- 应用弹性预测器以获得试探不变量 $p^{\\text{trial}}$ 和 $q^{\\text{trial}}$。\n- 根据屈服准则检查试探状态。如果 $f(p^{\\text{trial}}, q^{\\text{trial}}, k_0) \\le 0$，则该步是弹性的，$\\Delta \\lambda = 0$，更新后的 $(p, q) = (p^{\\text{trial}}, q^{\\text{trial}})$，$k = k_0$，以及 $f = f(p,q,k)$。否则，使用你推导的残差对塑性步进行局部 Newton–Raphson 求解，并返回更新后的 $(p, q)$、更新后的 $k$、塑性乘子 $\\Delta \\lambda$ 和最终的 $f$。\n- 在 Newton–Raphson 循环中，对残差范数使用 $10^{-12}$ 的绝对收敛容差，最大迭代次数为 $50$ 次。\n\n所有应力量（$p$、$q$、$k$）均以兆帕（MPa）表示。你的程序必须处理以下独立案例的测试套件，每个案例都指定为材料参数和试探不变量的元组：\n1. 案例 A（弹性）：$K = 100$ MPa，$G = 50$ MPa，$a = 0.3$，$b = 0.05$，$k_0 = 30$ MPa，$H = 100$ MPa，$p^{\\text{trial}} = 50$ MPa，$q^{\\text{trial}} = 10$ MPa。\n2. 案例 B（塑性，中等）：$K = 100$ MPa，$G = 50$ MPa，$a = 0.3$，$b = 0.05$，$k_0 = 20$ MPa，$H = 100$ MPa，$p^{\\text{trial}} = 50$ MPa，$q^{\\text{trial}} = 20$ MPa。\n3. 案例 C（在屈服面上，零硬化）：$K = 80$ MPa，$G = 40$ MPa，$a = 0.3$，$b = 0.1$，$k_0 = 19$ MPa，$H = 0$ MPa，$p^{\\text{trial}} = 30$ MPa，$q^{\\text{trial}} = 10$ MPa。\n4. 案例 D（塑性，收缩性剪胀）：$K = 150$ MPa，$G = 60$ MPa，$a = 0.2$，$b = -0.1$，$k_0 = 20$ MPa，$H = 50$ MPa，$p^{\\text{trial}} = 100$ MPa，$q^{\\text{trial}} = 45$ MPa。\n\n对于每个案例，你的程序必须输出列表 $[\\Delta \\lambda, p, q, k, f]$，其中 $\\Delta \\lambda$ 是塑性乘子增量，$p$ 和 $q$ 是更新后的不变量（单位为 MPa），$k$ 是更新后的硬化变量（单位为 MPa），$f$ 是最终的屈服函数值（单位为 MPa）。你的程序应生成一行输出，其中包含所有四个案例的结果，格式为一个以逗号分隔的列表，并用方括号括起来，其中每个案例的结果本身也是一个相同逗号分隔格式的列表，例如：\n$[[\\Delta \\lambda_A,p_A,q_A,k_A,f_A],[\\Delta \\lambda_B,p_B,q_B,k_B,f_B],[\\Delta \\lambda_C,p_C,q_C,k_C,f_C],[\\Delta \\lambda_D,p_D,q_D,k_D,f_D]]$。", "solution": "该问题要求为 Drucker–Prager 弹塑性材料模型构建并实现一个应力更新算法。该模型具有非关联流动法则和线性各向同性硬化。解将通过局部 Newton–Raphson (NR) 迭代方案获得。\n\n应力状态由平均应力 $p$ 和 von Mises 等效应力 $q$ 描述。给定一个试探弹性状态 $(p^{\\text{trial}}, q^{\\text{trial}})$ 和材料属性，目标是找到满足本构关系和屈服条件的更新状态 $(p, q)$ 和塑性乘子增量 $\\Delta\\lambda$。\n\n首先，使用初始硬化变量 $k_0$ 计算试探屈服函数值：\n$$\nf^{\\text{trial}} = q^{\\text{trial}} - a\\, p^{\\text{trial}} - k_0\n$$\n如果 $f^{\\text{trial}} \\le 0$，材料响应是弹性的。不发生塑性变形，因此 $\\Delta\\lambda=0$。更新后的状态即为试探状态：$p = p^{\\text{trial}}$，$q = q^{\\text{trial}}$，以及 $k=k_0$。最终的屈服函数值为 $f = f^{\\text{trial}}$。\n\n如果 $f^{\\text{trial}}  0$，试探状态位于屈服面之外，需要进行塑性修正。更新后的应力状态 $\\boldsymbol{\\sigma}$ 必须返回到屈服面上。这通过回映算法实现。总应变增量被加法分解为一个弹性部分 $\\Delta\\boldsymbol{\\varepsilon}^e$ 和一个塑性部分 $\\Delta\\boldsymbol{\\varepsilon}^p$：$\\Delta\\boldsymbol{\\varepsilon} = \\Delta\\boldsymbol{\\varepsilon}^e + \\Delta\\boldsymbol{\\varepsilon}^p$。\n\n应力通过胡克定律与弹性应变相关联，得到表达式：\n$$\n\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^{\\text{trial}} - \\boldsymbol{C} : \\Delta\\boldsymbol{\\varepsilon}^p\n$$\n其中 $\\boldsymbol{C}$ 是四阶各向同性弹性张量。塑性应变增量由非关联流动法则给出：\n$$\n\\Delta\\boldsymbol{\\varepsilon}^p = \\Delta\\lambda \\, \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}\n$$\n其中 $g(p, q) = q + b\\, p$ 是塑性势。偏导数 $\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$ 在未知的最终应力状态 $\\boldsymbol{\\sigma}$ 处求值：\n$$\n\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial g}{\\partial p}\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} + \\frac{\\partial g}{\\partial q}\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} = b \\left( \\frac{1}{3}\\boldsymbol{I} \\right) + 1 \\left( \\frac{3}{2q}\\boldsymbol{s} \\right)\n$$\n其中 $\\boldsymbol{I}$ 是二阶单位张量，$\\boldsymbol{s}$ 是 $\\boldsymbol{\\sigma}$ 的偏量部分。\n\n将流动法则代入应力更新方程，得到：\n$$\n\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^{\\text{trial}} - \\Delta\\lambda \\, \\boldsymbol{C} : \\left( \\frac{b}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s} \\right)\n$$\n对于具有体积模量 $K$ 和剪切模量 $G$ 的各向同性弹性材料，张量缩并为 $\\boldsymbol{C}:\\boldsymbol{I} = 3K\\boldsymbol{I}$ 和 $\\boldsymbol{C}:\\boldsymbol{s} = 2G\\boldsymbol{s}$。应力更新变为：\n$$\n\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^{\\text{trial}} - \\Delta\\lambda \\left( K b \\boldsymbol{I} + \\frac{3G}{q}\\boldsymbol{s} \\right)\n$$\n该方程可以分解为体积（平均）和偏量部分。\n平均部分通过取方程迹的三分之一得到：\n$$\np = p^{\\text{trial}} - K b \\Delta\\lambda\n$$\n偏量部分为：\n$$\n\\boldsymbol{s} = \\boldsymbol{s}^{\\text{trial}} - \\Delta\\lambda \\frac{3G}{q}\\boldsymbol{s} \\implies \\boldsymbol{s} \\left( 1 + \\frac{3G\\Delta\\lambda}{q} \\right) = \\boldsymbol{s}^{\\text{trial}}\n$$\n此关系表明，更新后的偏应力 $\\boldsymbol{s}$ 与试探偏应力 $\\boldsymbol{s}^{\\text{trial}}$ 共轴。通过定义 $q = \\sqrt{\\frac{3}{2}\\boldsymbol{s}:\\boldsymbol{s}}$ 对两边取范数，得到：\n$$\nq \\left( 1 + \\frac{3G\\Delta\\lambda}{q} \\right) = q^{\\text{trial}} \\implies q + 3G\\Delta\\lambda = q^{\\text{trial}} \\implies q = q^{\\text{trial}} - 3G\\Delta\\lambda\n$$\n在塑性步结束时，状态必须位于更新后的屈服面上，满足一致性条件 $f(p, q, k) = 0$。硬化变量 $k$ 根据线性法则 $k = k_0 + H\\Delta\\lambda$ 演化。因此，一致性条件为：\n$$\nq - a\\, p - (k_0 + H\\Delta\\lambda) = 0\n$$\n我们现在得到了一个包含三个未知数（更新后的不变量 $p$、$q$ 和塑性乘子增量 $\\Delta\\lambda$）的三个方程组。为了用 Newton–Raphson 方法求解这个系统，我们定义一个残差向量 $\\mathbf{R}(\\mathbf{x})$，其中未知向量是 $\\mathbf{x} = \\{p, q, \\Delta\\lambda\\}^T$。\n\n三个残差方程是：\n1.  强制执行体积回映映射：\n    $R_p(p, q, \\Delta\\lambda) = p - p^{\\text{trial}} + K b \\Delta\\lambda = 0$\n2.  强制执行偏量回映映射：\n    $R_q(p, q, \\Delta\\lambda) = q - q^{\\text{trial}} + 3G \\Delta\\lambda = 0$\n3.  强制执行屈服条件：\n    $R_f(p, q, \\Delta\\lambda) = q - a p - k_0 - H \\Delta\\lambda = 0$\n\nNewton-Raphson 方法通过求解线性系统 $\\mathbf{J}(\\mathbf{x}_i) \\delta\\mathbf{x} = -\\mathbf{R}(\\mathbf{x}_i)$ 来找到每次迭代 $i$ 的修正量 $\\delta\\mathbf{x}$，其中 $\\mathbf{J}$ 是残差系统的雅可比矩阵。然后，未知数更新为 $\\mathbf{x}_{i+1} = \\mathbf{x}_i + \\delta\\mathbf{x}$。\n\n雅可比矩阵 $\\mathbf{J}$ 定义为 $J_{ij} = \\frac{\\partial R_i}{\\partial x_j}$。对于我们的系统，它是：\n$$\n\\mathbf{J} =\n\\begin{bmatrix}\n\\frac{\\partial R_p}{\\partial p}  \\frac{\\partial R_p}{\\partial q}  \\frac{\\partial R_p}{\\partial \\Delta\\lambda} \\\\\n\\frac{\\partial R_q}{\\partial p}  \\frac{\\partial R_q}{\\partial q}  \\frac{\\partial R_q}{\\partial \\Delta\\lambda} \\\\\n\\frac{\\partial R_f}{\\partial p}  \\frac{\\partial R_f}{\\partial q}  \\frac{\\partial R_f}{\\partial \\Delta\\lambda}\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n1  0  K b \\\\\n0  1  3G \\\\\n-a  1  -H\n\\end{bmatrix}\n$$\n由于所有残差方程相对于未知数 $p$、$q$ 和 $\\Delta\\lambda$ 都是线性的，雅可比矩阵 $\\mathbf{J}$ 是一个常数。这意味着无论初始猜测如何，Newton–Raphson 算法都将在一次迭代中收敛到精确解。一个合适的初始猜测是试探状态，$\\mathbf{x}_0 = \\{p^{\\text{trial}}, q^{\\text{trial}}, 0\\}^T$。迭代过程将持续进行，直到残差向量 $\\mathbf{R}$ 的欧几里得范数低于指定的容差。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Drucker-Prager stress update.\n    \"\"\"\n    test_cases = [\n        # Case A (elastic)\n        {'K': 100.0, 'G': 50.0, 'a': 0.3, 'b': 0.05, 'k0': 30.0, 'H': 100.0, 'p_trial': 50.0, 'q_trial': 10.0},\n        # Case B (plastic, moderate)\n        {'K': 100.0, 'G': 50.0, 'a': 0.3, 'b': 0.05, 'k0': 20.0, 'H': 100.0, 'p_trial': 50.0, 'q_trial': 20.0},\n        # Case C (on yield surface, zero hardening)\n        {'K': 80.0, 'G': 40.0, 'a': 0.3, 'b': 0.1, 'k0': 19.0, 'H': 0.0, 'p_trial': 30.0, 'q_trial': 10.0},\n        # Case D (plastic, contractive dilatancy)\n        {'K': 150.0, 'G': 60.0, 'a': 0.2, 'b': -0.1, 'k0': 20.0, 'H': 50.0, 'p_trial': 100.0, 'q_trial': 45.0},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = stress_update_drucker_prager(**case)\n        all_results.append(result)\n\n    # Format the final output string as a list of lists.\n    case_results_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(case_results_str)}]\")\n\ndef stress_update_drucker_prager(K, G, a, b, k0, H, p_trial, q_trial):\n    \"\"\"\n    Performs an elasto-plastic stress update for a Drucker-Prager model.\n\n    Args:\n        K (float): Bulk modulus.\n        G (float): Shear modulus.\n        a (float): Friction parameter.\n        b (float): Dilatancy parameter.\n        k0 (float): Initial hardening variable.\n        H (float): Isotropic hardening modulus.\n        p_trial (float): Trial mean stress.\n        q_trial (float): Trial von Mises equivalent stress.\n\n    Returns:\n        list: A list containing [delta_lambda, p, q, k, f].\n    \"\"\"\n    # Calculate trial yield function value using the corrected formula\n    f_trial = q_trial - a * p_trial - k0\n\n    # Elastic case: trial state is inside or on the yield surface\n    if f_trial = 0:\n        p_final = p_trial\n        q_final = q_trial\n        k_final = k0\n        delta_lambda = 0.0\n        f_final = f_trial\n        return [delta_lambda, p_final, q_final, k_final, f_final]\n\n    # Plastic case: perform Newton-Raphson iteration\n    # Set up initial guess from the trial state\n    p_k = p_trial\n    q_k = q_trial\n    delta_lambda_k = 0.0\n\n    # Newton-Raphson parameters\n    tolerance = 1e-12\n    max_iterations = 50\n\n    # The Jacobian is constant for this linear problem. Corrected Jacobian.\n    J = np.array([\n        [1.0, 0.0, K * b],\n        [0.0, 1.0, 3.0 * G],\n        [-a,  1.0, -H]\n    ])\n\n    for _ in range(max_iterations):\n        # Calculate residual vector R(x_k). Corrected R_f.\n        R_p = p_k - p_trial + K * b * delta_lambda_k\n        R_q = q_k - q_trial + 3.0 * G * delta_lambda_k\n        R_f = q_k - a * p_k - k0 - H * delta_lambda_k\n        R = np.array([R_p, R_q, R_f])\n        \n        # Check for convergence\n        if np.linalg.norm(R)  tolerance:\n            break\n\n        # Solve for the increment: J * dx = -R\n        # dx = [dp, dq, d(delta_lambda)]^T\n        dx = np.linalg.solve(J, -R)\n\n        # Update the variables\n        p_k += dx[0]\n        q_k += dx[1]\n        delta_lambda_k += dx[2]\n\n    # Assign final values\n    p_final = p_k\n    q_final = q_k\n    delta_lambda = delta_lambda_k\n    \n    # Update hardening variable\n    k_final = k0 + H * delta_lambda\n    \n    # Compute final yield function value to check consistency\n    f_final = q_final - a * p_final - k_final\n\n    return [delta_lambda, p_final, q_final, k_final, f_final]\n\n\n# Execute the solver\nsolve()\n```", "id": "3536083"}]}