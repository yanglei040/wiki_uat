{"hands_on_practices": [{"introduction": "第一个练习是计算塑性力学的一个基石。我们将为一个经典的关联$J_2$ (von Mises) 模型实现隐式返回映射算法，这对于理解应力状态如何因塑性变形而更新至关重要。通过这个实践，你将掌握实现更复杂模型所需的核心编程技能。[@problem_id:3551039]", "problem": "您需要实现一个用于相伴各向同性 $J_2$ 弹塑性模型（带线性各向同性硬化）的小应变、三维隐式返回映射算法，并使用后向欧拉时间离散化方法。该实现必须是通用的、自包含的，纯粹对数学对象（张量）进行操作，无需外部输入。所有材料参数和状态变量将在下面的测试套件中以数值形式提供。您的程序必须为每个测试用例计算单个载荷增量的更新，从给定的先前状态开始。\n\n使用的基础理论：\n- 各向同性固体在线性弹性小应变下的关系：柯西应力张量 $\\boldsymbol{\\sigma}$ 通过 $\\boldsymbol{\\sigma} = \\mathbb{C}:(\\boldsymbol{\\varepsilon}-\\boldsymbol{\\varepsilon}^p)$ 与总应变张量 $\\boldsymbol{\\varepsilon}$ 和塑性应变张量 $\\boldsymbol{\\varepsilon}^p$ 相关联，其中四阶弹性张量 $\\mathbb{C}$ 由通过杨氏模量 $E$ 和泊松比 $\\nu$ 获得的拉梅参数 $\\lambda$ 和 $\\mu$ 定义。\n- 偏量-体积分解：$\\boldsymbol{\\sigma} = \\mathbf{s} + p \\mathbf{I}$，其中 $\\mathbf{s} = \\operatorname{dev}\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma} - \\tfrac{1}{3}(\\operatorname{tr}\\boldsymbol{\\sigma})\\mathbf{I}$ 且 $p = \\tfrac{1}{3}\\operatorname{tr}\\boldsymbol{\\sigma}$。\n- 带有线性各向同性硬化的各向同性 $J_2$ 塑性屈服函数：$f(\\boldsymbol{\\sigma},\\kappa) = \\|\\mathbf{s}\\| - r(\\kappa)$，其中 $\\|\\cdot\\|$ 是弗罗贝尼乌斯范数，$r(\\kappa) = \\sqrt{\\tfrac{2}{3}}\\left(\\sigma_{y0} + H \\kappa\\right)$；内硬化变量 $\\kappa$ 是累积等效塑性应变。\n- 关联塑性势和流动法则：采用 $g(\\boldsymbol{\\sigma}) \\equiv f(\\boldsymbol{\\sigma},\\kappa)$ 和 $\\Delta \\boldsymbol{\\varepsilon}^p = \\Delta \\gamma \\,\\dfrac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$，其中 $\\Delta \\gamma \\ge 0$ 是塑性乘子增量。\n- 库恩-塔克（Kuhn–Tucker）条件：$f \\le 0$，$\\Delta \\gamma \\ge 0$ 和 $\\Delta \\gamma f = 0$。\n- 各向同性硬化演化：$\\Delta \\kappa = \\sqrt{\\tfrac{2}{3}}\\|\\Delta \\boldsymbol{\\varepsilon}^p\\|$。\n\n需要实现的算法：\n- 使用弹性预测：假设 $\\Delta \\boldsymbol{\\varepsilon}^p = \\mathbf{0}$，从先前的应力和总应变增量 $\\Delta \\boldsymbol{\\varepsilon}$ 计算试探应力 $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$。\n- 使用 $\\mathbf{s}^{\\mathrm{tr}}=\\operatorname{dev}\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ 和先前的 $\\kappa_n$ 来评估试探屈服函数 $f^{\\mathrm{tr}}$。\n- 如果 $f^{\\mathrm{tr}} \\le 0$（在合理的数值容差范围内），则接受弹性试探状态：$\\boldsymbol{\\sigma}_{n+1}=\\boldsymbol{\\sigma}^{\\mathrm{tr}}$，$\\kappa_{n+1}=\\kappa_n$ 和 $\\Delta \\gamma = 0$。\n- 如果 $f^{\\mathrm{tr}}  0$，则在偏应力空间中执行径向返回，强制执行流动法则和一致性条件来计算 $\\Delta \\gamma$，更新偏应力 $\\mathbf{s}_{n+1}$，保持试探状态的静水压力 $p$，并更新 $\\kappa_{n+1}$。\n\n您的程序必须为每个测试用例输出以下列表：\n- 一个布尔值，指示是否发生了塑性修正（如果 $f^{\\mathrm{tr}}  0$ 则为 True，否则为 False）。\n- 增量结束时的 von Mises 等效应力 $q_{n+1} = \\sqrt{\\tfrac{3}{2}}\\|\\mathbf{s}_{n+1}\\|$，以千帕（kPa）为单位，表示为浮点数。\n- 塑性乘子增量 $\\Delta \\gamma$，表示为浮点数。\n- 最终的平均应力 $p_{n+1} = \\tfrac{1}{3}\\operatorname{tr}\\boldsymbol{\\sigma}_{n+1}$，以千帕（kPa）为单位，表示为浮点数。\n\n所有浮点数输出在最终打印结果中必须四舍五入到 $6$ 位小数。此问题不涉及角度。任何地方都不应使用百分比。\n\n测试套件：\n对于所有情况，假设小应变和零初始应力 $\\boldsymbol{\\sigma}_n = \\mathbf{0}$。所有模量均以千帕（kPa）为单位给出。每个应变增量是一个对称二阶张量，由其完整的 $3\\times 3$ 分量给出。每个测试用例提供 $(E,\\nu,\\sigma_{y0},H,\\kappa_n,\\Delta \\boldsymbol{\\varepsilon})$。\n\n- 测试 1（弹性，纯剪切）：\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 0$ (kPa), $\\kappa_n = 0$。\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.0003  0 \\\\ 0.0003  0  0 \\\\ 0  0  0 \\end{bmatrix}$。\n\n- 测试 2（塑性，理想塑性）：\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 0$ (kPa), $\\kappa_n = 0$。\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.002  0 \\\\ 0.002  0  0 \\\\ 0  0  0 \\end{bmatrix}$。\n\n- 测试 3（塑性，带非零先前 $\\kappa_n$ 的线性各向同性硬化）：\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 10000$ (kPa), $\\kappa_n = 0.05$。\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.002  0 \\\\ 0.002  0  0 \\\\ 0  0  0 \\end{bmatrix}$。\n\n- 测试 4（纯体积，弹性）：\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 5000$ (kPa), $\\kappa_n = 0$。\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.001  0  0 \\\\ 0  0.001  0 \\\\ 0  0  0.001 \\end{bmatrix}$。\n\n- 测试 5（边界情况，恰好在屈服面上，如果 $f^{\\mathrm{tr}} \\le 0$ 则视为弹性）：\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 0$ (kPa), $\\kappa_n = 0$。\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.00075  0 \\\\ 0.00075  0  0 \\\\ 0  0  0 \\end{bmatrix}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含每个测试用例结果的列表，每个结果本身是按 [plastic_flag, q_kPa, delta_gamma, p_kPa] 顺序排列的列表。例如，最终打印的行必须如下所示：\n\"[[True,123.456789,0.001234,10.000000],[False, ...], ...]\"\n\n不应打印其他任何文本。", "solution": "用户提供的问题要求实现一个针对率无关、小应变、各向同性 $J_2$ 弹塑性模型（带线性各向同性硬化）的返回映射算法。该问题定义明确，科学上合理，并为获得唯一解提供了所有必要信息。以下详细说明了实现的理论基础和算法步骤。\n\n### 1. 本构模型\n总应变张量 $\\boldsymbol{\\varepsilon}$ 被加性分解为弹性部分 $\\boldsymbol{\\varepsilon}^e$ 和塑性部分 $\\boldsymbol{\\varepsilon}^p$：$\\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^e + \\boldsymbol{\\varepsilon}^p$。\n\n**弹性行为**：柯西应力张量 $\\boldsymbol{\\sigma}$ 通过各向同性材料的胡克定律与弹性应变张量相关联：\n$$ \\boldsymbol{\\sigma} = \\mathbb{C}:\\boldsymbol{\\varepsilon}^e = \\mathbb{C}:(\\boldsymbol{\\varepsilon} - \\boldsymbol{\\varepsilon}^p) $$\n四阶弹性张量 $\\mathbb{C}$ 由拉梅参数 $\\lambda$ 和 $\\mu$（剪切模量）定义，这些参数由杨氏模量 $E$ 和泊松比 $\\nu$ 导出：\n$$ \\mu = \\frac{E}{2(1+\\nu)}, \\quad \\lambda = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} $$\n将应力-应变关系用偏量和体积分量表示会很方便。一个张量 $\\mathbf{A}$ 被分解为 $\\mathbf{A} = \\operatorname{dev}(\\mathbf{A}) + \\frac{1}{3}\\operatorname{tr}(\\mathbf{A})\\mathbf{I}$，其中 $\\operatorname{dev}(\\mathbf{A})$ 是偏量部分，$\\operatorname{tr}(\\mathbf{A})$ 是迹。令 $\\mathbf{s} = \\operatorname{dev}(\\boldsymbol{\\sigma})$ 为偏应力， $p = \\frac{1}{3}\\operatorname{tr}(\\boldsymbol{\\sigma})$ 为平均应力（静水压力）。类似地，$\\mathbf{e} = \\operatorname{dev}(\\boldsymbol{\\varepsilon})$ 且 $\\epsilon_v = \\operatorname{tr}(\\boldsymbol{\\varepsilon})$。弹性关系为：\n$$ \\mathbf{s} = 2\\mu(\\mathbf{e} - \\mathbf{e}^p), \\quad p = K(\\epsilon_v - \\epsilon_v^p) $$\n其中 $K = \\lambda + \\frac{2}{3}\\mu = \\frac{E}{3(1-2\\nu)}$ 是体积模量。\n\n**塑性行为**：塑性流动由一个屈服函数、一个流动法则和一个硬化定律控制。\n- **屈服函数**：塑性变形的开始由带有线性各向同性硬化的 $J_2$ 屈服函数确定：\n  $$ f(\\boldsymbol{\\sigma},\\kappa) = \\|\\mathbf{s}\\| - r(\\kappa) \\le 0 $$\n  其中 $\\|\\mathbf{s}\\| = \\sqrt{\\mathbf{s}:\\mathbf{s}}$ 是偏应力张量的弗罗贝尼乌斯范数。屈服面半径 $r(\\kappa)$ 取决于内硬化变量 $\\kappa$，它代表累积的等效塑性应变：\n  $$ r(\\kappa) = \\sqrt{\\frac{2}{3}}\\left(\\sigma_{y0} + H \\kappa\\right) $$\n  这里，$\\sigma_{y0}$ 是单轴拉伸下的初始屈服应力，$H$ 是常数硬化模量。屈服条件也可以用 von Mises 等效应力 $q = \\sqrt{\\frac{3}{2}}\\|\\mathbf{s}\\|$ 表示为 $q \\le \\sigma_{y}(\\kappa)$，其中 $\\sigma_{y}(\\kappa) = \\sigma_{y0} + H\\kappa$。\n\n- **流动法则**：采用关联流动法则，意味着塑性势 $g$ 与屈服函数 $f$ 相同。塑性应变增量 $\\Delta \\boldsymbol{\\varepsilon}^p$ 垂直于屈服面：\n  $$ \\Delta \\boldsymbol{\\varepsilon}^p = \\Delta \\gamma \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\Delta \\gamma \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} = \\Delta \\gamma \\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|} $$\n  标量 $\\Delta \\gamma \\ge 0$ 是塑性乘子。此流动法则意味着塑性变形是等体积的（保持体积不变），即 $\\operatorname{tr}(\\Delta \\boldsymbol{\\varepsilon}^p) = 0$。\n\n- **硬化定律**：硬化变量 $\\kappa$ 的演化由以下公式给出：\n  $$ \\Delta \\kappa = \\sqrt{\\frac{2}{3}}\\|\\Delta \\boldsymbol{\\varepsilon}^p\\| $$\n  根据流动法则，$\\|\\Delta \\boldsymbol{\\varepsilon}^p\\| = \\Delta \\gamma \\|\\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|}\\| = \\Delta \\gamma$。因此，硬化增量为：\n  $$ \\Delta \\kappa = \\sqrt{\\frac{2}{3}}\\Delta \\gamma $$\n  \n加载/卸载条件由库恩-塔克（Kuhn-Tucker）互补条件规定：\n$$ f \\le 0, \\quad \\Delta \\gamma \\ge 0, \\quad \\Delta \\gamma f = 0 $$\n\n### 2. 隐式返回映射算法\n该算法针对给定的总应变增量 $\\Delta\\boldsymbol{\\varepsilon}$，将状态从时间 $n$ 更新到 $n+1$。使用后向欧拉积分方案，我们的目标是找到满足时间 $n+1$ 处本构关系的 $(\\boldsymbol{\\sigma}_{n+1}, \\boldsymbol{\\varepsilon}^p_{n+1}, \\kappa_{n+1})$。\n\n**步骤 1：弹性预测**\n首先，假设该步骤是纯弹性的（$\\Delta \\boldsymbol{\\varepsilon}^p = \\mathbf{0}$，因此 $\\Delta \\gamma = 0$）。计算试探应力 $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$：\n$$ \\boldsymbol{\\sigma}^{\\mathrm{tr}} = \\mathbb{C}:(\\boldsymbol{\\varepsilon}_{n+1} - \\boldsymbol{\\varepsilon}^p_n) = \\boldsymbol{\\sigma}_n + \\mathbb{C}:\\Delta\\boldsymbol{\\varepsilon} $$\n分解为偏量和体积部分：\n$$ \\mathbf{s}^{\\mathrm{tr}} = \\mathbf{s}_n + 2\\mu\\operatorname{dev}(\\Delta\\boldsymbol{\\varepsilon}) $$\n$$ p^{\\mathrm{tr}} = p_n + K\\operatorname{tr}(\\Delta\\boldsymbol{\\varepsilon}) $$\n对于给定的问题，初始状态是无应力的，$\\boldsymbol{\\sigma}_n = \\mathbf{0}$，所以 $\\mathbf{s}_n=\\mathbf{0}$ 和 $p_n=0$。\n\n**步骤 2：屈服检查**\n在试探状态下，使用上一步的硬化状态 $\\kappa_n$ 评估屈服函数：\n$$ f^{\\mathrm{tr}} = \\|\\mathbf{s}^{\\mathrm{tr}}\\| - r(\\kappa_n) $$\n- 如果 $f^{\\mathrm{tr}} \\le 0$，则弹性假设是正确的。状态更新为试探状态：\n  $$ \\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\mathrm{tr}}, \\quad \\boldsymbol{\\varepsilon}^p_{n+1} = \\boldsymbol{\\varepsilon}^p_n, \\quad \\kappa_{n+1} = \\kappa_n, \\quad \\Delta\\gamma = 0 $$\n  这是一个**弹性步骤**。\n\n**步骤 3：塑性修正**\n- 如果 $f^{\\mathrm{tr}}  0$，则试探状态位于屈服面之外，表明发生了塑性屈服。必须将状态“返回”到更新后的屈服面上。这是一个**塑性步骤**。我们必须找到 $\\Delta \\gamma  0$ 使得一致性条件 $f(\\boldsymbol{\\sigma}_{n+1}, \\kappa_{n+1}) = 0$ 得以满足。\n\n$n+1$ 时刻的应力与试探应力相关：\n$$ \\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\mathbb{C}:\\Delta\\boldsymbol{\\varepsilon}^p $$\n由于 $\\operatorname{tr}(\\Delta\\boldsymbol{\\varepsilon}^p) = 0$，更新可分解为：\n$$ p_{n+1} = p^{\\mathrm{tr}} $$\n$$ \\mathbf{s}_{n+1} = \\mathbf{s}^{\\mathrm{tr}} - 2\\mu\\Delta\\boldsymbol{\\varepsilon}^p $$\n代入流动法则 $\\Delta \\boldsymbol{\\varepsilon}^p = \\Delta \\gamma \\frac{\\mathbf{s}_{n+1}}{\\|\\mathbf{s}_{n+1}\\|}$：\n$$ \\mathbf{s}_{n+1} = \\mathbf{s}^{\\mathrm{tr}} - 2\\mu\\Delta\\gamma \\frac{\\mathbf{s}_{n+1}}{\\|\\mathbf{s}_{n+1}\\|} $$\n此关系表明 $\\mathbf{s}_{n+1}$ 与 $\\mathbf{s}^{\\mathrm{tr}}$ 共线。对两边取范数得到：\n$$ \\|\\mathbf{s}_{n+1}\\| = \\|\\mathbf{s}^{\\mathrm{tr}}\\| - 2\\mu\\Delta\\gamma $$\n最终状态必须位于屈服面上：$\\|\\mathbf{s}_{n+1}\\| = r(\\kappa_{n+1})$。\n更新后的屈服半径为：\n$$ r(\\kappa_{n+1}) = r(\\kappa_n + \\Delta\\kappa) = \\sqrt{\\frac{2}{3}}(\\sigma_{y0} + H(\\kappa_n + \\sqrt{\\frac{2}{3}}\\Delta\\gamma)) = r(\\kappa_n) + \\frac{2}{3}H\\Delta\\gamma $$\n将 $\\|\\mathbf{s}_{n+1}\\|$ 的两个表达式相等：\n$$ \\|\\mathbf{s}^{\\mathrm{tr}}\\| - 2\\mu\\Delta\\gamma = r(\\kappa_n) + \\frac{2}{3}H\\Delta\\gamma $$\n求解塑性乘子 $\\Delta\\gamma$：\n$$ \\|\\mathbf{s}^{\\mathrm{tr}}\\| - r(\\kappa_n) = (2\\mu + \\frac{2}{3}H)\\Delta\\gamma \\implies \\Delta\\gamma = \\frac{f^{\\mathrm{tr}}}{2\\mu + \\frac{2}{3}H} $$\n已知 $\\Delta \\gamma$ 后，更新状态变量：\n- 偏应力：$\\mathbf{s}_{n+1} = \\left(1 - \\frac{2\\mu \\Delta\\gamma}{\\|\\mathbf{s}^{\\mathrm{tr}}\\|}\\right) \\mathbf{s}^{\\mathrm{tr}}$。这就是径向返回。\n- 平均应力：$p_{n+1} = p^{\\mathrm{tr}}$。\n- 总应力：$\\boldsymbol{\\sigma}_{n+1} = \\mathbf{s}_{n+1} + p_{n+1}\\mathbf{I}$。\n- 硬化变量：$\\kappa_{n+1} = \\kappa_n + \\sqrt{\\frac{2}{3}}\\Delta\\gamma$。\n\n**步骤 4：最终输出计算**\n所需的输出从 $n+1$ 时刻的最终状态计算得出：\n- `plastic_flag`：布尔值，如果 $f^{\\mathrm{tr}}  0$ 则为 `True`。\n- `q_{n+1}`：von Mises 应力，$q_{n+1} = \\sqrt{\\frac{3}{2}}\\|\\mathbf{s}_{n+1}\\|$。\n- `delta_gamma`：塑性乘子增量，$\\Delta\\gamma$。\n- `p_{n+1}`：平均应力，$p_{n+1} = \\frac{1}{3}\\operatorname{tr}(\\boldsymbol{\\sigma}_{n+1})$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_increment(E, nu, sigma_y0, H, kappa_n, delta_eps_mat):\n    \"\"\"\n    Performs a single increment update for a J2 elastoplastic model.\n\n    Args:\n        E (float): Young's modulus in kPa.\n        nu (float): Poisson's ratio.\n        sigma_y0 (float): Initial yield stress in kPa.\n        H (float): Linear isotropic hardening modulus in kPa.\n        kappa_n (float): Accumulated equivalent plastic strain at step n.\n        delta_eps_mat (list of lists): Total strain increment tensor.\n\n    Returns:\n        list: [plastic_flag, q_n+1, delta_gamma, p_n+1]\n    \"\"\"\n    delta_eps = np.array(delta_eps_mat, dtype=float)\n    I = np.eye(3)\n    TOL = 1e-12\n\n    # 1. Material properties\n    mu = E / (2 * (1 + nu))\n    K = E / (3 * (1 - 2 * nu))\n\n    # All tests start with sigma_n = 0, so s_n = 0, p_n = 0.\n    # In a general implementation, s_n and p_n would be inputs.\n    \n    # 2. Elastic predictor\n    trace_delta_eps = np.trace(delta_eps)\n    delta_e = delta_eps - (1/3) * trace_delta_eps * I\n    \n    # Trial stress (since s_n = 0, p_n = 0)\n    s_tr = 2 * mu * delta_e\n    p_tr = K * trace_delta_eps\n    \n    # 3. Check yield condition\n    norm_s_tr = np.linalg.norm(s_tr)\n    \n    # Handle the case of purely hydrostatic strain to avoid division by zero\n    if norm_s_tr  TOL:\n        plastic_flag = False\n        s_n1 = s_tr\n        p_n1 = p_tr\n        delta_gamma = 0.0\n    else:\n        # Yield radius at step n\n        r_n = np.sqrt(2/3) * (sigma_y0 + H * kappa_n)\n        \n        # Trial yield function value\n        f_tr = norm_s_tr - r_n\n\n        if f_tr = TOL:\n            # 4. Elastic update\n            plastic_flag = False\n            s_n1 = s_tr\n            p_n1 = p_tr\n            delta_gamma = 0.0\n        else:\n            # 5. Plastic corrector (radial return)\n            plastic_flag = True\n            \n            # Calculate plastic multiplier\n            delta_gamma = f_tr / (2 * mu + (2/3) * H)\n            \n            # Update deviatoric stress\n            s_n1 = (1 - (2 * mu * delta_gamma) / norm_s_tr) * s_tr\n            \n            # Update hydrostatic pressure\n            p_n1 = p_tr\n            \n            # Note: kappa_n+1 is not explicitly required for outputs but would be:\n            # kappa_n1 = kappa_n + np.sqrt(2/3) * delta_gamma\n\n    # 6. Calculate output quantities at step n+1\n    norm_s_n1 = np.linalg.norm(s_n1)\n    q_n1 = np.sqrt(3/2) * norm_s_n1\n    p_n1 = p_tr # From elastic predictor, as p is unchanged by J2 plasticity\n    \n    return [plastic_flag, q_n1, delta_gamma, p_n1]\n\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1 (elastic, pure shear)\n        (200000, 0.3, 200, 0, 0, [[0, 0.0003, 0], [0.0003, 0, 0], [0, 0, 0]]),\n        # Test 2 (plastic, perfect plasticity)\n        (200000, 0.3, 200, 0, 0, [[0, 0.002, 0], [0.002, 0, 0], [0, 0, 0]]),\n        # Test 3 (plastic, linear isotropic hardening with nonzero prior kappa_n) -> elastic\n        (200000, 0.3, 200, 10000, 0.05, [[0, 0.002, 0], [0.002, 0, 0], [0, 0, 0]]),\n        # Test 4 (purely volumetric, elastic)\n        (200000, 0.3, 200, 5000, 0, [[0.001, 0, 0], [0, 0.001, 0], [0, 0, 0.001]]),\n        # Test 5 (boundary case exactly on yield, treated as elastic)\n        (200000, 0.3, 200, 0, 0, [[0, 0.00075, 0], [0.00075, 0, 0], [0, 0, 0]]),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = run_increment(*case)\n        all_results.append(result)\n\n    # Format the final output string exactly as required\n    formatted_results = []\n    for res in all_results:\n        flag, q, dg, p = res\n        part = f\"[{str(flag)},{q:.6f},{dg:.6f},{p:.6f}]\"\n        formatted_results.append(part)\n        \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3551039"}, {"introduction": "在之前练习的基础上，我们现在通过一个依赖于压力的Drucker-Prager模型进入岩土力学领域。这个实践引入了非关联流动的关键概念，其中塑性应变的方向与屈服面的法线方向不同，这反映了岩土材料中摩擦强度和剪胀性的差异。我们将在方便的$(p,q)$不变量空间中分析这一概念。[@problem_id:3551085]", "problem": "考虑一个用于岩土材料的小应变各向同性弹塑性模型，该模型以应力不变量 $(p,q)$ 表示，其中 $p$ 是平均应力，$q$ 是一个偏应力不变量。弹性响应由体积模量 $K$ 和剪切模量 $G$ 定义，两者均为严格正值。该材料遵循Drucker–Prager型屈服函数 $f(p,q)$ 和Drucker–Prager型塑性势 $g(p,q)$，两者均为关于不变量的线性函数：\n- 屈服函数：$f(p,q) = q + \\alpha\\,p - k$。\n- 塑性势：$g(p,q) = q + \\beta\\,p$。\n\n其中，$\\alpha$ 和 $\\beta$ 分别是控制摩擦和剪胀性的无量纲材料参数，$k$ 是一个与 $p$ 和 $q$ 具有相同单位的类应力参数。塑性流动法则通常为非关联的，并使用 $g$。几何正交性检验通过相对于柯西应力张量 $\\boldsymbol{\\sigma}$ 的梯度来定义塑性流动方向：\n- 屈服法向：$\\boldsymbol{n}_f = \\dfrac{\\partial f}{\\partial \\boldsymbol{\\sigma}}$。\n- 塑性势法向：$\\boldsymbol{n}_g = \\dfrac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$。\n\n流动法则通过后向（隐式）欧拉积分定义：\n- 塑性应变增量：$\\Delta \\boldsymbol{\\varepsilon}^p = \\Delta\\lambda\\,\\boldsymbol{n}_g$，其中塑性乘子 $\\Delta\\lambda \\ge 0$。\n- 应力更新：$\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}_{\\text{trial}} - \\mathbb{C}:\\Delta \\boldsymbol{\\varepsilon}^p$，其中 $\\mathbb{C}$ 是各向同性弹性刚度张量。\n\n从不变量 $p$ 和 $q$ 关于 $\\boldsymbol{\\sigma}$、偏应力 $\\boldsymbol{s}$ 和偏应力第二不变量 $J_2$ 的基本定义出发，使用链式法则求得梯度 $\\partial p/\\partial \\boldsymbol{\\sigma}$ 和 $\\partial q/\\partial \\boldsymbol{\\sigma}$。基于此，推导出 $\\boldsymbol{n}_f$ 和 $\\boldsymbol{n}_g$，使用欧几里得（弗罗贝尼乌斯）内积计算角度 $\\theta = \\angle(\\boldsymbol{n}_f,\\boldsymbol{n}_g)$（以弧度为单位），并说明对于给定的Drucker–Prager形式，这种几何非关联性（即 $\\boldsymbol{n}_f \\neq \\boldsymbol{n}_g$）如何在 $(p,q)$ 上的离散返回映射中影响塑性乘子 $\\Delta\\lambda$。\n\n实现一个程序，该程序：\n1. 对于给定的 $(\\alpha,\\beta)$ 和当前应力状态，计算 $\\boldsymbol{n}_f$ 和 $\\boldsymbol{n}_g$ 之间的夹角 $\\theta$。\n2. 在 $(p,q)$ 空间中，执行从弹性预测的试探状态 $(p_{\\text{trial}},q_{\\text{trial}})$ 到修正状态 $(p_{n+1},q_{n+1})$ 的单步后向欧拉返回映射，过程如下：\n   - 如果试探状态是弹性的，即 $f(p_{\\text{trial}},q_{\\text{trial}}) \\le 0$，则设置 $\\Delta\\lambda = 0$ 且 $(p_{n+1},q_{n+1}) = (p_{\\text{trial}},q_{\\text{trial}})$。\n   - 如果试探状态违反屈服条件，即 $f(p_{\\text{trial}},q_{\\text{trial}})  0$，则通过后向欧拉流动法则强制执行一致性条件 $f(p_{n+1},q_{n+1})=0$，以确定 $\\Delta\\lambda$ 和修正后的不变量 $(p_{n+1},q_{n+1})$。\n3. 对于每个测试用例，输出列表 $[\\Delta\\lambda,\\,p_{n+1},\\,q_{n+1},\\,\\theta]$。\n\n采用以下约定和基准：\n- 平均应力：$p = \\dfrac{1}{3}\\,\\text{tr}(\\boldsymbol{\\sigma})$（压为正）。\n- 偏应力：$\\boldsymbol{s} = \\boldsymbol{\\sigma} - p\\,\\boldsymbol{I}$。\n- 第二不变量：$J_2 = \\dfrac{1}{2}\\,\\boldsymbol{s}:\\boldsymbol{s}$。\n- 偏应力不变量：$q = \\sqrt{3\\,J_2}$。\n- 使用弗罗贝尼乌斯内积 $A:B = \\text{tr}(A^\\top B)$ 和弗罗贝尼乌斯范数 $\\|A\\| = \\sqrt{A:A}$。\n\n物理单位：\n- 所有应力（$p$、$q$、$k$、$K$、$G$）均以千帕（$\\mathrm{kPa}$）为单位报告。\n- 角度 $\\theta$ 以弧度为单位报告。\n\n数值测试组：\n为以下四个测试用例提供结果，每个用例指定为 $(K,G,\\alpha,\\beta,k,p_{\\text{trial}},q_{\\text{trial}})$，所有应力单位均为 $\\mathrm{kPa}$：\n- 用例 A（一般塑性，关联流动）：$(50000,\\,30000,\\,0.25,\\,0.25,\\,30,\\,100,\\,60)$。\n- 用例 B（一般塑性，非关联流动）：$(60000,\\,40000,\\,0.35,\\,0.05,\\,70,\\,120,\\,85)$。\n- 用例 C（弹性，非关联流动）：$(45000,\\,35000,\\,0.20,\\,0.10,\\,50,\\,80,\\,10)$。\n- 用例 D（位于屈服面上，关联流动）：$(50000,\\,30000,\\,0.25,\\,0.25,\\,30,\\,100,\\,5)$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含四个测试用例的结果，格式为方括号括起来的列表的逗号分隔列表，顺序为 A、B、C、D。例如：“[[rA1,rA2,rA3,rA4],[rB1,rB2,rB3,rB4],[rC1,rC2,rC3,rC4],[rD1,rD2,rD3,rD4]]”，其中每个 $r\\cdot$ 是一个浮点数。", "solution": "该问题要求推导并实现一个返回映射算法，用于由线性Drucker–Prager屈服准则和塑性势控制的小应变各向同性弹塑性模型。该流动法则是非关联的。分析将在应力不变量空间中进行，即平均应力 $p$ 和偏应力不变量 $q$ 的空间。\n\n首先，我们将推导必要的张量，特别是屈服函数和塑性势相对于柯西应力张量 $\\boldsymbol{\\sigma}$ 的梯度。其次，我们将使用这些梯度来求出非关联角 $\\theta$。再次，我们将在 $(p,q)$ 空间中构建后向欧拉返回映射算法以更新应力状态。最后，我们将实现该算法来求解所提供的测试用例。\n\n关键定义如下：\n- 平均应力：$p = \\frac{1}{3}\\text{tr}(\\boldsymbol{\\sigma})$\n- 偏应力：$\\boldsymbol{s} = \\boldsymbol{\\sigma} - p\\boldsymbol{I}$\n- 偏应力不变量：$q = \\sqrt{3J_2}$，其中 $J_2 = \\frac{1}{2}\\boldsymbol{s}:\\boldsymbol{s}$\n- 屈服函数：$f(p,q) = q + \\alpha p - k$\n- 塑性势：$g(p,q) = q + \\beta p$\n\n**1. 相对于应力张量的梯度**\n\n为确定屈服法向 $\\boldsymbol{n}_f = \\partial f / \\partial \\boldsymbol{\\sigma}$ 和塑性势法向 $\\boldsymbol{n}_g = \\partial g / \\partial \\boldsymbol{\\sigma}$，我们使用链式法则：\n$$\n\\frac{\\partial H(p,q)}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial H}{\\partial p}\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} + \\frac{\\partial H}{\\partial q}\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}}\n$$\n我们必须首先计算不变量 $p$ 和 $q$ 相对于 $\\boldsymbol{\\sigma}$ 的梯度。\n\n平均应力 $p = \\frac{1}{3}\\text{tr}(\\boldsymbol{\\sigma}) = \\frac{1}{3}\\boldsymbol{\\sigma} : \\boldsymbol{I}$ 的梯度为：\n$$\n\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{1}{3}\\frac{\\partial (\\boldsymbol{\\sigma} : \\boldsymbol{I})}{\\partial \\boldsymbol{\\sigma}} = \\frac{1}{3}\\boldsymbol{I}\n$$\n其中 $\\boldsymbol{I}$ 是二阶单位张量。\n\n偏应力不变量 $q$ 的梯度通过链式法则求得，假设 $q  0$：\n$$\n\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial}{\\partial \\boldsymbol{\\sigma}} \\left( \\sqrt{3J_2} \\right) = \\sqrt{3} \\frac{1}{2\\sqrt{J_2}} \\frac{\\partial J_2}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\frac{\\partial J_2}{\\partial \\boldsymbol{\\sigma}}\n$$\n$J_2 = \\frac{1}{2}\\boldsymbol{s}:\\boldsymbol{s}$ 相对于 $\\boldsymbol{\\sigma}$ 的导数是连续介质力学中的一个标准结果：$\\partial J_2 / \\partial \\boldsymbol{\\sigma} = \\boldsymbol{s}$。这可以通过应用链式法则和乘积法则来证明，并注意到 $\\text{tr}(\\boldsymbol{s}) = 0$。\n因此，$q$ 的梯度为：\n$$\n\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\boldsymbol{s}\n$$\n现在我们可以组合出法向 $\\boldsymbol{n}_f$ 和 $\\boldsymbol{n}_g$。\n对于屈服函数 $f(p,q) = q + \\alpha p - k$，其偏导数为 $\\partial f/\\partial p = \\alpha$ 和 $\\partial f/\\partial q = 1$。屈服法向为：\n$$\n\\boldsymbol{n}_f = \\alpha \\left(\\frac{1}{3}\\boldsymbol{I}\\right) + (1) \\left(\\frac{3}{2q}\\boldsymbol{s}\\right) = \\frac{\\alpha}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\n$$\n对于塑性势 $g(p,q) = q + \\beta p$，其偏导数为 $\\partial g/\\partial p = \\beta$ 和 $\\partial g/\\partial q = 1$。决定塑性流动方向的塑性势法向为：\n$$\n\\boldsymbol{n}_g = \\beta \\left(\\frac{1}{3}\\boldsymbol{I}\\right) + (1) \\left(\\frac{3}{2q}\\boldsymbol{s}\\right) = \\frac{\\beta}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\n$$\n\n**2. 非关联角 $\\theta$**\n\n向量 $\\boldsymbol{n}_f$ 和 $\\boldsymbol{n}_g$ 之间的夹角 $\\theta$ 是流动法则非关联性的度量。它使用弗罗贝尼乌斯内积 $\\boldsymbol{A}:\\boldsymbol{B} = \\text{tr}(\\boldsymbol{A}^\\top \\boldsymbol{B})$ 计算。\n$$\n\\cos\\theta = \\frac{\\boldsymbol{n}_f : \\boldsymbol{n}_g}{\\|\\boldsymbol{n}_f\\| \\|\\boldsymbol{n}_g\\|}\n$$\n内积为：\n$$\n\\boldsymbol{n}_f : \\boldsymbol{n}_g = \\left(\\frac{\\alpha}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\\right) : \\left(\\frac{\\beta}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\\right) = \\frac{\\alpha\\beta}{9}(\\boldsymbol{I}:\\boldsymbol{I}) + \\left(\\frac{3}{2q}\\right)^2(\\boldsymbol{s}:\\boldsymbol{s})\n$$\n使用恒等式 $\\boldsymbol{I}:\\boldsymbol{I} = 3$、$\\boldsymbol{s}:\\boldsymbol{I} = \\text{tr}(\\boldsymbol{s}) = 0$ 以及 $\\boldsymbol{s}:\\boldsymbol{s} = 2J_2 = \\frac{2}{3}q^2$，我们得到：\n$$\n\\boldsymbol{n}_f : \\boldsymbol{n}_g = \\frac{\\alpha\\beta}{9}(3) + \\frac{9}{4q^2}\\left(\\frac{2}{3}q^2\\right) = \\frac{\\alpha\\beta}{3} + \\frac{3}{2}\n$$\n平方范数的计算如下：\n$$\n\\|\\boldsymbol{n}_f\\|^2 = \\boldsymbol{n}_f : \\boldsymbol{n}_f = \\frac{\\alpha^2}{3} + \\frac{3}{2}\n$$\n$$\n\\|\\boldsymbol{n}_g\\|^2 = \\boldsymbol{n}_g : \\boldsymbol{n}_g = \\frac{\\beta^2}{3} + \\frac{3}{2}\n$$\n因此，夹角的余弦值为：\n$$\n\\cos\\theta = \\frac{\\frac{\\alpha\\beta}{3} + \\frac{3}{2}}{\\sqrt{\\left(\\frac{\\alpha^2}{3} + \\frac{3}{2}\\right)\\left(\\frac{\\beta^2}{3} + \\frac{3}{2}\\right)}}\n$$\n此表达式仅取决于材料参数 $\\alpha$ 和 $\\beta$，而与应力状态无关（当 $q0$ 时）。如果流动是关联的（$\\alpha=\\beta$），则 $\\cos\\theta=1$ 且 $\\theta=0$。\n\n**3. $(p,q)$ 空间中的后向欧拉返回映射**\n\n返回映射算法修正违反屈服条件的弹性试探应力状态，使其返回到屈服面上。应力更新由后向欧拉格式给出：\n$$\n\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}_{\\text{trial}} - \\mathbb{C}:\\Delta \\boldsymbol{\\varepsilon}^p = \\boldsymbol{\\sigma}_{\\text{trial}} - \\Delta\\lambda\\,\\mathbb{C}:\\boldsymbol{n}_g\n$$\n其中 $\\Delta\\lambda \\ge 0$ 是塑性乘子，$\\boldsymbol{n}_g$ 在最终状态 $\\boldsymbol{\\sigma}_{n+1}$ 下取值。\n对于各向同性线弹性材料，应力-应变关系可以分解为体积和偏量两部分：\n- $p = K \\varepsilon_v^e$\n- $\\boldsymbol{s} = 2G \\boldsymbol{e}^e$\n其中 $\\varepsilon_v^e$ 和 $\\boldsymbol{e}^e$ 分别是弹性体积应变和弹性偏应变。\n从试探状态开始的应力更新为：\n- $p_{n+1} = p_{\\text{trial}} - K \\Delta\\varepsilon_v^p$\n- $\\boldsymbol{s}_{n+1} = \\boldsymbol{s}_{\\text{trial}} - 2G \\Delta\\boldsymbol{e}^p$\n\n塑性应变增量由流动法则 $\\Delta\\boldsymbol{\\varepsilon}^p = \\Delta\\lambda\\,\\boldsymbol{n}_g$ 推导得出：\n- $\\Delta\\varepsilon_v^p = \\text{tr}(\\Delta\\boldsymbol{\\varepsilon}^p) = \\Delta\\lambda\\,\\text{tr}(\\boldsymbol{n}_g) = \\Delta\\lambda\\,\\text{tr}\\left(\\frac{\\beta}{3}\\boldsymbol{I} + \\frac{3}{2q_{n+1}}\\boldsymbol{s}_{n+1}\\right) = \\Delta\\lambda\\,\\beta$。\n- $\\Delta\\boldsymbol{e}^p = \\text{dev}(\\Delta\\boldsymbol{\\varepsilon}^p) = \\Delta\\lambda\\,\\text{dev}(\\boldsymbol{n}_g) = \\Delta\\lambda \\frac{3}{2q_{n+1}}\\boldsymbol{s}_{n+1}$。\n\n将这些代入应力更新表达式中：\n- $p_{n+1} = p_{\\text{trial}} - K \\beta \\Delta\\lambda$\n- $\\boldsymbol{s}_{n+1} = \\boldsymbol{s}_{\\text{trial}} - 2G \\left( \\Delta\\lambda \\frac{3}{2q_{n+1}}\\boldsymbol{s}_{n+1} \\right) = \\boldsymbol{s}_{\\text{trial}} - \\frac{3G\\Delta\\lambda}{q_{n+1}}\\boldsymbol{s}_{n+1}$\n\n偏应力更新表明 $\\boldsymbol{s}_{n+1}$ 和 $\\boldsymbol{s}_{\\text{trial}}$ 是共轴的：$\\boldsymbol{s}_{n+1}\\left(1 + \\frac{3G\\Delta\\lambda}{q_{n+1}}\\right) = \\boldsymbol{s}_{\\text{trial}}$。对两边取范数（按 $\\sqrt{3/2}$ 比例缩放）可得 $q$ 的更新法则：\n- $q_{n+1} + 3G\\Delta\\lambda = q_{\\text{trial}} \\implies q_{n+1} = q_{\\text{trial}} - 3G\\Delta\\lambda$。\n\n现在，我们得到了一个关于未知数 $\\Delta\\lambda$ 的方程组，用以求解修正状态 $(p_{n+1}, q_{n+1})$：\n1. $p_{n+1} = p_{\\text{trial}} - K \\beta \\Delta\\lambda$\n2. $q_{n+1} = q_{\\text{trial}} - 3G \\Delta\\lambda$\n\n最后一步是一致性条件：修正后的状态必须位于屈服面上，即 $f(p_{n+1}, q_{n+1}) = 0$。\n$$\nq_{n+1} + \\alpha p_{n+1} - k = 0\n$$\n代入更新表达式：\n$$\n(q_{\\text{trial}} - 3G \\Delta\\lambda) + \\alpha(p_{\\text{trial}} - K \\beta \\Delta\\lambda) - k = 0\n$$\n整理以求解 $\\Delta\\lambda$：\n$$\n(q_{\\text{trial}} + \\alpha p_{\\text{trial}} - k) = \\Delta\\lambda (3G + \\alpha K \\beta)\n$$\n第一个括号中的项是在试探状态下的屈服函数值，即 $f_{\\text{trial}} = f(p_{\\text{trial}}, q_{\\text{trial}})$。\n$$\n\\Delta\\lambda = \\frac{f_{\\text{trial}}}{3G + \\alpha K \\beta}\n$$\n此表达式表明，几何非关联性（即 $\\beta \\neq \\alpha$）通过分母中的项 $\\alpha K \\beta$ 直接影响塑性变形的大小。对于关联流动法则，该项将是 $\\alpha^2 K$。\n\n**4. 算法总结**\n\n对于给定的试探状态 $(p_{\\text{trial}}, q_{\\text{trial}})$ 和材料参数 $(K, G, \\alpha, \\beta, k)$：\n\n1.  计算试探状态下的屈服函数值：$f_{\\text{trial}} = q_{\\text{trial}} + \\alpha p_{\\text{trial}} - k$。\n2.  **弹性预测**：如果 $f_{\\text{trial}} \\le 0$，则状态是容许的（弹性或在边界上）。无需进行塑性修正。\n    - $\\Delta\\lambda = 0$\n    - $p_{n+1} = p_{\\text{trial}}$\n    - $q_{n+1} = q_{\\text{trial}}$\n3.  **塑性修正**：如果 $f_{\\text{trial}}  0$，则状态是不可容许的，必须返回到屈服面上。\n    - 计算塑性乘子：$\\Delta\\lambda = \\frac{f_{\\text{trial}}}{3G + \\alpha K \\beta}$。\n    - 更新应力不变量：\n        - $p_{n+1} = p_{\\text{trial}} - K \\beta \\Delta\\lambda$\n        - $q_{n+1} = q_{\\text{trial}} - 3G \\Delta\\lambda$\n4.  计算非关联角 $\\theta$（以弧度为单位）：\n    $$\n    \\theta = \\arccos\\left(\\frac{\\frac{\\alpha\\beta}{3} + 1.5}{\\sqrt{\\left(\\frac{\\alpha^2}{3} + 1.5\\right)\\left(\\frac{\\beta^2}{3} + 1.5\\right)}}\\right)\n    $$\n每个用例的最终输出是列表 $[\\Delta\\lambda, p_{n+1}, q_{n+1}, \\theta]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Drucker-Prager return mapping problem for a suite of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (K, G, alpha, beta, k, p_trial, q_trial)\n    # Stresses are in kPa.\n    test_cases = [\n        # Case A: general plastic, associated flow\n        (50000.0, 30000.0, 0.25, 0.25, 30.0, 100.0, 60.0),\n        # Case B: general plastic, non-associated flow\n        (60000.0, 40000.0, 0.35, 0.05, 70.0, 120.0, 85.0),\n        # Case C: elastic, non-associated flow\n        (45000.0, 35000.0, 0.20, 0.10, 50.0, 80.0, 10.0),\n        # Case D: on the yield surface, associated flow\n        (50000.0, 30000.0, 0.25, 0.25, 30.0, 100.0, 5.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Using str() on a list automatically creates the bracketed format.\n    # Joining these with commas and wrapping in outer brackets gives the desired output.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _solve_case(K, G, alpha, beta, k, p_trial, q_trial):\n    \"\"\"\n    Performs a one-step backward Euler return mapping for a non-associative\n    Drucker-Prager model.\n\n    Args:\n        K (float): Bulk modulus (kPa).\n        G (float): Shear modulus (kPa).\n        alpha (float): Friction parameter (dimensionless).\n        beta (float): Dilatancy parameter (dimensionless).\n        k (float): Cohesion-related parameter (kPa).\n        p_trial (float): Trial mean stress (kPa).\n        q_trial (float): Trial deviatoric stress (kPa).\n\n    Returns:\n        list: A list containing [delta_lambda, p_n+1, q_n+1, theta].\n    \"\"\"\n    # 1. Calculate the angle of non-association, theta\n    # This calculation is independent of the stress state, only depends on alpha and beta\n    # cos(theta) = (n_f : n_g) / (||n_f|| * ||n_g||)\n    # n_f : n_g = alpha*beta/3 + 3/2\n    # ||n_f||^2 = alpha^2/3 + 3/2\n    # ||n_g||^2 = beta^2/3 + 3/2\n    \n    num = alpha * beta / 3.0 + 1.5\n    den1 = alpha**2 / 3.0 + 1.5\n    den2 = beta**2 / 3.0 + 1.5\n    \n    # Handle the case where the denominator might be zero, although with G,K > 0 this is not expected\n    # and the term 1.5 ensures positivity.\n    cos_theta = num / np.sqrt(den1 * den2)\n    # Clip to handle potential floating-point inaccuracies leading to |cos_theta| > 1\n    cos_theta = np.clip(cos_theta, -1.0, 1.0)\n    theta = np.arccos(cos_theta)\n\n    # 2. Check for yielding\n    # Yield function: f(p,q) = q + alpha*p - k\n    f_trial = q_trial + alpha * p_trial - k\n\n    delta_lambda = 0.0\n    p_new = p_trial\n    q_new = q_trial\n\n    # 3. Perform plastic correction if necessary (return mapping)\n    if f_trial > 0:\n        # Denominator H_cal = 3G + alpha*K*beta\n        H_cal = 3.0 * G + alpha * K * beta\n        \n        if H_cal = 0:\n            # This case is physically unexpected for K>0, G>0\n            # and non-negative parameters but included for robustness.\n            # It indicates a material softening that the current model does not handle.\n            # We treat it as an error or by simply letting the state be elastic.\n            pass\n        else:\n            # Calculate the plastic multiplier\n            delta_lambda = f_trial / H_cal\n\n            # Update the stress invariants\n            p_new = p_trial - K * beta * delta_lambda\n            q_new = q_trial - 3.0 * G * delta_lambda\n\n            # Ensure q_new is not negative (can happen with large steps)\n            if q_new  0:\n                q_new = 0.0\n    \n    return [delta_lambda, p_new, q_new, theta]\n\nsolve()\n```", "id": "3551085"}, {"introduction": "我们的最后一个实践将深入探讨一个对数值模拟稳健性有重要影响的高级主题。我们将研究一个混合模型，其中非关联程度随压力变化，并分析塑性流动方向和由此产生的算法切线刚度的连续性。这个练习突出了平滑的本构律对于确保大规模有限元分析中良好收敛行为的重要性。[@problem_id:3551067]", "problem": "考虑一个三维的各向同性、小应变、压力相关的弹塑性材料模型，该模型用柯西应力张量 $\\sigma \\in \\mathbb{R}^{3 \\times 3}$ 表示，并以下述定义和假设为基本基础：\n\n1. 弹性是线性和各向同性的，体积模量为 $K$，剪切模量为 $G$。弹性算子 $\\mathbb{C}^{\\text{e}}$ 根据下式将对称二阶张量 $X$ 映射到应力增量：\n$$\n\\mathbb{C}^{\\text{e}} : X = K \\, \\text{tr}(X) \\, \\mathbf{I} + 2 G \\, \\text{dev}(X),\n$$\n其中 $\\mathbf{I}$ 是二阶单位张量，$\\text{tr}(\\cdot)$ 表示迹，$\\text{dev}(X) = X - \\tfrac{1}{3} \\text{tr}(X) \\, \\mathbf{I}$ 是偏应力投影。\n\n2. 压力（平均应力）不变量 $p$、偏应力 $s$ 和第二不变量度量 $q$ 定义为：\n$$\np = \\tfrac{1}{3} \\, \\text{tr}(\\sigma), \\quad s = \\sigma - p \\, \\mathbf{I}, \\quad q = \\sqrt{\\tfrac{3}{2}} \\, \\|s\\|_F,\n$$\n其中 $\\|\\cdot\\|_F$ 是 Frobenius 范数。\n\n3. 屈服函数为 Drucker–Prager 类型，\n$$\nf(\\sigma,\\kappa) = q + \\alpha \\, p - k(\\kappa),\n$$\n其中 $\\alpha$ 是材料常数，$\\kappa$ 是硬化变量，$k(\\kappa)$ 是硬化应力。您可以假设存在一个由一致性条件线性化定义的常塑性模量 $H \\ge 0$，使得返回映射线性化使用标量硬化项 $H$。\n\n4. 塑性势函数取为\n$$\ng(\\sigma) = q + \\alpha_g(p) \\, p,\n$$\n其中 $\\alpha_g(p)$ 从低压 $p$ 时的相关情况 $\\alpha_g = \\alpha$ 过渡到高压 $p$ 时的非相关值 $\\alpha_g = \\alpha_{\\text{na}}$。函数 $\\alpha_g(p)$ 通过混合构建：\n$$\n\\alpha_g(p) = (1 - w(p)) \\, \\alpha + w(p) \\, \\alpha_{\\text{na}},\n$$\n其中 $w(p)$ 是一个仅依赖于 $p$ 的标量过渡函数。\n\n5. 塑性流动法则是广义非相关的，塑性流动方向由下式给出：\n$$\nn_g(\\sigma) = \\frac{\\partial g}{\\partial \\sigma}.\n$$\n\n6. 算法弹塑性切线算子 $\\mathbb{C}^{\\text{alg}}$ 定义为经典率无关塑性返回映射算法所返回的应力更新的一致性线性化：\n$$\nd\\sigma = \\mathbb{C}^{\\text{e}} : \\left(d\\varepsilon - d\\gamma \\, \\frac{\\partial g}{\\partial \\sigma} \\right), \\quad\n0 = \\frac{\\partial f}{\\partial \\sigma} : d\\sigma + H \\, d\\gamma,\n$$\n其中 $d\\varepsilon$ 是无穷小应变增量，$d\\gamma$ 是塑性乘子增量。一致性切线是满足 $d\\sigma = \\mathbb{C}^{\\text{alg}} : d\\varepsilon$ 的线性映射。\n\n您的任务是实现一个混合模型，其中 $w(p)$ 控制塑性势从低压 $p$ 时的相关情况过渡到高压 $p$ 时的非相关情况，并研究塑性流动方向 $n_g$ 和算法切线 $\\mathbb{C}^{\\text{alg}}$ 在过渡区域的连续性。从上述基本定义出发，推导您需要的所有中间关系。特别是，当 $\\alpha_g$ 依赖于 $p(\\sigma)$ 时，使用链式法则求得 $\\partial g / \\partial \\sigma$；并使用返回映射线性化，以 $\\mathbb{C}^{\\text{e}}$、$\\partial f / \\partial \\sigma$、$\\partial g / \\partial \\sigma$ 和 $H$ 的形式，求得 $\\mathbb{C}^{\\text{alg}}$ 的可计算形式。\n\n连续性研究方案：\n\n- 对于给定的应力状态，其压力 $p$ 和偏应力 $s$ (因此 $q$ 也确定) 已指定，定义两个邻近状态，其压力分别为 $p^{-} = p - h$ 和 $p^{+} = p + h$，其中 $h  0$ 是一个小数，并保持 $s$ 不变。计算\n$$\nJ_n = \\left\\| n_g(\\sigma^{+}) - n_g(\\sigma^{-}) \\right\\|_F,\n$$\n它衡量流动方向的跳跃，以及\n$$\nJ_C = \\frac{ \\left\\| \\mathbb{C}^{\\text{alg}}(\\cdot) \\big|_{p^{+}} - \\mathbb{C}^{\\text{alg}}(\\cdot) \\big|_{p^{-}} \\right\\| }{K},\n$$\n算法切线的无量纲跳跃，其中四阶算子的 $\\|\\cdot\\|$ 是由对称二阶张量上的 Frobenius 范数诱导的 Frobenius 范数。通过 $K$ 进行归一化使 $J_C$ 成为无量纲量。您应通过将算子差分作用于对称二阶张量的标准正交基，并对结果的 Frobenius 范数的平方求和，来计算该算子范数。\n\n待测试的过渡函数：\n\n- 突变阶跃：当 $p  p_t$ 时，$w_{\\text{step}}(p) = 0$；当 $p \\ge p_t$ 时，$w_{\\text{step}}(p) = 1$。\n- 分段线性斜坡：当 $p \\le p_1$ 时，$w_{\\text{ramp}}(p) = 0$；当 $p \\in (p_1,p_2)$ 时，$w_{\\text{ramp}}(p) = \\dfrac{p - p_1}{p_2 - p_1}$；当 $p \\ge p_2$ 时，$w_{\\text{ramp}}(p) = 1$。\n- 光滑 $C^1$ 三次过渡：当 $p \\le p_1$ 时，$w_{\\text{cubic}}(p) = 0$；当 $p \\in (p_1,p_2)$ 时，$w_{\\text{cubic}}(p) = 3 \\xi^2 - 2 \\xi^3$，其中 $\\xi = \\dfrac{p - p_1}{p_2 - p_1}$；当 $p \\ge p_2$ 时，$w_{\\text{cubic}}(p) = 1$。\n\n除非另有说明，所有测试均使用以下材料参数和应力状态构造：\n\n- 弹性模量：$K = 3.0 \\times 10^4$, $G = 1.5 \\times 10^4$（应力单位一致；输出将归一化为无量纲）。\n- 屈服参数：$\\alpha = 0.2$；高压下非相关参数：$\\alpha_{\\text{na}} = 0.1$。\n- 塑性模量：$H = 5.0 \\times 10^3$。\n- 过渡边界：$p_1 = 90$, $p_2 = 110$, $p_t = 100$；扰动大小 $h = 10^{-8}$。\n- 偏应力形状：$s = \\text{diag}(2a, -a, -a)$，其中 $a = q_0/3$，因此 $q = 3|a| = q_0$。除非另有说明，取 $q_0 = 40$。对于静水压力边缘测试，使用 $q_0 = 10^{-8}$。\n\n计算要求和约定：\n\n- 通过使用一个小的正阈值 $\\varepsilon_q$ 进行正则化，实现对 $q \\approx 0$ 时导数 $\\partial q/\\partial \\sigma$ 的稳健处理，例如在分母中使用 $q_{\\text{reg}} = \\max(q, \\varepsilon_q)$。\n- 使用 $\\partial p/\\partial \\sigma = \\mathbf{I}/3$ 和\n$$\n\\frac{\\partial q}{\\partial \\sigma} = \\frac{3}{2 q_{\\text{reg}}} \\, s.\n$$\n- 应用乘法和链式法则来处理 $\\partial g / \\partial \\sigma$ 中 $\\alpha_g(p(\\sigma))$ 的项。\n- 根据上面陈述的线性化返回映射方程推导并实现算法切线 $\\mathbb{C}^{\\text{alg}}$，并使用对称二阶张量的标准正交基计算其 Frobenius 范数跳跃 $J_C$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，包含一个包含五个子列表的列表形式的结果，每个子列表包含对应测试的两个浮点数 $[J_n, J_C]$，顺序如上所列。该行必须严格为一个 Python 风格的列表，不含任何额外文本，例如：[[Jn1,Jc1],[Jn2,Jc2],[Jn3,Jc3],[Jn4,Jc4],[Jn5,Jc5]]。\n- 所有报告的数字必须是纯无量纲浮点数。输出中不需要物理单位或角度单位。如果存在百分比，必须表示为小数，而不是使用百分号。", "solution": "用户的请求是一个在计算岩土力学领域中定义明确的问题。它具有科学依据、内容完整且客观。该问题要求推导并实现一个带有压力相关塑性势的非相关弹塑性模型，以研究塑性流动方向和算法切线算子的连续性。所有必要的数据和函数形式均已提供。该问题被认为是有效的。\n\n### 1. 理论公式\n\n该问题围绕一种各向同性、压力相关的弹塑性材料展开。我们将首先推导必要的量：塑性流动方向 $\\boldsymbol{n}_g$ 和算法切线算子 $\\mathbb{C}^{\\text{alg}}$。\n\n#### 1.1 塑性流动方向 $\\boldsymbol{n}_g$\n\n塑性势 $g$ 由下式给出：\n$$\ng(\\boldsymbol{\\sigma}) = q + \\alpha_g(p) \\, p\n$$\n其中 $p = \\frac{1}{3} \\text{tr}(\\boldsymbol{\\sigma})$ 是压力， $q = \\sqrt{\\frac{3}{2}} \\|\\boldsymbol{s}\\|_F$ 是偏应力 $\\boldsymbol{s}$ 的第二不变量，$\\alpha_g(p)$ 是一个与压力相关的材料函数。塑性流动方向定义为势函数对应力的梯度，即 $\\boldsymbol{n}_g = \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$。\n\n使用链式法则，我们有：\n$$\n\\boldsymbol{n}_g = \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} + \\frac{\\partial (\\alpha_g(p) \\, p)}{\\partial \\boldsymbol{\\sigma}}\n$$\n我们需要计算各个导数。压力 $p$ 对应力 $\\boldsymbol{\\sigma}$ 的导数是：\n$$\n\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial}{\\partial \\boldsymbol{\\sigma}} \\left( \\frac{1}{3} \\boldsymbol{\\sigma} : \\mathbf{I} \\right) = \\frac{1}{3} \\mathbf{I}\n$$\n偏应力不变量 $q$ 的导数在问题陈述中已给出，并对 $q \\to 0$ 的情况进行了正则化：\n$$\n\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2 q_{\\text{reg}}} \\boldsymbol{s}, \\quad \\text{其中 } q_{\\text{reg}} = \\max(q, \\varepsilon_q)\n$$\n其中 $\\varepsilon_q$ 是一个小的正阈值。\n\n第二项需要对乘积 $\\alpha_g(p)p$ 使用关于 $\\boldsymbol{\\sigma}$ 的链式法则：\n$$\n\\frac{\\partial (\\alpha_g(p) \\, p)}{\\partial \\boldsymbol{\\sigma}} = \\frac{d (\\alpha_g(p) \\, p)}{d p} \\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}}\n$$\n对压力的导数是：\n$$\n\\frac{d (\\alpha_g(p) \\, p)}{d p} = \\alpha_g(p) \\frac{dp}{dp} + p \\frac{d\\alpha_g}{dp} = \\alpha_g(p) + p \\frac{d\\alpha_g}{dp}\n$$\n函数 $\\alpha_g(p)$ 定义为混合形式：$\\alpha_g(p) = (1 - w(p)) \\, \\alpha + w(p) \\, \\alpha_{\\text{na}}$。其导数为：\n$$\n\\frac{d\\alpha_g}{dp} = -\\alpha \\frac{dw}{dp} + \\alpha_{\\text{na}} \\frac{dw}{dp} = (\\alpha_{\\text{na}} - \\alpha) \\frac{dw}{dp}\n$$\n其中 $\\frac{dw}{dp}$ 记为 $w'(p)$。代回原式，我们得到：\n$$\n\\frac{d (\\alpha_g(p) \\, p)}{d p} = \\alpha_g(p) + p (\\alpha_{\\text{na}} - \\alpha) w'(p)\n$$\n综合所有部分，塑性流动方向 $\\boldsymbol{n}_g$ 为：\n$$\n\\boldsymbol{n}_g(\\boldsymbol{\\sigma}) = \\frac{3}{2 q_{\\text{reg}}} \\boldsymbol{s} + \\left[ \\alpha_g(p) + p (\\alpha_{\\text{na}} - \\alpha) w'(p) \\right] \\frac{1}{3} \\mathbf{I}\n$$\n$\\boldsymbol{n}_g$ 的连续性取决于其分量的连续性。由于 $\\boldsymbol{s}$、$p$ 和 $\\alpha_g(p)$（依赖于 $w(p)$）对于所选的混合函数都是 $\\boldsymbol{\\sigma}$ 的连续函数，因此 $\\boldsymbol{n}_g$ 的连续性关键取决于 $w'(p)$ 的连续性。如果 $w'(p)$ 不连续，$\\boldsymbol{n}_g$ 将表现出跳跃间断。\n\n#### 1.2 算法切线算子 $\\mathbb{C}^{\\text{alg}}$\n\n问题提供了线性化的一致性条件和流动法则方程来定义切线算子：\n$$\nd\\boldsymbol{\\sigma} = \\mathbb{C}^{\\text{e}} : (d\\boldsymbol{\\varepsilon} - d\\gamma \\, \\boldsymbol{n}_g)\n$$\n$$\n0 = \\boldsymbol{n}_f : d\\boldsymbol{\\sigma} + H \\, d\\gamma\n$$\n其中 $\\boldsymbol{n}_f = \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}}$ 是屈服函数 $f(\\boldsymbol{\\sigma},\\kappa) = q + \\alpha p - k(\\kappa)$ 的梯度，$H$ 是塑性模量。屈服面法向为：\n$$\n\\boldsymbol{n}_f = \\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} + \\alpha \\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2 q_{\\text{reg}}} \\boldsymbol{s} + \\frac{\\alpha}{3} \\mathbf{I}\n$$\n将第一个方程代入第二个方程得到：\n$$\n0 = \\boldsymbol{n}_f : [\\mathbb{C}^{\\text{e}} : (d\\boldsymbol{\\varepsilon} - d\\gamma \\, \\boldsymbol{n}_g)] + H \\, d\\gamma = (\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) : d\\boldsymbol{\\varepsilon} - d\\gamma (\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g) + H \\, d\\gamma\n$$\n解出塑性乘子增量 $d\\gamma$：\n$$\nd\\gamma = \\frac{(\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) : d\\boldsymbol{\\varepsilon}}{H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g}\n$$\n将 $d\\gamma$ 代回到 $d\\boldsymbol{\\sigma}$ 的表达式中：\n$$\nd\\boldsymbol{\\sigma} = \\mathbb{C}^{\\text{e}} : d\\boldsymbol{\\varepsilon} - \\mathbb{C}^{\\text{e}} : \\left( \\boldsymbol{n}_g \\frac{(\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) : d\\boldsymbol{\\varepsilon}}{H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g} \\right) = \\left[ \\mathbb{C}^{\\text{e}} - \\frac{(\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g) \\otimes (\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}})}{H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g} \\right] : d\\boldsymbol{\\varepsilon}\n$$\n方括号中的项即为算法切线算子 $\\mathbb{C}^{\\text{alg}}$。请注意，这是连续介质切线，为了简化，通常用作真实一致算法切线的近似，正如问题陈述所暗示的那样。\n$$\n\\mathbb{C}^{\\text{alg}} = \\mathbb{C}^{\\text{e}} - \\frac{1}{A} (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g) \\otimes (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_f)\n$$\n其中 $A = H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g$，并且我们利用了 $\\mathbb{C}^{\\text{e}}$ 的主对称性，因此 $(\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) = (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_f)$。\n\n$\\mathbb{C}^{\\text{alg}}$ 的连续性取决于 $\\boldsymbol{n}_f$ 和 $\\boldsymbol{n}_g$ 的连续性。由于当 $q  0$ 时 $\\boldsymbol{n}_f$ 是连续的，$\\mathbb{C}^{\\text{alg}}$ 的连续性也取决于 $\\boldsymbol{n}_g$ 的连续性，进而取决于 $w(p)$ 和 $w'(p)$ 的连续性。\n\n弹性算子 $\\mathbb{C}^{\\text{e}}$ 作用于二阶张量 $\\boldsymbol{X}$ 的结果是 $\\mathbb{C}^{\\text{e}} : \\boldsymbol{X} = K \\, \\text{tr}(\\boldsymbol{X}) \\, \\mathbf{I} + 2G \\, \\text{dev}(\\boldsymbol{X})$。$\\mathbb{C}^{\\text{alg}}$ 中的各项可以计算如下：\n- $\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g = K \\, \\text{tr}(\\boldsymbol{n}_g) \\, \\mathbf{I} + 2G \\, \\text{dev}(\\boldsymbol{n}_g)$\n- $\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_f = K \\, \\text{tr}(\\boldsymbol{n}_f) \\, \\mathbf{I} + 2G \\, \\text{dev}(\\boldsymbol{n}_f)$\n- $\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g = \\text{tr}(\\boldsymbol{n}_f^T (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g)) = K \\, \\text{tr}(\\boldsymbol{n}_f) \\text{tr}(\\boldsymbol{n}_g) + 2G \\, \\text{tr}(\\text{dev}(\\boldsymbol{n}_f) \\text{dev}(\\boldsymbol{n}_g))$\n\n#### 1.3 连续性分析和跳跃度量\n\n问题要求计算跨越压力点 $p$ 的两个跳跃度量 $J_n$ 和 $J_C$。我们在 $p^{-} = p - h$ 和 $p^{+} = p + h$ 处评估相关量。\n$$\nJ_n = \\|\\boldsymbol{n}_g(\\boldsymbol{\\sigma}^{+}) - \\boldsymbol{n}_g(\\boldsymbol{\\sigma}^{-})\\|_F\n$$\n$$\nJ_C = \\frac{\\|\\mathbb{C}^{\\text{alg}}(p^{+}) - \\mathbb{C}^{\\text{alg}}(p^{-})\\|_F}{K}\n$$\n四阶算子差 $\\Delta\\mathbb{C} = \\mathbb{C}^{\\text{alg}}(p^{+}) - \\mathbb{C}^{\\text{alg}}(p^{-})$ 的 Frobenius 范数是使用对称二阶张量空间的一组标准正交基 $\\{\\mathbf{E}_i\\}_{i=1}^6$ 计算的：\n$$\n\\|\\Delta\\mathbb{C}\\|_F^2 = \\sum_{i=1}^6 \\|\\Delta\\mathbb{C} : \\mathbf{E}_i\\|_F^2\n$$\n所选基由一个体积张量和五个偏张量组成。\n\n### 2. 过渡函数分析\n\n1.  **突变阶跃 ($w_{\\text{step}}$)：** 在 $p = p_t$ 处，$w(p)$ 不连续。其导数 $w'(p)$ 是一个狄拉克δ函数。在 $p_t \\pm h$ 处求值时，$w$ 从 0 跳到 1，而 $w'$ 在这两点都为 0。$\\boldsymbol{n}_g$ 中的 $\\alpha_g(p)$ 项发生跳跃，导致 $\\boldsymbol{n}_g$ 不连续，从而 $\\mathbb{C}^{\\text{alg}}$ 也不连续。我们预期 $J_n  0$ 且 $J_C  0$。\n\n2.  **分段线性斜坡 ($w_{\\text{ramp}}$)：** $w(p)$ 是连续的 ($C^0$)，但其导数 $w'(p)$ 是分段常数，在 $p = p_1$ 和 $p = p_2$ 处有跳跃间断。因此，$\\boldsymbol{n}_g$ 中的 $p(\\alpha_{\\text{na}}-\\alpha)w'(p)$ 项是不连续的。我们预期在 $p_1$ 和 $p_2$ 处都有 $J_n  0$ 且 $J_C  0$。\n\n3.  **光滑三次函数 ($w_{\\text{cubic}}$)：** 该函数被设计为 $C^1$ 连续。$w(p)$ 和 $w'(p)$ 处处连续，包括在过渡边界 $p_1$ 和 $p_2$ 处。关键在于，形式为 $3\\xi^2 - 2\\xi^3$ 的光滑三次 Hermite 样条在其端点（$\\xi = 0$ 和 $\\xi = 1$）处的导数为零。因此，$w'(p_1)=0$ 且 $w'(p_2)=0$。结果是，$\\boldsymbol{n}_g$ 是连续的，因此 $\\mathbb{C}^{\\text{alg}}$ 也是连续的。对于这种情况，我们预期 $J_n$ 和 $J_C$ 接近于零（仅由于数值精度和有限扰动 $h$ 的高阶效应而为非零）。\n\n现在将遵循此理论框架进行实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating continuity jumps for five test cases.\n    \"\"\"\n\n    # --- Material and simulation parameters from the problem statement ---\n    K = 3.0e4\n    G = 1.5e4\n    alpha = 0.2\n    alpha_na = 0.1\n    H = 5.0e3\n    p1 = 90.0\n    p2 = 110.0\n    pt = 100.0\n    h = 1.0e-8\n    eps_q = 1.0e-12 # Regularization parameter for q derivatives\n\n    # --- Orthonormal basis for symmetric 3x3 tensors ---\n    I = np.eye(3)\n    E_basis = [\n        I / np.sqrt(3.0),\n        np.diag([1.0, -1.0, 0.0]) / np.sqrt(2.0),\n        np.diag([1.0, 1.0, -2.0]) / np.sqrt(6.0),\n        np.array([[0, 1, 0], [1, 0, 0], [0, 0, 0]]) / np.sqrt(2.0),\n        np.array([[0, 0, 1], [0, 0, 0], [1, 0, 0]]) / np.sqrt(2.0),\n        np.array([[0, 0, 0], [0, 0, 1], [0, 1, 0]]) / np.sqrt(2.0),\n    ]\n\n    # --- Transition functions and their derivatives ---\n    def w_step(p):\n        return 1.0 if p >= pt else 0.0\n    def w_prime_step(p):\n        return 0.0 # Derivative is zero everywhere except at the jump\n    \n    def w_ramp(p):\n        if p = p1: return 0.0\n        if p >= p2: return 1.0\n        return (p - p1) / (p2 - p1)\n    def w_prime_ramp(p):\n        if p = p1 or p >= p2: return 0.0\n        return 1.0 / (p2 - p1)\n\n    def w_cubic(p):\n        if p = p1: return 0.0\n        if p >= p2: return 1.0\n        xi = (p - p1) / (p2 - p1)\n        return 3.0 * xi**2 - 2.0 * xi**3\n    def w_prime_cubic(p):\n        if p = p1 or p >= p2: return 0.0\n        xi = (p - p1) / (p2 - p1)\n        d_xi_dp = 1.0 / (p2 - p1)\n        return (6.0 * xi - 6.0 * xi**2) * d_xi_dp\n    \n    # --- Function to compute jumps ---\n    def calculate_jumps(p_center, q0, w_func, w_prime_func):\n        \"\"\"\n        Computes the jumps Jn and Jc for a given stress state and transition function.\n        \"\"\"\n        \n        def get_quantities_at_p(p_val, q0_val):\n            \"\"\"Helper to compute n_g, n_f, and C_alg operator at a given p.\"\"\"\n            # Stress state construction\n            a = q0_val / 3.0\n            s = np.diag([2.0*a, -a, -a])\n            q = np.sqrt(1.5) * np.linalg.norm(s, 'fro')\n            q_reg = max(q, eps_q)\n\n            # --- n_g: Plastic flow direction ---\n            w = w_func(p_val)\n            w_prime = w_prime_func(p_val)\n            alpha_g = (1.0 - w) * alpha + w * alpha_na\n            \n            d_alphagp_dp = alpha_g + p_val * (alpha_na - alpha) * w_prime\n            \n            dq_dsigma = (3.0 / (2.0 * q_reg)) * s\n            dp_dsigma = I / 3.0\n            \n            n_g = dq_dsigma + d_alphagp_dp * dp_dsigma\n\n            # --- n_f: Yield surface normal ---\n            n_f = dq_dsigma + (alpha / 3.0) * I\n\n            # --- C_alg: Algorithmic tangent operator (as a function) ---\n            tr_ng = np.trace(n_g)\n            dev_ng = n_g - (tr_ng / 3.0) * I\n            Ce_ng = K * tr_ng * I + 2.0 * G * dev_ng\n\n            tr_nf = np.trace(n_f)\n            dev_nf = n_f - (tr_nf / 3.0) * I\n            \n            # Using tr(A.T @ B) for A:B\n            nf_Ce_ng = K * tr_nf * tr_ng + 2.0 * G * np.tensordot(dev_nf, dev_ng, axes=2)\n            A = H + nf_Ce_ng\n\n            def C_e(X):\n                tr_X = np.trace(X)\n                dev_X = X - (tr_X / 3.0) * I\n                return K * tr_X * I + 2.0 * G * dev_X\n\n            def C_alg(X):\n                Ce_X = C_e(X)\n                # Using tr(A.T @ B) for A:B\n                nf_Ce_X = np.tensordot(n_f, Ce_X, axes=2)\n                plastic_part = (1.0 / A) * np.outer(Ce_ng, np.array(1.0)).reshape(3,3,1) * nf_Ce_X # A bit tricky, broadcasting to get dyadic product\n                # Simplified: dyadic product (a \\otimes b) : c = a (b:c)\n                plastic_part = (1.0 / A) * Ce_ng * nf_Ce_X\n                return Ce_X - plastic_part\n\n            return n_g, C_alg\n\n        # Evaluate at p-h and p+h\n        p_minus, p_plus = p_center - h, p_center + h\n        n_g_minus, C_alg_minus_func = get_quantities_at_p(p_minus, q0)\n        n_g_plus, C_alg_plus_func = get_quantities_at_p(p_plus, q0)\n\n        # 1. Compute jump in n_g\n        J_n = np.linalg.norm(n_g_plus - n_g_minus, 'fro')\n\n        # 2. Compute jump in C_alg\n        sum_sq_norms = 0.0\n        for E in E_basis:\n            delta_C_E = C_alg_plus_func(E) - C_alg_minus_func(E)\n            sum_sq_norms += np.linalg.norm(delta_C_E, 'fro')**2\n        \n        norm_delta_C = np.sqrt(sum_sq_norms)\n        J_C = norm_delta_C / K\n\n        return [J_n, J_C]\n\n    # --- Test suite execution ---\n    test_cases = [\n        # 1. Sharp step at pt\n        {'p_center': pt, 'q0': 40.0, 'w_func': w_step, 'w_prime_func': w_prime_step},\n        # 2. Piecewise linear at p1\n        {'p_center': p1, 'q0': 40.0, 'w_func': w_ramp, 'w_prime_func': w_prime_ramp},\n        # 3. Piecewise linear at p2\n        {'p_center': p2, 'q0': 40.0, 'w_func': w_ramp, 'w_prime_func': w_prime_ramp},\n        # 4. Smooth cubic at p1\n        {'p_center': p1, 'q0': 40.0, 'w_func': w_cubic, 'w_prime_func': w_prime_cubic},\n        # 5. Smooth cubic at p2 with near-hydrostatic state\n        {'p_center': p2, 'q0': 1.0e-8, 'w_func': w_cubic, 'w_prime_func': w_prime_cubic},\n    ]\n\n    results = []\n    for case in test_cases:\n        jumps = calculate_jumps(case['p_center'], case['q0'], case['w_func'], case['w_prime_func'])\n        results.append(jumps)\n\n    # Final print statement in the exact required format.\n    print(results)\n\nsolve()\n```", "id": "3551067"}]}