{"hands_on_practices": [{"introduction": "返回映射算法是计算塑性力学的基石。我们的动手实践之旅将从实现冯·米塞斯 ($J_2$) 理想塑性模型的返回映射算法开始，该模型光滑的屈服面使得返回映射过程可以得到一个被称为径向返回的优雅精确解。这项编程练习 [@problem_id:3549335] 将巩固你对核心的“弹性预测-塑性修正”框架的理解，并揭示该模型不同算法形式之间的一个重要等价关系。", "problem": "设计并实现一个小应变本构更新程序。该程序针对各向同性 $J_2$ 理想塑性，在轴对称三轴压缩路径下，使用两种算法策略计算应力更新：(i) 偏量空间中的径向返回映射；(ii) 通过对塑性一致性条件进行牛顿型迭代，在完整应力空间中进行完全最近点投影。目标是探究这两种策略在三轴压缩型加载路径下的算法差异，并量化计算出的应力之间的任何差异。\n\n您必须使用以下基本理论来推导您的算法：\n- 小应变运动学与应变加法分解：$\\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^{\\mathrm{e}} + \\boldsymbol{\\varepsilon}^{\\mathrm{p}}$。\n- 各向同性线弹性：$\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon}^{\\mathrm{e}}$，其中体积模量 $K$ 和剪切模量 $G$ 通过杨氏模量 $E$ 和泊松比 $\\nu$ 计算，关系式为 $K = \\dfrac{E}{3(1-2\\nu)}$ 和 $G = \\dfrac{E}{2(1+\\nu)}$。使用标准的 6 分量 Voigt 记法，其中包含工程剪切应变和应力。\n- 应力分解为体积和偏量部分：$p = \\dfrac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$，$\\mathbf{s} = \\boldsymbol{\\sigma} - p\\,\\mathbf{I}$，以及 Frobenius 范数 $\\lVert \\mathbf{s} \\rVert = \\sqrt{\\mathbf{s}:\\mathbf{s}}$，在 Voigt 记法中应使用正确的剪切权重进行一致性解释。\n- von Mises 等效应力 $q = \\sqrt{\\dfrac{3}{2}} \\lVert \\mathbf{s} \\rVert$ 和 $J_2$ 屈服函数 $f(\\boldsymbol{\\sigma}) = q - \\sigma_{\\mathrm{y}}$，其中 $\\sigma_{\\mathrm{y}}$ 是屈服应力。\n- 理想塑性及塑性不可压缩性的相关联流动法则：$d\\boldsymbol{\\varepsilon}^{\\mathrm{p}} = d\\lambda \\dfrac{\\partial f}{\\partial \\boldsymbol{\\sigma}}$，并满足 Kuhn–Tucker 条件 $d\\lambda \\ge 0$, $f \\le 0$ 及 $d\\lambda\\, f = 0$。\n\n两种更新策略的要求：\n- 策略 A（偏量空间中的径向返回）：实现一个弹性预测-塑性校正算法，在塑性校正过程中保持平均应力不变，并沿偏量空间中的径向方向将偏应力返回到屈服面上。此策略必须仅使用上述定义以及 $J_2$ 理想塑性的塑性流动是偏量的这一原理。\n- 策略 B（完整应力空间中的完全最近点投影）：实现一个牛顿型迭代，通过一致性条件和流动法则强制执行增量势的平稳性，在完整应力空间中求解塑性乘子 $d\\lambda$ 和更新后的应力 $\\boldsymbol{\\sigma}$。由于塑性不可压缩性，体积应力必须保持弹性，而偏应力必须满足一致性条件。使用基于一致性条件残差的稳健停止准则。\n\n符号约定、单位和路径定义：\n- 采用岩土力学符号约定，应力和应变均以压缩为正。\n- 所有应力必须以兆帕（MPa）表示。所有应变均为无量纲。\n- 考虑轴对称三轴压缩型加载路径，其中侧向应变分量为零，轴向应变分量非零，即 $\\Delta \\boldsymbol{\\varepsilon} = [\\Delta \\varepsilon_{xx}, \\Delta \\varepsilon_{yy}, \\Delta \\varepsilon_{zz}, 0, 0, 0]^T$，其中 $\\Delta \\varepsilon_{xx} = 0$, $\\Delta \\varepsilon_{yy} = 0$ 且 $\\Delta \\varepsilon_{zz} > 0$。此外，还包括一个纯静水路径，其中 $\\Delta \\varepsilon_{xx} = \\Delta \\varepsilon_{yy} = \\Delta \\varepsilon_{zz} > 0$。\n\n输入数据和测试套件：\n- 材料参数，所有测试通用：$E = 20000\\ \\mathrm{MPa}$，$\\nu = 0.3$，$\\sigma_{\\mathrm{y}} = 100\\ \\mathrm{MPa}$。\n- 所有测试的初始应力：$\\boldsymbol{\\sigma}_0 = \\mathbf{0}$。\n- 定义以下五个测试用例。在所有情况下，对两种策略使用相同的时间增量更新，并从 $\\boldsymbol{\\sigma}_0$ 开始每个测试。\n    $1$. 单一弹性增量（轴对称）：$\\Delta \\boldsymbol{\\varepsilon} = [0, 0, 1.0\\times 10^{-4}, 0, 0, 0]^T$。\n    $2$. 单一塑性增量，轻度超调（轴对称）：$\\Delta \\boldsymbol{\\varepsilon} = [0, 0, 1.0\\times 10^{-2}, 0, 0, 0]^T$。\n    $3$. 单一塑性增量，大幅超调（轴对称）：$\\Delta \\boldsymbol{\\varepsilon} = [0, 0, 5.0\\times 10^{-2}, 0, 0, 0]^T$。\n    $4$. 单一静水增量：$\\Delta \\boldsymbol{\\varepsilon} = [1.0\\times 10^{-3}, 1.0\\times 10^{-3}, 1.0\\times 10^{-3}, 0, 0, 0]^T$。\n    $5$. 多增量轴对称路径，包含 $20$ 个等步长，每步顺序施加 $\\Delta \\boldsymbol{\\varepsilon} = [0, 0, 3.0\\times 10^{-3}, 0, 0, 0]^T$。\n\n程序任务和输出：\n- 对每个测试用例，从 $\\boldsymbol{\\sigma}_0$ 开始，施加指定的应变增量，使用策略 A 和策略 B 更新应力。\n- 对每个测试用例，计算两个结果应力向量（单位为 MPa）之间各分量的最大绝对差，即计算 6 个 Voigt 分量上的 $\\max_i \\left| \\sigma^{A}_i - \\sigma^{B}_i \\right|$。\n- 您的程序应生成单行输出，其中包含按测试 $1$ 到 $5$ 的顺序排列、用逗号分隔并括在方括号内的结果列表。每个条目必须是一个以 MPa 为单位的浮点数，通过数值计算四舍五入到 $10^{-9}$ MPa 的绝对公差范围内。\n\n科学真实性和约束条件：\n- 确保所有计算一致使用压缩为正的符号约定。\n- 偏量返回必须在塑性校正期间保持平均应力不变。\n- 最近点投影必须在完整应力空间中使用牛顿型方法求解一致性条件，并采用适当的残差和停止公差。\n- 代码必须是自包含和确定性的。不允许用户输入。\n\n最终答案格式：\n- 最终答案必须是一个完整的、可运行的 Python 程序，该程序实现上述要求并以指定格式精确打印一行输出。", "solution": "用户要求设计并实现一个用于各向同性 $J_2$ 理想塑性的小应变本构更新程序。该程序必须在指定的轴对称和静水加载路径下，比较两种常见的应力更新算法策略。\n\n### 1. 理论公式\n\n该问题基于经典的率无关弹塑性理论。关键方程如下：\n\n- **应变分解**：总应变增量 $\\Delta\\boldsymbol{\\varepsilon}$ 被加法分解为一个弹性部分 $\\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{e}}$ 和一个塑性部分 $\\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}}$。\n$$\n\\Delta\\boldsymbol{\\varepsilon} = \\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{e}} + \\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}}\n$$\n- **弹性定律**：应力 $\\boldsymbol{\\sigma}$ 通过各向同性线弹性定律与弹性应变 $\\boldsymbol{\\varepsilon}^{\\mathrm{e}}$ 相关联：\n$$\n\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon}^{\\mathrm{e}}\n$$\n其中 $\\mathbb{C}$ 是四阶弹性张量。用工程常数杨氏模量 $E$ 和泊松比 $\\nu$ 表示，体积模量 $K$ 和剪切模量 $G$ 为：\n$$\nK = \\frac{E}{3(1-2\\nu)}, \\quad G = \\frac{E}{2(1+\\nu)}\n$$\n- **屈服准则**：塑性变形的开始由 von Mises 屈服函数 $f(\\boldsymbol{\\sigma})$ 控制：\n$$\nf(\\boldsymbol{\\sigma}) = q - \\sigma_{\\mathrm{y}} \\le 0\n$$\n其中 $\\sigma_{\\mathrm{y}}$ 是单轴拉伸/压缩下的屈服应力。等效应力 $q$ 由偏应力张量 $\\mathbf{s} = \\boldsymbol{\\sigma} - p\\,\\mathbf{I}$（其中 $p = \\frac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$ 是平均应力）定义：\n$$\nq = \\sqrt{\\frac{3}{2}\\mathbf{s}:\\mathbf{s}} = \\sqrt{\\frac{3}{2} \\lVert \\mathbf{s} \\rVert^2}\n$$\n- **流动法则**：对于相关联塑性，塑性应变增量垂直于屈服面：\n$$\n\\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}} = \\Delta\\lambda \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} = \\Delta\\lambda \\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}}\n$$\n其中 $\\Delta\\lambda \\ge 0$ 是塑性乘子。Kuhn-Tucker 加载/卸载条件为 $\\Delta\\lambda \\ge 0$, $f(\\boldsymbol{\\sigma}) \\le 0$, 和 $\\Delta\\lambda \\cdot f(\\boldsymbol{\\sigma}) = 0$。\n- **塑性不可压缩性**：对于 $J_2$ 屈服函数，其梯度是纯偏量的：\n$$\n\\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\mathbf{s}\n$$\n这意味着 $\\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}}) = 0$，因此塑性流动是等体积的（体积保持不变）。\n\n### 2. 算法实现（应力更新）\n\n应力更新过程基于弹性预测-塑性校正方案。给定增量开始时的状态 $(\\boldsymbol{\\sigma}_n, \\boldsymbol{\\varepsilon}_n)$ 和总应变增量 $\\Delta\\boldsymbol{\\varepsilon}$，我们求解 $\\boldsymbol{\\sigma}_{n+1}$。\n\n- **弹性预测**：首先，假设整个增量是弹性的。试探应力计算如下：\n$$\n\\boldsymbol{\\sigma}^{\\text{trial}} = \\boldsymbol{\\sigma}_n + \\mathbb{C} : \\Delta\\boldsymbol{\\varepsilon}\n$$\n- **屈服检查**：在试探状态下评估屈服函数：$f^{\\text{trial}} = f(\\boldsymbol{\\sigma}^{\\text{trial}})$。\n  - 如果 $f^{\\text{trial}} \\le 0$，则假设正确，该步为弹性步，最终应力为 $\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\text{trial}}$。\n  - 如果 $f^{\\text{trial}} > 0$，则状态位于屈服面之外，表明发生了塑性变形，需要进行塑性校正步骤。\n\n- **塑性校正**：最终应力 $\\boldsymbol{\\sigma}_{n+1}$ 必须位于屈服面上。它与试探应力的关系为：\n$$\n\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\text{trial}} - \\mathbb{C} : \\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}}\n$$\n由于塑性不可压缩性，塑性应变增量 $\\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}}$ 是纯偏量的。对于各向同性材料，$\\mathbb{C}:\\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}}$ 是一个偏应力。因此，塑性校正仅影响应力的偏量部分，而平均应力由弹性决定：\n$$\np_{n+1} = p^{\\text{trial}}\n$$\n$$\n\\mathbf{s}_{n+1} = \\mathbf{s}^{\\text{trial}} - 2G \\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}}\n$$\n代入流动法则 $\\Delta\\boldsymbol{\\varepsilon}^{\\mathrm{p}} = \\Delta\\lambda \\frac{3}{2q_{n+1}}\\mathbf{s}_{n+1}$ 并使用一致性条件 $q_{n+1} = \\sigma_{\\mathrm{y}}$：\n$$\n\\mathbf{s}_{n+1} = \\mathbf{s}^{\\text{trial}} - 2G \\Delta\\lambda \\frac{3}{2\\sigma_{\\mathrm{y}}}\\mathbf{s}_{n+1} \\implies \\mathbf{s}_{n+1} \\left(1 + \\frac{3G\\Delta\\lambda}{\\sigma_{\\mathrm{y}}}\\right) = \\mathbf{s}^{\\text{trial}}\n$$\n这个基本关系表明，最终偏应力 $\\mathbf{s}_{n+1}$ 与试探偏应力 $\\mathbf{s}^{\\text{trial}}$ 共轴，这解释了“径向返回”这一术语的由来。\n\n### 3. 两种策略的比较\n\n**策略 A：偏量空间中的径向返回**\n此策略直接利用返回映射的几何解释。由于 $\\mathbf{s}_{n+1}$ 是 $\\mathbf{s}^{\\text{trial}}$ 的一个缩放版本，我们可以写成：\n$$\n\\mathbf{s}_{n+1} = \\alpha \\mathbf{s}^{\\text{trial}}\n$$\n我们通过施加一致性条件 $q_{n+1} = \\sigma_{\\mathrm{y}}$ 来找到标量 $\\alpha$。\n$$\nq_{n+1} = \\sqrt{\\frac{3}{2}(\\alpha \\mathbf{s}^{\\text{trial}}):(\\alpha \\mathbf{s}^{\\text{trial}})} = \\alpha \\sqrt{\\frac{3}{2}\\mathbf{s}^{\\text{trial}}:\\mathbf{s}^{\\text{trial}}} = \\alpha q^{\\text{trial}}\n$$\n设 $q_{n+1} = \\sigma_{\\mathrm{y}}$ 得到 $\\alpha q^{\\text{trial}} = \\sigma_{\\mathrm{y}}$，所以 $\\alpha = \\sigma_{\\mathrm{y}} / q^{\\text{trial}}$。最终的偏应力为：\n$$\n\\mathbf{s}_{n+1} = \\mathbf{s}^{\\text{trial}} \\frac{\\sigma_{\\mathrm{y}}}{q^{\\text{trial}}}\n$$\n然后重新组合应力：$\\boldsymbol{\\sigma}_{n+1} = \\mathbf{s}_{n+1} + p^{\\text{trial}}\\mathbf{I}$。这是一个闭式解。\n\n**策略 B：通过牛顿迭代进行完全最近点投影**\n此策略将问题形式化为寻找满足离散一致性条件的塑性乘子 $\\Delta\\lambda$。从 $\\mathbf{s}_{n+1} \\left(1 + \\frac{3G\\Delta\\lambda}{\\sigma_{\\mathrm{y}}}\\right) = \\mathbf{s}^{\\text{trial}}$，我们对两边取缩放范数：\n$$\nq_{n+1} \\left(1 + \\frac{3G\\Delta\\lambda}{\\sigma_{\\mathrm{y}}}\\right) = q^{\\text{trial}}\n$$\n当 $q_{n+1} = \\sigma_{\\mathrm{y}}$ 时，这变为：\n$$\n\\sigma_{\\mathrm{y}} + 3G\\Delta\\lambda = q^{\\text{trial}}\n$$\n我们可以为 Newton-Raphson 格式定义一个残差函数：\n$$\nR(\\Delta\\lambda) = q^{\\text{trial}} - 3G\\Delta\\lambda - \\sigma_{\\mathrm{y}}\n$$\n目标是找到 $\\Delta\\lambda$ 使得 $R(\\Delta\\lambda) = 0$。对于理想塑性，$R(\\Delta\\lambda)$ 是 $\\Delta\\lambda$ 的线性函数。因此，Newton-Raphson 方法将在单次迭代中收敛。其导数（雅可比矩阵）为 $J = \\frac{dR}{d(\\Delta\\lambda)} = -3G$。$\\Delta\\lambda$ 的更新量为 $\\delta(\\Delta\\lambda) = -J^{-1}R = R/(3G)$。从 $\\Delta\\lambda_0=0$ 开始，第一次也是唯一一次迭代给出：\n$$\n\\Delta\\lambda_1 = \\Delta\\lambda_0 + \\frac{R(\\Delta\\lambda_0)}{3G} = 0 + \\frac{q^{\\text{trial}} - \\sigma_{\\mathrm{y}}}{3G}\n$$\n一旦找到 $\\Delta\\lambda = \\frac{q^{\\text{trial}} - \\sigma_{\\mathrm{y}}}{3G}$，我们就可以计算 $\\mathbf{s}_{n+1}$：\n$$\n\\mathbf{s}_{n+1} = \\frac{\\mathbf{s}^{\\text{trial}}}{1 + \\frac{3G\\Delta\\lambda}{\\sigma_{\\mathrm{y}}}} = \\frac{\\mathbf{s}^{\\text{trial}}}{1 + \\frac{3G}{\\sigma_{\\mathrm{y}}}\\left(\\frac{q^{\\text{trial}}-\\sigma_{\\mathrm{y}}}{3G}\\right)} = \\frac{\\mathbf{s}^{\\text{trial}}}{1 + \\frac{q^{\\text{trial}}-\\sigma_{\\mathrm{y}}}{\\sigma_{\\mathrm{y}}}} = \\mathbf{s}^{\\text{trial}} \\frac{\\sigma_{\\mathrm{y}}}{q^{\\text{trial}}}\n$$\n这个结果在代数上与策略 A 的结果完全相同。\n\n**分析结论**\n对于各向同性 $J_2$ 理想塑性，这两种策略在解析上是等效的。因此，本问题旨在证明这一基本结果。两种策略之间计算出的任何差异都将完全由浮点运算引起，并且应在机器精度级别。预期的输出将是一个由非常接近于零的数字组成的列表。\n\n### 4. 代码实现\n实现将定义一个单一的本构更新函数，该函数接受一个策略（'A' 或 'B'）作为参数。主逻辑将遍历所提供的测试用例，从零应力状态开始，为每个策略顺序施加指定的应变增量，然后计算两种策略得出的最终应力向量之间的最大绝对差。所有计算均使用 Voigt 记法，其中应力和应变为 6 分量向量，弹性矩阵 $\\mathbb{C}$ 为 $6 \\times 6$，并遵循压缩为正的符号约定。张量内积 $\\mathbf{s}:\\mathbf{s}$ 在 Voigt 记法中实现为 $\\sum_{i=1}^3 s_i^2 + 2\\sum_{i=4}^6 s_i^2$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef constitutive_update(sigma_n, delta_eps, strategy, C, G, sigma_y):\n    \"\"\"\n    Performs a single stress update for a given strain increment using J2 perfect plasticity.\n\n    Args:\n        sigma_n (np.ndarray): Stress vector at the beginning of the increment (Voigt, 6x1).\n        delta_eps (np.ndarray): Strain increment vector (Voigt, engineering shear, 6x1).\n        strategy (str): 'A' for deviatoric radial return, 'B' for full Newton-based projection.\n        C (np.ndarray): Elastic stiffness matrix (6x6).\n        G (float): Shear modulus.\n        sigma_y (float): Yield stress.\n\n    Returns:\n        np.ndarray: Updated stress vector sigma_n+1 (Voigt, 6x1).\n    \"\"\"\n    # Elastic predictor\n    sigma_trial = sigma_n + C @ delta_eps\n\n    # Trial invariants\n    p_trial = (sigma_trial[0] + sigma_trial[1] + sigma_trial[2]) / 3.0\n    s_trial = sigma_trial - p_trial * np.array([1.0, 1.0, 1.0, 0.0, 0.0, 0.0])\n\n    s_dot_s_trial = s_trial[0]**2 + s_trial[1]**2 + s_trial[2]**2 + 2.0 * (s_trial[3]**2 + s_trial[4]**2 + s_trial[5]**2)\n\n    # A small tolerance to avoid division by zero for purely hydrostatic states\n    if s_dot_s_trial  1e-24:\n        q_trial = 0.0\n    else:\n        q_trial = np.sqrt(3.0 / 2.0 * s_dot_s_trial)\n\n    f_trial = q_trial - sigma_y\n\n    # Yield check\n    if f_trial = 1e-9:  # Elastic step (with a small numerical tolerance)\n        return sigma_trial\n    else:\n        # Plastic corrector\n        p_n1 = p_trial  # Mean stress is unchanged\n\n        if strategy == 'A':\n            # Strategy A: Direct radial return in deviatoric space\n            scale_factor = sigma_y / q_trial\n            s_n1 = s_trial * scale_factor\n            \n        elif strategy == 'B':\n            # Strategy B: Full closest-point projection via Newton solve for delta_lambda\n            # For J2 perfect plasticity, the residual equation is linear in delta_lambda,\n            # so Newton's method converges in a single exact step.\n            delta_lambda = (q_trial - sigma_y) / (3.0 * G)\n            \n            # The deviatoric stress is then updated. The formula below is derived\n            # from the return mapping equations and is algebraically identical\n            # to the direct scaling used in Strategy A.\n            s_n1 = s_trial / (1.0 + 3.0 * G * delta_lambda / sigma_y)\n\n        else:\n            raise ValueError(\"Unknown strategy\")\n\n        # Reassemble the final stress tensor\n        sigma_n1 = s_n1 + p_n1 * np.array([1.0, 1.0, 1.0, 0.0, 0.0, 0.0])\n        return sigma_n1\n\ndef solve():\n    \"\"\"\n    Main solver function to run test cases and compute differences between strategies.\n    \"\"\"\n    # Material parameters (MPa)\n    E = 20000.0  # Young's modulus\n    nu = 0.3     # Poisson's ratio\n    sigma_y = 100.0  # Yield stress\n\n    # Derived elastic constants\n    G = E / (2.0 * (1.0 + nu))\n    K = E / (3.0 * (1.0 - 2.0 * nu))\n    lam = K - (2.0/3.0) * G\n    \n    # Elastic stiffness matrix C for Voigt notation [xx, yy, zz, yz, zx, xy] and engineering shear strain\n    C = np.zeros((6, 6))\n    C[0,0] = C[1,1] = C[2,2] = lam + 2*G\n    C[0,1] = C[0,2] = C[1,0] = C[1,2] = C[2,0] = C[2,1] = lam\n    C[3,3] = C[4,4] = C[5,5] = G\n\n    # Test cases: (strain_increment_vector, number_of_steps)\n    test_cases = [\n        # 1. Single elastic increment (axisymmetric)\n        (np.array([0.0, 0.0, 1.0e-4, 0.0, 0.0, 0.0]), 1),\n        # 2. Single plastic increment, mild overshoot (axisymmetric)\n        (np.array([0.0, 0.0, 1.0e-2, 0.0, 0.0, 0.0]), 1),\n        # 3. Single plastic increment, large overshoot (axisymmetric)\n        (np.array([0.0, 0.0, 5.0e-2, 0.0, 0.0, 0.0]), 1),\n        # 4. Single hydrostatic increment\n        (np.array([1.0e-3, 1.0e-3, 1.0e-3, 0.0, 0.0, 0.0]), 1),\n        # 5. Multi-increment axisymmetric path\n        (np.array([0.0, 0.0, 3.0e-3, 0.0, 0.0, 0.0]), 20),\n    ]\n\n    results = []\n    for delta_eps_total, num_steps in test_cases:\n        delta_eps_step = delta_eps_total / num_steps\n        \n        # Run Strategy A\n        sigma_A = np.zeros(6)\n        for _ in range(num_steps):\n            sigma_A = constitutive_update(sigma_A, delta_eps_step, 'A', C, G, sigma_y)\n\n        # Run Strategy B\n        sigma_B = np.zeros(6)\n        for _ in range(num_steps):\n            sigma_B = constitutive_update(sigma_B, delta_eps_step, 'B', C, G, sigma_y)\n            \n        # Compute maximum absolute component-wise difference\n        max_diff = np.max(np.abs(sigma_A - sigma_B))\n        results.append(max_diff)\n\n    # Print results in the specified single-line format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3549335"}, {"introduction": "在掌握了理想化的 $J_2$ 模型之后，我们现在转向处理对于模拟岩土材料（如土壤和岩石）不可或缺的Mohr-Coulomb准则。该模型引入了新的复杂性，包括一个非光滑的多面体屈服面和非关联塑性流动的概念。这个引导性的计算练习 [@problem_id:3549281] 将带你走过一个完整的应力更新过程，演示如何在一个具体的积分步中处理这些特性。", "problem": "需要对一个遵循摩尔-库仑理想塑性及非关联流动的岩土材料进行一次小应变、平面应变条件下的应力更新。应力和应变均采用压为正的符号约定。该材料为各向同性弹-理想塑性材料，其杨氏模量 $E = 120 \\,\\mathrm{MPa}$，泊松比 $\\nu = 0.25$。摩尔-库仑强度参数为黏聚力 $c = 0.05 \\,\\mathrm{MPa}$ 和摩擦角 $\\phi = 30^\\circ$。塑性势是非关联的，其定义在同样的光滑三轴压缩分支上，通过将 $\\phi$ 替换为剪胀角 $\\psi$ 得到；取 $\\sin \\psi = 0.25$。不存在硬化或软化（理想塑性），也没有盖帽或拉伸截断。\n\n在增量开始时，应力和塑性应变均为零。在该增量内，笛卡尔基 $\\{x,y,z\\}$ 下施加的平面应变小应变张量为\n$$\n\\Delta \\boldsymbol{\\varepsilon} \\;=\\; \n\\begin{pmatrix}\n\\Delta \\varepsilon_{xx}  \\tfrac{1}{2}\\Delta \\gamma_{xy}  0 \\\\\n\\tfrac{1}{2}\\Delta \\gamma_{xy}  \\Delta \\varepsilon_{yy}  0 \\\\\n0  0  \\Delta \\varepsilon_{zz}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n0.004  0  0 \\\\\n0  -0.001  0 \\\\\n0  0  0\n\\end{pmatrix},\n$$\n其中平面应变约束为 $\\Delta \\varepsilon_{zz} = 0$，且无平面内剪切增量 $\\Delta \\gamma_{xy}=0$。\n\n假设更新后的应力状态位于摩尔-库仑面的光滑三轴压缩面上，并且主轴与 $\\{x,y,z\\}$ 基保持一致（无旋转）。使用拉梅形式的小应变各向同性弹性理论，以及用最大和最小主应力 $\\sigma_1$ 和 $\\sigma_3$ 表示的精确摩尔-库仑光滑三轴压缩屈服函数：\n$$\nf(\\boldsymbol{\\sigma}) \\;=\\; \\sigma_1 \\left(1 - \\sin \\phi \\right) \\;-\\; \\sigma_3 \\left(1 + \\sin \\phi \\right) \\;-\\; 2 c \\cos \\phi,\n$$\n以及非关联塑性势\n$$\ng(\\boldsymbol{\\sigma}) \\;=\\; \\sigma_1 \\left(1 - \\sin \\psi \\right) \\;-\\; \\sigma_3 \\left(1 + \\sin \\psi \\right).\n$$\n\n在所述假设下，对该单增量执行一次完整的最近点应力更新，并报告更新后的平面内柯西应力分量 $\\sigma_{xx}$、$\\sigma_{yy}$、$\\sigma_{xy}$ 以及平面内塑性应变增量 $\\Delta \\varepsilon^{p}_{xx}$、$\\Delta \\varepsilon^{p}_{yy}$、$\\Delta \\gamma^{p}_{xy}$。将报告的每个分量四舍五入至四位有效数字。应力以 $\\mathrm{MPa}$ 为单位，应变为无量纲量。最终答案必须以单行矩阵的形式提供，顺序为 $\\left[\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}, \\Delta \\varepsilon^{p}_{xx}, \\Delta \\varepsilon^{p}_{yy}, \\Delta \\gamma^{p}_{xy}\\right]$。", "solution": "用户提供了一个计算岩土力学问题，要求对一个遵循摩尔-库仑理想塑性模型及非关联流动法则的材料进行应力更新。该过程包括一个弹性试探步和一个塑性修正步，该方法也称为返回映射算法。\n\n问题验证如下：\n- **提取的已知条件**：\n  - 本构模型：各向同性弹-理想塑性，摩尔-库仑屈服准则，非关联流动。\n  - 符号约定：压为正。\n  - 弹性属性：杨氏模量 $E = 120 \\,\\mathrm{MPa}$，泊松比 $\\nu = 0.25$。\n  - 塑性属性：黏聚力 $c = 0.05 \\,\\mathrm{MPa}$，摩擦角 $\\phi = 30^\\circ$，由 $\\sin \\psi = 0.25$ 定义的剪胀角 $\\psi$。\n  - 初始条件：应力 $\\boldsymbol{\\sigma}^{(0)} = \\mathbf{0}$，塑性应变 $\\boldsymbol{\\varepsilon}^{p(0)} = \\mathbf{0}$。\n  - 施加的应变增量（平面应变，$\\Delta \\varepsilon_{zz}=0$）：$\\Delta \\varepsilon_{xx} = 0.004$, $\\Delta \\varepsilon_{yy} = -0.001$, $\\Delta \\gamma_{xy} = 0$。\n  - 屈服函数：$f(\\boldsymbol{\\sigma}) = \\sigma_1 (1 - \\sin \\phi) - \\sigma_3 (1 + \\sin \\phi) - 2 c \\cos \\phi$。\n  - 塑性势：$g(\\boldsymbol{\\sigma}) = \\sigma_1 (1 - \\sin \\psi) - \\sigma_3 (1 + \\sin \\psi)$。\n  - 假设：更新后的应力状态位于光滑三轴压缩面上；主轴与笛卡尔基保持一致。\n\n- **验证结论**：该问题具有科学依据，提法得当，客观且完整。它代表了计算塑性力学中的一个标准流程。所有参数均已提供且物理上一致。所作的假设将问题简化到一个可解的状态，且未引入矛盾。因此，该问题是**有效的**。\n\n求解过程主要分为三个步骤：\n1.  计算弹性试探应力。\n2.  通过计算屈服函数值来验证是否屈服。\n3.  通过返回映射算法进行塑性修正，以求得最终应力和塑性应变增量。\n\n首先，我们计算必要的材料参数。拉梅参数 $\\lambda$ 和 $\\mu$（剪切模量 $G$）由 $E$ 和 $\\nu$ 导出：\n$$ \\lambda = \\frac{E \\nu}{(1+\\nu)(1-2\\nu)} = \\frac{120 \\times 0.25}{(1+0.25)(1-2 \\times 0.25)} = \\frac{30}{1.25 \\times 0.5} = 48 \\,\\mathrm{MPa} $$\n$$ \\mu = G = \\frac{E}{2(1+\\nu)} = \\frac{120}{2(1+0.25)} = \\frac{120}{2.5} = 48 \\,\\mathrm{MPa} $$\n平面应变条件下的弹性刚度由关联平面内应力增量和应变增量的矩阵描述：\n$$\n\\begin{pmatrix} \\Delta\\sigma_{xx} \\\\ \\Delta\\sigma_{yy} \\\\ \\Delta\\sigma_{zz} \\end{pmatrix}\n=\n\\begin{pmatrix} \\lambda+2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda+2\\mu  0 \\\\ \\lambda  \\lambda  0 \\end{pmatrix}\n\\begin{pmatrix} \\Delta\\varepsilon_{xx} \\\\ \\Delta\\varepsilon_{yy} \\\\ \\Delta\\varepsilon_{zz} \\end{pmatrix}\n\\quad\\text{其中}\\quad \\Delta\\varepsilon_{zz}=0\n$$\n\n摩尔-库仑强度和流动参数为：\n- $\\sin\\phi = \\sin(30^\\circ) = 0.5$, $\\cos\\phi = \\cos(30^\\circ) = \\frac{\\sqrt{3}}{2}$\n- $\\sin\\psi = 0.25$\n\n步骤 1：弹性试探应力更新\n假设整个应变增量 $\\Delta\\boldsymbol{\\varepsilon}$ 都是弹性的，则从初始零应力状态计算出试探应力 $\\boldsymbol{\\sigma}^{\\text{trial}}$：\n$\\boldsymbol{\\sigma}^{\\text{trial}} = \\mathbf{D} : \\Delta\\boldsymbol{\\varepsilon}$，其中 $\\mathbf{D}$ 是各向同性弹性张量。\n对于平面应变（$\\Delta\\varepsilon_{zz}=0$），应力分量为：\n$$ \\sigma_{xx}^{\\text{trial}} = (\\lambda+2\\mu)\\Delta\\varepsilon_{xx} + \\lambda\\Delta\\varepsilon_{yy} = (48+2 \\times 48)(0.004) + 48(-0.001) = 144 \\times 0.004 - 48 \\times 0.001 = 0.576 - 0.048 = 0.528 \\,\\mathrm{MPa} $$\n$$ \\sigma_{yy}^{\\text{trial}} = \\lambda\\Delta\\varepsilon_{xx} + (\\lambda+2\\mu)\\Delta\\varepsilon_{yy} = 48(0.004) + (48+2 \\times 48)(-0.001) = 48 \\times 0.004 - 144 \\times 0.001 = 0.192 - 0.144 = 0.048 \\,\\mathrm{MPa} $$\n$$ \\sigma_{xy}^{\\text{trial}} = 2\\mu \\Delta\\varepsilon_{xy} = 2\\mu \\left(\\frac{1}{2}\\Delta\\gamma_{xy}\\right) = 0 $$\n面外试探应力为：\n$$ \\sigma_{zz}^{\\text{trial}} = \\lambda(\\Delta\\varepsilon_{xx} + \\Delta\\varepsilon_{yy}) = 48(0.004 - 0.001) = 48 \\times 0.003 = 0.144 \\,\\mathrm{MPa} $$\n由于非对角线应力为零，笛卡尔坐标轴即为主轴。主试探应力按 $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3$ 排序为：\n$$ \\sigma_1^{\\text{trial}} = 0.528 \\,\\mathrm{MPa} \\quad (\\text{来自 } \\sigma_{xx}) $$\n$$ \\sigma_2^{\\text{trial}} = 0.144 \\,\\mathrm{MPa} \\quad (\\text{来自 } \\sigma_{zz}) $$\n$$ \\sigma_3^{\\text{trial}} = 0.048 \\,\\mathrm{MPa} \\quad (\\text{来自 } \\sigma_{yy}) $$\n\n步骤 2：屈服校核\n我们计算屈服函数值 $f(\\boldsymbol{\\sigma}^{\\text{trial}})$：\n$$ f(\\boldsymbol{\\sigma}^{\\text{trial}}) = \\sigma_1^{\\text{trial}}(1-\\sin\\phi) - \\sigma_3^{\\text{trial}}(1+\\sin\\phi) - 2c\\cos\\phi $$\n$$ f = 0.528(1-0.5) - 0.048(1+0.5) - 2(0.05)\\frac{\\sqrt{3}}{2} $$\n$$ f = 0.528(0.5) - 0.048(1.5) - 0.05\\sqrt{3} = 0.264 - 0.072 - 0.05\\sqrt{3} = 0.192 - 0.05\\sqrt{3} \\approx 0.1054 $$\n由于 $f(\\boldsymbol{\\sigma}^{\\text{trial}}) > 0$，材料发生屈服，需要进行塑性修正。\n\n步骤 3：塑性修正\n总应变增量分解为 $\\Delta\\boldsymbol{\\varepsilon} = \\Delta\\boldsymbol{\\varepsilon}^e + \\Delta\\boldsymbol{\\varepsilon}^p$。最终应力为 $\\boldsymbol{\\sigma}^{\\text{final}} = \\mathbf{D} : \\Delta\\boldsymbol{\\varepsilon}^e = \\mathbf{D} : (\\Delta\\boldsymbol{\\varepsilon} - \\Delta\\boldsymbol{\\varepsilon}^p) = \\boldsymbol{\\sigma}^{\\text{trial}} - \\mathbf{D} : \\Delta\\boldsymbol{\\varepsilon}^p$。\n塑性应变增量由非关联流动法则给出：$\\Delta\\boldsymbol{\\varepsilon}^p = \\Delta\\lambda \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$，其中 $\\Delta\\lambda > 0$ 是塑性乘子。\n在主应力空间中，塑性势的梯度 $\\mathbf{r} = \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$ 为：\n$$ \\mathbf{r} = \\begin{pmatrix} \\partial g / \\partial\\sigma_1 \\\\ \\partial g / \\partial\\sigma_2 \\\\ \\partial g / \\partial\\sigma_3 \\end{pmatrix} = \\begin{pmatrix} 1-\\sin\\psi \\\\ 0 \\\\ -(1+\\sin\\psi) \\end{pmatrix} = \\begin{pmatrix} 1-0.25 \\\\ 0 \\\\ -(1+0.25) \\end{pmatrix} = \\begin{pmatrix} 0.75 \\\\ 0 \\\\ -1.25 \\end{pmatrix} $$\n一致性条件要求最终应力状态位于屈服面上，即 $f(\\boldsymbol{\\sigma}^{\\text{final}}) = 0$。对于这个线性屈服函数，我们可以精确求解 $\\Delta\\lambda$：\n$$ \\Delta\\lambda = \\frac{f(\\boldsymbol{\\sigma}^{\\text{trial}})}{H} \\quad \\text{其中} \\quad H = \\left(\\frac{\\partial f}{\\partial\\boldsymbol{\\sigma}}\\right)^T : \\mathbf{D} : \\left(\\frac{\\partial g}{\\partial\\boldsymbol{\\sigma}}\\right) $$\n令 $\\mathbf{a} = \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}}$。在主应力空间中，$\\mathbf{a} = \\left( 1-\\sin\\phi, 0, -(1+\\sin\\phi) \\right)^T = (0.5, 0, -1.5)^T$。\n模量 $H$ 在平面应变条件下计算如下：\n$$ H = a_1 (D_{11} r_1 + D_{13} r_3) + a_3 (D_{31} r_1 + D_{33} r_3) $$\n$$ H = a_1 ((\\lambda+2\\mu) r_1 + \\lambda r_3) + a_3 (\\lambda r_1 + (\\lambda+2\\mu) r_3) $$\n$$ H = (1-\\sin\\phi)[(\\lambda+2\\mu)(1-\\sin\\psi) - \\lambda(1+\\sin\\psi)] - (1+\\sin\\phi)[\\lambda(1-\\sin\\psi) - (\\lambda+2\\mu)(1+\\sin\\psi)] $$\n代入数值：\n$$ H = 0.5[144(0.75) - 48(1.25)] - 1.5[48(0.75) - 144(1.25)] $$\n$$ H = 0.5[108 - 60] - 1.5[36 - 180] = 0.5(48) - 1.5(-144) = 24 + 216 = 240 \\,\\mathrm{MPa} $$\n现在我们求解 $\\Delta\\lambda$：\n$$ \\Delta\\lambda = \\frac{0.192 - 0.05\\sqrt{3}}{240} \\approx 0.000439156 $$\n塑性应变增量为：\n$$ \\Delta\\varepsilon_{xx}^p = \\Delta\\lambda \\frac{\\partial g}{\\partial\\sigma_{xx}} = \\Delta\\lambda r_1 = 0.75 \\Delta\\lambda \\approx 0.75 \\times 0.000439156 = 0.000329367 $$\n$$ \\Delta\\varepsilon_{yy}^p = \\Delta\\lambda \\frac{\\partial g}{\\partial\\sigma_{yy}} = \\Delta\\lambda r_3 = -1.25 \\Delta\\lambda \\approx -1.25 \\times 0.000439156 = -0.000548945 $$\n由于 $\\partial g / \\partial\\sigma_{xy} = 0$（根据问题假设和 $g$ 的形式），$\\Delta\\varepsilon_{xy}^p=0$，这意味着 $\\Delta\\gamma_{xy}^p=0$。\n\n最终应力分量为：\n$$ \\sigma_{xx}^{\\text{final}} = \\sigma_{xx}^{\\text{trial}} - [(\\lambda+2\\mu)\\Delta\\varepsilon_{xx}^p + \\lambda\\Delta\\varepsilon_{yy}^p] = 0.528 - [144(0.75\\Delta\\lambda) + 48(-1.25\\Delta\\lambda)] $$\n$$ \\sigma_{xx}^{\\text{final}} = 0.528 - [108 - 60]\\Delta\\lambda = 0.528 - 48\\Delta\\lambda $$\n$$ \\sigma_{xx}^{\\text{final}} = 0.528 - 48 \\left(\\frac{0.192 - 0.05\\sqrt{3}}{240}\\right) = 0.528 - 0.2(0.192 - 0.05\\sqrt{3}) = 0.4896 + 0.01\\sqrt{3} \\approx 0.506921 \\,\\mathrm{MPa} $$\n\n$$ \\sigma_{yy}^{\\text{final}} = \\sigma_{yy}^{\\text{trial}} - [\\lambda\\Delta\\varepsilon_{xx}^p + (\\lambda+2\\mu)\\Delta\\varepsilon_{yy}^p] = 0.048 - [48(0.75\\Delta\\lambda) + 144(-1.25\\Delta\\lambda)] $$\n$$ \\sigma_{yy}^{\\text{final}} = 0.048 - [36 - 180]\\Delta\\lambda = 0.048 + 144\\Delta\\lambda $$\n$$ \\sigma_{yy}^{\\text{final}} = 0.048 + 144 \\left(\\frac{0.192 - 0.05\\sqrt{3}}{240}\\right) = 0.048 + 0.6(0.192 - 0.05\\sqrt{3}) = 0.1632 - 0.03\\sqrt{3} \\approx 0.111238 \\,\\mathrm{MPa} $$\n\n$$ \\sigma_{xy}^{\\text{final}} = \\sigma_{xy}^{\\text{trial}} - 2\\mu\\Delta\\varepsilon_{xy}^p = 0 - 0 = 0 \\,\\mathrm{MPa}$$\n\n将结果四舍五入至四位有效数字：\n- $\\sigma_{xx} = 0.5069 \\,\\mathrm{MPa}$\n- $\\sigma_{yy} = 0.1112 \\,\\mathrm{MPa}$\n- $\\sigma_{xy} = 0.0000 \\,\\mathrm{MPa}$\n- $\\Delta\\varepsilon_{xx}^p = 0.0003294$\n- $\\Delta\\varepsilon_{yy}^p = -0.0005489$\n- $\\Delta\\gamma_{xy}^p = 0.0000$\n\n最终答案按要求以行矩阵形式呈现。", "answer": "$$ \\boxed{ \\begin{pmatrix} 0.5069  0.1112  0.0000  0.0003294  -0.0005489  0.0000 \\end{pmatrix} } $$", "id": "3549281"}, {"introduction": "最后的实践是将我们的理解转化为一个稳健的算法，这是开发任何岩土力学模拟工具的核心任务。在前述练习的基础上，你将为Mohr-Coulomb模型在主应力空间中实现完整的最近点投影算法 [@problem_id:3549310]。这需要深入研究屈服面的几何形状，并为你开发出能够处理向其不同特征（面、棱和顶点）进行投影的逻辑。", "problem": "在主应力空间中，为理想塑性Mohr-Coulomb材料实现一个遵循压为正符号约定的最近点投影算法。该投影被定义为将一个试探主应力向量欧几里得投影到以主应力空间表示的凸Mohr-Coulomb屈服面上。目标是从第一性原理出发，推导Mohr-Coulomb六角锥体在主应力空间中的面法线和边法线，构建一个决策逻辑来确定最近点位于一个面、一条边还是顶点上，并实现一个稳健的算法来计算投影后的主应力。\n\n从以下基本原理开始：\n- Mohr-Coulomb的屈服条件由Coulomb摩擦定律控制，该定律以平面上的剪应力和法向应力表示，即 $\\tau = c + \\sigma_n \\tan \\varphi$，其中 $c$ 是黏聚力，$\\varphi$ 是摩擦角。\n- 在主应力空间中，设主应力为 $\\boldsymbol{\\sigma} = [\\sigma_1, \\sigma_2, \\sigma_3]^T$，并取压应力为正。\n- 在主应力空间中，Mohr-Coulomb屈服面是一个凸的分段线性（多面体）表面，可以表示为多个半空间的交集，每个半空间对应于与主应力有序对相关联的一个潜在破坏面。\n- 将点 $\\boldsymbol{t}$ 欧几里得最近点投影到凸集 $\\mathcal{C}$ 上的结果是 $\\min_{\\boldsymbol{\\sigma} \\in \\mathcal{C}} \\lVert \\boldsymbol{\\sigma} - \\boldsymbol{t} \\rVert_2^2$ 的唯一最小化子。\n\n任务：\n1. 从Coulomb摩擦定律推导主应力空间中的平面屈服不等式。证明Mohr-Coulomb曲面可以写成六个形式为 $\\boldsymbol{a}_{ij}^T \\boldsymbol{\\sigma} - b \\le 0$ 的半空间的交集，其中对于有序对 $(i,j)$ 且 $i \\ne j$，$\\boldsymbol{a}_{ij}$ 和 $b$ 仅依赖于摩擦角 $\\varphi$ 和黏聚力 $c$。\n2. 根据上述结果，推导面的外向き单位法向量和由两个面相交得到的边的方向向量的显式表达式。同时，推导顶点（所有主应力相等的点）的坐标。\n3. 构建一个有原则的决策逻辑（决策树），以确定给定试探应力的最近点是位于：\n   - 单个面上（一个线性约束激活），\n   - 一条边上（两个激活约束的交集），\n   - 顶点上（三个适当约束的交集）。\n   该逻辑必须基于试探主应力和屈服不等式的残差。\n4. 实现一个程序，该程序：\n   - 不接受输入，并使用下面指定的测试套件。\n   - 通过评估与决策逻辑一致的所有潜在激活特征（面、边、顶点）上的候选点，计算主应力空间中的欧几里得最近点投影，并选择满足所有屈服不等式且欧几里得距离最小的候选点。\n   - 以千帕（kPa）为单位返回每个测试用例的投影主应力。\n\n角度单位：摩擦角 $\\varphi$ 以度为单位给出，在程序内部必须转换为弧度以用于三角函数。\n\n单位：所有应力必须以千帕（kPa）表示。您的程序必须以kPa为单位输出投影主应力。将报告的每个主应力四舍五入到 $6$ 位小数。\n\n测试套件和参数：\n- 材料参数：黏聚力 $c = 20$ kPa，摩擦角 $\\varphi = 30$ 度。\n- 定义以下 $4$ 个试探主应力状态 $\\boldsymbol{t}$（单位均为kPa）：\n  1. $\\boldsymbol{t}^{(1)} = [100, 80, 60]^T$ (内部，预期的弹性/正常路径)。\n  2. $\\boldsymbol{t}^{(2)} = [300, 20, -10]^T$ (主要违反一个面)。\n  3. $\\boldsymbol{t}^{(3)} = [300, 200, -50]^T$ (违反两个相邻面，边的情况)。\n  4. $\\boldsymbol{t}^{(4)} = [-200, -200, -200]^T$ (超出顶点的静水拉伸，顶点的情况)。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个以逗号分隔的Python风格浮点数列表的列表形式的结果，每个内部列表对应一个测试用例的 $3$ 个投影主应力，顺序与上面指定的一致。\n- 格式示例：\"[[s11,s12,s13],[s21,s22,s23],[s31,s32,s33],[s41,s42,s43]]\"，其中每个 $s_{ij}$ 都四舍五入到 $6$ 位小数，并以kPa表示。", "solution": "该问题要求实现一个用于理想塑性Mohr-Coulomb材料的最近点投影算法。该过程始于对问题陈述的严格验证，随后是必要几何与代数实体的第一性原理推导，最终完成投影算法的设计与实现。\n\n### 问题验证\n\n**第1步：提取给定条件**\n\n- **屈服条件：** $\\tau = c + \\sigma_n \\tan \\varphi$，其中 $c$ 是黏聚力，$\\varphi$ 是摩擦角。\n- **主应力：** $\\boldsymbol{\\sigma} = [\\sigma_1, \\sigma_2, \\sigma_3]^T$，并取压应力为正。\n- **屈服面几何形状：** 在主应力空间中的一个凸的分段线性（多面体）表面。\n- **投影定义：** 将试探应力 $\\boldsymbol{t}$ 欧几里得最近点投影到凸屈服集 $\\mathcal{C}$ 上的结果是 $\\min_{\\boldsymbol{\\sigma} \\in \\mathcal{C}} \\lVert \\boldsymbol{\\sigma} - \\boldsymbol{t} \\rVert_2^2$ 的最小化子。\n- **任务1：** 推导平面屈服不等式 $\\boldsymbol{a}_{ij}^T \\boldsymbol{\\sigma} - b \\le 0$。\n- **任务2：** 推导面法线、边方向和顶点坐标。\n- **任务3：** 构建用于确定最近点位置（面、边或顶点）的决策逻辑。\n- **任务4：** 实现一个程序，为给定的测试套件计算投影。\n- **单位与约定：** 摩擦角 $\\varphi$ 以度为单位，应力以千帕（kPa）为单位，输出四舍五入到 $6$ 位小数。\n- **材料参数：** 黏聚力 $c = 20$ kPa，摩擦角 $\\varphi = 30$ 度。\n- **测试套件：**\n  1. $\\boldsymbol{t}^{(1)} = [100, 80, 60]^T$ kPa\n  2. $\\boldsymbol{t}^{(2)} = [300, 20, -10]^T$ kPa\n  3. $\\boldsymbol{t}^{(3)} = [300, 200, -50]^T$ kPa\n  4. $\\boldsymbol{t}^{(4)} = [-200, -200, -200]^T$ kPa\n- **最终输出格式：** \"[[s11,s12,s13],[s21,s22,s23],[s31,s32,s33],[s41,s42,s43]]\"\n\n**第2步：使用提取的给定条件进行验证**\n\n- **科学依据充分：** 该问题牢固地植根于塑性理论和计算岩土力学。Mohr-Coulomb屈服准则是标准的基本模型。\n- **问题适定：** 该问题是适定的。将一个点投影到闭合凸集（Mohr-Coulomb屈服面）上的欧几里得投影保证存在且唯一。\n- **目标明确：** 问题以精确、客观的数学和工程术语陈述。\n- **完整性：** 所有必要的数据（$c, \\varphi$）和条件（符号约定，测试用例）都已提供。问题是自成体系的。\n- **一致性：** 不存在内部矛盾。从理论推导到实现，各项任务逻辑上层层递进。\n- **真实性：** 材料参数和应力状态对于岩土工程分析是物理上现实的。\n\n**第3步：结论与行动**\n\n该问题有效。这是一个在计算塑性力学领域中定义明确、科学合理且具有一定难度的非平凡问题。现在开始求解过程。\n\n### 推导与算法设计\n\n解决方案分三部分展开，对应于问题陈述中概述的任务。\n\n**第1部分：主应力空间中平面屈服不等式的推导**\n\nMohr-Coulomb屈服准则指出，当平面上的剪应力 $\\tau$ 达到一个临界值时，材料发生破坏，该临界值取决于同一平面上的正应力 $\\sigma_n$、材料的黏聚力 $c$ 和摩擦角 $\\varphi$。当压应力为正时，表示为：\n$$|\\tau| \\le c + \\sigma_n \\tan\\varphi$$\n在主应力 $\\boldsymbol{\\sigma} = [\\sigma_1, \\sigma_2, \\sigma_3]^T$ 空间中，最大剪应力及相应的正应力由最大Mohr圆确定，该Mohr圆由最大和最小主应力 $\\sigma_{\\text{max}}$ 和 $\\sigma_{\\text{min}}$ 定义。\n\n该圆的圆心为 $S = (\\sigma_{\\text{max}} + \\sigma_{\\text{min}})/2$，半径为 $R = (\\sigma_{\\text{max}} - \\sigma_{\\text{min}})/2$。当该圆与破坏包络线 $|\\tau| = c + \\sigma_n \\tan\\varphi$ 相切时，满足屈服条件。\n\n为实现相切，圆心 $(S, 0)$ 到直线 $\\sigma_n \\tan\\varphi - \\tau + c = 0$ 的距离必须等于半径 $R$。\n$$R = \\frac{|S \\tan\\varphi + c|}{\\sqrt{\\tan^2\\varphi + (-1)^2}} = \\frac{S \\tan\\varphi + c}{\\sec\\varphi} = S \\sin\\varphi + c \\cos\\varphi$$\n代入 $R$ 和 $S$ 的表达式：\n$$\\frac{\\sigma_{\\text{max}} - \\sigma_{\\text{min}}}{2} = \\frac{\\sigma_{\\text{max}} + \\sigma_{\\text{min}}}{2} \\sin\\varphi + c \\cos\\varphi$$\n乘以2并整理各项，得到用最大和最小主应力表示的屈服函数：\n$$\\sigma_{\\text{max}}(1 - \\sin\\varphi) - \\sigma_{\\text{min}}(1 + \\sin\\varphi) - 2c\\cos\\varphi = 0$$\n一个容许的应力状态必须不违反此条件。因此，对于任意一对主应力 $(\\sigma_i, \\sigma_j)$，必须满足以下不等式：\n$$\\sigma_i(1 - \\sin\\varphi) - \\sigma_j(1 + \\sin\\varphi) - 2c\\cos\\varphi \\le 0$$\n$$\\sigma_j(1 - \\sin\\varphi) - \\sigma_i(1 + \\sin\\varphi) - 2c\\cos\\varphi \\le 0$$\n将此应用于所有三对主应力 $((\\sigma_1, \\sigma_2), (\\sigma_1, \\sigma_3), (\\sigma_2, \\sigma_3))$，得到定义Mohr-Coulomb六角锥体的六个平面不等式。对于任意有序对 $(i, j)$，其中 $i,j \\in \\{1,2,3\\}$ 且 $i \\ne j$，屈服函数为：\n$$f_{ij}(\\boldsymbol{\\sigma}) = \\sigma_i(1 - \\sin\\varphi) - \\sigma_j(1 + \\sin\\varphi) - 2c\\cos\\varphi \\le 0$$\n这符合所要求的形式 $\\boldsymbol{a}_{ij}^T \\boldsymbol{\\sigma} - b \\le 0$，其中：\n- $\\boldsymbol{a}_{ij}$ 是一个向量，其第 $i$ 个分量是 $(1 - \\sin\\varphi)$，第 $j$ 个分量是 $-(1 + \\sin\\varphi)$，第三个分量（设为 $k$，$k \\ne i, j$）是 $0$。\n- $b = 2c\\cos\\varphi$。\n\n**第2部分：屈服面的几何特性**\n\n从平面形式 $\\boldsymbol{a}_{ij}^T \\boldsymbol{\\sigma} - b \\le 0$ 出发，我们可以推导出关键的几何特征。\n\n- **顶点：** 锥体的顶点位于静水压力轴上，其中 $\\sigma_1 = \\sigma_2 = \\sigma_3 = p$。将此代入任意一个不等式中，例如 $f_{12}(\\boldsymbol{\\sigma}) \\le 0$，可得：\n$$p(1 - \\sin\\varphi) - p(1 + \\sin\\varphi) - 2c\\cos\\varphi \\le 0$$\n$$-2p\\sin\\varphi - 2c\\cos\\varphi \\le 0$$\n$$p \\ge -c \\frac{\\cos\\varphi}{\\sin\\varphi} = -c \\cot\\varphi$$\n屈服面在静水拉伸方向（负 $p$）是有界的。顶点是该边界的极限，因此其坐标为：\n$$\\boldsymbol{\\sigma}_{\\text{apex}} = [-c \\cot\\varphi, -c \\cot\\varphi, -c \\cot\\varphi]^T$$\n\n- **面法线：** 由 $f_{ij}(\\boldsymbol{\\sigma}) = 0$ 定义的面的外法线平行于向量 $\\boldsymbol{a}_{ij}$。单位法向量 $\\boldsymbol{n}_{ij}$ 为：\n$$\\boldsymbol{n}_{ij} = \\frac{\\boldsymbol{a}_{ij}}{\\|\\boldsymbol{a}_{ij}\\|_2}$$\n$\\boldsymbol{a}_{ij}$ 的二范数平方为：\n$$\\|\\boldsymbol{a}_{ij}\\|_2^2 = (1 - \\sin\\varphi)^2 + (-(1 + \\sin\\varphi))^2 + 0^2 = (1 - 2\\sin\\varphi + \\sin^2\\varphi) + (1 + 2\\sin\\varphi + \\sin^2\\varphi) = 2 + 2\\sin^2\\varphi$$\n对于所有六个面，此范数是恒定的。\n\n- **边：** 锥体的边由两个非平行面的交集形成。例如， $f_{ik}(\\boldsymbol{\\sigma})=0$ 和 $f_{jk}(\\boldsymbol{\\sigma})=0$ 的交集是：\n$$\\sigma_i(1 - \\sin\\varphi) - \\sigma_k(1 + \\sin\\varphi) - 2c\\cos\\varphi = 0$$\n$$\\sigma_j(1 - \\sin\\varphi) - \\sigma_k(1 + \\sin\\varphi) - 2c\\cos\\varphi = 0$$\n这意味着 $\\sigma_i(1 - \\sin\\varphi) = \\sigma_j(1 - \\sin\\varphi)$，对于 $\\varphi \\ne 90^\\circ$，可得 $\\sigma_i = \\sigma_j$。这些是锥体的六条边，它们位于两个主应力相等的平面上。边的方向向量与两个相交面的法线正交，即与 $\\boldsymbol{n}_{ik} \\times \\boldsymbol{n}_{jk}$ 成比例。\n\n**第3部分：最近点投影算法**\n\n任务是找到 $\\boldsymbol{\\sigma}^*$，使得 $g(\\boldsymbol{\\sigma}) = \\frac{1}{2}\\|\\boldsymbol{\\sigma} - \\boldsymbol{t}\\|^2$ 最小化，并满足所有六对 $(i,j)$ 的 $f_{ij}(\\boldsymbol{\\sigma}) \\le 0$。解必须满足 Karush-Kuhn-Tucker (KKT) 条件。平稳性条件是核心：\n$$\\nabla g(\\boldsymbol{\\sigma}^*) + \\sum_{ij} \\lambda_{ij} \\nabla f_{ij}(\\boldsymbol{\\sigma}^*) = 0 \\implies (\\boldsymbol{\\sigma}^* - \\boldsymbol{t}) + \\sum_{ij} \\lambda_{ij} \\boldsymbol{a}_{ij} = 0$$\n其中 $\\lambda_{ij} \\ge 0$ 是拉格朗日乘子，且 $\\lambda_{ij}f_{ij}(\\boldsymbol{\\sigma}^*) = 0$（互补松弛性）。这意味着返回向量 $(\\boldsymbol{t} - \\boldsymbol{\\sigma}^*)$ 是激活约束的外法线的正线性组合。\n\n问题要求一种算法，该算法评估所有潜在特征（面、边、顶点），并选择距离最小的有效候选点。这是一个稳健但计算量可能较大的策略。\n\n**算法：**\n1.  **弹性检查：** 给定一个试探应力 $\\boldsymbol{t}$，计算所有六个屈服函数值 $f_{ij}(\\boldsymbol{t})$。如果所有 $f_{ij}(\\boldsymbol{t}) \\le 0$，则该状态是容许的（弹性的），投影结果为 $\\boldsymbol{\\sigma}^* = \\boldsymbol{t}$。\n2.  **初始化候选点：** 如果任何 $f_{ij}(\\boldsymbol{t}) > 0$，则该状态是不可容许的（塑性的）。我们创建一个候选投影列表。顶点 $\\boldsymbol{\\sigma}_{\\text{apex}}$ 始终是一个可行点，因此它是我们的第一个候选点。\n3.  **面投影：** 对于 $f_{ij}(\\boldsymbol{t}) > 0$ 的六个面中的每一个（这是拉格朗日乘子 $\\lambda_{ij}$ 为正的必要条件）：\n    a.  假设这是唯一激活的约束。投影 $\\boldsymbol{\\sigma}_F$ 是通过从 $\\boldsymbol{t}$ 沿着法线方向 $-\\boldsymbol{a}_{ij}$ 移动直到该点位于平面上来找到的：\n        $$\\boldsymbol{\\sigma}_F = \\boldsymbol{t} - \\lambda_{ij} \\boldsymbol{a}_{ij}$$\n    b.  乘子 $\\lambda_{ij}$ 通过强制 $f_{ij}(\\boldsymbol{\\sigma}_F) = 0$ 来找到：\n        $$\\lambda_{ij} = \\frac{f_{ij}(\\boldsymbol{t})}{\\|\\boldsymbol{a}_{ij}\\|_2^2}$$\n    c.  计算候选点 $\\boldsymbol{\\sigma}_F$。通过确保所有六个平面 $(k,l)$ 的 $f_{kl}(\\boldsymbol{\\sigma}_F) \\le \\epsilon$ （其中 $\\epsilon$ 是一个小的数值容差）来检查其可行性。\n    d.  如果可行，则将 $\\boldsymbol{\\sigma}_F$ 添加到候选点列表中。\n4.  **边投影：** 对于六个形成边的面配对（例如 $f_{ik}=0$ 和 $f_{jk}=0$）中的每一个：\n    a.  假设这两个约束是激活的。投影 $\\boldsymbol{\\sigma}_E$ 是：\n        $$\\boldsymbol{\\sigma}_E = \\boldsymbol{t} - \\lambda_1 \\boldsymbol{a}_1 - \\lambda_2 \\boldsymbol{a}_2$$\n    b.  乘子 $(\\lambda_1, \\lambda_2)$ 通过求解强制 $f_1(\\boldsymbol{\\sigma}_E)=0$ 和 $f_2(\\boldsymbol{\\sigma}_E)=0$ 的 $2 \\times 2$ 方程组来找到：\n        $$ \\begin{bmatrix} \\|\\boldsymbol{a}_1\\|^2  \\boldsymbol{a}_1^T\\boldsymbol{a}_2 \\\\ \\boldsymbol{a}_1^T\\boldsymbol{a}_2  \\|\\boldsymbol{a}_2\\|^2 \\end{bmatrix} \\begin{Bmatrix} \\lambda_1 \\\\ \\lambda_2 \\end{Bmatrix} = \\begin{Bmatrix} f_1(\\boldsymbol{t}) \\\\ f_2(\\boldsymbol{t}) \\end{Bmatrix} $$\n    c.  如果 $\\lambda_1 \\ge 0$ 和 $\\lambda_2 \\ge 0$ 都成立，则计算候选点 $\\boldsymbol{\\sigma}_E$。\n    d.  通过确保所有六个平面 $k$ 的 $f_k(\\boldsymbol{\\sigma}_E) \\le \\epsilon$ 来检查其可行性。\n    e.  如果可行，则将 $\\boldsymbol{\\sigma}_E$ 添加到候选点列表中。\n5.  **最终选择：** 从所有可行候选点（来自弹性检查、顶点、面和边）的编译列表中，选择一个 $\\boldsymbol{\\sigma}^*$，使其最小化欧几里得距离 $\\|\\boldsymbol{\\sigma}^* - \\boldsymbol{t}\\|_2$。这就是唯一的最近点投影。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that defines test cases, computes projections,\n    and prints the final formatted output.\n    \"\"\"\n    # Material parameters\n    c = 20.0  # Cohesion in kPa\n    phi_deg = 30.0  # Friction angle in degrees\n\n    # Test suite of trial principal stresses in kPa\n    # NOTE: The problem statement uses ordered principal stresses (s1>=s2>=s3),\n    # but the algorithm should be general. The implementation here does NOT\n    # assume a priori ordering of the trial stress components. The yield\n    # functions f_ij cover all permutations.\n    test_cases = [\n        np.array([100.0, 80.0, 60.0]),   # Case 1: Interior (elastic)\n        np.array([300.0, 20.0, -10.0]),  # Case 2: Dominant face violation\n        np.array([300.0, 200.0, -50.0]), # Case 3: Edge return\n        np.array([-200.0, -200.0, -200.0]) # Case 4: Apex return\n    ]\n\n    results = []\n    for t_stress in test_cases:\n        projected_stress = project_mohr_coulomb(t_stress, c, phi_deg)\n        results.append(projected_stress)\n\n    # Format the output as specified\n    final_output = \"[\" + \",\".join([f\"[{s[0]:.6f},{s[1]:.6f},{s[2]:.6f}]\" for s in results]) + \"]\"\n    print(final_output)\n\ndef project_mohr_coulomb(trial_stress, c, phi_deg):\n    \"\"\"\n    Computes the closest-point projection of a trial stress vector onto the\n    Mohr-Coulomb yield surface in principal stress space.\n\n    Args:\n        trial_stress (np.ndarray): A 3-element array of trial principal stresses.\n        c (float): Cohesion.\n        phi_deg (float): Friction angle in degrees.\n\n    Returns:\n        np.ndarray: The 3-element projected principal stress vector.\n    \"\"\"\n    phi_rad = np.deg2rad(phi_deg)\n    s_phi = np.sin(phi_rad)\n    c_phi = np.cos(phi_rad)\n    \n    A = 1.0 - s_phi\n    B = 1.0 + s_phi\n    K = 2.0 * c * c_phi\n    \n    # Numerical tolerance\n    tol = 1e-9\n\n    # The 6 yield planes are identified by pairs of indices (i, j)\n    # where f_ij = A*sigma_i - B*sigma_j - K = 0.\n    # Indices are 0-based.\n    face_indices = [(0, 1), (1, 0), (0, 2), (2, 0), (1, 2), (2, 1)]\n\n    def get_normals_and_yield_vals(stress_vec):\n        f_vals = np.zeros(6)\n        normals = np.zeros((6, 3))\n        for idx, (i, j) in enumerate(face_indices):\n            k = 3 - i - j # The third index\n            f_vals[idx] = A * stress_vec[i] - B * stress_vec[j] - K\n            normals[idx, i] = A\n            normals[idx, j] = -B\n            normals[idx, k] = 0.0\n        return f_vals, normals\n\n    f_values_trial, normals = get_normals_and_yield_vals(trial_stress)\n\n    # 1. Elastic Check: If inside or on the surface, return the trial stress\n    if np.all(f_values_trial = tol):\n        return trial_stress\n\n    candidates = []\n\n    # 2. Apex Candidate\n    # The apex is always a feasible point.\n    if np.abs(s_phi) > tol:\n        p_apex = -c * c_phi / s_phi  # which is -c * cot(phi)\n    else: # friction angle is 0, Tresca case, apex is at infinity\n        p_apex = -1e12 # A very large negative number\n    \n    s_apex = np.array([p_apex, p_apex, p_apex])\n    dist_sq_apex = np.sum((s_apex - trial_stress)**2)\n    candidates.append((dist_sq_apex, s_apex))\n\n    # 3. Face Candidates\n    for i in range(6):\n        if f_values_trial[i] > 0:\n            a_i = normals[i]\n            norm_a_sq = np.dot(a_i, a_i)\n            s_face = trial_stress - (f_values_trial[i] / norm_a_sq) * a_i\n            \n            # Feasibility check for the face-projected candidate\n            f_check, _ = get_normals_and_yield_vals(s_face)\n            if np.all(f_check = tol):\n                dist_sq = np.sum((s_face - trial_stress)**2)\n                candidates.append((dist_sq, s_face))\n\n    # 4. Edge Candidates\n    # Edges are formed by the intersection of two planes. There are 6 edges.\n    # e.g., f_13=0 and f_23=0 form an edge.\n    edge_face_indices = [(2,4), (3,5), (0,5), (1,3), (0,2), (1,4)]\n\n    for i, j in edge_face_indices:\n        a1, a2 = normals[i], normals[j]\n        f1, f2 = f_values_trial[i], f_values_trial[j]\n\n        # Solve 2x2 system for Lagrange multipliers (lambdas)\n        M = np.array([\n            [np.dot(a1, a1), np.dot(a1, a2)],\n            [np.dot(a1, a2), np.dot(a2, a2)]\n        ])\n        \n        if np.abs(np.linalg.det(M))  tol:\n            continue\n\n        rhs = np.array([f1, f2])\n        try:\n            lambdas = np.linalg.solve(M, rhs)\n        except np.linalg.LinAlgError:\n            continue\n        \n        # Check KKT dual feasibility condition (lambda >= 0)\n        if lambdas[0] >= -tol and lambdas[1] >= -tol:\n            s_edge = trial_stress - lambdas[0] * a1 - lambdas[1] * a2\n            \n            # Feasibility check for the edge-projected candidate\n            f_check, _ = get_normals_and_yield_vals(s_edge)\n            if np.all(f_check = tol):\n                dist_sq = np.sum((s_edge - trial_stress)**2)\n                candidates.append((dist_sq, s_edge))\n\n    # 5. Final Selection\n    if not candidates:\n        raise RuntimeError(\"No valid projection candidate found.\")\n        \n    candidates.sort(key=lambda x: x[0])\n    best_projection = candidates[0][1]\n    \n    return best_projection\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3549310"}]}