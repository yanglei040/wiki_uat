{"hands_on_practices": [{"introduction": "在选择非线性求解器时，我们不仅要考虑其理论收敛阶数，还必须权衡每次迭代的计算成本。牛顿-拉弗森（Newton-Raphson）法虽然具有二次收敛性，但每一步都需要计算和求解雅可比矩阵系统，代价高昂。本练习 [@problem_id:3561408] 将指导您建立一个量化模型，用于估算在典型的有限元网格上，皮卡（Picard）迭代与牛顿法相比的总计算功，从而帮助您超越理论，从实践层面理解求解器性能的权衡。", "problem": "考虑一个计算岩土力学中的平面应变多孔弹性非线性水力-力学有限元模型。全局层面上的控制离散平衡由残差向量 $\\mathbf{R}(\\mathbf{x})$ 表示，其雅可比（切线刚度）矩阵为 $\\mathbf{J}(\\mathbf{x}) = \\frac{\\partial \\mathbf{R}}{\\partial \\mathbf{x}}$。考虑两种非线性求解策略：定点（Picard）迭代法和牛顿-拉夫逊（Newton-Raphson, NR）法。代表性网格是一个矩形上的结构化网格，由四节点四边形单元组成，其中水平方向有 $n_x = 80$ 个单元，垂直方向有 $n_y = 50$ 个单元。总单元数为 $N_e = n_x n_y$，节点数为 $N_n = (n_x + 1)(n_y + 1)$，自由度（DOF）总数为 $N_d = m N_n$，其中每个节点有 $m = 3$ 个自由度（两个位移和一个孔隙压力）。\n\n假设以下以挂钟时间表示的计算工作模型：\n1. 每次迭代的残差组装主要由局部本构评估和全局向量组装决定，建模为\n$$\nT_R = N_e \\left( N_q \\, t_r + t_{ra} \\right),\n$$\n其中，每个单元有 $N_q = 4$ 个高斯点，$t_r = 2.5 \\times 10^{-6} \\ \\text{s}$ 是每个高斯点残差评估的成本，$t_{ra} = 1.0 \\times 10^{-6} \\ \\text{s}$ 是每个单元的全局残差组装开销。\n\n2. 每次迭代的雅可比矩阵组装建模为\n$$\nT_J = N_e \\left( N_q \\, t_j + t_{ja} \\right),\n$$\n其中，$t_j = 1.0 \\times 10^{-5} \\ \\text{s}$ 是每个高斯点雅可比贡献评估的成本，$t_{ja} = 4.0 \\times 10^{-6} \\ \\text{s}$ 是每个单元的全局矩阵组装开销。\n\n3. 线性系统通过 Krylov 方法求解，具体为预处理广义最小残差（GMRES）方法。设每行的平均非零元素数为 $s = 70$，因此非零元素的总数为 $\\mathrm{nnz} = s N_d$。每次 GMRES 迭代的成本建模为\n$$\nT_{\\text{lin,iter}} = \\mathrm{nnz} \\, t_{nz} + N_d \\, t_p,\n$$\n其中，$t_{nz} = 1.0 \\times 10^{-9} \\ \\text{s}$ 是稀疏矩阵向量乘法中每个非零元素的成本，$t_p = 5.0 \\times 10^{-9} \\ \\text{s}$ 是应用右预条件子时每个自由度的成本。每次雅可比矩阵组装时构建预条件子的成本为\n$$\nT_b = \\mathrm{nnz} \\, t_b,\n$$\n其中每个非零元素的成本为 $t_b = 5.0 \\times 10^{-9} \\ \\text{s}$。\n\n对于 Picard 迭代，全局切线矩阵固定为初始线性化结果（在开始时组装一次），并在每个外层迭代中评估 $\\mathbf{R}(\\mathbf{x})$。对于 Picard 求解器，假设有 $K_P = 20$ 次外层迭代，每次外层迭代进行 $L_P = 45$ 次 GMRES 迭代。对于 Newton-Raphson 求解器，在 $K_N = 6$ 次外层迭代的每一次中，都组装 $\\mathbf{R}(\\mathbf{x})$ 和 $\\mathbf{J}(\\mathbf{x})$，构建一个新的预条件子，并执行 $L_N = 30$ 次 GMRES 迭代。\n\n使用上述模型和参数，计算无量纲比率\n$$\n\\mathcal{R} = \\frac{T_{\\text{Picard}}}{T_{\\text{Newton}}},\n$$\n其中 $T_{\\text{Picard}}$ 是 Picard 方法的总时间，$T_{\\text{Newton}}$ 是 Newton-Raphson 方法的总时间，两者都是在各自的外层迭代中累积的。将您计算的 $\\mathcal{R}$ 的最终答案四舍五入到四位有效数字。该比率为无量纲；报告时无需单位。", "solution": "该问题已经过验证，被确定为计算力学领域中一个适定且有科学依据的问题。任务是计算两种标准非线性求解算法的计算时间的无量纲比率。求解过程首先计算模型尺寸，然后计算基本计算任务的成本，最后计算每种算法的总成本以求出它们的比率。\n\n第一步是计算有限元模型离散化的关键参数。\n单元数由 $N_e = n_x n_y$ 给出。当 $n_x = 80$ 和 $n_y = 50$ 时，其值为：\n$$N_e = 80 \\times 50 = 4000$$\n节点数为 $N_n = (n_x + 1)(n_y + 1)$：\n$$N_n = (80 + 1)(50 + 1) = 81 \\times 51 = 4131$$\n自由度（DOF）总数为 $N_d = m N_n$，每个节点有 $m = 3$ 个自由度：\n$$N_d = 3 \\times 4131 = 12393$$\n雅可比矩阵中的非零元素总数为 $\\mathrm{nnz} = s N_d$，平均每行有 $s = 70$ 个非零元素：\n$$\\mathrm{nnz} = 70 \\times 12393 = 867510$$\n\n接下来，我们根据给定的成本模型评估每个基本计算操作的挂钟时间。\n\n1.  每次迭代的残差向量组装成本 $T_R$ 为：\n    $$T_R = N_e \\left( N_q \\, t_r + t_{ra} \\right)$$\n    使用给定值 $N_e = 4000$，$N_q = 4$，$t_r = 2.5 \\times 10^{-6}$ 和 $t_{ra} = 1.0 \\times 10^{-6}$：\n    $$T_R = 4000 \\left( 4 \\times 2.5 \\times 10^{-6} + 1.0 \\times 10^{-6} \\right) = 4000 \\left( 1.0 \\times 10^{-5} + 1.0 \\times 10^{-6} \\right) = 4000 \\left( 1.1 \\times 10^{-5} \\right) = 0.044$$\n\n2.  每次迭代的雅可比矩阵组装成本 $T_J$ 为：\n    $$T_J = N_e \\left( N_q \\, t_j + t_{ja} \\right)$$\n    使用 $t_j = 1.0 \\times 10^{-5}$ 和 $t_{ja} = 4.0 \\times 10^{-6}$：\n    $$T_J = 4000 \\left( 4 \\times 1.0 \\times 10^{-5} + 4.0 \\times 10^{-6} \\right) = 4000 \\left( 4.0 \\times 10^{-5} + 0.4 \\times 10^{-5} \\right) = 4000 \\left( 4.4 \\times 10^{-5} \\right) = 0.176$$\n\n3.  构建预条件子的成本 $T_b$ 为：\n    $$T_b = \\mathrm{nnz} \\, t_b$$\n    使用 $\\mathrm{nnz} = 867510$ 和 $t_b = 5.0 \\times 10^{-9}$：\n    $$T_b = 867510 \\times 5.0 \\times 10^{-9} = 0.00433755$$\n\n4.  GMRES 线性求解器每次迭代的成本 $T_{\\text{lin,iter}}$ 为：\n    $$T_{\\text{lin,iter}} = \\mathrm{nnz} \\, t_{nz} + N_d \\, t_p$$\n    使用 $t_{nz} = 1.0 \\times 10^{-9}$ 和 $t_p = 5.0 \\times 10^{-9}$：\n    $$T_{\\text{lin,iter}} = 867510 \\times 1.0 \\times 10^{-9} + 12393 \\times 5.0 \\times 10^{-9} = 0.00086751 + 0.000061965 = 0.000929475$$\n\n现在，我们可以计算两种非线性求解策略各自的总计算时间。\n\n对于 Picard 迭代，总时间 $T_{\\text{Picard}}$ 包括一次性的初始设置成本（雅可比矩阵组装和预条件子构建）加上 $K_P = 20$ 次迭代的累积成本。每次迭代涉及一次残差组装和一次包含 $L_P = 45$ 次 GMRES 迭代的线性求解。\n$$T_{\\text{Picard}} = (T_J + T_b) + K_P \\left( T_R + L_P T_{\\text{lin,iter}} \\right)$$\n$$T_{\\text{Picard}} = (0.176 + 0.00433755) + 20 \\left( 0.044 + 45 \\times 0.000929475 \\right)$$\n$$T_{\\text{Picard}} = 0.18033755 + 20 \\left( 0.044 + 0.041826375 \\right)$$\n$$T_{\\text{Picard}} = 0.18033755 + 20 \\left( 0.085826375 \\right)$$\n$$T_{\\text{Picard}} = 0.18033755 + 1.7165275 = 1.89686505$$\n\n对于 Newton-Raphson 方法，总时间 $T_{\\text{Newton}}$ 是单次迭代的成本乘以迭代次数 $K_N = 6$。每次迭代都涉及组装残差和雅可比矩阵、构建预条件子，以及执行一次包含 $L_N = 30$ 次 GMRES 迭代的线性求解。\n$$T_{\\text{Newton}} = K_N \\left( T_R + T_J + T_b + L_N T_{\\text{lin,iter}} \\right)$$\n$$T_{\\text{Newton}} = 6 \\left( 0.044 + 0.176 + 0.00433755 + 30 \\times 0.000929475 \\right)$$\n$$T_{\\text{Newton}} = 6 \\left( 0.044 + 0.176 + 0.00433755 + 0.02788425 \\right)$$\n$$T_{\\text{Newton}} = 6 \\left( 0.2522218 \\right) = 1.5133308$$\n\n最后，通过将 Picard 方法的总时间除以 Newton-Raphson 方法的总时间，计算出无量纲比率 $\\mathcal{R}$。\n$$\\mathcal{R} = \\frac{T_{\\text{Picard}}}{T_{\\text{Newton}}} = \\frac{1.89686505}{1.5133308} \\approx 1.253434$$\n按要求将结果四舍五入到四位有效数字：\n$$\\mathcal{R} \\approx 1.253$$", "answer": "$$\\boxed{1.253}$$", "id": "3561408"}, {"introduction": "在求解如孔隙力学等多物理场耦合问题时，不同场的变量（如位移和孔压）往往具有截然不同的物理单位和数量级。一个未经适当缩放的朴素收敛准则可能会被某个数量级较大的物理场完全主导，从而产生误导性的结果。本练习 [@problem_id:3561414] 旨在挑战您设计并论证一种稳健的、经过缩放的终止准则，这是在真实世界模拟中获得可靠结果的一项关键技能。", "problem": "一个饱和土工材料的准静态双场孔隙力学模型通过有限元法进行离散化，在固定的载荷和时间步下，得到一个关于节点位移向量 $\\mathbf{u}\\in\\mathbb{R}^{N_u}$ 和节点孔隙压力向量 $\\mathbf{p}\\in\\mathbb{R}^{N_p}$ 的非线性代数系统。组装后的残差为 $\\mathbf{r}(\\mathbf{x})=\\begin{bmatrix}\\mathbf{r}_u(\\mathbf{u},\\mathbf{p})\\\\ \\mathbf{r}_p(\\mathbf{u},\\mathbf{p})\\end{bmatrix}$，其中 $\\mathbf{x}=\\begin{bmatrix}\\mathbf{u}\\\\ \\mathbf{p}\\end{bmatrix}$。分块 $\\mathbf{r}_u$ 强制动量平衡，单位为力；而 $\\mathbf{r}_p$ 强制流体质量守恒，单位为质量（或体积）速率。Newton–Raphson 迭代求解 $\\mathbf{J}(\\mathbf{x}^{(k)})\\,\\Delta \\mathbf{x}^{(k)}=-\\mathbf{r}(\\mathbf{x}^{(k)})$ 以更新 $\\mathbf{x}^{(k+1)}=\\mathbf{x}^{(k)}+\\Delta \\mathbf{x}^{(k)}$，其中 $\\mathbf{J}$ 是雅可比矩阵。\n\n你的任务是规定绝对和相对的终止准则，这些准则基于残差和步长范数，并需要论证一种缩放策略，以平衡耦合残差中位移和压力的贡献。考虑到在当前载荷/时间步的牛顿法开始时（迭代 $k=0$），分块 2-范数满足 $\\lVert \\mathbf{r}_u^{(0)}\\rVert_2=5\\times 10^{4}$ 和 $\\lVert \\mathbf{r}_p^{(0)}\\rVert_2=2\\times 10^{-2}$（在它们各自的一致单位下）。独立的工程判断为未知量提供了特征量级：位移为 $U_{\\mathrm{ref}}=10^{-3}$（单位为米），孔隙压力为 $P_{\\mathrm{ref}}=10^{6}$（单位为帕斯卡）。\n\n对于耦合孔隙力学求解，哪个选项最佳地定义了残差和步长的绝对与相对终止准则，并为以量纲一致且数值稳健的方式平衡位移和压力残差的变量缩放策略提供了合理解释？\n\nA. 定义一个缩放后的残差范数 $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2$，其中 $\\mathbf{S}_r=\\mathrm{diag}(s_u\\,\\mathbf{I}_{N_u},\\,s_p\\,\\mathbf{I}_{N_p})$，选择 $s_u=1/\\lVert \\mathbf{r}_u^{(0)}\\rVert_2$ 和 $s_p=1/\\lVert \\mathbf{r}_p^{(0)}\\rVert_2$，使得初始分块贡献相当。施加绝对和相对残差检验 $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{abs}}$ 和 $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2/\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(0)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{rel}}$。对于步长，通过 $\\mathbf{S}_x=\\mathrm{diag}(1/U_{\\mathrm{ref}}\\,\\mathbf{I}_{N_u},\\,1/P_{\\mathrm{ref}}\\,\\mathbf{I}_{N_p})$ 定义一个缩放后的步长范数，使得 $\\lVert \\mathbf{S}_x\\,\\Delta \\mathbf{x}^{(k)}\\rVert_2$ 测量 $\\mathbf{u}$ 和 $p$ 的无量纲增量。施加 $\\lVert \\mathbf{S}_x\\,\\Delta \\mathbf{x}^{(k)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{abs}}$ 和 $\\lVert \\mathbf{S}_x\\,\\Delta \\mathbf{x}^{(k)}\\rVert_2/\\lVert \\mathbf{S}_x\\,\\mathbf{x}^{(k)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{rel}}$。此方法通过构造在 $k=0$ 时平衡了耦合残差，并相对于有物理意义的 $\\mathbf{u}$ 和 $p$ 的尺度来测量步长。\n\nB. 使用未缩放的残差范数 $\\lVert \\mathbf{r}^{(k)}\\rVert_2$ 和一个以力为单位的单一绝对容差 $\\lVert \\mathbf{r}^{(k)}\\rVert_2\\le \\varepsilon_r$，以及一个未缩放的步长范数 $\\lVert \\Delta \\mathbf{x}^{(k)}\\rVert_2\\le \\varepsilon_x$，同时进行相对步长检验 $\\lVert \\Delta \\mathbf{x}^{(k)}\\rVert_2/\\lVert \\mathbf{x}^{(0)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{rel}}$。不需要单独的缩放，因为 2-范数能统一地聚合所有分量。\n\nC. 对残差和步长使用基于变量量级的单一缩放：$\\mathbf{S}=\\mathrm{diag}(1/U_{\\mathrm{ref}}\\,\\mathbf{I}_{N_u},\\,1/P_{\\mathrm{ref}}\\,\\mathbf{I}_{N_p})$，并检验 $\\lVert \\mathbf{S}\\,\\mathbf{r}^{(k)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{abs}}$、$\\lVert \\mathbf{S}\\,\\mathbf{r}^{(k)}\\rVert_2/\\lVert \\mathbf{S}\\,\\mathbf{x}^{(0)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{rel}}$ 和 $\\lVert \\mathbf{S}\\,\\Delta \\mathbf{x}^{(k)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{abs}}$。这确保了使用相同的参考尺度对残差和步长进行无量纲化处理。\n\nD. 将残差的每个分块除以其未知数数量的平方根，以均衡每个自由度的贡献：$\\mathbf{S}_r=\\mathrm{diag}(1/\\sqrt{N_u}\\,\\mathbf{I}_{N_u},\\,1/\\sqrt{N_p}\\,\\mathbf{I}_{N_p})$，并且只检验相对减小量 $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2/\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k-1)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{rel}}$ 和 $\\lVert \\Delta \\mathbf{x}^{(k)}\\rVert_2/\\lVert \\Delta \\mathbf{x}^{(k-1)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{rel}}$，不设绝对准则。这通过在自由度上取平均来防止单位不一致，并避免当 $\\lVert \\mathbf{x}^{(k)}\\rVert_2$ 很小时出现问题。", "solution": "用户要求对一个关于计算孔隙力学中非线性求解器终止准则的问题进行批判性评估，并对所提供的选项进行详细分析。\n\n**问题验证**\n\n**步骤 1：提取已知条件**\n- **模型：** 一个饱和土工材料的准静态双场孔隙力学模型。\n- **离散化：** 有限元法。\n- **系统：** 一个关于节点位移向量 $\\mathbf{u}\\in\\mathbb{R}^{N_u}$ 和节点孔隙压力向量 $\\mathbf{p}\\in\\mathbb{R}^{N_p}$ 的非线性代数系统。\n- **状态向量：** $\\mathbf{x}=\\begin{bmatrix}\\mathbf{u}\\\\ \\mathbf{p}\\end{bmatrix}$。\n- **残差向量：** $\\mathbf{r}(\\mathbf{x})=\\begin{bmatrix}\\mathbf{r}_u(\\mathbf{u},\\mathbf{p})\\\\ \\mathbf{r}_p(\\mathbf{u},\\mathbf{p})\\end{bmatrix}$。\n- **残差物理意义：** $\\mathbf{r}_u$ 强制动量平衡（单位为力）；$\\mathbf{r}_p$ 强制流体质量守恒（单位为质量或体积速率）。\n- **求解方法：** Newton–Raphson 迭代：$\\mathbf{J}(\\mathbf{x}^{(k)})\\,\\Delta \\mathbf{x}^{(k)}=-\\mathbf{r}(\\mathbf{x}^{(k)})$。\n- **解更新：** $\\mathbf{x}^{(k+1)}=\\mathbf{x}^{(k)}+\\Delta \\mathbf{x}^{(k)}$。\n- **初始残差分块范数：** 在迭代 $k=0$ 时，$\\lVert \\mathbf{r}_u^{(0)}\\rVert_2=5\\times 10^{4}$（力单位）和 $\\lVert \\mathbf{r}_p^{(0)}\\rVert_2=2\\times 10^{-2}$（质量/体积速率单位）。\n- **特征量级：** $U_{\\mathrm{ref}}=10^{-3}$（米），$P_{\\mathrm{ref}}=10^{6}$（帕斯卡）。\n- **任务：** 规定残差和步长范数的绝对和相对终止准则，并论证一种缩放策略，以平衡位移和压力场贡献的差异。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学基础：** 该问题牢固地植根于计算力学的既定领域，特别是关于 Biot 孔隙力学理论所描述的耦合场问题的数值解。有限元法的使用、动量和质量平衡残差向量的构建，以及 Newton-Raphson 方法的应用，都是标准且被充分理解的程序。该问题在科学上是合理的。\n- **适定性：** 问题要求在几种定义收敛准则的策略中选出最佳方案。这是多物理场仿真数值分析中的一个经典且关键的课题。基于量纲分析和数值稳定性的原则，存在一个明确、合理的解。该问题是适定的。\n- **客观性：** 问题陈述使用精确、客观、技术性的语言表达。所提供的数值和物理量是清晰的，并用于凸显尺度分离的核心问题。该问题是客观的。\n\n**步骤 3：结论和行动**\n问题陈述是有效的。它提出了计算科学与工程中的一个标准的、不平凡的挑战，并且有公认的最佳实践来解决它。因此，我将进行全面的推导和分析。\n\n**基于原理的推导**\n\n定义此耦合系统收敛性的核心挑战在于其组成场及其相应残差在物理性质和数值量级上的巨大差异。\n状态向量 $\\mathbf{x}=\\begin{bmatrix}\\mathbf{u}\\\\ \\mathbf{p}\\end{bmatrix}$ 混合了具有长度单位（米）和压力单位（帕斯卡）的分量。残差向量 $\\mathbf{r}=\\begin{bmatrix}\\mathbf{r}_u\\\\ \\mathbf{r}_p\\end{bmatrix}$ 混合了具有力单位和质量/体积速率单位的分量。\n\n一个朴素的欧几里得范数，如 $\\lVert \\mathbf{r} \\rVert_2 = \\sqrt{\\lVert \\mathbf{r}_u \\rVert_2^2 + \\lVert \\mathbf{r}_p \\rVert_2^2}$，是量纲不一致的。这无异于将具有不同单位的量（例如，牛顿和千克/秒）相加，这在物理上是无意义的。在数值上，这样的范数将完全由具有较大量级的分块所主导。在这种情况下，由于 $\\lVert \\mathbf{r}_u^{(0)}\\rVert_2^2 \\approx (5\\times 10^4)^2 = 2.5 \\times 10^9$ 且 $\\lVert \\mathbf{r}_p^{(0)}\\rVert_2^2 \\approx (2\\times 10^{-2})^2 = 4 \\times 10^{-4}$，压力残差 $\\mathbf{r}_p$ 对未缩放范数的贡献可以忽略不计。迭代过程的收敛将似乎仅取决于力学残差 $\\mathbf{r}_u$ 的减小，可能导致流体质量守恒方程未得到良好满足。\n\n一个稳健的收敛准则必须基于量级可比的无量纲量。这通过缩放来实现。\n\n**1. 残差缩放与准则：**\n目标是定义一个缩放后的残差范数 $\\lVert \\mathbf{S}_r \\mathbf{r} \\rVert_2$，其中来自 $\\mathbf{r}_u$ 和 $\\mathbf{r}_p$ 的贡献是平衡的。对角缩放矩阵 $\\mathbf{S}_r=\\mathrm{diag}(s_u\\,\\mathbf{I}_{N_u},\\,s_p\\,\\mathbf{I}_{N_p})$ 是合适的。一个出色且常见的策略是用其初始值对每个残差分块进行归一化。我们选择缩放因子 $s_u = 1/\\lVert\\mathbf{r}_u^{(0)}\\rVert_2$ 和 $s_p = 1/\\lVert\\mathbf{r}_p^{(0)}\\rVert_2$。\n在第 $k$ 次迭代时的缩放残差为 $\\mathbf{S}_r \\mathbf{r}^{(k)} = \\begin{bmatrix} \\mathbf{r}_u^{(k)}/\\lVert\\mathbf{r}_u^{(0)}\\rVert_2 \\\\ \\mathbf{r}_p^{(k)}/\\lVert\\mathbf{r}_p^{(0)}\\rVert_2 \\end{bmatrix}$。此向量是无量纲的。\n在第一次迭代时（$k=0$），范数的平方为：\n$$ \\lVert \\mathbf{S}_r \\mathbf{r}^{(0)} \\rVert_2^2 = \\left\\lVert \\frac{\\mathbf{r}_u^{(0)}}{\\lVert\\mathbf{r}_u^{(0)}\\rVert_2} \\right\\rVert_2^2 + \\left\\lVert \\frac{\\mathbf{r}_p^{(0)}}{\\lVert\\mathbf{r}_p^{(0)}\\rVert_2} \\right\\rVert_2^2 = 1 + 1 = 2 $$\n这种构造确保了在非线性求解开始时，力学残差和流体流动残差对总缩放残差范数的贡献是相等的。\n有了这个稳健的缩放范数，我们可以定义标准的终止准则：\n- **绝对残差检验：** $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2 \\le \\varepsilon_r^{\\mathrm{abs}}$。当组合的无量纲残差足够小时，停止迭代。\n- **相对残差检验：** $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2 / \\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(0)}\\rVert_2 \\le \\varepsilon_r^{\\mathrm{rel}}$。当残差相对于其初始值减小了足够倍数时，停止迭代。\n\n**2. 步长（解更新）缩放与准则：**\n与残差类似，更新向量 $\\Delta \\mathbf{x}^{(k)} = \\begin{bmatrix} \\Delta \\mathbf{u}^{(k)} \\\\ \\Delta \\mathbf{p}^{(k)} \\end{bmatrix}$ 是量纲不均匀的。需要一个缩放范数。对于解变量，通过特征值或参考值进行缩放具有物理意义。问题提供了这些值：位移的 $U_{\\mathrm{ref}}$ 和压力的 $P_{\\mathrm{ref}}$。\n我们定义一个缩放矩阵 $\\mathbf{S}_x = \\mathrm{diag}((1/U_{\\mathrm{ref}})\\mathbf{I}_{N_u}, (1/P_{\\mathrm{ref}})\\mathbf{I}_{N_p})$。\n缩放后的步长向量为 $\\mathbf{S}_x \\Delta \\mathbf{x}^{(k)} = \\begin{bmatrix} \\Delta \\mathbf{u}^{(k)}/U_{\\mathrm{ref}} \\\\ \\Delta \\mathbf{p}^{(k)}/P_{\\mathrm{ref}} \\end{bmatrix}$。此向量是无量纲的。其分量表示相应变量更新量占其特征量级的比例。\n适当的终止准则是：\n- **绝对步长检验：** $\\lVert \\mathbf{S}_x\\,\\Delta \\mathbf{x}^{(k)}\\rVert_2 \\le \\varepsilon_x^{\\mathrm{abs}}$。当无量纲更新量小到可以忽略时，停止迭代。\n- **相对步长检验：** $\\lVert \\mathbf{S}_x\\,\\Delta \\mathbf{x}^{(k)}\\rVert_2 / \\lVert \\mathbf{S}_x\\,\\mathbf{x}^{(k)}\\rVert_2 \\le \\varepsilon_x^{\\mathrm{rel}}$。当更新量相对于解的当前量级很小时，停止迭代。这可以防止在 $\\mathbf{x}^{(k)}$ 很大时过早终止，并防止在 $\\mathbf{x}^{(k)}$ 接近零时进行过多迭代。\n\n这种组合策略为评估收敛性提供了一个量纲一致、物理解释清晰且数值稳健的框架。\n\n**逐项分析**\n\n**A. 定义一个缩放后的残差范数 $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2$，其中 $\\mathbf{S}_r=\\mathrm{diag}(s_u\\,\\mathbf{I}_{N_u},\\,s_p\\,\\mathbf{I}_{N_p})$，选择 $s_u=1/\\lVert \\mathbf{r}_u^{(0)}\\rVert_2$ 和 $s_p=1/\\lVert \\mathbf{r}_p^{(0)}\\rVert_2$，使得初始分块贡献相当…… [等]**\n这个选项与推导出的最佳实践策略完全匹配。\n- **残差缩放：** 它正确地使用残差分块的初始范数作为缩放因子。如推导所述，这公平地平衡了不同物理场的贡献。\n- **残差检验：** 它基于正确缩放的残差范数，提出了标准且正确的绝对和相对检验。\n- **步长缩放：** 它正确地使用提供的物理参考值 $U_{\\mathrm{ref}}$ 和 $P_{\\mathrm{ref}}$ 来创建一个无量纲的步长向量。\n- **步长检验：** 它为缩放后的步长提出了标准且正确的绝对和相对检验，其中相对检验正确地使用当前解向量 $\\mathbf{x}^{(k)}$ 的缩放范数作为分母。\n- **论证：** 选项中提供的论证清晰且准确。\n**结论：** **正确**。\n\n**B. 使用未缩放的残差范数 $\\lVert \\mathbf{r}^{(k)}\\rVert_2$ 和一个以力为单位的单一绝对容差 $\\lVert \\mathbf{r}^{(k)}\\rVert_2\\le \\varepsilon_r$，以及一个未缩放的步长范数 $\\lVert \\Delta \\mathbf{x}^{(k)}\\rVert_2\\le \\varepsilon_x$，同时进行相对步长检验 $\\lVert \\Delta \\mathbf{x}^{(k)}\\rVert_2/\\lVert \\mathbf{x}^{(0)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{rel}}$。不需要单独的缩放，因为 2-范数能统一地聚合所有分量。**\n这个选项存在根本性缺陷。\n- **缩放：** 它明确主张不进行缩放。如推导中所述，这会导致一个量纲不一致的范数，其中数值量级较大的分块（这里是 $\\mathbf{r}_u$）将完全主导收敛性检查。声称 2-范数“能统一地聚合所有分量”仅在数学意义上对无量纲数向量成立；对于具有不同单位和尺度的物理量向量，这是具有危险误导性的。\n- **检验：** 这些检验应用于这些不合理的范数。相对步长检验的分母 $\\lVert \\mathbf{x}^{(0)}\\rVert_2$ 也是量纲不一致的。\n**结论：** **不正确**。\n\n**C. 对残差和步长使用基于变量量级的单一缩放：$\\mathbf{S}=\\mathrm{diag}(1/U_{\\mathrm{ref}}\\,\\mathbf{I}_{N_u},\\,1/P_{\\mathrm{ref}}\\,\\mathbf{I}_{N_p})$，并检验 $\\lVert \\mathbf{S}\\,\\mathbf{r}^{(k)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{abs}}$、$\\lVert \\mathbf{S}\\,\\mathbf{r}^{(k)}\\rVert_2/\\lVert \\mathbf{S}\\,\\mathbf{x}^{(0)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{rel}}$ 和 $\\lVert \\mathbf{S}\\,\\Delta \\mathbf{x}^{(k)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{abs}}$。这确保了使用相同的参考尺度对残差和步长进行无量纲化处理。**\n这个选项混淆了变量的缩放和残差的缩放。\n- **缩放：** 虽然用 $\\mathbf{S}$ 缩放步长 $\\Delta \\mathbf{x}$ 是正确的，但用同一个矩阵 $\\mathbf{S}$ 缩放残差 $\\mathbf{r}$ 是不正确的。$\\mathbf{S} \\mathbf{r}$ 的分量将具有 $(\\text{力})/(\\text{长度})$ 和 $(\\text{质量速率})/(\\text{压力})$ 的单位。这些既不是无量纲的，也不能直接比较。使残差无量纲化且数量级为一的目标没有实现。\n- **检验：** 相对残差检验 $\\lVert \\mathbf{S}\\,\\mathbf{r}^{(k)}\\rVert_2/\\lVert \\mathbf{S}\\,\\mathbf{x}^{(0)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{rel}}$ 是无意义的，因为它将一个缩放残差的范数与一个缩放初始状态向量的范数进行比较。这些在物理上和数值上都是不相关的量。\n**结论：** **不正确**。\n\n**D. 将残差的每个分块除以其未知数数量的平方根，以均衡每个自由度的贡献：$\\mathbf{S}_r=\\mathrm{diag}(1/\\sqrt{N_u}\\,\\mathbf{I}_{N_u},\\,1/\\sqrt{N_p}\\,\\mathbf{I}_{N_p})$，并且只检验相对减小量 $\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k)}\\rVert_2/\\lVert \\mathbf{S}_r\\,\\mathbf{r}^{(k-1)}\\rVert_2\\le \\varepsilon_r^{\\mathrm{rel}}$ 和 $\\lVert \\Delta \\mathbf{x}^{(k)}\\rVert_2/\\lVert \\Delta \\mathbf{x}^{(k-1)}\\rVert_2\\le \\varepsilon_x^{\\mathrm{rel}}$，不设绝对准则。这通过在自由度上取平均来防止单位不一致，并避免当 $\\lVert \\mathbf{x}^{(k)}\\rVert_2$ 很小时出现问题。**\n这个选项提出了一个不同的、不充分的缩放策略和一套不完整的检验标准。\n- **缩放：** 通过 $1/\\sqrt{N_{dof}}$ 进行缩放是一种均方根归一化的形式。虽然有时有用，但它完全没有解决不同物理单位和 $\\lVert \\mathbf{r}_u^{(0)}\\rVert_2$ 与 $\\lVert \\mathbf{r}_p^{(0)}\\rVert_2$ 之间 6 个数量级差异的根本问题。力学残差仍然会完全主导收敛准则。\n- **检验：** 这个选项建议仅通过比较迭代 $k$ 的范数与迭代 $k-1$ 的范数来检验收敛速率。这是不够的。一个求解器可能收敛速度很快，但却收敛到错误的解。没有绝对或相对于初始值的检验，就无法保证最终残差确实很小。省略绝对准则是很差的做法。\n**结论：** **不正确**。", "answer": "$$\\boxed{A}$$", "id": "3561414"}, {"introduction": "除了标准的整体式牛顿求解器外，分裂法为求解非线性系统提供了另一条路径，尤其是在与序列加速技术结合时，这种方法可能更加稳健或高效。本练习将引导您探索一种基于“固定应力分裂”思想的块高斯-赛德尔（Block Gauss-Seidel）格式，并应用安德森加速（Anderson acceleration）这一强大的定点迭代加速技术。通过亲手实现并对比这种高级求解策略与标准牛顿法的性能 [@problem_id:3561443]，您将获得宝贵的实践经验，并学会如何通过数值实验来评估不同求解方案的性能边界。", "problem": "考虑 Biot 孔隙弹性理论下流固耦合中单个代表性控制体积的准静态固结。在一个新时间步结束时，未知量为孔隙流体压力 $p^{n+1}$ 和体积应变 $e^{n+1}$。该耦合由以下两个代数关系建模，这两个关系源于准静态动量平衡和全隐式质量平衡，并针对零维（无空间通量）控制体积进行了特化：\n\n1. 动量平衡，其中排水体积模量 $K0$ 且 Biot 系数 $\\alpha \\in (0,1]$：\n$$\nK\\,e^{n+1} - \\alpha\\,p^{n+1} = s_m,\n$$\n其中 $s_m$ 是一个指定的体积源，代表外部机械荷载的影响。\n\n2. 质量平衡，其中包含非线性储水项 $S(p)$：\n$$\n\\alpha\\,e^{n+1} + S\\!\\left(p^{n+1}\\right) = \\alpha\\,e^{n} + S\\!\\left(p^{n}\\right) + \\Delta t\\,s_f,\n$$\n其中 $s_f$ 是单位时间指定的流体源项，$\\Delta t  0$ 是时间步长。前一时间步的值 $e^{n}$ 和 $p^{n}$ 是已知的。非线性储水项取为三次多项式\n$$\nS(p) = c_0\\,p + c_1\\,p^2 + c_2\\,p^3,\n$$\n其中 $c_00$，$c_1 \\ge 0$，$c_2 \\ge 0$ 确保了储水关系的单调性和物理一致性。\n\n您的任务是在每个时间步，使用两种非线性策略求解未知量对 $\\left(e^{n+1}, p^{n+1}\\right)$，并比较当时间步长 $\\Delta t$ 变化时它们的非线性迭代性能：\n\nA. 应用于耦合系统的整体式 Newton–Raphson 方法\n$$\nF_1(e,p) = K e - \\alpha p - s_m = 0,\\quad\nF_2(e,p) = \\alpha e + S(p) - \\left(\\alpha e^{n} + S(p^{n}) + \\Delta t\\,s_f\\right) = 0,\n$$\n从初始猜测值 $e^{0} = e^{n}$ 和 $p^{0} = p^{n}$ 开始，停止准则为残差向量 $\\left(F_1, F_2\\right)$ 的欧几里得范数小于容差 $\\varepsilon$。\n\nB. 使用固定应力分裂的块 Gauss–Seidel Picard 迭代，在该方法中，您按如下方式顺序更新 $e$ 和 $p$：\n- 给定当前的 $p^{k}$，根据动量平衡更新 $e^{k+1}$，\n$$\ne^{k+1} = \\frac{s_m + \\alpha\\,p^{k}}{K}.\n$$\n- 通过对 $S(p)$ 在 $p^{k}$ 周围进行 Picard 线性化，从质量平衡中更新 $p^{k+1}$，\n$$\nS(p^{k+1}) \\approx \\left(c_0 + c_1\\,p^{k} + c_2\\,(p^{k})^2\\right)\\,p^{k+1},\n$$\n这会产生以下显式映射\n$$\np^{k+1} = \\frac{\\alpha e^{n} + S(p^{n}) + \\Delta t\\,s_f - \\alpha\\,e^{k+1}}{c_0 + c_1\\,p^{k} + c_2\\,(p^{k})^2}.\n$$\n在标量不动点映射 $p^{k+1} = G(p^{k})$ 上嵌入深度为二的 Anderson 加速，以获得加速迭代值，\n$$\np^{k+1}_{\\text{AA}} = \\theta\\,G\\!\\left(p^{k-1}\\right) + (1-\\theta)\\,G\\!\\left(p^k\\right),\\quad\n\\theta = \\frac{G(p^{k}) - p^{k}}{G(p^{k}) - p^{k} - \\left(G(p^{k-1}) - p^{k-1}\\right)},\n$$\n当分母非零时使用该公式；否则，使用 $p^{k+1} = G(p^{k})$。在形成 $p^{k+1}_{\\text{AA}}$ 后，使用 $p^{k+1}_{\\text{AA}}$ 从动量平衡中更新 $e^{k+1}$。使用与整体式 Newton–Raphson 方法中相同的基于残差范数的停止准则。\n\n从计算岩土力学的角度来看，固定应力分裂是一种源于 Biot 方程结构的稳定化技术，其中力学子问题在应力保持固定的情况下求解，同时迭代更新流动子问题。Anderson 加速是一种非线性序列加速方法，它通过混合过去的不动点迭代值来改善收敛性。\n\n您的任务是实现这两种非线性求解器，并针对下面的每个参数集，经验性地确定一个最小时间步长 $\\Delta t$（以秒为单位），在此时间步长下，带 Anderson 加速的块 Gauss–Seidel Picard 迭代达到容差所需的非线性迭代次数严格少于整体式 Newton–Raphson 方法。如果整体式 Newton–Raphson 方法因雅可比矩阵奇异或在规定的最大迭代次数内不收敛，而带 Anderson 加速的块 Gauss–Seidel Picard 迭代确实收敛，则阈值定义为所提供集合中出现这种情况的最小 $\\Delta t$。如果在提供的集合中不存在这样的 $\\Delta t$，则报告值 $-1.0$。\n\n在所有测试中使用以下固定的上一步状态和容差：\n- 上一步状态：$e^{n} = 0$ (无量纲体积应变)，$p^{n} = 0$ (单位：帕斯卡)。\n- 容差：$\\varepsilon = 10^{-10}$。\n- 每个求解器的最大非线性迭代次数：$N_{\\max} = 200$。\n\n测试套件：\n对于每种情况，使用以下候选时间步长列表 $\\Delta t$（单位：秒）：$\\left[0.1,\\,0.3,\\,1.0,\\,3.0,\\,10.0,\\,30.0,\\,50.0\\right]$。\n\n- 情况1（一般耦合，中等非线性）：\n  - $K = 1.0$, $\\alpha = 0.8$, $c_0 = 0.6$, $c_1 = 0.25$, $c_2 = 0.10$, $s_m = 0.0$, $s_f = 1.0$.\n- 情况2（整体式系统中接近雅可比矩阵奇异）：\n  - $K = 1.0$, $\\alpha = 1.0$, $c_0 = 1.0$, $c_1 = 0.0$, $c_2 = 0.0$, $s_m = 0.0$, $s_f = 1.0$.\n- 情况3（强非线性在较大压力下占主导地位）：\n  - $K = 2.0$, $\\alpha = 0.6$, $c_0 = 0.2$, $c_1 = 0.6$, $c_2 = 0.5$, $s_m = 0.0$, $s_f = 0.5$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个情况的结果，格式为方括号内以逗号分隔的浮点数列表，每个数字是按上述顺序列出的一个情况所确定的阈值时间步长（以秒为单位）（例如，\"[dt_case1,dt_case2,dt_case3]\"）。每个条目必须是单个浮点数（单位：秒）。如果在提供的时间步长集合中未找到阈值，则为该情况输出“-1.0”。\n\n所有角度（如有）必须以弧度表示。所有时间步长必须以秒表示。所有百分比（如有）必须以小数表示。", "solution": "该问题被评估为有效。它在科学上基于已建立的 Biot 孔隙弹性理论，数学上是适定的，并且所有参数、初始条件和算法过程都得到了明确的规定。该问题要求进行一个数值实验，比较两种标准的非线性求解方案：整体式 Newton-Raphson 方法和一种通过 Anderson 加速增强的分裂法。这在计算力学中是一个合理的研究课题。\n\n该物理模型描述了准静态条件下代表性控制体积中体积应变 $e$ 和孔隙流体压力 $p$ 的耦合演化。新时间步的未知量 $e^{n+1}$ 和 $p^{n+1}$ 的控制方程构成一个包含两个非线性代数方程的方程组。为简单起见，我们将未知量表示为 $(e, p)$。\n\n第一个方程源于动量平衡，是线性的：\n$$\nF_1(e, p) = K e - \\alpha p - s_m = 0\n$$\n这里，$K$ 是排水体积模量，$\\alpha$ 是 Biot 系数，$s_m$ 是一个力学源项。\n\n第二个方程源于全隐式质量平衡，包含非线性项：\n$$\nF_2(e, p) = \\alpha e + S(p) - C = 0\n$$\n其中 $C = \\alpha e^n + S(p^n) + \\Delta t s_f$ 是该时间步内的一个常数，由前一时间步的已知值 $(e^n, p^n)$、时间步长 $\\Delta t$ 和流体源项 $s_f$ 组成。非线性储水函数为三次多项式 $S(p) = c_0 p + c_1 p^2 + c_2 p^3$。鉴于 $e^n=0$ 且 $p^n=0$，我们有 $S(p^n)=0$，因此常数简化为 $C = \\Delta t s_f$。\n\n任务是使用两种方法求解系统 $\\mathbf{F}(e,p) = [F_1, F_2]^T = \\mathbf{0}$，并通过计算达到残差范数 $\\|\\mathbf{F}\\|  \\varepsilon = 10^{-10}$ 所需的迭代次数来比较它们的性能。\n\n**方法 A：整体式 Newton-Raphson**\n该方法同时求解两个未知量。从初始猜测值 $\\mathbf{x}_k = [e_k, p_k]^T$ 开始，通过求解以下线性系统来找到下一个迭代值 $\\mathbf{x}_{k+1}$：\n$$\nJ(\\mathbf{x}_k) (\\mathbf{x}_{k+1} - \\mathbf{x}_k) = -\\mathbf{F}(\\mathbf{x}_k)\n$$\n其中 $J$ 是系统 $\\mathbf{F}$ 的雅可比矩阵。雅可比矩阵的分量是 $F_1$ 和 $F_2$ 关于 $e$ 和 $p$ 的偏导数：\n$$\nJ(e,p) = \\begin{pmatrix} \\frac{\\partial F_1}{\\partial e}  \\frac{\\partial F_1}{\\partial p} \\\\ \\frac{\\partial F_2}{\\partial e}  \\frac{\\partial F_2}{\\partial p} \\end{pmatrix} = \\begin{pmatrix} K  -\\alpha \\\\ \\alpha  S'(p) \\end{pmatrix}\n$$\n其中 $S'(p) = \\frac{dS}{dp} = c_0 + 2c_1p + 3c_2p^2$。迭代从前一时间步的值 $\\mathbf{x}_0 = [e^n, p^n]^T = [0, 0]^T$ 开始，并持续进行，直到残差向量 $\\mathbf{F}(\\mathbf{x}_k)$ 的欧几里得范数低于容差 $\\varepsilon$。一个潜在的失效模式是雅可比矩阵的奇异性，即其行列式 $\\det(J) = K S'(p) + \\alpha^2$ 趋近于零时。\n\n**方法 B：带 Anderson 加速的块 Gauss-Seidel Picard 迭代**\n这种方法是一种分裂法，其中系统按顺序求解 $e$ 和 $p$。具体方案是“固定应力分裂”。由 $k$ 索引的迭代过程如下：\n1.  从动量平衡方程中，将 $e$ 表示为当前压力迭代值 $p_k$ 的函数：\n    $$\n    e_{k+1} = \\frac{s_m + \\alpha p_k}{K}\n    $$\n2.  将 $e_{k+1}$ 的表达式代入质量平衡方程的线性化形式中，以求解 $p_{k+1}$。问题指定了对 $S(p)$ 的 Picard 线性化，其中 $S(p_{k+1})$ 近似为 $(c_0 + c_1 p_k + c_2 p_k^2)p_{k+1}$。这导出了一个不动点映射 $p_{k+1} = G(p_k)$：\n    $$\n    G(p_k) = \\frac{\\alpha e^n + S(p^n) + \\Delta t s_f - \\alpha \\left(\\frac{s_m + \\alpha p_k}{K}\\right)}{c_0 + c_1 p_k + c_2 (p_k)^2}\n    $$\n    简单的 Picard 迭代 $p_{k+1} = G(p_k)$ 可能收敛缓慢或发散。为提高性能，应用了深度为二的 Anderson 加速。该方法混合当前和之前的不动点函数求值，以生成一个改进的后续迭代值。给定迭代值 $p_k$ 和 $p_{k-1}$，以及它们对应的函数求值 $g_k = G(p_k)$ 和 $g_{k-1} = G(p_{k-1})$，加速更新公式为：\n    $$\n    p_{k+1} = \\theta g_{k-1} + (1-\\theta) g_k, \\quad \\text{where} \\quad \\theta = \\frac{g_k - p_k}{(g_k - p_k) - (g_{k-1} - p_{k-1})}\n    $$\n    此加速应用于 $k \\ge 1$ 的情况。对于第一次迭代（$k=0$），使用标准的 Picard 步 $p_1 = G(p_0)$。在计算出每个新的压力迭代值 $p_{k+1}$ 后，使用动量平衡方程重新计算相应的应变 $e_{k+1}$ 以保持一致性。停止准则与 Newton-Raphson 方法相同，基于完整残差向量 $\\mathbf{F}(e_{k+1}, p_{k+1})$ 的范数。\n\n**计算任务**\n目标是实现这两种求解器，并为三个不同的参数集，从给定列表中找到最小的时间步长 $\\Delta t$，使得 Anderson 加速求解器（方法 B）收敛所需的迭代次数严格少于 Newton-Raphson 求解器（方法 A）。如果方法 A 未能收敛而方法 B 成功收敛，则该 $\\Delta t$ 也满足条件。如果在提供的列表中找不到这样的 $\\Delta t$，则结果为 $-1.0$。通过对每个 $\\Delta t$ 运行两种求解器并比较最终的迭代次数来进行比较。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Global constants and previous step state\nE_N = 0.0\nP_N = 0.0\nTOL = 1e-10\nMAX_ITER = 200\n\ndef get_S(p, c0, c1, c2):\n    \"\"\"Computes the nonlinear storage term S(p).\"\"\"\n    return c0 * p + c1 * p**2 + c2 * p**3\n\ndef get_dSdp(p, c0, c1, c2):\n    \"\"\"Computes the derivative of the storage term dS/dp.\"\"\"\n    return c0 + 2 * c1 * p + 3 * c2 * p**2\n\ndef solve_newton(params, dt):\n    \"\"\"\n    Solves the system using monolithic Newton-Raphson (Method A).\n    Returns (number of iterations, did_converge).\n    \"\"\"\n    K, alpha, c0, c1, c2, sm, sf = params\n    e_k, p_k = E_N, P_N\n    C = alpha * E_N + get_S(P_N, c0, c1, c2) + dt * sf\n\n    for i in range(MAX_ITER):\n        f1 = K * e_k - alpha * p_k - sm\n        f2 = alpha * e_k + get_S(p_k, c0, c1, c2) - C\n        residual = np.array([f1, f2])\n        \n        if np.linalg.norm(residual)  TOL:\n            return i, True\n\n        dSdp_k = get_dSdp(p_k, c0, c1, c2)\n        J = np.array([[K, -alpha], [alpha, dSdp_k]])\n        \n        if abs(np.linalg.det(J))  1e-14:\n            return i, False # Jacobian is singular\n\n        try:\n            delta_x = np.linalg.solve(J, -residual)\n        except np.linalg.LinAlgError:\n            return i, False\n\n        e_k += delta_x[0]\n        p_k += delta_x[1]\n\n    # Final check after loop\n    f1 = K * e_k - alpha * p_k - sm\n    f2 = alpha * e_k + get_S(p_k, c0, c1, c2) - C\n    if np.linalg.norm(np.array([f1, f2]))  TOL:\n        return MAX_ITER, True\n        \n    return MAX_ITER, False\n\ndef solve_aa(params, dt):\n    \"\"\"\n    Solves the system using block Gauss-Seidel with Anderson Acceleration (Method B).\n    Returns (number of iterations, did_converge).\n    \"\"\"\n    K, alpha, c0, c1, c2, sm, sf = params\n    C = alpha * E_N + get_S(P_N, c0, c1, c2) + dt * sf\n\n    def G(p_in):\n        denom_picard = c0 + c1 * p_in + c2 * p_in**2\n        if abs(denom_picard)  1e-14:\n            return np.nan\n        e_intermediate = (sm + alpha * p_in) / K\n        p_out = (C - alpha * e_intermediate) / denom_picard\n        return p_out\n\n    p_k = P_N\n    p_hist = [None, p_k]\n    g_hist = [None, None]\n\n    for k in range(MAX_ITER):\n        e_k = (sm + alpha * p_k) / K\n        f1 = K * e_k - alpha * p_k - sm\n        f2 = alpha * e_k + get_S(p_k, c0, c1, c2) - C\n        if np.linalg.norm(np.array([f1, f2]))  TOL:\n            return k, True\n\n        g_k = G(p_k)\n        if np.isnan(g_k):\n            return k, False\n\n        g_hist.append(g_k)\n        g_hist.pop(0)\n\n        if k == 0:\n            p_k_plus_1 = g_k\n        else:\n            p_k_minus_1 = p_hist[0]\n            g_k_minus_1 = g_hist[0]\n            \n            f_k = g_k - p_k\n            f_k_minus_1 = g_k_minus_1 - p_k_minus_1\n            \n            denom_aa = f_k - f_k_minus_1\n            if abs(denom_aa) > 1e-14:\n                theta = f_k / denom_aa\n                p_k_plus_1 = theta * g_k_minus_1 + (1 - theta) * g_k\n            else:\n                p_k_plus_1 = g_k\n\n        p_k = p_k_plus_1\n        p_hist.append(p_k)\n        p_hist.pop(0)\n    \n    e_k = (sm + alpha * p_k) / K\n    f1 = K * e_k - alpha * p_k - sm\n    f2 = alpha * e_k + get_S(p_k, c0, c1, c2) - C\n    if np.linalg.norm(np.array([f1, f2]))  TOL:\n        return MAX_ITER, True\n\n    return MAX_ITER, False\n\ndef solve():\n    test_cases = [\n        # Case 1: K, alpha, c0, c1, c2, sm, sf\n        (1.0, 0.8, 0.6, 0.25, 0.10, 0.0, 1.0),\n        # Case 2\n        (1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0),\n        # Case 3\n        (2.0, 0.6, 0.2, 0.6, 0.5, 0.0, 0.5),\n    ]\n\n    dt_candidates = [0.1, 0.3, 1.0, 3.0, 10.0, 30.0, 50.0]\n    results = []\n\n    for params in test_cases:\n        threshold_dt = -1.0\n        for dt in dt_candidates:\n            n_nr, conv_nr = solve_newton(params, dt)\n            n_aa, conv_aa = solve_aa(params, dt)\n            \n            condition_met = False\n            if conv_aa:\n                if not conv_nr:\n                    condition_met = True\n                elif n_aa  n_nr:\n                    condition_met = True\n\n            if condition_met:\n                threshold_dt = dt\n                break\n        \n        results.append(threshold_dt)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3561443"}]}