{"hands_on_practices": [{"introduction": "在材料软化分析中，一个核心挑战是应变局部化现象，即变形集中在极窄的区域内。经典连续介质模型在此会预测出宽度为零的剪切带，这既不符合物理实际，也导致了数值解的网格依赖性。梯度增强模型通过引入一个内在长度尺度参数 $\\ell$ 来解决此问题。本练习将引导您通过解析推导，直接揭示在相场损伤模型中，这一内在长度尺度 $\\ell$ 是如何决定物理上可观测的局部化区域宽度的，这是理解这些高级模型的基石。[@problem_id:3528898]", "problem": "考虑一根占据区间 $x \\in \\left[-\\frac{L}{2}, \\frac{L}{2}\\right]$ 的一维单轴杆，其承受小应变，并施加了端到端位移，在远场产生空间均匀的名义拉伸应变。该杆采用 Ambrosio-Tortorelli 2 型 (AT2) 相场损伤模型进行建模，其中位移场为 $u(x)$，标量损伤场为 $\\alpha(x) \\in [0,1]$，杨氏模量为 $E$，临界能量释放率为 $G_c$。假设为纯拉伸，并忽略残余刚度正则化。总能量泛函为\n$$\n\\Pi[u,\\alpha] \\;=\\; \\int_{-L/2}^{L/2} \\left[ g(\\alpha)\\,\\psi_e(\\varepsilon) \\;+\\; G_c\\left(\\frac{\\alpha^2}{2\\,\\ell} \\;+\\; \\frac{\\ell}{2}\\,(\\alpha')^2\\right) \\right] \\,\\mathrm{d}x,\n$$\n其中退化函数为 $g(\\alpha)=(1-\\alpha)^2$，弹性应变能密度为 $\\psi_e(\\varepsilon) = \\tfrac{1}{2} E\\,\\varepsilon^2$，应变为 $\\varepsilon(x)=u'(x)$，内禀长度尺度为 $\\ell>0$。假设 $L \\gg \\ell$，使得损伤区与边界充分分离，并且在峰值载荷下，损伤在 $x=0$ 附近发生局部化，而远场基本保持弹性，具有近乎均匀的拉伸应变。\n\n从最小势能原理、相关的欧拉-拉格朗日方程以及率无关损伤不可逆条件出发，在峰值载荷附近且远场峰值载荷损伤小但非零的假设下，推导出一维损伤分布 $\\alpha(x)$ 的闭合形式前导项。然后，将局部化宽度 $w$ 定义为超额损伤（损伤与其远场值之差）的半峰全宽 (FWHM)，即对于 $\\beta(x) \\equiv \\alpha(x)-\\alpha_{\\infty}$，其中 $\\alpha_{\\infty} \\equiv \\lim_{|x|\\to\\infty} \\alpha(x)$，令 $w$ 满足 $\\beta\\!\\left(\\tfrac{w}{2}\\right) = \\tfrac{1}{2}\\,\\beta(0)$。使用此定义明确表达 $w$，并讨论它如何依赖于 $\\ell$ 和 $E$。\n\n答案规格：\n- 提供 $\\alpha(x)$ 的完整推导过程以及得到 $w$ 的推理过程。\n- 以 $\\ell$ 和 $E$ 表示的闭合形式解析表达式报告最终答案。不要代入数值。不要在最终方框答案中包含单位。在解答中解释 $w$ 是否以及如何依赖于 $E$。\n- 以米为单位表示最终宽度。", "solution": "该问题要求推导由 Ambrosio-Tortorelli (AT2) 相场损伤模型描述的一维杆的损伤分布和局部化宽度。\n\n首先，我们必须验证问题陈述。\n已知条件如下：\n- 域为一维杆，$x \\in [-L/2, L/2]$。\n- 状态变量为位移场 $u(x)$ 和损伤场 $\\alpha(x) \\in [0,1]$。\n- 物理常数为杨氏模量 $E$ 和临界能量释放率 $G_c$。\n- 总能量泛函为 $\\Pi[u,\\alpha] = \\int_{-L/2}^{L/2} \\left[ g(\\alpha)\\,\\psi_e(\\varepsilon) + G_c\\left(\\frac{\\alpha^2}{2\\,\\ell} + \\frac{\\ell}{2}\\,(\\alpha')^2\\right) \\right] \\,\\mathrm{d}x$。\n- 本构函数和定义为：退化函数 $g(\\alpha)=(1-\\alpha)^2$，弹性应变能密度 $\\psi_e(\\varepsilon) = \\frac{1}{2} E\\,\\varepsilon^2$，应变 $\\varepsilon(x)=u'(x)$，以及内禀长度尺度 $\\ell>0$。\n- 假设包括 $L \\gg \\ell$，损伤在 $x=0$ 处局部化，以及“远场峰值载荷损伤小但非零”，记为 $\\alpha_{\\infty}$。\n\n该问题具有科学依据，使用了计算力学中的标准公式。它在很大程度上是适定且客观的。然而，存在一个微妙的矛盾。对于指定的 AT2 模型，峰值载荷条件（从均匀状态的分岔）发生在远场损伤值为 $\\alpha_{\\infty} = 1/4$ 时，这不是一个很小的值。因此，问题中“远场峰值载荷损伤小但非零”的假设与模型在峰值载荷下的性质直接冲突。为了继续进行，我们必须将此解释为寻找一个“前导项”解的指令，该解对应于远场小损伤的极限（$\\alpha_{\\infty} \\to 0$）。这是得出所要求的闭合形式解析解的唯一途径。在此解释下，该问题被认为是有效的。\n\n杆的平衡状态通过最小化总势能 $\\Pi[u,\\alpha]$ 来找到。与 $\\Pi$ 对 $u$ 和 $\\alpha$ 的变分相关的欧拉-拉格朗日方程提供了控制方程。泛函的被积函数是 $\\mathcal{L}(\\alpha, \\alpha', \\varepsilon) = (1-\\alpha)^2 \\frac{1}{2} E \\varepsilon^2 + G_c \\frac{\\alpha^2}{2\\ell} + G_c \\frac{\\ell}{2} (\\alpha')^2$。\n\n1.  **平衡方程 (由 $\\delta_u \\Pi$ 得出):**\n    位移场 $u(x)$ 的欧拉-拉格朗日方程为 $\\frac{d}{dx}\\left(\\frac{\\partial \\mathcal{L}}{\\partial \\varepsilon}\\right) - \\frac{\\partial \\mathcal{L}}{\\partial u} = 0$。由于 $\\mathcal{L}$ 不显式依赖于 $u$，这简化为 $\\frac{d}{dx}\\left(\\frac{\\partial \\mathcal{L}}{\\partial \\varepsilon}\\right) = 0$。\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial \\varepsilon} = (1-\\alpha)^2 E \\varepsilon = \\sigma\n    $$\n    这是应力 $\\sigma$ 的本构关系。因此，平衡方程为 $\\sigma'(x) = 0$，这意味着应力 $\\sigma$ 在整个杆中必须是均匀的。我们用 $\\sigma_0$ 表示这个常数应力。\n\n2.  **损伤演化方程 (由 $\\delta_\\alpha \\Pi$ 得出):**\n    损伤场 $\\alpha(x)$ 的欧拉-拉格朗日方程为 $\\frac{d}{dx}\\left(\\frac{\\partial \\mathcal{L}}{\\partial \\alpha'}\\right) - \\frac{\\partial \\mathcal{L}}{\\partial \\alpha} = 0$。\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial \\alpha'} = G_c \\ell \\alpha'\n    $$\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial \\alpha} = 2(1-\\alpha)(-1)\\frac{1}{2}E\\varepsilon^2 + G_c\\frac{\\alpha}{\\ell} = -(1-\\alpha)E\\varepsilon^2 + G_c\\frac{\\alpha}{\\ell}\n    $$\n    遵守不可逆条件 ($\\dot{\\alpha} \\geq 0$) 的损伤控制方程为：\n    $$\n    G_c \\ell \\alpha'' - G_c\\frac{\\alpha}{\\ell} + (1-\\alpha)E\\varepsilon^2 = 0\n    $$\n    从平衡方程，我们有 $\\varepsilon(x) = \\frac{\\sigma_0}{E(1-\\alpha(x))^2}$。将其代入损伤方程，得到关于 $\\alpha(x)$ 的非线性常微分方程 (ODE)：\n    $$\n    G_c \\ell \\alpha'' - G_c\\frac{\\alpha}{\\ell} + \\frac{\\sigma_0^2}{E(1-\\alpha)^3} = 0\n    $$\n\n3.  **方程的第一积分:**\n    这是一个自治 ODE。我们可以通过乘以 $\\alpha'$ 并对 $x$ 积分来找到第一积分。一个更直接的基于能量的论证可以得到相同的结果。第一积分是：\n    $$\n    \\frac{1}{2} G_c \\ell (\\alpha')^2 - \\frac{1}{2} G_c \\frac{\\alpha^2}{\\ell} - \\frac{\\sigma_0^2}{2E(1-\\alpha)^2} = \\text{常数}\n    $$\n    我们使用远场边界条件来评估该常数：当 $|x| \\to \\infty$ 时，$\\alpha \\to \\alpha_{\\infty}$ 且 $\\alpha' \\to 0$。\n    $$\n    \\text{常数} = -\\frac{1}{2} G_c \\frac{\\alpha_{\\infty}^2}{\\ell} - \\frac{\\sigma_0^2}{2E(1-\\alpha_{\\infty})^2}\n    $$\n    将其代回并简化，我们得到：\n    $$\n    G_c \\ell (\\alpha')^2 = G_c\\frac{\\alpha^2 - \\alpha_{\\infty}^2}{\\ell} + \\frac{\\sigma_0^2}{E}\\left(\\frac{1}{(1-\\alpha)^2} - \\frac{1}{(1-\\alpha_{\\infty})^2}\\right)\n    $$\n    在远场，损伤演化方程对均匀状态 ($\\alpha''=0$) 也必须成立，这给出了 $\\sigma_0$ 和 $\\alpha_{\\infty}$ 之间的关系：$G_c \\frac{\\alpha_{\\infty}}{\\ell} = \\frac{\\sigma_0^2}{E(1-\\alpha_{\\infty})^3}$，所以 $\\sigma_0^2 = \\frac{E G_c \\alpha_{\\infty} (1-\\alpha_{\\infty})^3}{\\ell}$。\n    将 $\\sigma_0^2$ 代入第一积分方程得到：\n    $$\n    \\ell^2 (\\alpha')^2 = (\\alpha^2 - \\alpha_{\\infty}^2) - \\alpha_{\\infty}(1-\\alpha_{\\infty})^3 \\left(\\frac{1}{(1-\\alpha)^2} - \\frac{1}{(1-\\alpha_{\\infty})^2}\\right)\n    $$\n\n4.  **损伤分布的前导项近似:**\n    为了找到前导项分布，我们分析当损伤 $\\alpha(x)$ 接近其远场值 $\\alpha_{\\infty}$ 时的行为。设 $\\alpha(x) = \\alpha_{\\infty} + \\beta(x)$，其中 $\\beta(x)$ 很小。我们将 $(\\alpha')^2$ 方程的右侧 (RHS) 按 $\\beta$ 的幂次展开。\n    设 $F(\\alpha) = \\text{RHS}$。我们对 $F(\\alpha)$ 在 $\\alpha=\\alpha_{\\infty}$ 附近进行泰勒展开：$F(\\alpha) = F(\\alpha_{\\infty}) + F'(\\alpha_{\\infty})\\beta + \\frac{1}{2}F''(\\alpha_{\\infty})\\beta^2 + O(\\beta^3)$。\n    - $F(\\alpha_{\\infty})=0$ 是由构造得出的。\n    - $F'(\\alpha) = 2\\alpha - 2\\alpha_{\\infty}(1-\\alpha_{\\infty})^3(1-\\alpha)^{-3}$。因此，$F'(\\alpha_{\\infty}) = 2\\alpha_{\\infty} - 2\\alpha_{\\infty}(1-\\alpha_{\\infty})^3(1-\\alpha_{\\infty})^{-3} = 0$。\n    - $F''(\\alpha) = 2 - 6\\alpha_{\\infty}(1-\\alpha_{\\infty})^3(1-\\alpha)^{-4}$。因此，$F''(\\alpha_{\\infty}) = 2 - 6\\alpha_{\\infty}(1-\\alpha_{\\infty})^{-1} = 2\\frac{1-4\\alpha_{\\infty}}{1-\\alpha_{\\infty}}$。\n    所以，对于小 $\\beta$，我们有 $(\\beta')^2 = \\ell^{-2} (\\frac{1}{2}F''(\\alpha_{\\infty})\\beta^2) = \\ell^{-2} \\left(\\frac{1-4\\alpha_{\\infty}}{1-\\alpha_{\\infty}}\\right)\\beta^2$。\n    ODE 是 $\\beta' = \\pm \\frac{1}{\\ell}\\sqrt{\\frac{1-4\\alpha_{\\infty}}{1-\\alpha_{\\infty}}} \\beta$。\n    如同在验证时指出的，问题陈述要求假设“远场小损伤”，我们将其解释为取极限 $\\alpha_{\\infty} \\to 0$。在此极限下，项 $\\sqrt{\\frac{1-4\\alpha_{\\infty}}{1-\\alpha_{\\infty}}} \\to 1$。\n    超额损伤 $\\beta(x)$ 的前导项方程变为：\n    $$\n    \\beta' = \\pm \\frac{1}{\\ell} \\beta\n    $$\n    当 $|x| \\to \\infty$ 时衰减到零的解是一个指数函数：\n    $$\n    \\beta(x) = \\beta(0) \\exp\\left(-\\frac{|x|}{\\ell}\\right)\n    $$\n    这里 $\\beta(0) = \\alpha(0) - \\alpha_{\\infty}$ 是杆中心处的峰值超额损伤。因此，完整的前导项损伤分布为 $\\alpha(x) = \\alpha_{\\infty} + (\\alpha(0) - \\alpha_{\\infty})\\exp(-|x|/\\ell)$。\n\n5.  **局部化宽度 $w$ 的计算:**\n    局部化宽度 $w$ 定义为超额损伤分布 $\\beta(x)$ 的半峰全宽 (FWHM)。这需要找到宽度 $w$ 使得 $\\beta(w/2) = \\frac{1}{2}\\beta(0)$。\n    $$\n    \\beta(0) \\exp\\left(-\\frac{w/2}{\\ell}\\right) = \\frac{1}{2}\\beta(0)\n    $$\n    假设非平凡的局部化（$\\beta(0) \\neq 0$），我们可以除以 $\\beta(0)$：\n    $$\n    \\exp\\left(-\\frac{w}{2\\ell}\\right) = \\frac{1}{2}\n    $$\n    对两边取自然对数：\n    $$\n    -\\frac{w}{2\\ell} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)\n    $$\n    解出 $w$，我们得到：\n    $$\n    w = 2\\ell\\ln(2)\n    $$\n    此表达式给出了用内禀长度尺度 $\\ell$ 表示的局部化宽度。按照指示，这提供了与 $\\ell$ 相同单位（例如米）的宽度 $w$。\n\n6.  **对 $\\ell$ 和 $E$ 的依赖性:**\n    推导出的局部化宽度 $w$ 与内禀长度尺度 $\\ell$ 成正比。在这个前导项近似下，它完全独立于杨氏模量 $E$。其物理原因是，局部化区域内损伤分布的形状是由局部能量存储项 $G_c \\alpha^2/(2\\ell)$ 和梯度能量项 $G_c \\ell (\\alpha')^2/2$ 之间的平衡决定的。这两项都是断裂能惩罚项的一部分，并且与材料的弹性 $E$ 无关。弹性性质通过 $E$ 影响应力 $\\sigma_0$ 的大小以及损伤值 $\\alpha_{\\infty}$ 和 $\\alpha(0)$，但在这种前导项分析中，它们不影响空间损伤变化的特征长度。", "answer": "$$\n\\boxed{2\\ell\\ln(2)}\n$$", "id": "3528898"}, {"introduction": "从解析理论过渡到计算实践是掌握梯度增强模型的关键一步。由于这些模型通常涉及高阶导数和耦合场，解析解非常有限，因此必须依赖于如有限元法（FEM）等数值方法。本练习将指导您完成为一个耦合梯度塑性问题构建有限元求解器的核心步骤，从推导变分形式（弱形式）到组装单元和全局刚度矩阵。通过这个实践，您将深刻理解基于能量泛函的公式如何自然地导出对称的切线刚度矩阵，这对于保证数值求解的稳定性和效率至关重要。[@problem_id:3528869]", "problem": "考虑一根长度为 $L$、横截面积恒为 $A$ 的直棱柱一维杆，采用小应变下的能量梯度增强塑性模型进行建模。总应变由 $\\varepsilon = u'$ 给出，其中 $u$ 是位移场，内标量场 $\\kappa$ 代表一个类等效塑性应变变量。假设单位参考长度的亥姆霍兹自由能是二次的，并由下式给出\n$$\n\\psi(u,\\kappa) = \\tfrac{1}{2} E A \\left(u' - \\kappa\\right)^2 + \\tfrac{1}{2} A H \\kappa^2 + \\tfrac{1}{2} A \\ell^2 \\left(\\kappa'\\right)^2,\n$$\n其中 $E$ 是杨氏模量，$H$ 是一个恒定的能量硬化/软化模量（在软化情况下可以为负，但 $E+H$ 需保持为正以确保内变量的稳定性），$\\ell$ 是一个材料长度尺度。忽略外部体力和面力，因此只有内能对增量势有贡献。假设准静态条件，无惯性。\n\n任务 A (推导)：从总势能的驻值条件（一阶变分为零）出发，使用伽辽金法和等阶插值，推导未知场 $u$ 和 $\\kappa$ 的耦合弱形式。$u$ 和 $\\kappa$ 均在均匀网格上使用相同的两节点单元线性拉格朗日形函数进行离散。在物理坐标 $x$ 中使用等参映射，以便对 $x$ 求导。\n\n任务 B (离散化)：根据弱形式，为长度为 $h$ 的两节点单元，同时使用线形形函数对 $u$ 和 $\\kappa$ 进行离散，写出一致的单元级切线子矩阵。清晰地标示出耦合 $u$ 和 $\\kappa$ 的块。\n\n任务 C (实现与对称性验证)：实现一个程序，该程序：\n- 使用任务 B 中的单元矩阵，为具有 $n$ 个单元的均匀网格组装全局切线矩阵。\n- 将全局自由度排序为 $[u_0, u_1, \\dots, u_n, \\kappa_0, \\kappa_1, \\dots, \\kappa_n]$。\n- 通过对称的行列消除法施加本质边界条件 $u(0)=0$，以在缩减系统上保持对称性。不对 $\\kappa$ 施加任何本质边界条件。\n- 计算一个定义为归一化弗罗贝尼乌斯范数的对称性指标\n$$\n\\eta = \\frac{\\left\\|K - K^\\top\\right\\|_F}{\\max\\left(1, \\left\\|K\\right\\|_F\\right)},\n$$\n其中 $K$ 是施加本质边界条件后的缩减全局切线矩阵，$\\|\\cdot\\|_F$ 表示弗罗贝尼乌斯范数。对称性指标 $\\eta$ 是无量纲的，对于一个精确对称的矩阵（在舍入误差内），其值为零。\n\n需使用的科学基础和建模假设：\n- 小应变运动学和应用于所述亥姆霍兹自由能的最小势能原理。\n- 在每个单元上对 $u$ 和 $\\kappa$ 均使用标准的双节点线性拉格朗日形函数。\n- 单元长度为 $h = L/n$ 的均匀网格。\n- 伽辽金有限元离散和一致线性化以形成全局切线矩阵。\n\n测试套件：\n为以下每组参数 $(L, n, E, A, H, \\ell)$ 计算对称性指标 $\\eta$：\n- 情况 1：$(1.0, 4, 30\\times 10^9, 0.01, 5\\times 10^9, 0.05)$。\n- 情况 2：$(1.0, 4, 30\\times 10^9, 0.01, 0.0, 0.05)$。\n- 情况 3：$(1.0, 4, 30\\times 10^9, 0.01, 5\\times 10^9, 0.0)$。\n- 情况 4：$(1.0, 1, 210\\times 10^9, 0.02, 10\\times 10^9, 0.1)$。\n- 情况 5：$(1.5, 3, 25\\times 10^9, 0.015, -2\\times 10^9, 0.08)$。\n\n所有量均采用国际单位制：$L$ 和 $\\ell$ 以米为单位，$E$ 和 $H$ 以帕斯卡为单位，$A$ 以平方米为单位。输出 $\\eta$ 是一个无量纲实数。您的程序必须计算与这五个情况对应的列表 $[\\eta_1, \\eta_2, \\eta_3, \\eta_4, \\eta_5]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表的结果（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是情况 $i$ 的 $\\eta$ 的浮点值。", "solution": "该问题要求推导、离散化并实现一个一维杆的梯度增强塑性模型，以验证所得到的切线刚度矩阵的对称性。解答分为三部分，遵循指定的任务。\n\n### 任务 A：耦合弱形式的推导\n\n出发点是最小势能原理，该原理指出，对于处于稳定平衡状态的系统，其总势能是驻定的。对于这个无外力的准静态问题，总势能 $\\Pi$ 是亥姆霍兹自由能密度 $\\psi$ 在杆的域上（从 $x=0$ 到 $x=L$）的积分。\n\n给定的单位参考长度的亥姆霍兹自由能为：\n$$\n\\psi(u', \\kappa, \\kappa') = \\tfrac{1}{2} E A (u' - \\kappa)^2 + \\tfrac{1}{2} A H \\kappa^2 + \\tfrac{1}{2} A \\ell^2 (\\kappa')^2\n$$\n总势能为：\n$$\n\\Pi[u, \\kappa] = \\int_0^L \\psi(u', \\kappa, \\kappa') dx = \\int_0^L \\left[ \\tfrac{1}{2} E A (u' - \\kappa)^2 + \\tfrac{1}{2} A H \\kappa^2 + \\tfrac{1}{2} A \\ell^2 (\\kappa')^2 \\right] dx\n$$\n驻值条件要求 $\\Pi$ 相对于独立场 $u$ 和 $\\kappa$ 的一阶变分对所有容许的变分 $\\delta u$ 和 $\\delta \\kappa$ 都为零。一个容许的变分是与约束运动学兼容的变分；这里，本质边界条件 $u(0)=0$ 意味着相应的变分必须满足 $\\delta u(0)=0$。\n\n一阶变分（或 Gâteaux 导数）是：\n$$\n\\delta \\Pi = \\int_0^L \\left[ \\frac{\\partial \\psi}{\\partial u'} \\delta(u') + \\frac{\\partial \\psi}{\\partial \\kappa} \\delta \\kappa + \\frac{\\partial \\psi}{\\partial \\kappa'} \\delta(\\kappa') \\right] dx = 0\n$$\n由于变分和微分是线性算子，我们有 $\\delta(u') = (\\delta u)'$ 和 $\\delta(\\kappa') = (\\delta \\kappa)'$。$\\psi$ 的偏导数为：\n$$\n\\frac{\\partial \\psi}{\\partial u'} = E A (u' - \\kappa)\n$$\n$$\n\\frac{\\partial \\psi}{\\partial \\kappa} = -E A (u' - \\kappa) + A H \\kappa\n$$\n$$\n\\frac{\\partial \\psi}{\\partial \\kappa'} = A \\ell^2 \\kappa'\n$$\n将这些代入变分表达式中，得到：\n$$\n\\delta \\Pi = \\int_0^L \\left[ E A (u' - \\kappa) (\\delta u)' + (-E A (u' - \\kappa) + A H \\kappa) \\delta \\kappa + (A \\ell^2 \\kappa') (\\delta \\kappa)' \\right] dx = 0\n$$\n在伽辽金方法中，变分 $\\delta u$ 和 $\\delta \\kappa$ 被替换为来自与 $u$ 和 $\\kappa$ 相同函数空间的任意权函数 $w_u$ 和 $w_\\kappa$。由于此方程必须对 $w_u$ 和 $w_\\kappa$ 的任何选择都成立，我们可以将其分离为两个独立的方程。这构成了问题的耦合弱形式。\n\n第一个方程，控制力学平衡（与 $u$ 相关）：\n$$\nG_u(u, \\kappa; w_u) = \\int_0^L E A (u' - \\kappa) w_u' \\,dx = 0 \\quad \\forall w_u \\text{ with } w_u(0)=0\n$$\n第二个方程，控制内变量的演化（与 $\\kappa$ 相关）：\n$$\nG_\\kappa(u, \\kappa; w_\\kappa) = \\int_0^L \\left[ -E A (u' - \\kappa) w_\\kappa + A H \\kappa w_\\kappa + A \\ell^2 \\kappa' w_\\kappa' \\right] dx = 0 \\quad \\forall w_\\kappa\n$$\n这两个积分方程构成了耦合弱形式。它们必须同时求解以获得位移场 $u(x)$ 和内变量场 $\\kappa(x)$。\n\n### 任务 B：单元级切线子矩阵\n\n为了数值求解弱形式，我们采用有限元法。我们将域 $L$ 离散为 $n$ 个双节点线性单元，每个单元长度为 $h = L/n$。在每个单元内，未知场 $u$ 和 $\\kappa$ 使用线性拉格朗日形函数 $\\mathbf{N} = [N_1, N_2]$ 进行近似：\n$$\nu^h(x) = \\mathbf{N}(x) \\mathbf{u}_e, \\quad \\kappa^h(x) = \\mathbf{N}(x) \\boldsymbol{\\kappa}_e\n$$\n其中 $\\mathbf{u}_e = [u_1, u_2]^\\top$ 和 $\\boldsymbol{\\kappa}_e = [\\kappa_1, \\kappa_2]^\\top$ 是单元的节点值。导数近似为：\n$$\n(u^h)'(x) = \\mathbf{B}(x) \\mathbf{u}_e, \\quad (\\kappa^h)'(x) = \\mathbf{B}(x) \\boldsymbol{\\kappa}_e\n$$\n其中 $\\mathbf{B} = d\\mathbf{N}/dx$。对于长度为 $h$ 的线性单元，形函数导数是常数：$\\mathbf{B} = [-1/h, 1/h]$。测试函数也以相同方式离散。\n\n由于控制弱形式方程在 $u$ 和 $\\kappa$ 中是线性的，它们的离散化导致一个线性代数方程组 $\\mathbf{K}_{global} \\mathbf{d} = \\mathbf{f}$。矩阵 $\\mathbf{K}_{global}$ 是全局切线刚度矩阵。我们首先通过找到单元切线矩阵 $\\mathbf{K}_e$ 来推导它。切线是残差向量相对于节点自由度的导数。对于这个线性问题，这等同于将有限元近似代入弱形式底层的双线性形式中。单元切线矩阵是一个 $4 \\times 4$ 的矩阵，由四个 $2 \\times 2$ 的子矩阵组成：\n$$\n\\mathbf{K}_e = \\begin{pmatrix} \\mathbf{K}_{e,uu}  \\mathbf{K}_{e,u\\kappa} \\\\ \\mathbf{K}_{e,\\kappa u}  \\mathbf{K}_{e,\\kappa\\kappa} \\end{pmatrix}\n$$\n这些子矩阵通过将弱形式中的相应项在单元长度 $h$ 上积分得到：\n$$\n\\mathbf{K}_{e,uu} = E A \\int_0^h \\mathbf{B}^\\top \\mathbf{B} \\,dx = E A \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n$$\n\\mathbf{K}_{e,u\\kappa} = -E A \\int_0^h \\mathbf{B}^\\top \\mathbf{N} \\,dx = -E A \\begin{pmatrix} -1/2  -1/2 \\\\ 1/2  1/2 \\end{pmatrix} = E A \\begin{pmatrix} 1/2  1/2 \\\\ -1/2  -1/2 \\end{pmatrix}\n$$\n$$\n\\mathbf{K}_{e,\\kappa u} = -E A \\int_0^h \\mathbf{N}^\\top \\mathbf{B} \\,dx = -E A \\begin{pmatrix} -1/2  1/2 \\\\ -1/2  1/2 \\end{pmatrix} = E A \\begin{pmatrix} 1/2  -1/2 \\\\ 1/2  -1/2 \\end{pmatrix}\n$$\n$$\n\\mathbf{K}_{e,\\kappa\\kappa} = (E+H) A \\int_0^h \\mathbf{N}^\\top \\mathbf{N} \\,dx + A \\ell^2 \\int_0^h \\mathbf{B}^\\top \\mathbf{B} \\,dx = (E+H) A \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} + A \\ell^2 \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n积分 $\\int \\mathbf{N}^\\top\\mathbf{N}\\,dx$ 和 $\\int \\mathbf{B}^\\top\\mathbf{N}\\,dx$ 是线性有限元的标准结果。矩阵 $\\mathbf{K}_{e,u\\kappa}$ 和 $\\mathbf{K}_{e,\\kappa u}$ 是耦合块。正如从基于势的公式所预期的那样，单元切线矩阵是对称的，因为 $\\mathbf{K}_{e,\\kappa u} = \\mathbf{K}_{e,u\\kappa}^\\top$。\n\n### 任务 C：实现与对称性验证\n\n实现过程包括从单元矩阵组装全局切线矩阵，然后计算对称性指标。\n\n1.  **组装**：我们初始化一个大小为 $(2(n+1) \\times 2(n+1))$ 的全零全局切线矩阵 $\\mathbf{K}_{global}$。然后我们遍历 $n$ 个单元中的每一个。对于每个单元 $i$（连接节点 $i$ 和 $i+1$），我们计算其 $4 \\times 4$ 的单元切线矩阵 $\\mathbf{K}_e$。然后将 $\\mathbf{K}_e$ 的条目加到 $\\mathbf{K}_{global}$ 中相应的位置。局部自由度到全局自由度的映射遵循指定的排序 $[u_0, \\dots, u_n, \\kappa_0, \\dots, \\kappa_n]$。对于单元 $i$，节点自由度映射到全局索引如下：$u_i \\rightarrow i$, $u_{i+1} \\rightarrow i+1$, $\\kappa_i \\rightarrow (n+1)+i$, 和 $\\kappa_{i+1} \\rightarrow (n+1)+i+1$。这个标准的组装过程，称为直接刚度法，构建了完整的全局矩阵。\n\n2.  **边界条件**：本质边界条件 $u(0)=0$ 固定了自由度 $u_0$，它对应于我们全局系统中的索引 $0$。为了获得未知自由度的缩减系统，我们应用对称消除。这包括从全局矩阵中移除与受约束自由度对应的行和列。得到的缩减矩阵 $K$ 的大小将为 $(2n+1) \\times (2n+1)$。此操作保留了原始矩阵的对称性。\n\n3.  **对称性指标**：最后，为了数值验证缩减矩阵 $K$ 的对称性，我们计算对称性指标 $\\eta$：\n    $$\n    \\eta = \\frac{\\left\\|K - K^\\top\\right\\|_F}{\\max\\left(1, \\left\\|K\\right\\|_F\\right)}\n    $$\n    其中 $\\|\\cdot\\|_F$ 是弗罗贝尼乌斯范数。如果 $K$ 是完全对称的，则 $\\|K - K^\\top\\|_F$ 项将为零。由于有限精度的浮点运算，这个范数将是一个非常小的数，接近机器精度。通过 $\\|K\\|_F$ 进行归一化使得该指标无量纲，并且对矩阵条目的大小具有鲁棒性。对于正确实现的对称公式，所有测试用例的 $\\eta$ 都应该有效地为零。提供的程序实现了这整个过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_element_matrix(h, E, A, H, l):\n    \"\"\"\n    Computes the 4x4 element tangent matrix for a two-node element.\n\n    The local degrees of freedom are ordered as [u1, u2, k1, k2].\n    \"\"\"\n    # K_uu = E*A/h * [[1, -1], [-1, 1]]\n    k_uu = (E * A / h) * np.array([[1, -1], [-1, 1]])\n\n    # K_uk = E*A * [[1/2, 1/2], [-1/2, -1/2]]\n    k_uk = (E * A / 2.0) * np.array([[1, 1], [-1, -1]])\n\n    # K_ku = E*A * [[1/2, -1/2], [1/2, -1/2]]\n    k_ku = (E * A / 2.0) * np.array([[1, -1], [1, -1]])\n    # Note: k_ku should be the transpose of k_uk for symmetry.\n    # As a check: k_uk.T = (E*A/2) * [[1, -1], [1, -1]] == k_ku. Correct.\n\n    # K_kk = (E+H)*A*h/6 * [[2, 1], [1, 2]] + A*l^2/h * [[1, -1], [-1, 1]]\n    term1 = ((E + H) * A * h / 6.0) * np.array([[2, 1], [1, 2]])\n    term2 = (A * l**2 / h) * np.array([[1, -1], [-1, 1]])\n    k_kk = term1 + term2\n\n    # Assemble the 4x4 element matrix using blocks\n    K_e = np.block([[k_uu, k_uk], [k_ku, k_kk]])\n    \n    return K_e\n\ndef assemble_global_matrix(n, K_e):\n    \"\"\"\n    Assembles the global tangent matrix from element matrices.\n    \n    DOF ordering: [u_0, ..., u_n, k_0, ..., k_n]\n    \"\"\"\n    num_nodes = n + 1\n    total_dofs = 2 * num_nodes\n    K_global = np.zeros((total_dofs, total_dofs))\n\n    for i in range(n):\n        # Global indices for element 'i' (connecting nodes i and i+1)\n        # Local DOFs: u_i, u_{i+1}, k_i, k_{i+1}\n        # Global DOF map for the element\n        dof_map = [\n            i,          # u_i\n            i + 1,      # u_{i+1}\n            num_nodes + i,  # k_i\n            num_nodes + i + 1   # k_{i+1}\n        ]\n        \n        # Add element matrix to global matrix\n        K_global[np.ix_(dof_map, dof_map)] += K_e\n        \n    return K_global\n\ndef compute_symmetry_indicator(L, n, E, A, H, l):\n    \"\"\"\n    Computes the symmetry indicator for the given set of parameters.\n    \"\"\"\n    # 1. Calculate element properties\n    h = L / n\n    \n    # 2. Compute the element tangent matrix\n    # For cases where h or l could be zero, we need to handle division by zero.\n    # But based on test cases, this won't happen.\n    # Let's assume h > 0.\n    if h == 0:\n        return np.nan\n\n    K_e = compute_element_matrix(h, E, A, H, l)\n    \n    # 3. Assemble the global tangent matrix\n    K_global = assemble_global_matrix(n, K_e)\n    \n    # 4. Apply essential boundary condition u(0)=0 by symmetric elimination\n    # The DOF for u(0) is at index 0. We remove the first row and column.\n    K_reduced = np.delete(K_global, 0, axis=0)\n    K_reduced = np.delete(K_reduced, 0, axis=1)\n\n    # 5. Compute the symmetry indicator eta\n    K_transpose = K_reduced.T\n    diff_norm = np.linalg.norm(K_reduced - K_transpose, 'fro')\n    K_norm = np.linalg.norm(K_reduced, 'fro')\n    \n    eta = diff_norm / max(1.0, K_norm)\n    \n    return eta\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test suite: (L, n, E, A, H, l)\n    test_cases = [\n        (1.0, 4, 30e9, 0.01, 5e9, 0.05),\n        (1.0, 4, 30e9, 0.01, 0.0, 0.05),\n        (1.0, 4, 30e9, 0.01, 5e9, 0.0),\n        (1.0, 1, 210e9, 0.02, 10e9, 0.1),\n        (1.5, 3, 25e9, 0.015, -2e9, 0.08),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, n, E, A, H, l = case\n        eta = compute_symmetry_indicator(L, n, E, A, H, l)\n        results.append(eta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solver\nsolve()\n```", "id": "3528869"}, {"introduction": "在开发和应用复杂的计算模型时，代码验证是确保其正确性和可靠性的决定性步骤。本练习将介绍“制造解方法”（Method of Manufactured Solutions, MMS），这是一种强大而通用的代码验证技术。通过本练习，您将定量地比较一个经典的局部软化模型和一个梯度增强模型在不同网格密度下的表现。您将亲眼见证，局部模型的结果会随网格变化而剧烈改变（网格依赖性），而正确实现的梯度模型则能提供一致、客观的结果（网格客观性），从而巩固您对梯度模型核心优势的理解。[@problem_id:3528900]", "problem": "考虑一根长度为 $L$、横截面积为 $A$ 的一维杆，其承受小应变准静态拉伸载荷，并具有指定的均匀总应变 $\\varepsilon_0$。该杆表现出弹塑性软化行为。在标准的局部塑性描述中，等效塑性应变 $p(x)$ 逐点演化，这在出现软化时会导致病态的网格敏感性。梯度增强塑性模型引入了一个内禀的内部长度尺度 $\\ell$ 来正则化响应，从而产生具有网格无关性的场和能量。假设为小变形，因此轴向应力由 $\\sigma(x) = E\\left(\\varepsilon(x) - p(x)\\right)$ 给出，其中 $E$ 是杨氏模量，$\\varepsilon(x)$ 是轴向应变。对于均匀位移控制加载，假设 $\\varepsilon(x) \\equiv \\varepsilon_0$。\n\n使用“人造解”范式来对模型进行基准测试。具体而言，假设精确的非局部等效塑性应变场由下式指定\n$$\np_m(x) = p_0 \\exp\\left(-\\frac{\\left(x - \\frac{L}{2}\\right)^2}{2\\ell^2}\\right), \\quad x \\in [0,L],\n$$\n其中 $p_0  0$ 为某个振幅。在一个线性的亥姆霍兹型 Aifantis 梯度公式中，该公式将非局部度量 $p(x)$ 与局部度量 $\\bar{p}(x)$ 相关联，\n$$\np(x) - \\ell^2 \\frac{d^2 p(x)}{dx^2} = \\bar{p}(x),\n$$\n在自然（零微观牵引）边界条件 $\\frac{d p}{dx}(0) = 0$ 和 $\\frac{d p}{dx}(L) = 0$ 下，指定的人造解 $p_m(x)$ 导出相应的局部度量\n$$\n\\bar{p}(x) = p_m(x) - \\ell^2 \\frac{d^2 p_m(x)}{dx^2}.\n$$\n对于所选的高斯函数 $p_m(x)$，解析地计算\n$$\n\\frac{d^2 p_m}{dx^2}(x) = p_0 \\left(\\frac{\\left(x-\\frac{L}{2}\\right)^2}{\\ell^4} - \\frac{1}{\\ell^2} \\right) \\exp\\left(-\\frac{\\left(x - \\frac{L}{2}\\right)^2}{2\\ell^2}\\right),\n$$\n因此\n$$\n\\bar{p}(x) = p_0 \\left(2 - \\frac{\\left(x-\\frac{L}{2}\\right)^2}{\\ell^2}\\right) \\exp\\left(-\\frac{\\left(x - \\frac{L}{2}\\right)^2}{2\\ell^2}\\right).\n$$\n\n使用包含 $N$ 个节点且间距为 $h = \\frac{L}{N-1}$ 的均匀网格来离散化区间 $[0,L]$，使得单元尺寸与内部长度之比为 $r = \\frac{h}{\\ell}$。实现两个离散模型：\n\n- 局部模型：在节点 $x_i$ 处逐点设置 $p_{\\text{local}}(x_i) = \\bar{p}(x_i)$。\n- 梯度模型：求解离散的亥姆霍兹问题\n$$\np - \\ell^2 \\, D^{(2)} p = \\bar{p},\n$$\n其中 $D^{(2)}$ 是带有齐次诺伊曼边界条件的标准二阶导数有限差分算子。对于内部节点 $i=1,\\dots,N-2$，\n$$\n\\left(D^{(2)} p\\right)_i = \\frac{p_{i-1} - 2 p_i + p_{i+1}}{h^2},\n$$\n并在边界 $i=0$ 和 $i=N-1$ 处（使用满足 $\\frac{dp}{dx}=0$ 的虚点），\n$$\n\\left(D^{(2)} p\\right)_0 = \\frac{-2 p_0 + 2 p_1}{h^2}, \\quad \\left(D^{(2)} p\\right)_{N-1} = \\frac{2 p_{N-2} - 2 p_{N-1}}{h^2}.\n$$\n\n使用人造解对精度和网格无关性进行基准测试。对于每个 $r$：\n\n1. 构建网格并在节点处计算 $p_m(x_i)$ 和 $\\bar{p}(x_i)$。\n2. 为梯度模型组装并求解线性系统，以获得 $p_{\\text{grad}}(x_i)$。\n3. 计算相对于 $p_m(x)$ 的相对 $L^2$ 误差：\n$$\ne_{\\text{grad}} = \\frac{\\left\\|p_{\\text{grad}} - p_m\\right\\|_{L^2}}{\\left\\|p_m\\right\\|_{L^2}}, \\quad e_{\\text{local}} = \\frac{\\left\\|p_{\\text{local}} - p_m\\right\\|_{L^2}}{\\left\\|p_m\\right\\|_{L^2}},\n$$\n通过在网格上使用梯形法则来近似计算 $L^2$ 范数。\n4. 在均匀总应变 $\\varepsilon_0$ 下，计算每个模型的名义应力：\n$$\n\\Sigma_{\\text{grad}} = E \\left(\\varepsilon_0 - \\frac{1}{L} \\int_0^L p_{\\text{grad}}(x)\\, dx \\right), \\quad \\Sigma_{\\text{local}} = E \\left(\\varepsilon_0 - \\frac{1}{L} \\int_0^L p_{\\text{local}}(x)\\, dx \\right),\n$$\n其中积分通过梯形法则进行近似计算。\n\n使用以下物理上一致的参数：\n- $E = 3.0 \\times 10^{10}$ (帕斯卡),\n- $\\ell = 5.0 \\times 10^{-2}$ (米),\n- $L = 40\\,\\ell$ (米),\n- $p_0 = 1.0 \\times 10^{-3}$ (无量纲),\n- $\\varepsilon_0 = 2.0 \\times 10^{-3}$ (无量纲).\n\n不涉及角度单位。所有应力输出必须以帕斯卡（Pa）为单位。误差输出为无量纲。\n\n单元尺寸比 $r = h/\\ell$ 的测试套件：\n- $r = 0.1$ (细网格),\n- $r = 0.5$ (中等细网格),\n- $r = 1.0$ (内部长度被解析),\n- $r = 2.5$ (粗网格),\n- $r = 10.0$ (非常粗的网格).\n\n对于测试套件中的每个 $r$，程序必须计算并报告元组 $[e_{\\text{grad}}, e_{\\text{local}}, \\Sigma_{\\text{grad}}, \\Sigma_{\\text{local}}]$，其中误差是浮点数，应力是以帕斯卡为单位的浮点数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目对应一个 $r$ 值，并且本身是按指定顺序排列的列表（例如， $[[e_{\\text{grad}},e_{\\text{local}},\\Sigma_{\\text{grad}},\\Sigma_{\\text{local}}],\\dots]$）。", "solution": "用户提供的问题已经过严格验证，并被确定为计算力学中一个适定且科学合理的练习。所有参数、方程和边界条件都已指定，并且该方法利用了标准的、可验证的技术。人造解 $p_m(x)$ 在解析意义上并不严格满足齐次诺伊曼边界条件；然而，对于给定的参数 $L=40\\ell$，边界处导数的值量级为 $10^{-86}$，这在数值上为零。这种差异是在有限域上使用无界域函数（如高斯函数）时的典型特征，并不会使该问题作为基准测试的效用失效。\n\n该问题要求使用人造解方法比较局部塑性模型和梯度增强塑性模型。这种方法提供了一个强大的验证工具，使我们能够根据一个已知的精确解来量化我们数值格式的准确性。所要解决的核心物理问题是，对于表现出软化（即材料强度随应变增加而降低的现象）的材料，其数值解存在病态的网格依赖性。标准的局部连续介质模型在这种情况下会失效，因为它们缺乏内禀长度尺度，导致变形局部化到一个零宽度区域内，这在物理上是不真实的，在数值上也是难以处理的。梯度增强模型（如此处介绍的模型）引入一个内部长度尺度 $\\ell$ 来对问题进行正则化，确保变形区域具有有限的、物理上有意义的宽度，从而恢复数值模拟的网格无关性。\n\n该问题围绕一根长度为 $L$、杨氏模量为 $E$ 的一维杆展开。轴向应力 $\\sigma$ 通过小应变关系 $\\sigma(x) = E(\\varepsilon(x) - p(x))$ 与总应变 $\\varepsilon$ 和塑性应变 $p$ 相关。对于指定的载荷，总应变是均匀的，即 $\\varepsilon(x) = \\varepsilon_0$。\n\n梯度增强是通过一个线性的亥姆霍兹型方程引入的，该方程将非局部塑性应变 $p(x)$（即进入应力方程的场）与一个底层的类局部变量 $\\bar{p}(x)$ 相关联：\n$$\np(x) - \\ell^2 \\frac{d^2 p(x)}{dx^2} = \\bar{p}(x)\n$$\n该方程在域 $x \\in [0, L]$ 上求解，边界条件为齐次诺伊曼（零通量）边界条件，即 $\\frac{dp}{dx}(0) = \\frac{dp}{dx}(L) = 0$。\n\n在人造解方法中，我们为非局部塑性应变 $p_m(x)$ 假设一个精确形式，并使用控制方程来推导出产生此解所必需的“源”项 $\\bar{p}(x)$。\n指定的人造解是一个高斯函数：\n$$\np_m(x) = p_0 \\exp\\left(-\\frac{\\left(x - \\frac{L}{2}\\right)^2}{2\\ell^2}\\right)\n$$\n将 $p_m(x)$ 代入亥姆霍兹方程，得到相应的源项 $\\bar{p}(x)$：\n$$\n\\bar{p}(x) = p_m(x) - \\ell^2 \\frac{d^2 p_m(x)}{dx^2} = p_0 \\left(2 - \\frac{\\left(x-\\frac{L}{2}\\right)^2}{\\ell^2}\\right) \\exp\\left(-\\frac{\\left(x - \\frac{L}{2}\\right)^2}{2\\ell^2}\\right)\n$$\n\n任务是针对由比率 $r=h/\\ell$（其中 $h$ 是网格间距）定义的一系列网格分辨率，比较两个离散模型。\n\n1.  **局部模型**：该模型错误地假设某点的物理塑性应变就是该点的局部源项，即在每个节点 $x_i$ 处，$p_{\\text{local}}(x_i) = \\bar{p}(x_i)$。这种方法完全忽略了空间梯度项的正则化效应，预计将对塑性应变场以及因此产生的整体结构响应得出不准确的结果。\n\n2.  **梯度模型**：该模型正确地求解亥姆霍兹方程的离散化版本，以求得非局部塑性应变场 $p_{\\text{grad}}(x_i)$。域 $[0, L]$ 被离散为 $N$ 个节点，间距为 $h = L/(N-1)$。使用二阶有限差分近似来表示二阶导数，我们得到一个线性代数方程组：\n    $$\n    \\mathbf{p}_{\\text{grad}} - \\ell^2 \\mathbf{D}^{(2)} \\mathbf{p}_{\\text{grad}} = \\bar{\\mathbf{p}}\n    $$\n    其中 $\\mathbf{p}_{\\text{grad}}$ 和 $\\bar{\\mathbf{p}}$ 是节点值的向量，$\\mathbf{D}^{(2)}$ 是包含诺伊曼边界条件的二阶导数算子的矩阵表示。这可以写成一个线性系统 $\\mathbf{A} \\mathbf{p}_{\\text{grad}} = \\bar{\\mathbf{p}}$，其中 $\\mathbf{A} = \\mathbf{I} - \\ell^2 \\mathbf{D}^{(2)}$ 是一个对称、三对角、正定的矩阵，从而保证了解的唯一性。设 $\\alpha = \\ell^2/h^2 = 1/r^2$。矩阵 $\\mathbf{A}$ 的非零元素为：\n    $$\n    \\begin{cases}\n    A_{i,i-1} = -\\alpha, \\quad A_{i,i} = 1+2\\alpha, \\quad A_{i,i+1} = -\\alpha  \\text{for } i \\in \\{1, \\dots, N-2\\} \\\\\n    A_{0,0} = 1+2\\alpha, \\quad A_{0,1} = -2\\alpha  \\text{for } i=0 \\\\\n    A_{N-1,N-2} = -2\\alpha, \\quad A_{N-1,N-1} = 1+2\\alpha  \\text{for } i=N-1\n    \\end{cases}\n    $$\n\n在组装并求解该系统之后，我们通过计算相对于精确解 $p_m(x)$ 的相对 $L^2$ 误差来评估两个模型的准确性。$L^2$ 范数 $\\|f\\|_{L^2} = \\sqrt{\\int_0^L f(x)^2 dx}$ 在离散节点值上使用梯形法则进行数值近似。\n$$\ne_{\\text{grad}} = \\frac{\\|p_{\\text{grad}} - p_m\\|_{L^2}}{\\|p_m\\|_{L^2}}, \\quad e_{\\text{local}} = \\frac{\\|p_{\\text{local}} - p_m\\|_{L^2}}{\\|p_m\\|_{L^2}}\n$$\n随着网格的细化（即 $r$ 减小），$e_{\\text{grad}}$ 预计将减小，表现出向精确解的收敛。相反，$e_{\\text{local}}$ 将保持较大值，因为局部模型从根本上是错误的。\n\n最后，我们计算两个模型的宏观工程响应，即名义应力 $\\Sigma$。这需要将各自的塑性应变场在杆的长度 $L$ 上进行平均：\n$$\n\\Sigma = E \\left(\\varepsilon_0 - \\frac{1}{L} \\int_0^L p(x)\\, dx \\right)\n$$\n积分同样使用梯形法则计算。$\\Sigma_{\\text{grad}}$ 和 $\\Sigma_{\\text{local}}$ 的比较展示了模型选择对预测全局结构行为的影响。\n\n实现将遍历指定的比率 $r \\in \\{0.1, 0.5, 1.0, 2.5, 10.0\\}$，并对每个比率执行以下操作：\n1.  基于 $L$、$\\ell$ 和 $r$ 定义网格。\n2.  在节点处计算人造场 $p_m(x_i)$ 和 $\\bar{p}(x_i)$。\n3.  设置 $p_{\\text{local},i} = \\bar{p}(x_i)$。\n4.  组装并求解线性系统 $\\mathbf{A} \\mathbf{p}_{\\text{grad}} = \\bar{\\mathbf{p}}$ 以求得 $p_{\\text{grad},i}$。\n5.  计算所要求的四个指标：$e_{\\text{grad}}, e_{\\text{local}}, \\Sigma_{\\text{grad}}, \\Sigma_{\\text{local}}$。\n\n这个过程将定量地证明梯度增强公式的优越性和网格无关性。", "answer": "```python\nimport numpy as np\nimport scipy  # Specified in environment, though not directly used in this implementation\n\ndef solve():\n    \"\"\"\n    Solves the gradient-enhanced plasticity benchmark problem for a suite of mesh sizes.\n    \"\"\"\n    # Physical and model parameters\n    E = 3.0e10        # Young's modulus in Pascals\n    l_scale = 5.0e-2  # Internal length scale in meters\n    L = 40.0 * l_scale # Bar length in meters\n    p_0 = 1.0e-3      # Amplitude of plastic strain (dimensionless)\n    eps_0 = 2.0e-3    # Prescribed total strain (dimensionless)\n\n    # Test suite of element size to internal length ratios\n    r_values = [0.1, 0.5, 1.0, 2.5, 10.0]\n\n    # --- Analytical Functions for Manufactured Solution ---\n    def p_m_func(x, L_val, l_val, p0_val):\n        \"\"\"Manufactured solution for nonlocal plastic strain p(x).\"\"\"\n        term = (x - L_val / 2.0)**2 / (2.0 * l_val**2)\n        return p0_val * np.exp(-term)\n\n    def p_bar_func(x, L_val, l_val, p0_val):\n        \"\"\"Induced local measure p_bar(x) corresponding to p_m(x).\"\"\"\n        term1 = (x - L_val / 2.0)**2 / l_val**2\n        exp_term = np.exp(-term1 / 2.0)\n        return p0_val * (2.0 - term1) * exp_term\n\n    def compute_metrics(r, E_val, l_val, L_val, p0_val, eps0_val):\n        \"\"\"\n        Computes errors and stresses for a given mesh size ratio 'r'.\n        \"\"\"\n        # 1. Construct the mesh\n        h = r * l_val\n        # Ensure N is an integer, rounding handles potential floating point issues\n        N = int(round(L_val / h)) + 1\n        x_nodes = np.linspace(0, L_val, N)\n\n        # Evaluate the manufactured fields at the mesh nodes\n        p_m_nodes = p_m_func(x_nodes, L_val, l_val, p0_val)\n        p_bar_nodes = p_bar_func(x_nodes, L_val, l_val, p0_val)\n\n        # 2. Local model solution (trivial assignment)\n        p_local_nodes = p_bar_nodes\n\n        # 3. Gradient model: assemble and solve the linear system\n        # A * p_grad = p_bar, where A = I - l^2 * D^(2)\n        A = np.zeros((N, N))\n        alpha = (l_val / h)**2  # alpha = 1/r^2\n\n        # Fill the interior rows of the matrix A\n        for i in range(1, N - 1):\n            A[i, i - 1] = -alpha\n            A[i, i] = 1.0 + 2.0 * alpha\n            A[i, i + 1] = -alpha\n\n        # Fill the boundary rows (homogeneous Neumann BCs)\n        A[0, 0] = 1.0 + 2.0 * alpha\n        A[0, 1] = -2.0 * alpha\n        A[N - 1, N - 2] = -2.0 * alpha\n        A[N - 1, N - 1] = 1.0 + 2.0 * alpha\n\n        # Solve for the gradient-enhanced plastic strain field\n        p_grad_nodes = np.linalg.solve(A, p_bar_nodes)\n\n        # 4. Compute relative L2 errors\n        # The L2 norm is computed using the trapezoidal rule.\n        # ||f||^2 = integral(f^2 dx)\n        norm_p_m_sq = np.trapz(p_m_nodes**2, x_nodes)\n        \n        # Avoid division by zero if p_m is zero everywhere (not the case here)\n        norm_p_m = np.sqrt(norm_p_m_sq) if norm_p_m_sq > 0 else 1.0\n\n        # Error for the gradient model\n        err_grad_sq = np.trapz((p_grad_nodes - p_m_nodes)**2, x_nodes)\n        e_grad = np.sqrt(err_grad_sq) / norm_p_m\n\n        # Error for the local model\n        err_local_sq = np.trapz((p_local_nodes - p_m_nodes)**2, x_nodes)\n        e_local = np.sqrt(err_local_sq) / norm_p_m\n\n        # 5. Compute nominal stresses\n        # Stress = E * (total_strain - average_plastic_strain)\n        # Average plastic strain = (1/L) * integral(p(x) dx)\n        avg_p_grad = np.trapz(p_grad_nodes, x_nodes) / L_val\n        sigma_grad = E_val * (eps0_val - avg_p_grad)\n\n        avg_p_local = np.trapz(p_local_nodes, x_nodes) / L_val\n        sigma_local = E_val * (eps0_val - avg_p_local)\n        \n        return [e_grad, e_local, sigma_grad, sigma_local]\n\n    # --- Main Execution Loop ---\n    all_results = []\n    for r in r_values:\n        result_tuple = compute_metrics(r, E, l_scale, L, p_0, eps_0)\n        all_results.append(result_tuple)\n\n    # Format the final output string exactly as required\n    output_str = \"[\" + \",\".join([str(res) for res in all_results]) + \"]\"\n\n    print(output_str)\n\nsolve()\n```", "id": "3528900"}]}