{"hands_on_practices": [{"introduction": "在微观力学中，一个核心问题是如何确定代表性单元体（REV）的尺寸。对于统计均匀的材料，REV必须足够大，以便能够平滑掉微观结构的涨落，从而得到稳定的宏观属性。本练习将引导你通过一个具体的计算，实践如何基于材料的统计特性（如相关长度）和对结果各向异性的容忍度，来估算所需的最小REV尺寸 [@problem_id:3556458]。这个过程将统计理论与实际工程决策联系起来。", "problem": "一个非均质线性弹性岩土材料被建模为一个具有各向同性系综平均的局部刚度涨落的平稳遍历随机场。令局部刚度中偏离各向同性的部分由一个无量纲标量场 $a(\\mathbf{x})$ 表示，该场量化了刚度的局部方向性差异（例如，两个正交模量之差的归一化度量），其系综平均为零，方差为单位1，即 $\\mathbb{E}[a(\\mathbf{x})]=0$ 和 $\\mathrm{Var}[a(\\mathbf{x})]=1$。假设 $a(\\mathbf{x})$ 具有一个可分离的指数型两点相关函数\n$$\n\\rho(\\mathbf{r}) \\equiv \\mathbb{E}[a(\\mathbf{x})\\,a(\\mathbf{x}+\\mathbf{r})] = \\exp\\!\\left(-\\frac{|r_x|}{\\ell_x} - \\frac{|r_y|}{\\ell_y} - \\frac{|r_z|}{\\ell_z}\\right),\n$$\n其中 $\\ell_x,\\ell_y,\\ell_z$ 是方向相关长度。在周期性边界条件（PBC）下，有效刚度在一个尺寸为 $L_x \\times L_y \\times L_z$ 的矩形单元上计算，并且平均刚度的各向异性被取为 $a(\\mathbf{x})$ 在该单元上体积平均值的大小，\n$$\n\\bar{a} = \\frac{1}{V}\\int_V a(\\mathbf{x})\\,\\mathrm{d}V, \\quad V=L_x L_y L_z,\n$$\n在PBC和Hill-Mandel宏观均匀性条件下，该值是系综平均各向异性的一个无偏估计量。对于代表性体积元（REV）的选择，要求 $\\bar{a}$ 的标准差不超过 $0.05$，从而在一倍标准差的意义下，平均刚度的各向异性低于百分之五。\n\n使用平稳随机场体积平均值方差的渐近关系，\n$$\n\\mathrm{Var}(\\bar{a}) \\approx \\frac{1}{V}\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} \\quad \\text{for } \\min\\{L_x,L_y,L_z\\} \\gg \\max\\{\\ell_x,\\ell_y,\\ell_z\\},\n$$\n并假设单元的选择与最大相关长度成比例，使得 $L_x=L_y=L_z=L$ 且 $L=\\alpha\\,\\max\\{\\ell_x,\\ell_y,\\ell_z\\}$（对于某个标量 $\\alpha \\ge 1$），计算保证 $\\sqrt{\\mathrm{Var}(\\bar{a})} \\le 0.05$ 的最小边长 $L_{\\min}$。请用 $\\ell_x,\\ell_y,\\ell_z$ 将你的最终答案表示为一个闭式解析表达式，$L_{\\min}$ 的长度单位与 $\\ell_x,\\ell_y,\\ell_z$ 相同。不要以不等式形式呈现答案；请提供 $L_{\\min}$ 的显式表达式。", "solution": "问题要求确定一个立方计算单元的最小边长 $L_{\\min}$，以确保体积平均各向异性 $\\bar{a}$ 的标准差不超过 $0.05$。分析始于所给出的平稳随机场 $a(\\mathbf{x})$ 体积平均值方差的渐近关系。\n\n体积平均值 $\\bar{a}$ 的方差由以下表达式给出：\n$$\n\\mathrm{Var}(\\bar{a}) \\approx \\frac{1}{V}\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r}\n$$\n其中 $V$ 是平均域的体积，$\\rho(\\mathbf{r})$ 是两点相关函数。\n\n第一步是计算给定相关函数在整个三维空间 $\\mathbb{R}^3$ 上的积分。相关函数为：\n$$\n\\rho(\\mathbf{r}) = \\exp\\!\\left(-\\frac{|r_x|}{\\ell_x} - \\frac{|r_y|}{\\ell_y} - \\frac{|r_z|}{\\ell_z}\\right)\n$$\n由于指数函数的可分离性，三重积分可以表示为三个一维积分的乘积：\n$$\n\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} = \\int_{\\mathbb{R}^3} \\exp\\!\\left(-\\frac{|r_x|}{\\ell_x}\\right) \\exp\\!\\left(-\\frac{|r_y|}{\\ell_y}\\right) \\exp\\!\\left(-\\frac{|r_z|}{\\ell_z}\\right) \\mathrm{d}r_x \\mathrm{d}r_y \\mathrm{d}r_z\n$$\n$$\n\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} = \\left( \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|r_x|}{\\ell_x}\\right) \\mathrm{d}r_x \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|r_y|}{\\ell_y}\\right) \\mathrm{d}r_y \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|r_z|}{\\ell_z}\\right) \\mathrm{d}r_z \\right)\n$$\n我们计算这些积分的一般形式。对于一个泛型变量 $u$ 和相关长度 $\\ell$：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|u|}{\\ell}\\right) \\mathrm{d}u\n$$\n被积函数是偶函数，因此我们可以将积分重写为：\n$$\n2 \\int_{0}^{\\infty} \\exp\\!\\left(-\\frac{u}{\\ell}\\right) \\mathrm{d}u = 2 \\left[ -\\ell \\exp\\!\\left(-\\frac{u}{\\ell}\\right) \\right]_{0}^{\\infty} = 2 \\left( 0 - (-\\ell \\exp(0)) \\right) = 2\\ell\n$$\n将此结果应用于三个方向的积分中的每一个，我们得到相关函数的总积分为：\n$$\n\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} = (2\\ell_x) (2\\ell_y) (2\\ell_z) = 8\\ell_x\\ell_y\\ell_z\n$$\n问题指定了一个边长为 $L$ 的立方计算单元，因此其体积为 $V = L^3$。将积分结果和体积代入方差公式，得到：\n$$\n\\mathrm{Var}(\\bar{a}) \\approx \\frac{8\\ell_x\\ell_y\\ell_z}{L^3}\n$$\n代表性体积元（REV）的选择准则是 $\\bar{a}$ 的标准差不得超过 $0.05$：\n$$\n\\sqrt{\\mathrm{Var}(\\bar{a})} \\le 0.05\n$$\n代入方差的表达式：\n$$\n\\sqrt{\\frac{8\\ell_x\\ell_y\\ell_z}{L^3}} \\le 0.05\n$$\n为了找到最小边长 $L_{\\min}$，我们在该不等式的边界处求解方程：\n$$\n\\sqrt{\\frac{8\\ell_x\\ell_y\\ell_z}{L_{\\min}^3}} = 0.05\n$$\n两边平方得到：\n$$\n\\frac{8\\ell_x\\ell_y\\ell_z}{L_{\\min}^3} = (0.05)^2 = \\left(\\frac{5}{100}\\right)^2 = \\left(\\frac{1}{20}\\right)^2 = \\frac{1}{400}\n$$\n现在，我们求解 $L_{\\min}^3$：\n$$\nL_{\\min}^3 = 400 \\times 8 \\ell_x\\ell_y\\ell_z = 3200 \\ell_x\\ell_y\\ell_z\n$$\n最后，对两边取立方根，得到所需最小边长 $L_{\\min}$ 的表达式：\n$$\nL_{\\min} = \\sqrt[3]{3200 \\ell_x\\ell_y\\ell_z}\n$$\n数值系数可以简化。我们注意到 $3200 = 8 \\times 400 = 2^3 \\times 400$。因此，我们可以写成：\n$$\nL_{\\min} = \\sqrt[3]{8 \\times 400 \\ell_x\\ell_y\\ell_z} = 2\\sqrt[3]{400 \\ell_x\\ell_y\\ell_z}\n$$\n这就是最小边长的最终闭式表达式。", "answer": "$$\n\\boxed{2\\sqrt[3]{400 \\ell_x \\ell_y \\ell_z}}\n$$", "id": "3556458"}, {"introduction": "确定了REV的尺寸后，下一步是在数值模型中施加能模拟无限介质的边界条件。本练习将引导你完成在离散系统中应用周期性边界条件（PBCs）的核心算法，这是有限元或离散元模拟中的一项常见任务。通过这个练习，你将处理关键的实践细节，例如如何处理跨越周期性边界的颗粒间的接触，以及如何消除由约束方程引起的非物理刚体运动 [@problem_id:3556487]。", "problem": "考虑一个边长为 $L = 1$ 的二维方形代表性体积单元 (REV)，其处于小应变运动学条件下。设微观位移场 $\\mathbf{u}(\\mathbf{x})$ 分解为一个施加的仿射部分和一个波动部分，即 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x} + \\mathbf{w}(\\mathbf{x})$，其中 $\\mathbf{E} \\in \\mathbb{R}^{2 \\times 2}$ 是宏观应变张量，$\\mathbf{w}(\\mathbf{x})$ 是周期性波动场。周期性边界条件要求波动在周期性对应的边界点上相等，而总位移差在相应的晶格矢量上等于仿射部分。当微观结构组分之间存在接触相互作用时，必须确保跨周期性镜像映射的接触与周期性一致地处理。此外，周期性联结约束不得引入波动场的人为刚体运动。\n\n使用以下 REV 边界的离散表示，其中包含位于每条边中点的 $8$ 个节点：\n- 左侧面：$\\mathbf{x}_{\\mathrm{L1}} = (0,\\,0.25)$，$\\mathbf{x}_{\\mathrm{L2}} = (0,\\,0.75)$，\n- 右侧面：$\\mathbf{x}_{\\mathrm{R1}} = (1,\\,0.25)$，$\\mathbf{x}_{\\mathrm{R2}} = (1,\\,0.75)$，\n- 底面：$\\mathbf{x}_{\\mathrm{B1}} = (0.25,\\,0)$，$\\mathbf{x}_{\\mathrm{B2}} = (0.75,\\,0)$，\n- 顶面：$\\mathbf{x}_{\\mathrm{T1}} = (0.25,\\,1)$，$\\mathbf{x}_{\\mathrm{T2}} = (0.75,\\,1)$。\n\n按如下方式定义波动场上的周期性联结。对于每一对具有相同横向坐标的相对面节点，施加约束\n$$\n\\mathbf{w}(\\mathbf{x}_+) - \\mathbf{w}(\\mathbf{x}_-) = \\mathbf{0},\n$$\n并对总位移施加约束\n$$\n\\mathbf{u}(\\mathbf{x}_+) - \\mathbf{u}(\\mathbf{x}_-) = \\mathbf{E}\\,(\\mathbf{x}_+ - \\mathbf{x}_-).\n$$\n在边界节点上，以离散形式将这些关系收集到一个关于节点波动向量 $\\mathbf{w}_{\\mathrm{b}} \\in \\mathbb{R}^{16}$ 的线性系统中，使用一个约束矩阵 $A_{\\mathrm{w}}$ 使得 $A_{\\mathrm{w}}\\,\\mathbf{w}_{\\mathrm{b}} = \\mathbf{0}$，其中 $\\mathbf{w}_{\\mathrm{b}}$ 堆叠了 $8$ 个边界节点上 $\\mathbf{w}$ 的 $x$ 和 $y$ 分量。对应的总位移联结系统是 $A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}} = \\mathbf{b}$，其中 $\\mathbf{b}$ 由仿射差分 $\\mathbf{E}(\\mathbf{x}_+ - \\mathbf{x}_-)$ 组装而成，$\\mathbf{u}_{\\mathrm{b}}$ 堆叠了边界节点上的 $\\mathbf{u}$。\n\n为测试接触，考虑 REV 内部由点（中心）表示的两个微观结构组分：\n- 粒子 $1$ 位于 $\\mathbf{x}_1 = (0.10,\\,0.50)$，半径为 $r_1$，\n- 粒子 $2$ 位于 $\\mathbf{x}_2 = (0.90,\\,0.50)$，半径为 $r_2$。\n\n使用周期性最小镜像约定来定义跨周期性单元的 $\\mathbf{x}_1$ 和 $\\mathbf{x}_2$ 之间的最短向量：\n$$\n\\Delta \\mathbf{x}_{\\mathrm{p}} = \\left( \\left( (x_2-x_1 + \\tfrac{L}{2}) \\bmod L \\right) - \\tfrac{L}{2},\\; \\left( (y_2-y_1 + \\tfrac{L}{2}) \\bmod L \\right) - \\tfrac{L}{2} \\right).\n$$\n标量间隙为\n$$\ng = \\|\\Delta \\mathbf{x}_{\\mathrm{p}}\\| - (r_1 + r_2),\n$$\n如果 $g \\le 0$，则认为接触是激活的。\n\n波动场的刚体运动由两次平移和一次无穷小平面内转动所张成的子空间定义：\n- $x$ 方向平移：$\\mathbf{t}_x$，在所有边界节点上分量为 $w_x = 1$ 和 $w_y = 0$，\n- $y$ 方向平移：$\\mathbf{t}_y$，在所有边界节点上分量为 $w_x = 0$ 和 $w_y = 1$，\n- 无穷小转动：$\\mathbf{r}$，在每个边界节点上分量为 $\\mathbf{w}(\\mathbf{x}) = R\\,\\mathbf{x}$，其中 $R = \\begin{pmatrix} 0 & -1 \\\\ 1 & 0 \\end{pmatrix}$。\n\n您的程序必须：\n1. 为四个相对面节点对 $(\\mathrm{L1},\\mathrm{R1})$, $(\\mathrm{L2},\\mathrm{R2})$, $(\\mathrm{B1},\\mathrm{T1})$, $(\\mathrm{B2},\\mathrm{T2})$ 上的波动联结组装 $A_{\\mathrm{w}}$。每对节点产生两个标量等式（针对 $x$ 和 $y$ 分量）。\n2. 可选择地使用规范约束来增广 $A_{\\mathrm{w}}$，以防止人为的刚体运动：\n   - 在参考节点 $\\mathbf{x}_{\\mathrm{ref}} = \\mathbf{x}_{\\mathrm{B1}}$ 处的钉扎约束：通过向 $A_{\\mathrm{w}}$ 添加两行来施加 $w_x(\\mathbf{x}_{\\mathrm{ref}}) = 0$ 和 $w_y(\\mathbf{x}_{\\mathrm{ref}}) = 0$。\n   - 可选的转动消除约束：通过向 $A_{\\mathrm{w}}$ 添加一行来施加 $\\sum_{i} \\left( -y_i\\,w_x(\\mathbf{x}_i) + x_i\\,w_y(\\mathbf{x}_i) \\right) = 0$。\n3. 通过检查 $A_{\\mathrm{w}}$ 是否在数值容差内零化每个向量，确定三个刚体基向量 $\\{\\mathbf{t}_x, \\mathbf{t}_y, \\mathbf{r}\\}$ 中有多少个位于 $A_{\\mathrm{w}}$ 的零空间中。将此计数报告为整数。\n4. 使用周期性最小镜像 $\\Delta \\mathbf{x}_{\\mathrm{p}}$ 和间隙 $g$ 评估周期性接触激活状态，并将接触是否激活报告为布尔值。\n5. 为相同的四个节点对的联结方程组装 $A_{\\mathrm{u}}$ 和 $\\mathbf{b}$。在边界节点上使用纯仿射位移 $\\mathbf{u}_{\\mathrm{b}}$（其中 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x}$），计算残差向量 $\\mathbf{r}_{\\mathrm{tie}} = A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}} - \\mathbf{b}$ 并将其无穷范数 $\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}$ 报告为浮点数。\n\n使用以下包含三个案例的测试套件，涵盖正常路径、边界条件缺失和边缘情况：\n- 案例 1 (正常路径)：\n  - 宏观应变 $\\mathbf{E} = \\begin{pmatrix} 0.01 & 0.02 \\\\ 0.02 & -0.01 \\end{pmatrix}$，\n  - 规范：包含在 $\\mathbf{x}_{\\mathrm{B1}}$ 的钉扎，不包含转动消除约束，\n  - 半径：$r_1 + r_2 = 0.22$。\n- 案例 2 (边界条件缺失)：\n  - 宏观应变 $\\mathbf{E} = \\begin{pmatrix} 0.01 & 0.02 \\\\ 0.02 & -0.01 \\end{pmatrix}$，\n  - 规范：不包含任何规范约束，\n  - 半径：$r_1 + r_2 = 0.15$。\n- 案例 3 (边缘情况)：\n  - 宏观应变 $\\mathbf{E} = \\begin{pmatrix} 0 & 0.02 \\\\ 0.02 & 0 \\end{pmatrix}$，\n  - 规范：包含在 $\\mathbf{x}_{\\mathrm{B1}}$ 的钉扎并包含转动消除约束，\n  - 半径：$r_1 + r_2 = 0.20$。\n\n您的程序应为每个案例计算三元组 $[\\text{rbm\\_count}, \\text{contact\\_active}, \\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}]$，其中 $\\text{rbm\\_count}$ 是一个整数，$\\text{contact\\_active}$ 是一个布尔值，$\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}$ 是一个浮点数。您的程序应生成单行输出，其中包含用方括号括起来的结果，结果为逗号分隔的列表，每个案例的三元组本身也表示为一个列表。例如，最终输出格式必须类似于 $[\\,[\\cdot,\\cdot,\\cdot],\\,[\\cdot,\\cdot,\\cdot],\\,[\\cdot,\\cdot,\\cdot]\\,]$。不需要物理单位；所有量都是无量纲的。角度（若有）必须以弧度为单位，但此问题不要求输入角度。", "solution": "所提供的问题在科学上是合理的、适定的，并包含了获得唯一解所需的所有信息。因此，我们可以进行分步推导和实现。\n\n该问题要求进行一系列与在离散二维代表性体积单元 (REV) 上应用周期性边界条件相关的计算。我们将按顺序处理五个指定的任务中的每一项。\n\n首先，我们建立离散系统。REV 边界由 $8$ 个节点离散化，为计算方便，我们将其索引为 $0$ 到 $7$：\n- 节点 $0$：$\\mathbf{x}_0 = \\mathbf{x}_{\\mathrm{L1}} = (0, 0.25)$\n- 节点 $1$：$\\mathbf{x}_1 = \\mathbf{x}_{\\mathrm{L2}} = (0, 0.75)$\n- 节点 $2$：$\\mathbf{x}_2 = \\mathbf{x}_{\\mathrm{R1}} = (1, 0.25)$\n- 节点 $3$：$\\mathbf{x}_3 = \\mathbf{x}_{\\mathrm{R2}} = (1, 0.75)$\n- 节点 $4$：$\\mathbf{x}_4 = \\mathbf{x}_{\\mathrm{B1}} = (0.25, 0)$\n- 节点 $5$：$\\mathbf{x}_5 = \\mathbf{x}_{\\mathrm{B2}} = (0.75, 0)$\n- 节点 $6$：$\\mathbf{x}_6 = \\mathbf{x}_{\\mathrm{T1}} = (0.25, 1)$\n- 节点 $7$：$\\mathbf{x}_7 = \\mathbf{x}_{\\mathrm{T2}} = (0.75, 1)$\n\n波动位移向量 $\\mathbf{w}_{\\mathrm{b}}$ 收集了这 $8$ 个节点上波动场 $\\mathbf{w}$ 的 $x$ 和 $y$ 分量。我们采用一种标准排序，其中对于节点 $i$，自由度 (DOF) 索引 $2i$ 对应于 $x$ 分量 $w_x(\\mathbf{x}_i)$，$2i+1$ 对应于 $y$ 分量 $w_y(\\mathbf{x}_i)$。这将得到一个向量 $\\mathbf{w}_{\\mathrm{b}} \\in \\mathbb{R}^{16}$。\n\n**1. 波动约束矩阵 $A_{\\mathrm{w}}$ 的组装**\n\n矩阵 $A_{\\mathrm{w}}$ 对波动向量 $\\mathbf{w}_{\\mathrm{b}}$ 施加线性约束。它根据每个测试案例的活动约束进行组装。\n\n基本约束源于波动场的周期性：$\\mathbf{w}(\\mathbf{x}_+) - \\mathbf{w}(\\mathbf{x}_-) = \\mathbf{0}$。对于四个指定的节点对中的每一个，该向量方程产生两个标量方程。\n- 节点对 $(\\mathbf{x}_{\\mathrm{L1}}, \\mathbf{x}_{\\mathrm{R1}}) \\equiv (\\mathbf{x}_0, \\mathbf{x}_2)$:\n  $w_x(\\mathbf{x}_2) - w_x(\\mathbf{x}_0) = 0$\n  $w_y(\\mathbf{x}_2) - w_y(\\mathbf{x}_0) = 0$\n- 节点对 $(\\mathbf{x}_{\\mathrm{L2}}, \\mathbf{x}_{\\mathrm{R2}}) \\equiv (\\mathbf{x}_1, \\mathbf{x}_3)$:\n  $w_x(\\mathbf{x}_3) - w_x(\\mathbf{x}_1) = 0$\n  $w_y(\\mathbf{x}_3) - w_y(\\mathbf{x}_1) = 0$\n- 节点对 $(\\mathbf{x}_{\\mathrm{B1}}, \\mathbf{x}_{\\mathrm{T1}}) \\equiv (\\mathbf{x}_4, \\mathbf{x}_6)$:\n  $w_x(\\mathbf{x}_6) - w_x(\\mathbf{x}_4) = 0$\n  $w_y(\\mathbf{x}_6) - w_y(\\mathbf{x}_4) = 0$\n- 节点对 $(\\mathbf{x}_{\\mathrm{B2}}, \\mathbf{x}_{\\mathrm{T2}}) \\equiv (\\mathbf{x}_5, \\mathbf{x}_7)$:\n  $w_x(\\mathbf{x}_7) - w_x(\\mathbf{x}_5) = 0$\n  $w_y(\\mathbf{x}_7) - w_y(\\mathbf{x}_5) = 0$\n这 $8$ 个方程构成一个 $8 \\times 16$ 的矩阵，这是 $A_{\\mathrm{w}}$ 的基本形式。\n\n或者，可以将规范约束作为新行添加到 $A_{\\mathrm{w}}$ 中，以消除波动场 $\\mathbf{w}$ 的刚体模态。\n- 在 $\\mathbf{x}_{\\mathrm{ref}} = \\mathbf{x}_{\\mathrm{B1}} = \\mathbf{x}_4$ 处的钉扎约束：这些约束施加了 $w_x(\\mathbf{x}_4) = 0$ 和 $w_y(\\mathbf{x}_4) = 0$。这会向 $A_{\\mathrm{w}}$ 添加两行，一行在第 $2 \\times 4 = 8$ 列处为 $1$，另一行在第 $2 \\times 4+1 = 9$ 列处为 $1$。\n- 转动消除约束：$\\sum_{i=0}^7 \\left( -y_i w_x(\\mathbf{x}_i) + x_i w_y(\\mathbf{x}_i) \\right) = 0$。这会向 $A_{\\mathrm{w}}$ 添加一行。该行中第 $2i$ 列（对应 $w_x(\\mathbf{x}_i)$）的条目是 $-y_i$，第 $2i+1$ 列（对应 $w_y(\\mathbf{x}_i)$）的条目是 $x_i$。\n\n**2. 刚体模态分析**\n\n我们必须确定组装好的矩阵 $A_{\\mathrm{w}}$ 的零空间中包含三个刚体模态 (RBM) 向量中的多少个。如果 $A_{\\mathrm{w}} \\mathbf{v} = \\mathbf{0}$，则向量 $\\mathbf{v}$ 位于零空间中。我们对每个 RBM 向量 $\\mathbf{t}_x, \\mathbf{t}_y, \\mathbf{r}$ 进行此测试。\n- $x$ 方向平移 $\\mathbf{t}_x$：在所有节点上 $w_x = 1, w_y = 0$。\n- $y$ 方向平移 $\\mathbf{t}_y$：在所有节点上 $w_x = 0, w_y = 1$。\n- 无穷小转动 $\\mathbf{r}$：$\\mathbf{w}(\\mathbf{x}_i) = R\\,\\mathbf{x}_i = \\begin{pmatrix} -y_i \\\\ x_i \\end{pmatrix}$。\n\n基本周期性约束 $\\mathbf{w}(\\mathbf{x}_+) = \\mathbf{w}(\\mathbf{x}_-)$ 被所有三个 RBM 满足。例如，对于 $\\mathbf{t}_x$，我们有 $1=1$。对于在节点对 $(\\mathbf{x}_0, \\mathbf{x}_2)$ 上的 $\\mathbf{r}$，我们检查 $w_x(\\mathbf{x}_2)-w_x(\\mathbf{x}_0) = -y_2 - (-y_0) = -0.25 - (-0.25) = 0$，以及 $w_y(\\mathbf{x}_2)-w_y(\\mathbf{x}_0) = x_2 - x_0 = 1-0 = 1 \\ne 0$。我最初的想法是错误的。让我们重新验证一下。对波动场的要求是 $\\mathbf{w}(\\mathbf{x}_+)=\\mathbf{w}(\\mathbf{x}_-)$。对总位移的要求是 $\\mathbf{u}(\\mathbf{x}_+) - \\mathbf{u}(\\mathbf{x}_-) = \\mathbf{E}(\\mathbf{x}_+-\\mathbf{x}_-)$。代入 $\\mathbf{u} = \\mathbf{E}\\mathbf{x}+\\mathbf{w}$，我们得到 $\\mathbf{E}\\mathbf{x}_+ + \\mathbf{w}_+ - (\\mathbf{E}\\mathbf{x}_- + \\mathbf{w}_-) = \\mathbf{E}(\\mathbf{x}_+-\\mathbf{x}_-)$，简化后即为 $\\mathbf{w}_+ - \\mathbf{w}_- = \\mathbf{0}$。\n让我们再次检查无穷小转动 `r` 在 L-R 对 $(x_0, x_2)$ 上的情况：\n$w_x(x_2) = -y_2 = -0.25$， $w_x(x_0) = -y_0 = -0.25$。所以 $w_x(x_2) - w_x(x_0) = 0$。x 分量满足。\n$w_y(x_2) = x_2 = 1$， $w_y(x_0) = x_0 = 0$。所以 $w_y(x_2) - w_y(x_0) = 1 \\ne 0$。基本周期性约束*不*允许转动模态 $\\mathbf{r}$。\n让我们重新检查平移。对于 $\\mathbf{t}_x$：$w_x(x_2)-w_x(x_0)=1-1=0$, $w_y(x_2)-w_y(x_0)=0-0=0$。这对所有节点对都成立。$\\mathbf{t}_x$ 和 $\\mathbf{t}_y$ 都位于基本周期性矩阵的零空间中。\n因此，在没有规范约束的情况下（案例 2），存在 $2$ 个 RBM。\n在 $\\mathbf{x}_4=(0.25,0)$ 处施加钉扎：约束为 $w_x(\\mathbf{x}_4)=0$ 和 $w_y(\\mathbf{x}_4)=0$。\n- 对于 $\\mathbf{t}_x$：$w_x(\\mathbf{x}_4)=1 \\ne 0$。$\\mathbf{t}_x$ 被消除。\n- 对于 $\\mathbf{t}_y$：$w_y(\\mathbf{x}_4)=1 \\ne 0$。$\\mathbf{t}_y$ 被消除。\n因此，钉扎约束消除了平移模态。转动模态已被消除。RBM 计数应为 $0$。\n对于案例 3，有钉扎和转动消除约束，计数也必须是 $0$。\n\n修正后的 `rbm_count` 预期值：\n- 案例 1 (钉扎)：$\\mathbf{t}_x, \\mathbf{t}_y$ 被钉扎消除。$\\mathbf{r}$ 被基本 PBCs 消除。`rbm_count = 0`。\n- 案例 2 (无规范)：$\\mathbf{t}_x, \\mathbf{t}_y$ 在零空间中。$\\mathbf{r}$ 不在。`rbm_count = 2`。\n- 案例 3 (钉扎 + 转动消除)：钉扎足以消除 $\\mathbf{t}_x, \\mathbf{t}_y$。`rbm_count = 0`。\n\n**3. 周期性接触激活**\n\n接触条件使用周期性最小镜像约定进行评估。计算边长 $L=1$ 的 REV 中粒子 $\\mathbf{x}_1 = (0.10, 0.50)$ 和 $\\mathbf{x}_2 = (0.90, 0.50)$ 之间的最短向量。\n$\\Delta \\mathbf{x} = \\mathbf{x}_2 - \\mathbf{x}_1 = (0.80, 0.0)$。\n周期性最小镜像向量 $\\Delta \\mathbf{x}_{\\mathrm{p}}$ 的分量为：\n$\\Delta x_{\\mathrm{p}} = (((0.8) + 1/2) \\pmod 1) - 1/2 = (1.3 \\pmod 1) - 0.5 = 0.3 - 0.5 = -0.2$。\n$\\Delta y_{\\mathrm{p}} = (((0.0) + 1/2) \\pmod 1) - 1/2 = (0.5 \\pmod 1) - 0.5 = 0.5 - 0.5 = 0.0$。\n所以，$\\Delta \\mathbf{x}_{\\mathrm{p}} = (-0.2, 0.0)$，其范数为 $\\|\\Delta \\mathbf{x}_{\\mathrm{p}}\\| = 0.2$。\n间隙为 $g = \\|\\Delta \\mathbf{x}_{\\mathrm{p}}\\| - (r_1 + r_2) = 0.2 - (r_1 + r_2)$。如果 $g \\le 0$，则接触是激活的。\n- 案例 1: $r_1+r_2=0.22 \\implies g = 0.2 - 0.22 = -0.02 \\le 0$。激活。\n- 案例 2: $r_1+r_2=0.15 \\implies g = 0.2 - 0.15 = 0.05 > 0$。未激活。\n- 案例 3: $r_1+r_2=0.20 \\implies g = 0.2 - 0.20 = 0.0 \\le 0$。激活。\n\n**4. 总位移联结残差**\n\n我们必须计算仿射位移场 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x}$ 的残差 $\\mathbf{r}_{\\mathrm{tie}} = A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}} - \\mathbf{b}$ 的无穷范数。\n约束矩阵 $A_{\\mathrm{u}}$ 与 $A_{\\mathrm{w}}$ 的基本周期性部分相同，是一个 $8 \\times 16$ 的矩阵。\n右侧向量 $\\mathbf{b} \\in \\mathbb{R}^{8}$ 由项 $\\mathbf{E}\\,(\\mathbf{x}_+ - \\mathbf{x}_-)$ 组装而成。\n- 对于节点对 $(\\mathbf{x}_0, \\mathbf{x}_2)$ 和 $(\\mathbf{x}_1, \\mathbf{x}_3)$，$\\mathbf{x}_+ - \\mathbf{x}_- = (1, 0)^T$。右侧（RHS）为 $\\mathbf{E}(1,0)^T = (E_{11}, E_{21})^T$。\n- 对于节点对 $(\\mathbf{x}_4, \\mathbf{x}_6)$ 和 $(\\mathbf{x}_5, \\mathbf{x}_7)$，$\\mathbf{x}_+ - \\mathbf{x}_- = (0, 1)^T$。右侧（RHS）为 $\\mathbf{E}(0,1)^T = (E_{12}, E_{22})^T$。\n位移向量 $\\mathbf{u}_{\\mathrm{b}}$ 是通过为每个边界节点 $i$ 计算 $\\mathbf{u}(\\mathbf{x}_i) = \\mathbf{E}\\,\\mathbf{x}_i$ 形成的。\n让我们考虑一个来自 $A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}}$ 的约束方程，例如 $(\\mathbf{x}_0, \\mathbf{x}_2)$ 对的 $x$ 分量：\n$(A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}})_{\\text{row } j} = u_x(\\mathbf{x}_2) - u_x(\\mathbf{x}_0) = (\\mathbf{E}\\,\\mathbf{x}_2)_x - (\\mathbf{E}\\,\\mathbf{x}_0)_x = (\\mathbf{E}\\,(\\mathbf{x}_2-\\mathbf{x}_0))_x$。\n由于 $\\mathbf{x}_2-\\mathbf{x}_0=(1,0)^T$，这等于 $(\\mathbf{E}\\,(1,0)^T)_x = E_{11}$。\n$\\mathbf{b}$ 中对应的分量是 $b_j = E_{11}$。\n该分量的残差为 $E_{11} - E_{11} = 0$。由于矩阵-向量乘积的线性性质，这对所有 $8$ 个约束都成立。根据构造，仿射场精确地满足总位移的周期性条件。因此，残差向量 $\\mathbf{r}_{\\mathrm{tie}}$ 在解析上为零，其范数 $\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}$ 必须为 $0$（或由于浮点精度而为一个很小的数）。\n\n**测试案例结果总结**\n- **案例 1：** $A_{\\mathrm{w}}$ 包含钉扎。`rbm_count=0`。接触半径和为 $0.22$，所以 `contact_active=True`。联结残差范数为 $0.0$。\n- **案例 2：** $A_{\\mathrm{w}}$ 没有规范约束。`rbm_count=2`。接触半径和为 $0.15$，所以 `contact_active=False`。联结残差范数为 $0.0$。\n- **案例 3：** $A_{\\mathrm{w}}$ 包含钉扎和转动消除。`rbm_count=0`。接触半径和为 $0.20$，所以 `contact_active=True`。联结残差范数为 $0.0$。\n\n这些解析推导将在 Python 脚本中实现。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational geomechanics problem for three test cases.\n    \"\"\"\n\n    # Define the 8 boundary nodes\n    nodes_coords = np.array([\n        [0.0, 0.25],  # 0: L1\n        [0.0, 0.75],  # 1: L2\n        [1.0, 0.25],  # 2: R1\n        [1.0, 0.75],  # 3: R2\n        [0.25, 0.0],  # 4: B1\n        [0.75, 0.0],  # 5: B2\n        [0.25, 1.0],  # 6: T1\n        [0.75, 1.0],  # 7: T2\n    ])\n    \n    num_nodes = 8\n    num_dofs = num_nodes * 2\n\n    # Define the 4 periodic tie pairs by node indices\n    tie_pairs = [\n        (0, 2),  # (L1, R1)\n        (1, 3),  # (L2, R2)\n        (4, 6),  # (B1, T1)\n        (5, 7),  # (B2, T2)\n    ]\n    \n    # Define rigid body mode vectors\n    t_x = np.zeros(num_dofs)\n    t_x[0::2] = 1.0\n\n    t_y = np.zeros(num_dofs)\n    t_y[1::2] = 1.0\n\n    r_vec = np.zeros(num_dofs)\n    for i in range(num_nodes):\n        x, y = nodes_coords[i]\n        r_vec[2*i] = -y  # w_x = -y\n        r_vec[2*i+1] = x   # w_y = x\n    \n    rbm_vectors = [t_x, t_y, r_vec]\n\n    # Contact parameters\n    x1 = np.array([0.10, 0.50])\n    x2 = np.array([0.90, 0.50])\n    L = 1.0\n\n    # Test cases from the problem statement\n    test_cases = [\n        {\n            \"E\": np.array([[0.01, 0.02], [0.02, -0.01]]),\n            \"use_pinning\": True,\n            \"use_rot_elim\": False,\n            \"r1_plus_r2\": 0.22,\n        },\n        {\n            \"E\": np.array([[0.01, 0.02], [0.02, -0.01]]),\n            \"use_pinning\": False,\n            \"use_rot_elim\": False,\n            \"r1_plus_r2\": 0.15,\n        },\n        {\n            \"E\": np.array([[0.0, 0.02], [0.02, 0.0]]),\n            \"use_pinning\": True,\n            \"use_rot_elim\": True,\n            \"r1_plus_r2\": 0.20,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Task 1  2: Assemble A_w with optional gauge constraints ---\n        A_w_rows = []\n        \n        # Base periodicity constraints\n        for node_minus, node_plus in tie_pairs:\n            # x-component: w_x(+) - w_x(-) = 0\n            row_x = np.zeros(num_dofs)\n            row_x[2 * node_plus] = 1.0\n            row_x[2 * node_minus] = -1.0\n            A_w_rows.append(row_x)\n            \n            # y-component: w_y(+) - w_y(-) = 0\n            row_y = np.zeros(num_dofs)\n            row_y[2 * node_plus + 1] = 1.0\n            row_y[2 * node_minus + 1] = -1.0\n            A_w_rows.append(row_y)\n        \n        # Pinning constraint at B1 (node 4)\n        if case[\"use_pinning\"]:\n            # w_x(B1) = 0\n            row_pin_x = np.zeros(num_dofs)\n            row_pin_x[2 * 4] = 1.0\n            A_w_rows.append(row_pin_x)\n            \n            # w_y(B1) = 0\n            row_pin_y = np.zeros(num_dofs)\n            row_pin_y[2 * 4 + 1] = 1.0\n            A_w_rows.append(row_pin_y)\n\n        # Rotation-elimination constraint\n        if case[\"use_rot_elim\"]:\n            row_rot = np.zeros(num_dofs)\n            for i in range(num_nodes):\n                x, y = nodes_coords[i]\n                row_rot[2 * i] = -y      # Coeff of w_x\n                row_rot[2 * i + 1] = x   # Coeff of w_y\n            A_w_rows.append(row_rot)\n            \n        A_w = np.array(A_w_rows)\n\n        # --- Task 3: Count RBMs in null space of A_w ---\n        rbm_count = 0\n        for v in rbm_vectors:\n            if np.allclose(A_w @ v, 0):\n                rbm_count += 1\n\n        # --- Task 4: Evaluate periodic contact activation ---\n        delta_x = x2 - x1\n        delta_x_p = np.zeros(2)\n        delta_x_p[0] = ((delta_x[0] + L / 2) % L) - L / 2\n        delta_x_p[1] = ((delta_x[1] + L / 2) % L) - L / 2\n        \n        gap = np.linalg.norm(delta_x_p) - case[\"r1_plus_r2\"]\n        contact_active = gap = 0\n        \n        # --- Task 5: Compute tie residual for total displacements ---\n        # A_u is just the base periodicity part\n        A_u = np.array(A_w_rows[:8])\n        \n        E = case[\"E\"]\n        b_tie = np.zeros(8)\n        for i, (node_minus, node_plus) in enumerate(tie_pairs):\n            delta_coord = nodes_coords[node_plus] - nodes_coords[node_minus]\n            rhs_vec = E @ delta_coord\n            b_tie[2*i] = rhs_vec[0]\n            b_tie[2*i+1] = rhs_vec[1]\n            \n        u_b = np.zeros(num_dofs)\n        for i in range(num_nodes):\n            u_b[2*i:2*i+2] = E @ nodes_coords[i]\n            \n        r_tie = A_u @ u_b - b_tie\n        tie_residual_norm = np.linalg.norm(r_tie, np.inf)\n\n        results.append([rbm_count, contact_active, tie_residual_norm])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3556487"}, {"introduction": "REV分析的最终目的通常是计算等效力学属性，以用于更大尺度的宏观模拟（即多尺度方法）。这项高级练习将向你展示如何推导并实现“一致性宏观切线算子”的计算。这个算子能够正确地线性化整个REV的弹塑性响应，是在FE²计算框架下确保宏观牛顿迭代法快速收敛的关键要素 [@problem_id:3556511]。", "problem": "考虑一个在小应变平面应变下的二维代表性体积单元 (REV)，该单元具有周期性边界条件 (PBC)。该 REV 通过一个具有两个独立周期性模态的波动位移场进行建模。宏观应变由 Voigt 记法下的向量 $\\boldsymbol{E} \\in \\mathbb{R}^3$ 表示，其分量为 $\\boldsymbol{E} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^\\top$。第 $i$ 个求积点的微观应变为 $\\boldsymbol{\\varepsilon}_i = \\boldsymbol{E} + \\boldsymbol{B}_i \\boldsymbol{u}$，其中 $\\boldsymbol{u} \\in \\mathbb{R}^2$ 是两个周期性波动模态的幅值向量，$\\boldsymbol{B}_i \\in \\mathbb{R}^{3 \\times 2}$ 是这些模态在第 $i$ 个求积点处的应变-位移矩阵。第 $i$ 个求积点的算法本构切线矩阵为 $\\boldsymbol{D}^{\\text{ep}}_i \\in \\mathbb{R}^{3 \\times 3}$，相应的应力为 $\\boldsymbol{\\sigma}_i = \\boldsymbol{D}^{\\text{ep}}_i \\boldsymbol{\\varepsilon}_i$。求积权重为 $w_i \\in \\mathbb{R}$，对于单位面积，其满足 $\\sum_i w_i = 1$。\n\n从 Hill-Mandel 宏观均匀性条件和波动场的微观平衡（含 PBC）出发，对微观本构方程和 PBC 约束进行线性化，以获得将宏观应变增量映射到宏观应力增量的一致性宏观算法切线算子 $\\boldsymbol{C}_{\\text{eff}} \\in \\mathbb{R}^{3 \\times 3}$。使用以下基本依据：\n\n- Hill-Mandel 条件：宏观应力功率等于微观应力功率的体积平均值，即 $\\boldsymbol{\\Sigma} : \\dot{\\boldsymbol{E}} = \\langle \\boldsymbol{\\sigma} : \\dot{\\boldsymbol{\\varepsilon}} \\rangle$。\n- 每个求积点处的线性化微观本构关系：$\\delta \\boldsymbol{\\sigma}_i = \\boldsymbol{D}^{\\text{ep}}_i \\, \\delta \\boldsymbol{\\varepsilon}_i$。\n- 周期性波动场的线性化微观平衡：$\\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{\\sigma}_i = \\boldsymbol{0}$，其中波动场在周期性边界条件 (PBC) 下被约束为具有零平均梯度，即 $\\sum_i w_i \\boldsymbol{B}_i = \\boldsymbol{0}$。\n- 平面应变运动学和 Voigt 记法，其排序为 $[\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^\\top$ 和 $[\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^\\top$。\n\n推导组装以下线性化微观到宏观算子的算法：\n- 波动刚度 $\\boldsymbol{K}_{uu} = \\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{D}^{\\text{ep}}_i \\boldsymbol{B}_i \\in \\mathbb{R}^{2 \\times 2}$。\n- 耦合矩阵 $\\boldsymbol{K}_{uE} = \\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{D}^{\\text{ep}}_i \\in \\mathbb{R}^{2 \\times 3}$。\n然后从微观平衡中消去 $\\boldsymbol{u}$，得到 $\\boldsymbol{u} = - \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE} \\boldsymbol{E}$，并证明一致性宏观算法切线为\n$$\n\\boldsymbol{C}_{\\text{eff}} = \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\;-\\; \\boldsymbol{K}_{uE}^\\top \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE}.\n$$\n解释在完全耦合的多尺度方案中，$\\boldsymbol{C}_{\\text{eff}}$ 如何作为将宏观应变增量映射到应力残差修正的雅可比矩阵，被用于宏观 Newton 求解器。\n\n在程序中为以下测试套件实现此构造。该 REV 有两个求积点，权重为 $w_1 = 0.5$ 和 $w_2 = 0.5$。周期性波动应变-位移矩阵为\n$$\n\\boldsymbol{B}_1 = \n\\begin{bmatrix}\n0.6  -0.4 \\\\\n-0.3  0.5 \\\\\n0.2  -0.2\n\\end{bmatrix},\n\\quad\n\\boldsymbol{B}_2 = \n\\begin{bmatrix}\n-0.6  0.4 \\\\\n0.3  -0.5 \\\\\n-0.2  0.2\n\\end{bmatrix},\n$$\n满足 $\\sum_i w_i \\boldsymbol{B}_i = \\boldsymbol{0}$。\n\n对于每个测试用例，在无塑性体积变形（体积刚度保持弹性）和塑性可能导致偏刚度降低的假设下，给出每个求积点的材料参数以定义算法切线 $\\boldsymbol{D}^{\\text{ep}}_i$。对于具有杨氏模量 $E$ 和泊松比 $\\nu$ 的各向同性材料，其平面应变弹性模量矩阵为\n$$\n\\boldsymbol{C}_e(E,\\nu) =\n\\begin{bmatrix}\n\\lambda + 2 \\mu  \\lambda  0 \\\\\n\\lambda  \\lambda + 2 \\mu  0 \\\\\n0  0  \\mu\n\\end{bmatrix},\n\\quad\n\\lambda = \\frac{E \\nu}{(1+\\nu)(1-2\\nu)}, \\quad\n\\mu = \\frac{E}{2(1+\\nu)}.\n$$\n对于具有线性各向同性硬化模量 $H$ 的塑性激活点，使用算法剪切模量 $\\mu_{\\text{ep}} = \\mu \\cdot \\frac{H}{H + 2\\mu}$ 并保持体积（容积）刚度不变，因此\n$$\n\\boldsymbol{D}^{\\text{ep}} =\n\\begin{bmatrix}\n\\lambda + 2 \\mu_{\\text{vol}}  \\lambda  0 \\\\\n\\lambda  \\lambda + 2 \\mu_{\\text{vol}}  0 \\\\\n0  0  \\mu_{\\text{ep}}\n\\end{bmatrix},\n\\quad\n\\mu_{\\text{vol}} = \\mu,\n$$\n对于纯弹性点，$\\mu_{\\text{ep}} = \\mu$（等价于 $H \\to +\\infty$）。所有刚度项必须以帕斯卡表示。使用以下测试用例：\n\n- 测试用例 1（均匀弹性，理想情况）：$E_1 = 30 \\times 10^9$, $\\nu_1 = 0.25$, $H_1 \\to +\\infty$；$E_2 = 30 \\times 10^9$, $\\nu_2 = 0.25$, $H_2 \\to +\\infty$。\n- 测试用例 2（非均匀弹塑性，微观松弛）：$E_1 = 30 \\times 10^9$, $\\nu_1 = 0.25$, $H_1 = 2 \\times 10^9$；$E_2 = 30 \\times 10^9$, $\\nu_2 = 0.25$, $H_2 \\to +\\infty$。\n- 测试用例 3（近不可压缩弹性，边界行为）：$E_1 = 10 \\times 10^9$, $\\nu_1 = 0.49$, $H_1 \\to +\\infty$；$E_2 = 10 \\times 10^9$, $\\nu_2 = 0.49$, $H_2 \\to +\\infty$。\n\n你的程序必须：\n- 为每个测试用例组装 $\\boldsymbol{K}_{uu}$ 和 $\\boldsymbol{K}_{uE}$。\n- 使用上述公式计算 $\\boldsymbol{C}_{\\text{eff}}$。\n- 对每个测试用例，以浮点数的嵌套列表形式，按行主序输出 $\\boldsymbol{C}_{\\text{eff}}$ 的条目。\n\n最终输出格式：你的程序应生成单行输出，包含一个含三个子列表的列表，每个子列表对应一个测试用例，其中每个子列表包含九个浮点数，对应于 $\\boldsymbol{C}_{\\text{eff}}$ 按行主序排列的条目，并用方括号括起来。例如，$[\\,[c_{11},c_{12},\\dots,c_{33}],\\,[\\dots],\\,[\\dots]\\,]$。所有刚度值必须以帕斯卡表示为普通浮点数（打印的文本中不含单位）。", "solution": "该问题要求推导在平面应变条件和周期性边界条件（PBC）下，二维代表性体积单元（REV）的一致性宏观算法切线算子 $\\boldsymbol{C}_{\\text{eff}}$。推导之后是针对三个具体测试用例的计算实现。\n\n### 一致性宏观切线算子的推导\n\n推导从具有周期性微观结构的材料的计算均匀化基本原理开始。\n\n1.  **基本关系**:\n    REV 的状态由宏观应变张量 $\\boldsymbol{E}$ 和内部波动模态幅值向量 $\\boldsymbol{u}$ 描述。提供的相关方程如下：\n    -   一个求积点 $i$ 处的微观应变分解：\n        $$\n        \\boldsymbol{\\varepsilon}_i = \\boldsymbol{E} + \\boldsymbol{B}_i \\boldsymbol{u}\n        $$\n    -   宏观应力 $\\boldsymbol{\\Sigma}$，作为微观应力 $\\boldsymbol{\\sigma}_i$ 的体积平均值：\n        $$\n        \\boldsymbol{\\Sigma} = \\langle \\boldsymbol{\\sigma} \\rangle = \\sum_i w_i \\boldsymbol{\\sigma}_i\n        $$\n        其中 $w_i$ 是求积权重。\n    -   周期性波动场的微观平衡（弱形式）：\n        $$\n        \\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{\\sigma}_i = \\boldsymbol{0}\n        $$\n\n2.  **线性化**:\n    为了找到将宏观应变增量 $\\delta\\boldsymbol{E}$ 与宏观应力增量 $\\delta\\boldsymbol{\\Sigma}$ 相关联的切线算子 $\\boldsymbol{C}_{\\text{eff}}$（即 $\\delta\\boldsymbol{\\Sigma} = \\boldsymbol{C}_{\\text{eff}} \\delta\\boldsymbol{E}$），我们对控制方程进行线性化。我们对所有状态变量应用一个由 $\\delta$ 表示的增量扰动。\n\n    -   线性化微观应变分解可得：\n        $$\n        \\delta \\boldsymbol{\\varepsilon}_i = \\delta \\boldsymbol{E} + \\boldsymbol{B}_i \\delta \\boldsymbol{u}\n        $$\n        应变-位移矩阵 $\\boldsymbol{B}_i$ 是常数，因为它们仅取决于周期性模态的几何形状。\n\n    -   线性化的微观本构关系由下式给出：\n        $$\n        \\delta \\boldsymbol{\\sigma}_i = \\boldsymbol{D}^{\\text{ep}}_i \\delta \\boldsymbol{\\varepsilon}_i\n        $$\n        其中 $\\boldsymbol{D}^{\\text{ep}}_i$ 是点 $i$ 处的算法切线矩阵。\n\n    -   将线性化应变代入本构关系可得：\n        $$\n        \\delta \\boldsymbol{\\sigma}_i = \\boldsymbol{D}^{\\text{ep}}_i (\\delta \\boldsymbol{E} + \\boldsymbol{B}_i \\delta \\boldsymbol{u})\n        $$\n\n3.  **宏观应力增量**:\n    宏观应力的增量通过线性化平均关系得到：\n    $$\n    \\delta \\boldsymbol{\\Sigma} = \\sum_i w_i \\delta \\boldsymbol{\\sigma}_i\n    $$\n    代入 $\\delta \\boldsymbol{\\sigma}_i$ 的表达式：\n    $$\n    \\delta \\boldsymbol{\\Sigma} = \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i (\\delta \\boldsymbol{E} + \\boldsymbol{B}_i \\delta \\boldsymbol{u})\n    $$\n    这可以展开并重新整理为：\n    $$\n    \\delta \\boldsymbol{\\Sigma} = \\left( \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\right) \\delta \\boldsymbol{E} + \\left( \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\boldsymbol{B}_i \\right) \\delta \\boldsymbol{u}\n    $$\n\n4.  **微观平衡增量和静力凝聚**:\n    在整个变形过程中，微观平衡必须保持成立，因此其增量为零：\n    $$\n    \\delta \\left( \\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{\\sigma}_i \\right) = \\sum_i w_i \\boldsymbol{B}_i^\\top \\delta \\boldsymbol{\\sigma}_i = \\boldsymbol{0}\n    $$\n    代入 $\\delta\\boldsymbol{\\sigma}_i$ 的表达式：\n    $$\n    \\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{D}^{\\text{ep}}_i (\\delta \\boldsymbol{E} + \\boldsymbol{B}_i \\delta \\boldsymbol{u}) = \\boldsymbol{0}\n    $$\n    让我们按照要求定义以下算子：\n    -   波动刚度矩阵：$\\boldsymbol{K}_{uu} = \\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{D}^{\\text{ep}}_i \\boldsymbol{B}_i \\in \\mathbb{R}^{2 \\times 2}$\n    -   耦合矩阵：$\\boldsymbol{K}_{uE} = \\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{D}^{\\text{ep}}_i \\in \\mathbb{R}^{2 \\times 3}$\n\n    使用这些定义，线性化的平衡方程变为：\n    $$\n    \\boldsymbol{K}_{uE} \\delta \\boldsymbol{E} + \\boldsymbol{K}_{uu} \\delta \\boldsymbol{u} = \\boldsymbol{0}\n    $$\n    这个方程建立了微观波动增量 $\\delta\\boldsymbol{u}$ 和宏观应变增量 $\\delta\\boldsymbol{E}$ 之间的线性关系。我们可以通过对波动刚度矩阵 $\\boldsymbol{K}_{uu}$ 求逆来求解 $\\delta\\boldsymbol{u}$：\n    $$\n    \\boldsymbol{K}_{uu} \\delta \\boldsymbol{u} = - \\boldsymbol{K}_{uE} \\delta \\boldsymbol{E} \\implies \\delta \\boldsymbol{u} = - \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE} \\delta \\boldsymbol{E}\n    $$\n    这一步被称为静力凝聚，其中内部自由度（$\\boldsymbol{u}$）被消去。\n\n5.  **$\\boldsymbol{C}_{\\text{eff}}$ 的最终表达式**:\n    现在我们将 $\\delta\\boldsymbol{u}$ 的表达式代回到宏观应力增量 $\\delta\\boldsymbol{\\Sigma}$ 的方程中。在此之前，我们注意到，对于标准的对称算法切线（$\\boldsymbol{D}^{\\text{ep}}_i = (\\boldsymbol{D}^{\\text{ep}}_i)^\\top$），耦合矩阵的转置是 $\\boldsymbol{K}_{uE}^\\top = (\\sum_i w_i \\boldsymbol{B}_i^\\top \\boldsymbol{D}^{\\text{ep}}_i)^\\top = \\sum_i w_i (\\boldsymbol{D}^{\\text{ep}}_i)^\\top \\boldsymbol{B}_i = \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\boldsymbol{B}_i$。\n    因此，$\\delta\\boldsymbol{\\Sigma}$ 的方程可以写成：\n    $$\n    \\delta \\boldsymbol{\\Sigma} = \\left( \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\right) \\delta \\boldsymbol{E} + \\boldsymbol{K}_{uE}^\\top \\delta \\boldsymbol{u}\n    $$\n    代入 $\\delta \\boldsymbol{u} = - \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE} \\delta \\boldsymbol{E}$：\n    $$\n    \\delta \\boldsymbol{\\Sigma} = \\left( \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\right) \\delta \\boldsymbol{E} + \\boldsymbol{K}_{uE}^\\top \\left( - \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE} \\delta \\boldsymbol{E} \\right)\n    $$\n    提出 $\\delta\\boldsymbol{E}$：\n    $$\n    \\delta \\boldsymbol{\\Sigma} = \\left[ \\left( \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\right) - \\boldsymbol{K}_{uE}^\\top \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE} \\right] \\delta \\boldsymbol{E}\n    $$\n    根据定义，$\\delta\\boldsymbol{\\Sigma} = \\boldsymbol{C}_{\\text{eff}} \\delta\\boldsymbol{E}$。因此，一致性宏观算法切线算子为：\n    $$\n    \\boldsymbol{C}_{\\text{eff}} = \\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i \\;-\\; \\boldsymbol{K}_{uE}^\\top \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE}\n    $$\n    第一项 $\\sum_i w_i \\boldsymbol{D}^{\\text{ep}}_i$ 代表微观刚度的简单体积平均（一个 Voigt 型界限）。第二项 $-\\boldsymbol{K}_{uE}^\\top \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE}$ 是一个负半定修正项，它解释了由于微观结构通过周期性波动模态松弛而导致的整体刚度下降。该项仅在非均匀微观结构（其中 $\\boldsymbol{K}_{uE} \\neq \\boldsymbol{0}$）中非零。\n\n### 在宏观 Newton 求解器中的作用\n\n在一个多尺度有限元框架（通常称为 FE$^2$）中，宏观结构用有限元进行建模。在该宏观模型的每个积分点（Gauss 点），本构响应（应力和切线刚度）不是由简单的解析定律给出，而是通过在代表该点材料微观结构的 REV 上求解一个边值问题来计算的。\n\n使用全局 Newton-Raphson 迭代求解器来寻找宏观结构的平衡状态。在每次迭代 $k$ 中，求解器通过求解线性化系统来计算位移场的修正量 $\\Delta \\boldsymbol{U}^{(k+1)}$：\n$$\n\\boldsymbol{K}_T^{(k)} \\Delta \\boldsymbol{U}^{(k+1)} = \\boldsymbol{R}_{res}^{(k)}\n$$\n其中 $\\boldsymbol{R}_{res}^{(k)}$ 是残余力向量（外力和内力之间的不平衡），而 $\\boldsymbol{K}_T^{(k)}$ 是全局切线刚度矩阵。这个全局矩阵由单元刚度矩阵组装而成，单元刚度矩阵通过在单元体积上积分计算得出：\n$$\n\\boldsymbol{k}_{e}^{(k)} = \\int_{V_e} (\\boldsymbol{B}_{macro})^\\top \\boldsymbol{C}_{\\text{eff}}^{(k)} \\boldsymbol{B}_{macro} \\, dV\n$$\n这里，$\\boldsymbol{B}_{macro}$ 是宏观应变-位移矩阵，而 $\\boldsymbol{C}_{\\text{eff}}^{(k)}$ 是当前状态下的一致性宏观切线算子。这正是上面推导出的算子，在与该积分点关联的 REV 的当前状态下进行评估。$\\boldsymbol{C}_{\\text{eff}}$ 作为局部材料雅可比矩阵 $\\frac{\\partial\\boldsymbol{\\Sigma}}{\\partial\\boldsymbol{E}}$，关联了宏观应力的变化与宏观应变的变化。使用这个一致性切线对于维持 Newton-Raphson 方法的二次收敛率至关重要。\n\n### 算法实现\n\n为每个测试用例组装 $\\boldsymbol{C}_{\\text{eff}}$ 的计算步骤如下：\n1.  对于 REV 中的每个材料点 $i \\in \\{1, 2\\}$，定义材料参数（$E_i$, $\\nu_i$, $H_i$）。\n2.  构建平面应变算法切线矩阵 $\\boldsymbol{D}^{\\text{ep}}_i \\in \\mathbb{R}^{3 \\times 3}$。这涉及到计算拉梅参数 $\\lambda_i$ 和 $\\mu_i$。如果材料点是弹性的（$H_i \\to \\infty$），则 $\\mu_{\\text{ep}, i} = \\mu_i$。如果它正在塑性变形，则 $\\mu_{\\text{ep}, i} = \\mu_i \\frac{H_i}{H_i + 2\\mu_i}$。然后使用弹性的 $\\lambda_i, \\mu_i$ 组装体积部分，使用 $\\mu_{\\text{ep}, i}$ 组装偏（剪切）部分。\n3.  使用提供的求积权重 $w_i$ 和应变-位移矩阵 $\\boldsymbol{B}_i$，计算所需中间算子：\n    -   $\\boldsymbol{C}_{\\text{avg}} = w_1 \\boldsymbol{D}^{\\text{ep}}_1 + w_2 \\boldsymbol{D}^{\\text{ep}}_2$\n    -   $\\boldsymbol{K}_{uu} = w_1 \\boldsymbol{B}_1^\\top \\boldsymbol{D}^{\\text{ep}}_1 \\boldsymbol{B}_1 + w_2 \\boldsymbol{B}_2^\\top \\boldsymbol{D}^{\\text{ep}}_2 \\boldsymbol{B}_2$\n    -   $\\boldsymbol{K}_{uE} = w_1 \\boldsymbol{B}_1^\\top \\boldsymbol{D}^{\\text{ep}}_1 + w_2 \\boldsymbol{B}_2^\\top \\boldsymbol{D}^{\\text{ep}}_2$\n4.  计算波动刚度的逆矩阵 $\\boldsymbol{K}_{uu}^{-1}$。\n5.  计算修正项 $\\boldsymbol{C}_{\\text{corr}} = \\boldsymbol{K}_{uE}^\\top \\boldsymbol{K}_{uu}^{-1} \\boldsymbol{K}_{uE}$。\n6.  最后，获得有效切线算子 $\\boldsymbol{C}_{\\text{eff}} = \\boldsymbol{C}_{\\text{avg}} - \\boldsymbol{C}_{\\text{corr}}$。\n然后按行主序报告 $\\boldsymbol{C}_{\\text{eff}}$ 的九个分量。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the effective algorithmic tangent matrix C_eff for an REV\n    with periodic boundary conditions for three test cases.\n    \"\"\"\n\n    def get_dep_matrix(E, nu, H):\n        \"\"\"\n        Assembles the plane strain algorithmic tangent matrix D_ep.\n        \"\"\"\n        # Lamé parameters\n        mu = E / (2 * (1 + nu))\n        # The formula for lambda is unstable as nu -> 0.5, but the provided\n        # test cases are safe.\n        lmbda = E * nu / ((1 + nu) * (1 - 2 * nu))\n\n        # Algorithmic shear modulus\n        if H == np.inf:\n            mu_ep = mu\n        else:\n            # Formula for linear isotropic hardening model\n            mu_ep = mu * H / (H + 2 * mu)\n\n        # Assemble the 3x3 plane strain algorithmic tangent matrix.\n        # The problem states mu_vol = mu, meaning the volumetric stiffness\n        # component remains elastic.\n        D_ep = np.array([\n            [lmbda + 2 * mu, lmbda, 0.0],\n            [lmbda, lmbda + 2 * mu, 0.0],\n            [0.0, 0.0, mu_ep]\n        ])\n        return D_ep\n\n    # Common REV data\n    w1, w2 = 0.5, 0.5\n    B1 = np.array([\n        [0.6, -0.4],\n        [-0.3, 0.5],\n        [0.2, -0.2]\n    ])\n    B2 = np.array([\n        [-0.6, 0.4],\n        [0.3, -0.5],\n        [-0.2, 0.2]\n    ])\n    quad_points_geom = [(w1, B1), (w2, B2)]\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: ((E1, nu1, H1), (E2, nu2, H2))\n    test_cases = [\n        ((30e9, 0.25, np.inf), (30e9, 0.25, np.inf)),  # Case 1\n        ((30e9, 0.25, 2e9), (30e9, 0.25, np.inf)),    # Case 2\n        ((10e9, 0.49, np.inf), (10e9, 0.49, np.inf))   # Case 3\n    ]\n\n    results = []\n    for case in test_cases:\n        params1, params2 = case\n        \n        # 1. Compute D_ep for each quadrature point\n        D_ep1 = get_dep_matrix(*params1)\n        D_ep2 = get_dep_matrix(*params2)\n        \n        quad_points_mat = [D_ep1, D_ep2]\n\n        # 2. Assemble K_uu, K_uE, and the averaged stiffness\n        K_uu = np.zeros((2, 2))\n        K_uE = np.zeros((2, 3))\n        C_avg = np.zeros((3, 3))\n\n        for i in range(2):\n            w, B = quad_points_geom[i]\n            D_ep = quad_points_mat[i]\n            \n            C_avg += w * D_ep\n            K_uu += w * B.T @ D_ep @ B\n            K_uE += w * B.T @ D_ep\n\n        # 3. Compute the effective tangent operator C_eff\n        # C_eff = C_avg - K_uE^T * K_uu^{-1} * K_uE\n        \n        # For homogeneous cases, K_uE becomes zero, so no correction term.\n        # This is because D_ep1 = D_ep2 and w1*B1 + w2*B2 = 0.\n        # K_uE = (w1*B1.T + w2*B2.T) @ D_ep = (0.5*B1.T - 0.5*B1.T) @ D_ep = 0.\n        if np.allclose(K_uE, 0):\n            C_eff = C_avg\n        else:\n            K_uu_inv = np.linalg.inv(K_uu)\n            C_correction = K_uE.T @ K_uu_inv @ K_uE\n            C_eff = C_avg - C_correction\n        \n        # Flatten the matrix into row-major order and append\n        results.append(list(C_eff.flatten()))\n\n    # Format the final output as a string\n    # e.g., [[c11, c12, ...], [c11, c12, ...], ...]\n    output_str = \"[\" + \",\".join([f\"[{','.join(map(str, row))}]\" for row in results]) + \"]\"\n    \n    print(output_str)\n\nsolve()\n```", "id": "3556511"}]}