{"hands_on_practices": [{"introduction": "为了将在单元内部高斯积分点上计算得到的不连续应力场转化为在节点上连续的、全局一致的应力场，一种基本方法是采用$L^2$投影。这个练习将通过一个简单的一维杆模型，指导你构建并求解一个全局线性系统，以获得在最小二乘意义上与原始应力场最接近的连续节点应力。通过这个实践，你将掌握全局应力平滑的核心思想，为处理更复杂的问题奠定数学基础。[@problem_id:3564930]", "problem": "一根长度为 $L=3\\,\\mathrm{m}$ 的直棱柱一维杆，使用有限元法 (FEM) 离散为三个均匀的线性（双节点）单元，使得全局节点位于 $x=0\\,\\mathrm{m}$、$x=1\\,\\mathrm{m}$、$x=2\\,\\mathrm{m}$ 和 $x=3\\,\\mathrm{m}$。对每个单元，考虑标准的等参映射，其母坐标为 $\\xi \\in [-1,1]$，线性形函数为 $N_{1}(\\xi) = (1-\\xi)/2$ 和 $N_{2}(\\xi) = (1+\\xi)/2$，雅可比行列式为 $J_{e} = L_{e}/2$，其中所有单元的长度 $L_{e}=1\\,\\mathrm{m}$。轴向应力场 $\\sigma_{h}(x)$ 仅在每个单元内的两点高斯求积点位置处已知，其横坐标为 $\\xi = \\pm 1/\\sqrt{3}$，权重为 $w=1$。从左到右三个单元在高斯点处的给定轴向应力值为：\n- 单元 $1$ (连接 $x=0$ 到 $x=1$)：在 $\\xi=-1/\\sqrt{3}$ 处 $\\sigma_{1,-} = 102\\,\\mathrm{MPa}$，在 $\\xi=+1/\\sqrt{3}$ 处 $\\sigma_{1,+} = 110\\,\\mathrm{MPa}$。\n- 单元 $2$ (连接 $x=1$ 到 $x=2$)：在 $\\xi=-1/\\sqrt{3}$ 处 $\\sigma_{2,-} = 118\\,\\mathrm{MPa}$，在 $\\xi=+1/\\sqrt{3}$ 处 $\\sigma_{2,+} = 126\\,\\mathrm{MPa}$。\n- 单元 $3$ (连接 $x=2$ 到 $x=3$)：在 $\\xi=-1/\\sqrt{3}$ 处 $\\sigma_{3,-} = 134\\,\\mathrm{MPa}$，在 $\\xi=+1/\\sqrt{3}$ 处 $\\sigma_{3,+} = 142\\,\\mathrm{MPa}$。\n\n您需要构建一个在线性节点基 $\\{N_{i}(x)\\}_{i=1}^{4}$ 中表示的全局 $L^2$投影节点应力场 $\\hat{\\sigma}(x)$，使得 $\\hat{\\sigma}(x) = \\sum_{i=1}^{4} s_{i} N_{i}(x)$，并且节点应力向量 $\\{s_{i}\\}$ 能够最小化在整个杆上与 $\\sigma_{h}(x)$ 之差的 $L^2$范数。在每个单元上使用提供的两点高斯求积来近似所有积分，并为四个节点值 $\\{s_{i}\\}$ 组装一个单一的全局系统。\n\n此外，计算一个“简单平均”节点应力估计值，该值在每个全局节点上定义为共享该节点的所有单元的高斯点应力的算术平均值。对于端点节点，这是单个相邻单元中两个高斯点的平均值；对于内部节点，这是两个相邻单元中四个高斯点的平均值。\n\n报告四个全局节点处的 $L^2$投影节点应力值。以 $\\mathrm{MPa}$ 为单位表示最终节点应力值，并将您的答案四舍五入到四位有效数字。清楚地说明任何中间假设，并确保推导过程中的科学一致性。", "solution": "用户希望通过应用全局 $L^{2}$-投影，从有限元法 (FEM) 分析中找出节点应力。这个过程也称为应力平滑。\n\n### 步骤 1：问题验证\n\n问题陈述已根据指定标准进行了验证。\n\n**1. 提取已知条件：**\n- 一维杆，长度 $L=3\\,\\mathrm{m}$。\n- 离散化：$3$ 个均匀的线性（双节点）单元。\n- 全局节点位于 $x=0\\,\\mathrm{m}$、$x=1\\,\\mathrm{m}$、$x=2\\,\\mathrm{m}$、$x=3\\,\\mathrm{m}$。\n- 每个单元的长度 $L_{e}=1\\,\\mathrm{m}$。\n- 等参母坐标 $\\xi \\in [-1,1]$。\n- 线性形函数：$N_{1}(\\xi) = \\frac{1-\\xi}{2}$，$N_{2}(\\xi) = \\frac{1+\\xi}{2}$。\n- 雅可比行列式：$J_{e} = L_{e}/2 = 1/2$。\n- 高斯求积：两点法则，横坐标 $\\xi_{k} = \\pm 1/\\sqrt{3}$，权重 $w_{k}=1$。\n- 高斯点处的应力值 $\\sigma_{h}$：\n  - 单元 $1$ ($x \\in [0, 1]$)：在 $\\xi=-1/\\sqrt{3}$ 处 $\\sigma_{1,-} = 102\\,\\mathrm{MPa}$，在 $\\xi=+1/\\sqrt{3}$ 处 $\\sigma_{1,+} = 110\\,\\mathrm{MPa}$。\n  - 单元 $2$ ($x \\in [1, 2]$)：在 $\\xi=-1/\\sqrt{3}$ 处 $\\sigma_{2,-} = 118\\,\\mathrm{MPa}$，在 $\\xi=+1/\\sqrt{3}$ 处 $\\sigma_{2,+} = 126\\,\\mathrm{MPa}$。\n  - 单元 $3$ ($x \\in [2, 3]$)：在 $\\xi=-1/\\sqrt{3}$ 处 $\\sigma_{3,-} = 134\\,\\mathrm{MPa}$，在 $\\xi=+1/\\sqrt{3}$ 处 $\\sigma_{3,+} = 142\\,\\mathrm{MPa}$。\n\n**2. 任务：**\n- 对于连续应力场近似 $\\hat{\\sigma}(x) = \\sum_{i=1}^{4} s_{i} N_{i}(x)$，求全局 $L^{2}$-投影节点应力向量 $\\mathbf{s} = \\{s_{1}, s_{2}, s_{3}, s_{4}\\}^{T}$。\n- 对所有积分使用两点高斯求积。\n- 将最终值四舍五入到四位有效数字。\n\n**3. 验证结论：**\n该问题具有科学依据、适定、客观且完整。它描述了计算力学中后处理有限元结果的标准程序。未检测到任何缺陷。\n\n### 步骤 2：求解推导\n\n目标是找到节点应力值 $\\{s_{i}\\}$，以最小化不连续的有限元应力场 $\\sigma_{h}(x)$ 与其连续的、全局定义的近似 $\\hat{\\sigma}(x) = \\sum_{j=1}^{4} s_j N_j(x)$ 之间的 $L^{2}$-误差。这可以通过最小化以下泛函来实现：\n$$ \\Pi(\\mathbf{s}) = \\int_{0}^{L} (\\hat{\\sigma}(x) - \\sigma_{h}(x))^{2} dx $$\n对于每个 $i \\in \\{1, 2, 3, 4\\}$，最小化条件 $\\frac{\\partial \\Pi}{\\partial s_{i}} = 0$ 导出 Galerkin 弱形式：\n$$ \\int_{0}^{L} \\hat{\\sigma}(x) N_{i}(x) dx = \\int_{0}^{L} \\sigma_{h}(x) N_{i}(x) dx $$\n代入 $\\hat{\\sigma}(x) = \\sum_{j=1}^{4} s_j N_j(x)$，我们得到一个线性方程组：\n$$ \\sum_{j=1}^{4} \\left( \\int_{0}^{L} N_{i}(x) N_{j}(x) dx \\right) s_{j} = \\int_{0}^{L} \\sigma_{h}(x) N_{i}(x) dx $$\n该系统可以写成矩阵形式 $\\mathbf{M} \\mathbf{s} = \\mathbf{f}$，其中：\n- $\\mathbf{s} = [s_{1}, s_{2}, s_{3}, s_{4}]^T$ 是未知的节点应力向量。\n- $\\mathbf{M}$ 是全局质量矩阵，其项为 $M_{ij} = \\int_{0}^{L} N_i(x) N_j(x) dx$。\n- $\\mathbf{f}$ 是全局力向量，其项为 $f_i = \\int_{0}^{L} \\sigma_h(x) N_i(x) dx$。\n\n全局矩阵由单元贡献组装而成。对于一个线性双节点单元，单元质量矩阵 $\\mathbf{M}^{(e)}$ 和力向量 $\\mathbf{f}^{(e)}$ 在母域 $\\xi \\in [-1, 1]$ 上计算。\n\n**单元质量矩阵：**\n单元质量矩阵的项由 $M_{ab}^{(e)} = \\int_{-1}^{1} N_{a}(\\xi) N_{b}(\\xi) J_{e} d\\xi$ 给出，其中 $a,b \\in \\{1,2\\}$ 是局部节点索引。当 $L_e=1$ 且 $J_e = L_e/2 = 1/2$ 时，线性杆单元的标准单元质量矩阵为：\n$$ \\mathbf{M}^{(e)} = \\frac{L_{e}}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} = \\frac{1}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} $$\n这个结果是精确的，因为两点高斯求积可以精确积分最高为 3 次的多项式。被积函数 $N_a(\\xi)N_b(\\xi)$ 是 2 次的。\n\n**全局质量矩阵组装：**\n全局节点为 1、2、3、4。单元 1 连接节点 1、2；单元 2 连接节点 2、3；单元 3 连接节点 3、4。组装单元矩阵得到全局质量矩阵：\n$$ \\mathbf{M} = \\mathbf{M}^{(1)} + \\mathbf{M}^{(2)} + \\mathbf{M}^{(3)} = \\frac{1}{6} \\begin{pmatrix} 2  1  0  0 \\\\ 1  2+2  1  0 \\\\ 0  1  2+2  1 \\\\ 0  0  1  2 \\end{pmatrix} = \\frac{1}{6} \\begin{pmatrix} 2  1  0  0 \\\\ 1  4  1  0 \\\\ 0  1  4  1 \\\\ 0  0  1  2 \\end{pmatrix} $$\n\n**单元力向量：**\n单元力向量的项为 $f_{a}^{(e)} = \\int_{\\Omega_e} \\sigma_h(x) N_a(x) dx$。我们使用权重为 $w_k=1$、横坐标为 $\\xi_k = \\pm 1/\\sqrt{3}$ 的两点高斯求积。\n$$ f_{a}^{(e)} = \\int_{-1}^{1} \\sigma_{h}(\\xi) N_{a}(\\xi) J_{e} d\\xi \\approx \\sum_{k=1}^{2} w_k \\sigma_{h}(\\xi_k) N_{a}(\\xi_k) J_{e} = \\frac{1}{2} \\left[ \\sigma_{h}(-\\tfrac{1}{\\sqrt{3}}) N_{a}(-\\tfrac{1}{\\sqrt{3}}) + \\sigma_{h}(+\\tfrac{1}{\\sqrt{3}}) N_{a}(+\\tfrac{1}{\\sqrt{3}}) \\right] $$\n高斯点处的形函数值为：\n$N_{1}(-\\tfrac{1}{\\sqrt{3}}) = \\frac{1+1/\\sqrt{3}}{2}$，$N_{2}(-\\tfrac{1}{\\sqrt{3}}) = \\frac{1-1/\\sqrt{3}}{2}$\n$N_{1}(+\\tfrac{1}{\\sqrt{3}}) = \\frac{1-1/\\sqrt{3}}{2}$，$N_{2}(+\\tfrac{1}{\\sqrt{3}}) = \\frac{1+1/\\sqrt{3}}{2}$\n\n- **单元 1：** $\\sigma_{1,-}=102$，$\\sigma_{1,+}=110$。\n$f_{1}^{(1)} = \\frac{1}{2} \\left[ 102 \\frac{1+1/\\sqrt{3}}{2} + 110 \\frac{1-1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [212 - \\frac{8}{\\sqrt{3}}] = 53 - \\frac{2}{\\sqrt{3}}$。\n$f_{2}^{(1)} = \\frac{1}{2} \\left[ 102 \\frac{1-1/\\sqrt{3}}{2} + 110 \\frac{1+1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [212 + \\frac{8}{\\sqrt{3}}] = 53 + \\frac{2}{\\sqrt{3}}$。\n\n- **单元 2：** $\\sigma_{2,-}=118$，$\\sigma_{2,+}=126$。\n$f_{1}^{(2)} = \\frac{1}{2} \\left[ 118 \\frac{1+1/\\sqrt{3}}{2} + 126 \\frac{1-1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [244 - \\frac{8}{\\sqrt{3}}] = 61 - \\frac{2}{\\sqrt{3}}$。\n$f_{2}^{(2)} = \\frac{1}{2} \\left[ 118 \\frac{1-1/\\sqrt{3}}{2} + 126 \\frac{1+1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [244 + \\frac{8}{\\sqrt{3}}] = 61 + \\frac{2}{\\sqrt{3}}$。\n\n- **单元 3：** $\\sigma_{3,-}=134$，$\\sigma_{3,+}=142$。\n$f_{1}^{(3)} = \\frac{1}{2} \\left[ 134 \\frac{1+1/\\sqrt{3}}{2} + 142 \\frac{1-1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [276 - \\frac{8}{\\sqrt{3}}] = 69 - \\frac{2}{\\sqrt{3}}$。\n$f_{2}^{(3)} = \\frac{1}{2} \\left[ 134 \\frac{1-1/\\sqrt{3}}{2} + 142 \\frac{1+1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [276 + \\frac{8}{\\sqrt{3}}] = 69 + \\frac{2}{\\sqrt{3}}$。\n\n**全局力向量组装：**\n$f_{1} = f_{1}^{(1)} = 53 - \\frac{2}{\\sqrt{3}}$。\n$f_{2} = f_{2}^{(1)} + f_{1}^{(2)} = (53 + \\frac{2}{\\sqrt{3}}) + (61 - \\frac{2}{\\sqrt{3}}) = 114$。\n$f_{3} = f_{2}^{(2)} + f_{1}^{(3)} = (61 + \\frac{2}{\\sqrt{3}}) + (69 - \\frac{2}{\\sqrt{3}}) = 130$。\n$f_{4} = f_{2}^{(3)} = 69 + \\frac{2}{\\sqrt{3}}$。\n因此，$\\mathbf{f} = [ 53 - \\frac{2}{\\sqrt{3}}, 114, 130, 69 + \\frac{2}{\\sqrt{3}} ]^T$。\n\n**求解全局系统：**\n系统 $\\mathbf{M} \\mathbf{s} = \\mathbf{f}$ 变为：\n$$ \\frac{1}{6} \\begin{pmatrix} 2  1  0  0 \\\\ 1  4  1  0 \\\\ 0  1  4  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} s_{1} \\\\ s_{2} \\\\ s_{3} \\\\ s_{4} \\end{pmatrix} = \\begin{pmatrix} 53 - \\frac{2}{\\sqrt{3}} \\\\ 114 \\\\ 130 \\\\ 69 + \\frac{2}{\\sqrt{3}} \\end{pmatrix} $$\n两边乘以 6：\n$$ \\begin{pmatrix} 2  1  0  0 \\\\ 1  4  1  0 \\\\ 0  1  4  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} s_{1} \\\\ s_{2} \\\\ s_{3} \\\\ s_{4} \\end{pmatrix} = \\begin{pmatrix} 318 - \\frac{12}{\\sqrt{3}} \\\\ 684 \\\\ 780 \\\\ 414 + \\frac{12}{\\sqrt{3}} \\end{pmatrix} = \\begin{pmatrix} 318 - 4\\sqrt{3} \\\\ 684 \\\\ 780 \\\\ 414 + 4\\sqrt{3} \\end{pmatrix} $$\n这得到四个线性方程：\n1. $2s_{1} + s_{2} = 318 - 4\\sqrt{3}$\n2. $s_{1} + 4s_{2} + s_{3} = 684$\n3. $s_{2} + 4s_{3} + s_{4} = 780$\n4. $s_{3} + 2s_{4} = 414 + 4\\sqrt{3}$\n\n由 (1) 式，$s_{1} = (318 - 4\\sqrt{3} - s_{2})/2$。由 (4) 式，$s_{4} = (414 + 4\\sqrt{3} - s_{3})/2$。\n代入 (2) 式和 (3) 式，得到关于 $s_2$ 和 $s_3$ 的 $2 \\times 2$ 系统：\n$ (318 - 4\\sqrt{3} - s_{2})/2 + 4s_{2} + s_{3} = 684 \\implies 7s_{2} + 2s_{3} = 1050 + 4\\sqrt{3} $\n$ s_{2} + 4s_{3} + (414 + 4\\sqrt{3} - s_{3})/2 = 780 \\implies 2s_{2} + 7s_{3} = 1146 - 4\\sqrt{3} $\n将这两个方程相加得到 $9s_2 + 9s_3 = 2196$，化简为 $s_2 + s_3 = 244$。\n将 $s_3 = 244 - s_2$ 代入第一个方程：\n$ 7s_2 + 2(244 - s_2) = 1050 + 4\\sqrt{3} \\implies 5s_2 + 488 = 1050 + 4\\sqrt{3} $\n$ 5s_2 = 562 + 4\\sqrt{3} \\implies s_2 = 112.4 + \\frac{4\\sqrt{3}}{5} $。\n然后 $s_3 = 244 - s_2 = 244 - (112.4 + \\frac{4\\sqrt{3}}{5}) = 131.6 - \\frac{4\\sqrt{3}}{5}$。\n\n现在，我们求 $s_1$ 和 $s_4$：\n$ s_1 = \\frac{1}{2}(318 - 4\\sqrt{3} - s_2) = \\frac{1}{2}(318 - 4\\sqrt{3} - 112.4 - \\frac{4\\sqrt{3}}{5}) = \\frac{1}{2}(205.6 - \\frac{24\\sqrt{3}}{5}) = 102.8 - \\frac{12\\sqrt{3}}{5} $。\n$ s_4 = \\frac{1}{2}(414 + 4\\sqrt{3} - s_3) = \\frac{1}{2}(414 + 4\\sqrt{3} - 131.6 + \\frac{4\\sqrt{3}}{5}) = \\frac{1}{2}(282.4 + \\frac{24\\sqrt{3}}{5}) = 141.2 + \\frac{12\\sqrt{3}}{5} $。\n\n**数值：**\n使用 $\\sqrt{3} \\approx 1.73205$：\n$s_1 = 102.8 - \\frac{12 \\times 1.73205}{5} = 102.8 - 4.15692 = 98.64308$\n$s_2 = 112.4 + \\frac{4 \\times 1.73205}{5} = 112.4 + 1.38564 = 113.78564$\n$s_3 = 131.6 - \\frac{4 \\times 1.73205}{5} = 131.6 - 1.38564 = 130.21436$\n$s_4 = 141.2 + \\frac{12 \\times 1.73205}{5} = 141.2 + 4.15692 = 145.35692$\n\n四舍五入到四位有效数字，以 MPa 为单位的节点应力为：\n$s_1 = 98.64$\n$s_2 = 113.8$\n$s_3 = 130.2$\n$s_4 = 145.4$\n这些值代表了在 $L^2$-范数意义下，对给定不连续应力场的最佳连续线性近似。", "answer": "$$ \\boxed{ \\begin{pmatrix} 98.64  113.8  130.2  145.4 \\end{pmatrix} } $$", "id": "3564930"}, {"introduction": "与全局投影方法不同，另一种常见且计算成本更低的技术是单元层面的应力外推。这种方法首先将高斯点上的应力值外推到单元的节点，然后再进行节点平均。本练习聚焦于二维双线性四边形单元，你将推导一个外推矩阵，该矩阵直接将高斯点应力映射到节点应力，并验证该方法对于线性应力场能够精确恢复节点值的关键特性。[@problem_id:3564946]", "problem": "考虑一个二维双线性四边形有限元，其四个节点位于物理坐标 $(x,y) \\in \\{(-1,-1),(+1,-1),(+1,+1),(-1,+1)\\}$，因此在等参映射下，有 $(x,y)=(\\xi,\\eta)$，其中 $(\\xi,\\eta)$ 是自然坐标。设单元内的插值基于标准的双线性形函数 $N_{1}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1-\\eta)$，$N_{2}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1-\\eta)$，$N_{3}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1+\\eta)$ 和 $N_{4}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1+\\eta)$。在有限元法 (FEM) 中，使用每个方向两点的高斯求积 (GQ)，这些点位于 $(\\xi,\\eta)=\\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$。\n\n假设真实应力场分量在物理坐标中是线性的，由 $\\sigma_{xx}(x,y)=\\alpha+\\beta x+\\gamma y$ 给出，其中 $\\alpha=150\\,\\text{MPa}$，$\\beta=30\\,\\text{MPa}\\cdot\\text{m}^{-1}$，以及 $\\gamma=-10\\,\\text{MPa}\\cdot\\text{m}^{-1}$。在映射 $(x,y)=(\\xi,\\eta)$ 下，四个高斯点处的应力值（按 $(\\xi,\\eta)=\\left(-\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$, $\\left(-\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$ 的顺序排列）因此是\n$$\n\\sigma^{(g)}=\\begin{pmatrix}\n150-20\\,\\frac{1}{\\sqrt{3}}\\\\\n150+40\\,\\frac{1}{\\sqrt{3}}\\\\\n150+20\\,\\frac{1}{\\sqrt{3}}\\\\\n150-40\\,\\frac{1}{\\sqrt{3}}\n\\end{pmatrix}\\,\\text{MPa}.\n$$\n\n从双线性插值的基本定义以及双线性基 $\\{1,\\xi,\\eta,\\xi\\eta\\}$ 在节点和高斯点处的值出发，推导将高斯点应力向量 $\\sigma^{(g)}$ 映射到节点应力向量 $\\sigma^{(n)}$ 的 $4\\times 4$ 外推矩阵。然后，使用这个推导出的矩阵，计算外推的节点应力向量，并证明该过程在节点处保持了精确的线性应力场。\n\n以 $\\text{MPa}$ 为单位表示最终的节点应力向量分量，并将您的答案四舍五入到 $4$ 位有效数字。", "solution": "用户要求我解决一个有限元法中的应力外推问题。\n\n### 第一步：提取已知条件\n-   **单元类型**：二维双线性四边形有限元。\n-   **节点坐标**：四个节点位于物理坐标 $(x,y) \\in \\{(-1,-1),(+1,-1),(+1,+1),(-1,+1)\\}$。\n-   **等参映射**：物理坐标与自然坐标相同，$(x,y) = (\\xi,\\eta)$。\n-   **形函数**：\n    $N_{1}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1-\\eta)$\n    $N_{2}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1-\\eta)$\n    $N_{3}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1+\\eta)$\n    $N_{4}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1+\\eta)$\n    节点编号是隐含的：节点 $1$ 在 $(\\xi=-1,\\eta=-1)$，节点 $2$ 在 $(\\xi=1,\\eta=-1)$，节点 $3$ 在 $(\\xi=1,\\eta=1)$，节点 $4$ 在 $(\\xi=-1,\\eta=1)$。\n-   **高斯求积点**：使用 $2 \\times 2$ 方案，积分点位于 $(\\xi,\\eta)=\\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$。\n-   **真实应力场**：$\\sigma_{xx}(x,y)=\\alpha+\\beta x+\\gamma y$，其中 $\\alpha=150\\,\\text{MPa}$，$\\beta=30\\,\\text{MPa}\\cdot\\text{m}^{-1}$，$\\gamma=-10\\,\\text{MPa}\\cdot\\text{m}^{-1}$。\n-   **高斯点应力**：四个高斯点处的应力值，按 $(\\xi,\\eta)=\\left(-\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$, $\\left(-\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$ 顺序排列，由向量 $\\sigma^{(g)}$ 给出：\n$$\n\\sigma^{(g)}=\\begin{pmatrix}\n150-20\\,\\frac{1}{\\sqrt{3}}\\\\\n150+40\\,\\frac{1}{\\sqrt{3}}\\\\\n150+20\\,\\frac{1}{\\sqrt{3}}\\\\\n150-40\\,\\frac{1}{\\sqrt{3}}\n\\end{pmatrix}\\,\\text{MPa}.\n$$\n-   **任务**：\n    1.  推导将高斯点应力 $\\sigma^{(g)}$ 映射到节点应力 $\\sigma^{(n)}$ 的 $4\\times 4$ 外推矩阵。\n    2.  使用此矩阵计算外推的节点应力向量 $\\sigma^{(n)}$。\n    3.  证明该过程在节点处保持了精确的线性应力场。\n    4.  以 MPa 为单位表示最终答案，并四舍五入到 $4$ 位有效数字。\n\n### 第二步：使用提取的已知条件进行验证\n-   **科学依据**：该问题描述了有限元法中一个标准且基础的后处理技术，特别是从高斯点到节点的应力平滑和外推。双线性形函数、高斯求积和等参映射的使用都是计算力学的核心概念。该问题在科学上是合理的。\n-   **适定性**：问题是适定的。所有必要信息都已提供：单元几何形状、形函数、高斯点位置以及这些点上的应力值。目标明确陈述，并导向唯一解。\n-   **客观性**：问题以精确的数学语言陈述，没有歧义或主观论断。所提供的高斯点应力值与给定的线性应力场一致，这一点可以被验证。\n-   **一致性检查**：该问题陈述了一个坐标相关的应力场，并定义了一个具有特定尺寸的单元。对于位于 $(\\pm 1, \\pm 1)$ 的节点，映射 $(x,y)=(\\xi,\\eta)$ 可能会在单位上产生歧义。然而，将物理单元域解释为 $[-1,1] \\times [-1,1]$ (单位为米) 的做法，与从函数 $\\sigma_{xx}(x,y)$ 计算高斯点应力的过程是一致的。在这种解释下，设置是完全一致的。例如，在 GP1 $(\\xi, \\eta) = (-1/\\sqrt{3}, -1/\\sqrt{3})$ 处，应力为 $\\sigma_{xx} = 150 + 30(-1/\\sqrt{3}) - 10(-1/\\sqrt{3}) = 150 - 20/\\sqrt{3}$，这与提供的 $\\sigma_1^{(g)}$ 相匹配。\n\n### 第三步：结论与行动\n问题是有效的。这是一个计算力学中的标准练习，自洽、一致且适定。我将继续进行求解。\n\n将应力从高斯点外推到节点的程序包括，根据高斯点数据拟合一个函数，然后在节点位置评估该函数。对于双线性单元，我们拟合一个形式为 $\\sigma^*(\\xi, \\eta) = c_0 + c_1\\xi + c_2\\eta + c_3\\xi\\eta$ 的双线性函数。对于任何本身在 $\\xi$ 和 $\\eta$ 中是双线性的应力场，此方法都是精确的。由于映射是 $(x,y)=(\\xi,\\eta)$，给定的线性应力场 $\\sigma_{xx}(x,y) = \\alpha+\\beta x+\\gamma y$ 在 $(\\xi,\\eta)$ 中也是线性的，并且是可以由双线性基精确表示的函数子集。\n\n令 $\\boldsymbol{\\sigma}^{(g)}$ 为 4 个高斯点处的已知应力向量，$\\boldsymbol{\\sigma}^{(n)}$ 为 4 个节点处的未知应力向量。我们寻求一个外推矩阵 $\\mathbf{E}$，使得 $\\boldsymbol{\\sigma}^{(n)} = \\mathbf{E}\\boldsymbol{\\sigma}^{(g)}$。\n\n双线性场的系数 $\\mathbf{c} = (c_0, c_1, c_2, c_3)^T$ 与高斯点处的值之间的关系由 $\\boldsymbol{\\sigma}^{(g)} = \\mathbf{P}^{(g)}\\mathbf{c}$ 给出，其中 $\\mathbf{P}^{(g)}$ 是在各高斯点处求值的基函数 $\\{1, \\xi, \\eta, \\xi\\eta\\}$ 组成的矩阵。\n类似地，节点处的值由 $\\boldsymbol{\\sigma}^{(n)} = \\mathbf{P}^{(n)}\\mathbf{c}$ 给出，其中 $\\mathbf{P}^{(n)}$ 是在各节点坐标处求值的基函数组成的矩阵。\n\n从这些关系中，我们得到 $\\mathbf{c} = (\\mathbf{P}^{(g)})^{-1}\\boldsymbol{\\sigma}^{(g)}$。将其代入节点应力的方程中，得到：\n$\\boldsymbol{\\sigma}^{(n)} = \\mathbf{P}^{(n)}(\\mathbf{P}^{(g)})^{-1}\\boldsymbol{\\sigma}^{(g)}$。\n因此，外推矩阵是 $\\mathbf{E} = \\mathbf{P}^{(n)}(\\mathbf{P}^{(g)})^{-1}$。\n\n节点位于 $(\\xi,\\eta) \\in \\{(-1,-1),(1,-1),(1,1),(-1,1)\\}$。基是 $\\{1, \\xi, \\eta, \\xi\\eta\\}$。矩阵 $\\mathbf{P}^{(n)}$ 是：\n$$ \\mathbf{P}^{(n)} = \\begin{pmatrix}\n1  -1  -1  1 \\\\\n1  1  -1  -1 \\\\\n1  1  1  1 \\\\\n1  -1  1  -1\n\\end{pmatrix} $$\n高斯点位于 $(\\xi,\\eta) \\in \\{(-a,-a),(a,-a),(a,a),(-a,a)\\}$，其中 $a = 1/\\sqrt{3}$。矩阵 $\\mathbf{P}^{(g)}$ 是：\n$$ \\mathbf{P}^{(g)} = \\begin{pmatrix}\n1  -a  -a  a^2 \\\\\n1  a  -a  -a^2 \\\\\n1  a  a  a^2 \\\\\n1  -a  a  -a^2\n\\end{pmatrix} $$\n为了找到 $(\\mathbf{P}^{(g)})^{-1}$，我们可以求解方程组 $\\mathbf{P}^{(g)}\\mathbf{c} = \\boldsymbol{\\sigma}^{(g)}$ 以得到 $\\mathbf{c}$：\n$\\sigma_{g1} = c_0 - a c_1 - a c_2 + a^2 c_3$\n$\\sigma_{g2} = c_0 + a c_1 - a c_2 - a^2 c_3$\n$\\sigma_{g3} = c_0 + a c_1 + a c_2 + a^2 c_3$\n$\\sigma_{g4} = c_0 - a c_1 + a c_2 - a^2 c_3$\n求解此方程组可得：\n$c_0 = \\frac{1}{4}(\\sigma_{g1}+\\sigma_{g2}+\\sigma_{g3}+\\sigma_{g4})$\n$c_1 = \\frac{1}{4a}(-\\sigma_{g1}+\\sigma_{g2}+\\sigma_{g3}-\\sigma_{g4})$\n$c_2 = \\frac{1}{4a}(-\\sigma_{g1}-\\sigma_{g2}+\\sigma_{g3}+\\sigma_{g4})$\n$c_3 = \\frac{1}{4a^2}(\\sigma_{g1}-\\sigma_{g2}+\\sigma_{g3}-\\sigma_{g4})$\n这给出了逆矩阵 $(\\mathbf{P}^{(g)})^{-1}$：\n$$ (\\mathbf{P}^{(g)})^{-1} = \\frac{1}{4} \\begin{pmatrix}\n1  1  1  1 \\\\\n-1/a  1/a  1/a  -1/a \\\\\n-1/a  -1/a  1/a  1/a \\\\\n1/a^2  -1/a^2  1/a^2  -1/a^2\n\\end{pmatrix} $$\n令 $b = 1/a = \\sqrt{3}$。则 $b^2 = 3$。\n$$ (\\mathbf{P}^{(g)})^{-1} = \\frac{1}{4} \\begin{pmatrix}\n1  1  1  1 \\\\\n-b  b  b  -b \\\\\n-b  -b  b  b \\\\\nb^2  -b^2  b^2  -b^2\n\\end{pmatrix} $$\n现在我们计算外推矩阵 $\\mathbf{E} = \\mathbf{P}^{(n)}(\\mathbf{P}^{(g)})^{-1}$：\n$$ \\mathbf{E} = \\frac{1}{4} \\begin{pmatrix}\n1  -1  -1  1 \\\\\n1  1  -1  -1 \\\\\n1  1  1  1 \\\\\n1  -1  1  -1\n\\end{pmatrix}\n\\begin{pmatrix}\n1  1  1  1 \\\\\n-b  b  b  -b \\\\\n-b  -b  b  b \\\\\nb^2  -b^2  b^2  -b^2\n\\end{pmatrix} $$\n$\\mathbf{E}$ 的第一行是：\n$E_{1j} = \\frac{1}{4}(1, 1+2b, 1-2b, 1) \\rightarrow E_{1j} = \\frac{1}{4}(1(1)+(-1)(-b)+(-1)(-b)+1(b^2), 1(1)+(-1)(b)+(-1)(-b)+1(-b^2), \\dots)$\n$E_{11} = \\frac{1}{4}(1+b+b+b^2) = \\frac{1}{4}(1+2b+b^2) = \\frac{1}{4}(1+b)^2 = \\frac{1}{4}(1+\\sqrt{3})^2 = 1+\\frac{\\sqrt{3}}{2}$\n$E_{12} = \\frac{1}{4}(1-b+b-b^2) = \\frac{1}{4}(1-b^2) = \\frac{1}{4}(1-3) = -\\frac{1}{2}$\n$E_{13} = \\frac{1}{4}(1-b-b+b^2) = \\frac{1}{4}(1-2b+b^2) = \\frac{1}{4}(1-b)^2 = \\frac{1}{4}(1-\\sqrt{3})^2 = 1-\\frac{\\sqrt{3}}{2}$\n$E_{14} = \\frac{1}{4}(1+b-b-b^2) = \\frac{1}{4}(1-b^2) = -\\frac{1}{2}$\n\n由于矩阵的对称性，我们可以构建出完整的矩阵 $\\mathbf{E}$：\n$$ \\mathbf{E} = \\begin{pmatrix}\n1+\\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  1-\\frac{\\sqrt{3}}{2}  -\\frac{1}{2} \\\\\n-\\frac{1}{2}  1+\\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  1-\\frac{\\sqrt{3}}{2} \\\\\n1-\\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  1+\\frac{\\sqrt{3}}{2}  -\\frac{1}{2} \\\\\n-\\frac{1}{2}  1-\\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  1+\\frac{\\sqrt{3}}{2}\n\\end{pmatrix} $$\n现在，我们计算节点应力向量 $\\boldsymbol{\\sigma}^{(n)} = \\mathbf{E}\\boldsymbol{\\sigma}^{(g)}$。\n$$ \\boldsymbol{\\sigma}^{(g)} = \\begin{pmatrix}\n150-20/\\sqrt{3}\\\\\n150+40/\\sqrt{3}\\\\\n150+20/\\sqrt{3}\\\\\n150-40/\\sqrt{3}\n\\end{pmatrix} = 150\\begin{pmatrix}1\\\\1\\\\1\\\\1\\end{pmatrix} + \\frac{1}{\\sqrt{3}}\\begin{pmatrix}-20\\\\40\\\\20\\\\-40\\end{pmatrix} $$\n令 $\\mathbf{1}=(1,1,1,1)^T$ 和 $\\mathbf{v}=(-20,40,20,-40)^T$。$\\mathbf{E}$ 的每行之和为 $1$，因此 $\\mathbf{E}\\mathbf{1}=\\mathbf{1}$。因此，计算可以简化为：\n$\\boldsymbol{\\sigma}^{(n)} = 150 \\cdot \\mathbf{1} + \\frac{1}{\\sqrt{3}}\\mathbf{E}\\mathbf{v}$。\n\n我们计算 $\\mathbf{E}\\mathbf{v}$：\n- 对于节点 1:\n$(\\mathbf{E}\\mathbf{v})_1 = (1+\\frac{\\sqrt{3}}{2})(-20) - \\frac{1}{2}(40) + (1-\\frac{\\sqrt{3}}{2})(20) - \\frac{1}{2}(-40) = -20-10\\sqrt{3} - 20 + 20-10\\sqrt{3} + 20 = -20\\sqrt{3}$。\n$\\sigma_1^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(-20\\sqrt{3}) = 150 - 20 = 130$。\n验证：节点 1 $(x=-1, y=-1)$ 处的精确应力为 $\\sigma_{xx}(-1,-1) = 150+30(-1)-10(-1) = 150-30+10 = 130$。匹配。\n\n- 对于节点 2:\n$(\\mathbf{E}\\mathbf{v})_2 = -\\frac{1}{2}(-20) + (1+\\frac{\\sqrt{3}}{2})(40) - \\frac{1}{2}(20) + (1-\\frac{\\sqrt{3}}{2})(-40) = 10 + 40+20\\sqrt{3} - 10 - 40+20\\sqrt{3} = 40\\sqrt{3}$。\n$\\sigma_2^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(40\\sqrt{3}) = 150 + 40 = 190$。\n验证：节点 2 $(x=1, y=-1)$ 处的精确应力为 $\\sigma_{xx}(1,-1) = 150+30(1)-10(-1) = 150+30+10 = 190$。匹配。\n\n- 对于节点 3:\n$(\\mathbf{E}\\mathbf{v})_3 = (1-\\frac{\\sqrt{3}}{2})(-20) - \\frac{1}{2}(40) + (1+\\frac{\\sqrt{3}}{2})(20) - \\frac{1}{2}(-40) = -20+10\\sqrt{3} - 20 + 20+10\\sqrt{3} + 20 = 20\\sqrt{3}$。\n$\\sigma_3^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(20\\sqrt{3}) = 150 + 20 = 170$。\n验证：节点 3 $(x=1, y=1)$ 处的精确应力为 $\\sigma_{xx}(1,1) = 150+30(1)-10(1) = 150+30-10 = 170$。匹配。\n\n- 对于节点 4:\n$(\\mathbf{E}\\mathbf{v})_4 = -\\frac{1}{2}(-20) + (1-\\frac{\\sqrt{3}}{2})(40) - \\frac{1}{2}(20) + (1+\\frac{\\sqrt{3}}{2})(-40) = 10 + 40-20\\sqrt{3} - 10 - 40-20\\sqrt{3} = -40\\sqrt{3}$。\n$\\sigma_4^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(-40\\sqrt{3}) = 150 - 40 = 110$。\n验证：节点 4 $(x=-1, y=1)$ 处的精确应力为 $\\sigma_{xx}(-1,1) = 150+30(-1)-10(1) = 150-30-10 = 110$。匹配。\n\n计算表明，正如预期的那样，外推程序正确地恢复了线性应力场的精确节点值。最终的节点应力向量，分量按节点编号排序，为 $(130, 190, 170, 110)\\,\\text{MPa}$。四舍五入到 4 位有效数字，我们将这些表示为 $130.0$、$190.0$、$170.0$ 和 $110.0$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n130.0  190.0  170.0  110.0\n\\end{pmatrix}\n}\n$$", "id": "3564946"}, {"introduction": "在实际应用中，直接外推并平均得到的节点应力场可能存在伪影或“噪声”，需要进一步处理以获得物理上更合理的解。本练习是一个综合性的高级实践，它引入了图拉普拉斯算子作为一种正则化工具来平滑节点应力场。更重要的是，它要求你检验最终应力场在多大程度上满足静力平衡这一基本物理定律，从而将数值后处理技术与岩土力学的核心物理原则联系起来。[@problem_id:3564967]", "problem": "给定一个二维双线性四边形网格以及每个单元内部标准 $2\\times2$ 高斯点上的原始柯西应力样本。目标是通过将高斯点应力外插到网格节点来构建节点应力场，然后使用图拉普拉斯罚项对节点应力进行正则化。在获得正则化的节点应力后，使用有限元法（FEM）通过从应力场组集内部节点力以及从重力组集体力来评估重力作用下的离散平衡残差。最终程序必须針對一组指定的正则化参数，计算最大节点残差的模，并将这些值在单行中报告。\n\n基本原理和物理设置：\n- 静态平衡要求 $\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\mathbf{g}=\\mathbf{0}$，其中 $\\boldsymbol{\\sigma}$ 是柯西应力张量，$\\rho$ 是质量密度，$\\mathbf{g}$ 是重力加速度向量。\n- 在有限元法框架中，对于双线性四边形单元，与应力场相关的内部节点力向量 $\\mathbf{f}_{\\text{int}}$ 由 $\\int_{\\Omega_e}\\mathbf{B}^\\top\\boldsymbol{\\sigma}\\,\\mathrm{d}\\Omega$ 的单元组集给出，其中 $\\mathbf{B}$ 是由形函数的物理导数构建的标准应变-位移矩阵。体力向量 $\\mathbf{f}_{\\text{body}}$ 是 $\\int_{\\Omega_e}\\mathbf{N}^\\top\\rho\\mathbf{g}\\,\\mathrm{d}\\Omega$ 的组集，其中 $\\mathbf{N}$ 是形函数矩阵。\n- 目标节点应力向量 $\\boldsymbol{\\sigma}_n$ 通过最小化二次目标函数 $\\|\\boldsymbol{\\sigma}_n-\\mathbf{E}\\boldsymbol{\\sigma}_g\\|^2+\\beta\\sum_{(i,j)\\in\\mathcal{E}}\\|\\boldsymbol{\\sigma}_i-\\boldsymbol{\\sigma}_j\\|^2$ 获得，其中 $\\boldsymbol{\\sigma}_g$ 堆叠了给定的高斯点应力，$\\mathbf{E}$ 是一个将高斯点应力映射到初始节点估计的全局外插算子，$\\beta\\ge 0$ 是一个标量正则化参数，$\\mathcal{E}$ 是连接相邻节点的无向网格边的集合。图拉普拉斯矩阵 $\\mathbf{L}$ 定义为 $\\mathbf{L}=\\mathbf{D}-\\mathbf{A}$，其中 $\\mathbf{A}$ 是邻接矩阵（如果节点 $i$ 和 $j$ 共享一个单元边，则 $\\mathbf{A}_{ij}=1$，否则为 $0$），$\\mathbf{D}$ 是对角度矩阵（$\\mathbf{D}_{ii}=\\sum_j\\mathbf{A}_{ij}$）。最小化器按分量满足 $(\\mathbf{I}+\\beta\\mathbf{L})\\boldsymbol{\\sigma}_n=\\mathbf{E}\\boldsymbol{\\sigma}_g$。\n\n网格和数据：\n- 矩形域，宽 $W=2\\,\\text{m}$，高 $H=2\\,\\text{m}$，坐标为 $(x,y)$，y轴指向下方（因此重力在正y方向）。假设为平面应变，单位厚度 $t=1\\,\\text{m}$。\n- 具有 $3\\times3$ 个节点的结构化双线性四边形网格：坐标 $(x,y)\\in\\{0,1,2\\}\\times\\{0,1,2\\}$（单位：米）。四个单元：左下单元连接节点 $\\{(0,0),(1,0),(1,1),(0,1)\\}$，右下单元连接 $\\{(1,0),(2,0),(2,1),(1,1)\\}$，左上单元连接 $\\{(0,1),(1,1),(1,2),(0,2)\\}$，右上单元连接 $\\{(1,1),(2,1),(2,2),(1,2)\\}$；每个单元内的节点排序为 $\\{(x_1,y_1),(x_2,y_2),(x_3,y_3),(x_4,y_4)\\}=\\{\\text{左下},\\text{右下},\\text{右上},\\text{左上}\\}$。\n- 质量密度 $\\rho=2000\\,\\text{kg/m}^3$ 和重力加速度向量 $\\mathbf{g}=[0,9.81]\\,\\text{m/s}^2$。\n- 原始高斯点应力由重力平衡场定义\n$$\n\\sigma_{xx}=0,\\quad \\sigma_{yy}=-\\rho\\,g_y\\,y,\\quad \\sigma_{xy}=0,\n$$\n在标准双线性四边形 $2\\times2$ 高斯点的物理坐标处求值，即自然坐标 $(\\xi,\\eta)\\in\\{\\pm 1/\\sqrt{3}\\}\\times\\{\\pm 1/\\sqrt{3}\\}$ 通过双线性形函数映射到 $(x,y)$。\n- 外插 $\\mathbf{E}$ 是通过对每个分量的四个高斯点应力样本拟合一个双线性多项式 $s(\\xi,\\eta)=a_0+a_1\\xi+a_2\\eta+a_3\\xi\\eta$ 并在四个单元角节点 $(\\xi,\\eta)\\in\\{(-1,-1),(1,-1),(1,1),(-1,1)\\}$ 处求值 $s$ 来逐单元定义的。全局初始节点应力 $\\mathbf{s}_0=\\mathbf{E}\\boldsymbol{\\sigma}_g$ 是共享同一全局节点的所有单元级节点外插值的平均值。\n- 图拉普拉斯正则化沿单元边使用单位边权重。对每个应力分量 $s\\in\\{\\sigma_{xx},\\sigma_{yy},\\sigma_{xy}\\}$ 独立求解 $(\\mathbf{I}+\\beta\\mathbf{L})\\boldsymbol{\\sigma}_n=\\mathbf{s}_0$。\n\n离散平衡残差：\n- 使用正则化的节点应力场，通过双线性形函数将应力插值到高斯点，并使用每个点权重为 $1$ 的 $2\\times2$ 高斯积分评估内部节点力向量 $\\mathbf{f}_{\\text{int}}$：\n$$\n\\mathbf{f}_{\\text{int},e}=\\sum_{k=1}^{4}\\mathbf{B}(\\xi_k,\\eta_k)^\\top\\,\\boldsymbol{\\sigma}(\\xi_k,\\eta_k)\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t,\n$$\n并对所有单元求和。这里 $\\mathbf{B}$ 是通过形函数的物理导数计算的标准 $3\\times 8$ 应变-位移矩阵，$\\mathbf{J}$ 是等参映射的雅可比矩阵。\n- 体力向量为\n$$\n\\mathbf{f}_{\\text{body},e}=\\sum_{k=1}^{4}\\mathbf{N}(\\xi_k,\\eta_k)^\\top\\,\\rho\\mathbf{g}\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t,\n$$\n并对所有单元求和。全局残差为 $\\mathbf{r}=\\mathbf{f}_{\\text{int}}+\\mathbf{f}_{\\text{body}}$。\n- 计算节点残差的模 $\\|\\mathbf{r}_i\\|_2=\\sqrt{r_{ix}^2+r_{iy}^2}$ 并报告所有节点中的最大值。\n\n单位和输出：\n- 所有力都必须以牛顿（$\\text{N}$）为单位。程序必须为测试套件中的每个测试用例计算以 $\\text{N}$ 为单位的最大节点残差模，并输出一个单行，其中包含用方括号括起来的逗号分隔列表。\n- 测试套件（正则化参数）：$\\beta\\in\\{0.0,0.1,10.0\\}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$\\texttt{[result1,result2,result3]}$）。", "solution": "用户希望使用有限元法（FEM）解决一个计算地质力学问题，该问题涉及二维四边形网格中的应力分析。\n\n### 步骤 1：提取给定条件\n- **问题类型**：二维平面应变静态平衡分析。\n- **控制方程**：$\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\mathbf{g}=\\mathbf{0}$。\n- **几何**：尺寸为 $W=2\\,\\text{m} \\times H=2\\,\\text{m}$ 的矩形域。\n- **网格**：$3 \\times 3$ 的结构化节点网格，形成 4 个双线性四边形单元。\n  - 节点坐标：$(x,y) \\in \\{0,1,2\\} \\times \\{0,1,2\\}$ 米。\n  - 单元 1 (左下): 节点位于 $\\{(0,0),(1,0),(1,1),(0,1)\\}$。\n  - 单元 2 (右下): 节点位于 $\\{(1,0),(2,0),(2,1),(1,1)\\}$。\n  - 单元 3 (左上): 节点位于 $\\{(0,1),(1,1),(1,2),(0,2)\\}$。\n  - 单元 4 (右上): 节点位于 $\\{(1,1),(2,1),(2,2),(1,2)\\}$。\n- **材料与载荷**：\n  - 质量密度：$\\rho=2000\\,\\text{kg/m}^3$。\n  - 重力加速度：$\\mathbf{g}=[0, 9.81]\\,\\text{m/s}^2$ (y轴指向下方)。\n- **应力场**：\n  - 高斯点处的原始应力从解析场采样：$\\sigma_{xx}=0$, $\\sigma_{yy}=-\\rho\\,g_y\\,y$, $\\sigma_{xy}=0$。\n  - 高斯点是标准的 $2 \\times 2$ 集合，自然坐标为 $(\\xi,\\eta)\\in\\{\\pm 1/\\sqrt{3}\\} \\times \\{\\pm 1/\\sqrt{3}\\}$。\n- **数值方法**：\n  1.  **应力外插**：通过在每个单元内拟合双线性多项式 $s(\\xi,\\eta)=a_0+a_1\\xi+a_2\\eta+a_3\\xi\\eta$，将高斯点应力外插到单元节点。\n  2.  **节点平均**：通过对共享一个节点的所有单元的外插值进行平均，获得初始的全局节点应力场 $\\mathbf{s}_0$。\n  3.  **正则化**：通过求解 $(\\mathbf{I}+\\beta\\mathbf{L})\\boldsymbol{\\sigma}_n=\\mathbf{s}_0$ 来找到最终的节点应力 $\\boldsymbol{\\sigma}_n$，其中 $\\mathbf{L}$ 是网格的图拉普拉斯算子，$\\beta$ 是正则化参数。此操作对每个应力分量独立进行。\n  4.  **力的计算**：使用 $2 \\times 2$ 高斯积分计算内力 $\\mathbf{f}_{\\text{int}}$ 和体力 $\\mathbf{f}_{\\text{body}}$。\n      - $\\mathbf{f}_{\\text{int}} = \\text{组集} \\left( \\sum_{k=1}^{4}\\mathbf{B}(\\xi_k,\\eta_k)^\\top\\,\\boldsymbol{\\sigma}(\\xi_k,\\eta_k)\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t \\right)$\n      - $\\mathbf{f}_{\\text{body}} = \\text{组集} \\left( \\sum_{k=1}^{4}\\mathbf{N}(\\xi_k,\\eta_k)^\\top\\,\\rho\\mathbf{g}\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t \\right)$\n      - 注意：高斯积分权重均为 $1$。\n- **任务**：\n  - 计算全局平衡残差 $\\mathbf{r}=\\mathbf{f}_{\\text{int}}+\\mathbf{f}_{\\text{body}}$。\n  - 计算每个节点残差向量的L2范数：$\\|\\mathbf{r}_i\\|_2=\\sqrt{r_{ix}^2+r_{iy}^2}$。\n  - 找出所有节点中最大的节点残差模。\n- **测试用例**：必须对正则化参数 $\\beta \\in \\{0.0, 0.1, 10.0\\}$ 进行计算。\n- **输出**：一个单行，包含一个用方括号括起来的逗号分隔列表，内容是各测试用例的最大节点残差模（单位：牛顿）。\n\n### 步骤 2：使用提取的给定条件进行验证\n该问题是适定的并且有科学依据。\n- **科学依据**：该问题基于连续介质力学（静态平衡）和有限元法的基本原理，有限元法是工程和物理学中一种标准且成熟的数值技术。所提供的应力场 $\\sigma_{yy} = -\\rho g_y y$ 在 $\\mathbf{g}=[0, g_y]$ 且其他应力分量为零时，正确满足平衡方程 $\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\mathbf{g}=\\mathbf{0}$。\n- **适定性**：问题是完全指定的。网格、材料属性、边界条件（通过应力场隐含）以及数值程序都已明确定义。任务是为一组给定的参数计算一个特定的量（最大节点残差）。使用一个半正定的图拉普拉斯矩阵加上一个正单位矩阵，确保了正则化的线性系统是可逆的，并为 $\\boldsymbol{\\sigma}_n$ 产生唯一解。\n- **客观性**：问题以精确的数学和工程术语陈述，没有主观或模糊的语言。所有量都有定义，过程是算法化的。\n- **完整性**：所有必要的数据（$\\rho$, $\\mathbf{g}$, 网格几何，FEM公式）都已提供。没有信息缺失。\n- **一致性**：尺寸和单位是一致的。物理定律和数值公式是内部一致的。例如，残差的定义 $\\mathbf{r}=\\mathbf{f}_{\\text{int}}+\\mathbf{f}_{\\text{body}}$ 与形如 $\\int \\mathbf{B}^T \\boldsymbol{\\sigma} d\\Omega + \\int \\mathbf{N}^T \\rho\\mathbf{g} d\\Omega = \\mathbf{0}$ 的平衡陈述一致，这是控制偏微分方程的有效弱形式。\n\n该问题没有任何无效性缺陷。这是一个标准但复杂的计算练习。\n\n### 步骤 3：结论与行动\n该问题是 **有效的**。将开发并实现一个分步解决方案。\n\n### 基于原则的设计\n解决方案遵循一个源自有限元法的结构化、多步骤方法。\n\n1.  **网格和求积设置**：我们首先定义网格拓扑（节点坐标和单元连接性）以及数值积分的参数（高斯点和权重）。这些构成了我们分析的离散域。\n\n2.  **初始应力场计算**：过程从解析应力场开始。\n    - 对四个单元中的每一个，我们遍历四个 $2 \\times 2$ 高斯点。\n    - 使用等参映射将每个高斯点的自然坐标 $(\\xi_k, \\eta_k)$ 映射到物理坐标 $(x_k, y_k)$：$\\mathbf{x}(\\xi, \\eta) = \\sum_i N_i(\\xi, \\eta) \\mathbf{x}_i$，其中 $N_i$ 是双线性形函数，$\\mathbf{x}_i$ 是单元的节点坐标。\n    - 在每个物理点 $(x_k, y_k)$，我们评估“基准真相”应力分量：$\\sigma_{xx,k}=0$、$\\sigma_{yy,k}=-\\rho g_y y_k$、$\\sigma_{xy,k}=0$。这为我们提供了所有高斯点应力的集合 $\\boldsymbol{\\sigma}_g$。\n\n3.  **外插和平均**：使用离散的高斯点应力来构建一个在节点上定义的初始连续场。\n    - 在每个单元内，每个分量的四个应力值用于拟合一个双线性场 $s(\\xi, \\eta)$。这等同于应用一个预先计算的 $4 \\times 4$ 外插矩阵 $\\mathbf{E}_{\\text{elem}}$，它将四个高斯点的值映射到单元局部角节点 $(\\pm 1, \\pm 1)$ 处的四个值。\n    - 由于内部节点由多个单元共享，它们会收到多个通常不同的应力预测。问题指定了一种平均方案：全局节点的初始节点应力 $\\mathbf{s}_0$ 是所有连接到它的单元贡献的算术平均值。\n\n4.  **图拉普拉斯正则化**：初始节点应力场 $\\mathbf{s}_0$ 通常是噪声的或不光滑的。应用正则化步骤来强制空间平滑性。\n    - 我们为网格构建图拉普拉斯矩阵 $\\mathbf{L} = \\mathbf{D} - \\mathbf{A}$，其中 $\\mathbf{A}$ 是邻接矩阵（连接共享边的节点），$\\mathbf{D}$ 是对角度矩阵。\n    - 对于每个给定的正则化参数 $\\beta$，我们求解线性系统 $(\\mathbf{I} + \\beta \\mathbf{L})\\boldsymbol{\\sigma}_n = \\mathbf{s}_0$ 以获得平滑的节点应力 $\\boldsymbol{\\sigma}_n$。这对三个应力分量（$\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}$）中的每一个都独立进行。此操作充当一个低通滤波器，其中 $\\beta$ 控制平滑程度。当 $\\beta=0$ 时，$\\boldsymbol{\\sigma}_n = \\mathbf{s}_0$。\n\n5.  **平衡残差计算**：我们评估正则化应力场 $\\boldsymbol{\\sigma}_n$ 满足离散平衡的程度。\n    - **体力**：我们首先计算全局体力向量 $\\mathbf{f}_{\\text{body}}$。这是通过组集单元贡献来完成的。对于每个单元，我们使用 $2 \\times 2$ 高斯积分在单元体积上积分 $\\mathbf{N}^\\top \\rho \\mathbf{g}$。由于几何形状和载荷是固定的，该向量对于所有测试用例都是恒定的。\n    - **内力**：然后我们计算取决于应力场的全局内力向量 $\\mathbf{f}_{\\text{int}}$。对于每个 $\\beta$，我们使用相应的 $\\boldsymbol{\\sigma}_n$。\n        - 在每个单元内，我们遍历高斯点。在每个点，我们从正则化的节点值插值应力：$\\boldsymbol{\\sigma}(\\xi_k, \\eta_k) = \\sum_i N_i(\\xi_k, \\eta_k) \\boldsymbol{\\sigma}_{n,i}$。\n        - 然后我们使用高斯积分评估积分 $\\int \\mathbf{B}^\\top \\boldsymbol{\\sigma} \\, d\\Omega$，其中 $\\mathbf{B}$ 是将节点位移与应变关联的应变-位移矩阵。\n        - 将得到的单元力向量组集到全局向量 $\\mathbf{f}_{\\text{int}}$ 中。\n    - **残差**：然后全局残差为 $\\mathbf{r} = \\mathbf{f}_{\\text{int}} + \\mathbf{f}_{\\text{body}}$。如果平衡被完美满足，$\\mathbf{r}$ 将为零。外插、平均和正则化会引入误差，导致非零残差。\n\n6.  **结果评估**：最后，我们量化平衡误差的大小。\n    - 将 $18 \\times 1$ 的全局残差向量 $\\mathbf{r}$ 重新解释为九个 $2 \\times 1$ 向量的集合，每个节点一个。\n    - 我们计算每个节点处残差的欧几里得范数 $\\|\\mathbf{r}_i\\|_2$。\n    - 对于给定的 $\\beta$，这些节点范数中的最大值是最终结果。对所有指定的 $\\beta$ 值重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum nodal equilibrium residual for a regularized stress field\n    in a 2D quadrilateral mesh under gravity.\n    \"\"\"\n    # --------------------------------------------------------------------------\n    # 1. GIVENS AND MESH DEFINITION\n    # --------------------------------------------------------------------------\n    RHO = 2000.0  # kg/m^3\n    G_VEC = np.array([0.0, 9.81])  # m/s^2\n    THICKNESS = 1.0  # m\n    TEST_CASES = [0.0, 0.1, 10.0]  # Regularization parameters (beta)\n\n    NODAL_COORDS = np.array([\n        [0.0, 0.0], [1.0, 0.0], [2.0, 0.0],\n        [0.0, 1.0], [1.0, 1.0], [2.0, 1.0],\n        [0.0, 2.0], [1.0, 2.0], [2.0, 2.0]\n    ], dtype=np.float64)\n    NUM_NODES = NODAL_COORDS.shape[0]\n\n    ELEM_NODE_INDICES = np.array([\n        [0, 1, 4, 3],  # Element 0 (BL)\n        [1, 2, 5, 4],  # Element 1 (BR)\n        [3, 4, 7, 6],  # Element 2 (TL)\n        [4, 5, 8, 7]   # Element 3 (TR)\n    ])\n    NUM_ELEMS = ELEM_NODE_INDICES.shape[0]\n\n    # Standard 2x2 Gauss quadrature points and weights\n    p = 1.0 / np.sqrt(3.0)\n    GAUSS_POINTS = np.array([[-p, -p], [p, -p], [p, p], [-p, p]])\n    GAUSS_WEIGHTS = np.array([1.0, 1.0, 1.0, 1.0])\n\n    # --------------------------------------------------------------------------\n    # 2. FEM HELPER FUNCTIONS AND PRE-COMPUTATIONS\n    # --------------------------------------------------------------------------\n    def get_shape_functions(xi, eta):\n        N = 0.25 * np.array([\n            (1.0 - xi) * (1.0 - eta), (1.0 + xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 + eta), (1.0 - xi) * (1.0 + eta)\n        ])\n        dNdxi = 0.25 * np.array([-(1.0 - eta), (1.0 - eta), (1.0 + eta), -(1.0 + eta)])\n        dNdeta = 0.25 * np.array([-(1.0 - xi), -(1.0 + xi), (1.0 + xi), (1.0 - xi)])\n        return N, dNdxi, dNdeta\n\n    def get_B_matrix(dNdxi, dNdeta, elem_coords):\n        J = np.zeros((2, 2))\n        J[0, 0] = np.dot(dNdxi, elem_coords[:, 0])\n        J[0, 1] = np.dot(dNdeta, elem_coords[:, 0])\n        J[1, 0] = np.dot(dNdxi, elem_coords[:, 1])\n        J[1, 1] = np.dot(dNdeta, elem_coords[:, 1])\n        detJ = np.linalg.det(J)\n        \n        # Derivatives w.r.t physical coordinates\n        invJ = np.linalg.inv(J)\n        dN_phys = invJ @ np.vstack((dNdxi, dNdeta))\n        \n        B = np.zeros((3, 8))\n        for i in range(4):\n            B[0, 2 * i] = dN_phys[0, i]\n            B[1, 2 * i + 1] = dN_phys[1, i]\n            B[2, 2 * i] = dN_phys[1, i]\n            B[2, 2 * i + 1] = dN_phys[0, i]\n        return B, detJ\n\n    # Extrapolation matrix (Gauss points to element corner nodes)\n    M_inv = np.array([\n        [0.25, 0.25, 0.25, 0.25],\n        [-np.sqrt(3)/4, np.sqrt(3)/4, np.sqrt(3)/4, -np.sqrt(3)/4],\n        [-np.sqrt(3)/4, -np.sqrt(3)/4, np.sqrt(3)/4, np.sqrt(3)/4],\n        [0.75, -0.75, 0.75, -0.75]\n    ])\n    C_eval = np.array([[1,-1,-1,1], [1,1,-1,-1], [1,1,1,1], [1,-1,1,-1]])\n    E_ELEM = C_eval @ M_inv\n\n    # --------------------------------------------------------------------------\n    # 3. COMPUTE INITIAL NODAL STRESSES (s0)\n    # --------------------------------------------------------------------------\n    initial_nodal_stresses_sum = np.zeros((NUM_NODES, 3))\n    nodal_counts = np.zeros(NUM_NODES)\n    \n    for i in range(NUM_ELEMS):\n        elem_nodes = ELEM_NODE_INDICES[i]\n        elem_coords = NODAL_COORDS[elem_nodes]\n        gauss_stresses = np.zeros((4, 3))\n\n        for k in range(4):\n            xi, eta = GAUSS_POINTS[k]\n            N, _, _ = get_shape_functions(xi, eta)\n            phys_coords = N @ elem_coords\n            y_coord = phys_coords[1]\n            \n            # Analytical stress field\n            gauss_stresses[k, 0] = 0.0  # sigma_xx\n            gauss_stresses[k, 1] = -RHO * G_VEC[1] * y_coord  # sigma_yy\n            gauss_stresses[k, 2] = 0.0  # sigma_xy\n\n        # Extrapolate Gauss stresses to element nodes for each component\n        elem_nodal_stresses = np.zeros((4, 3))\n        for comp in range(3):\n            elem_nodal_stresses[:, comp] = E_ELEM @ gauss_stresses[:, comp]\n\n        # Accumulate for averaging\n        initial_nodal_stresses_sum[elem_nodes] += elem_nodal_stresses\n        nodal_counts[elem_nodes] += 1\n\n    s0 = initial_nodal_stresses_sum / nodal_counts[:, np.newaxis]\n\n    # --------------------------------------------------------------------------\n    # 4. COMPUTE GRAPH LAPLACIAN (L)\n    # --------------------------------------------------------------------------\n    adj_matrix = np.zeros((NUM_NODES, NUM_NODES))\n    for elem_nodes in ELEM_NODE_INDICES:\n        for i in range(4):\n            n1 = elem_nodes[i]\n            n2 = elem_nodes[(i + 1) % 4]\n            adj_matrix[n1, n2] = 1\n            adj_matrix[n2, n1] = 1\n    \n    degree_matrix = np.diag(adj_matrix.sum(axis=1))\n    L = degree_matrix - adj_matrix\n\n    # --------------------------------------------------------------------------\n    # 5. COMPUTE BODY FORCES (f_body)\n    # --------------------------------------------------------------------------\n    f_body = np.zeros(NUM_NODES * 2)\n    body_force_density = RHO * G_VEC\n\n    for i in range(NUM_ELEMS):\n        elem_nodes = ELEM_NODE_INDICES[i]\n        elem_coords = NODAL_COORDS[elem_nodes]\n        f_body_e = np.zeros(8)\n        \n        for k in range(4):\n            xi, eta = GAUSS_POINTS[k]\n            w = GAUSS_WEIGHTS[k]\n            N, dNdxi, dNdeta = get_shape_functions(xi, eta)\n            \n            _ , detJ = get_B_matrix(dNdxi, dNdeta, elem_coords)\n            \n            N_mat = np.zeros((2, 8))\n            for j in range(4):\n                N_mat[0, 2*j] = N[j]\n                N_mat[1, 2*j+1] = N[j]\n            \n            f_body_e += N_mat.T @ body_force_density * detJ * w * THICKNESS\n        \n        # Assembly\n        for j in range(4):\n            node_g_idx = elem_nodes[j]\n            f_body[2*node_g_idx : 2*node_g_idx+2] += f_body_e[2*j : 2*j+2]\n\n    # --------------------------------------------------------------------------\n    # 6. MAIN LOOP: REGULARIZE, COMPUTE RESIDUAL, AND FIND MAX NORM\n    # --------------------------------------------------------------------------\n    results = []\n    for beta in TEST_CASES:\n        # Solve for regularized nodal stresses\n        M_reg = np.identity(NUM_NODES) + beta * L\n        sigma_n = np.zeros((NUM_NODES, 3))\n        for comp in range(3):\n            sigma_n[:, comp] = np.linalg.solve(M_reg, s0[:, comp])\n            \n        # Compute internal forces from regularized stresses\n        f_int = np.zeros(NUM_NODES * 2)\n        for i in range(NUM_ELEMS):\n            elem_nodes = ELEM_NODE_INDICES[i]\n            elem_coords = NODAL_COORDS[elem_nodes]\n            elem_sigma_n = sigma_n[elem_nodes]\n            f_int_e = np.zeros(8)\n            \n            for k in range(4):\n                xi, eta = GAUSS_POINTS[k]\n                w = GAUSS_WEIGHTS[k]\n                N, dNdxi, dNdeta = get_shape_functions(xi, eta)\n                \n                B, detJ = get_B_matrix(dNdxi, dNdeta, elem_coords)\n                \n                # Interpolate stress to Gauss point\n                sigma_gp = N @ elem_sigma_n\n\n                f_int_e += B.T @ sigma_gp * detJ * w * THICKNESS\n            \n            # Assembly\n            for j in range(4):\n                node_g_idx = elem_nodes[j]\n                f_int[2*node_g_idx : 2*node_g_idx+2] += f_int_e[2*j : 2*j+2]\n        \n        # Final residual calculation\n        residual = f_int + f_body\n        residual_reshaped = residual.reshape((NUM_NODES, 2))\n        nodal_residual_norms = np.linalg.norm(residual_reshaped, axis=1)\n        max_residual_norm = np.max(nodal_residual_norms)\n        results.append(max_residual_norm)\n\n    # --------------------------------------------------------------------------\n    # 7. FINAL OUTPUT\n    # --------------------------------------------------------------------------\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n\n```", "id": "3564967"}]}