{"hands_on_practices": [{"introduction": "要真正掌握计算弹黏塑性力学，我们必须从验证基本模型开始。本练习将引导您解决一个经典的单轴蠕变问题，这是计算塑性力学中的一个基础模型 [@problem_id:3521801]。通过推导该问题的解析解，并将其与后向欧拉数值积分方案的结果进行比较，您将能够直接量化时间积分算法的精度，这是验证更复杂计算模型时的一项关键技能。", "problem": "考虑一根单轴杆，其材料为遵循 Perzyna 率相关塑性模型的线性弹性-超应力黏塑性固体，并带有线性各向同性硬化。假设为小应变、等温条件和单轴应力。总应变 $\\varepsilon$ 可进行加法分解为 $\\varepsilon = \\varepsilon^{e} + \\varepsilon^{p}$。单轴弹性本构关系为 $\\sigma = E \\, \\varepsilon^{e}$，其中 $E$ 为杨氏模量。黏塑性流动由指数 $n=1$ 的 Perzyna 超应力法则控制，\n$\\dot{\\varepsilon}^{p} = \\frac{1}{\\eta} \\left\\langle f(\\sigma,\\varepsilon^{p}) \\right\\rangle$，\n其中 $\\eta$ 是黏度参数，$\\langle \\cdot \\rangle$ 表示 Macaulay 括号 $\\langle x \\rangle = \\max(x,0)$，带线性各向同性硬化的单轴屈服函数为 $f(\\sigma,\\varepsilon^{p}) = |\\sigma| - \\sigma_{y} - H \\, \\varepsilon^{p}$，其中 $\\sigma_{y}$ 为初始屈服应力，$H$ 为硬化模量。该杆在 $t=0$ 时被瞬时加载进入拉伸状态，然后在所有 $t \\ge 0$ 的时间内保持恒定的单轴应力 $\\sigma(t) = \\sigma_{0}>0$。初始条件为 $\\varepsilon^{p}(0)=0$。\n\n任务：\n1) 仅从上述定义和准静态极限（无惯性）下的线性动量平衡出发，推导在恒定应力 $\\sigma(t)=\\sigma_{0}$（假设 $\\sigma_{0} > \\sigma_{y}$）下，当 $t \\ge 0$ 时黏塑性应变 $\\varepsilon^{p}(t)$ 和总应变 $\\varepsilon(t)$ 的解析表达式。\n2) 针对 $\\varepsilon^{p}$ 的演化，构建一个具有恒定时间步长 $\\Delta t$ 的全隐式后向欧拉（BE）时间离散化方案，并推导经过 $N$ 步后（即在 $t_{N} = N \\Delta t$ 时）$\\varepsilon^{p}$ 关于 $E$、$H$、$\\eta$、$\\sigma_{y}$、$\\sigma_{0}$、$\\Delta t$ 和 $N$ 的闭式表达式。\n3) 使用任务1得到的解析解和任务2得到的BE解，计算在最终时间 $T$ 时总应变的绝对误差，\n$\\left|\\varepsilon_{\\text{exact}}(T) - \\varepsilon_{\\text{BE}}(T)\\right|$，\n使用以下数据（国际单位制）：$E = 30\\,\\mathrm{GPa}$，$H = 2\\,\\mathrm{GPa}$，$\\eta = 2 \\times 10^{14}\\,\\mathrm{Pa\\,s}$，$\\sigma_{y} = 40\\,\\mathrm{MPa}$，$\\sigma_{0} = 60\\,\\mathrm{MPa}$，$T = 2.0 \\times 10^{5}\\,\\mathrm{s}$，$\\Delta t = 2.5 \\times 10^{4}\\,\\mathrm{s}$，以及 $N = T/\\Delta t$。将误差以纯应变（无量纲）的形式报告，并将您的答案四舍五入到四位有效数字。最终数字不带单位表示。", "solution": "该问题陈述经检验在科学上是合理的、适定的和完整的。它描述了计算黏塑性力学中的一个标准问题。所有必要的本构关系、参数以及边界/初始条件均已提供。\n\n准静态加载的假设意味着惯性力可以忽略不计。对于单轴杆，这确保了轴向应力 $\\sigma$ 在空间上是均匀的，从而可以将其指定为时间的函数 $\\sigma(t)$。问题陈述中说明，对于 $t \\ge 0$，施加了恒定应力 $\\sigma(t) = \\sigma_{0}$，且 $\\sigma_{0} > \\sigma_{y}$。\n\n按要求，分析分三部分进行。\n\n**任务1：应变演化的解析解**\n\n总应变 $\\varepsilon$ 是弹性应变 $\\varepsilon^{e}$ 和塑性应变 $\\varepsilon^{p}$ 的和：\n$$\n\\varepsilon(t) = \\varepsilon^{e}(t) + \\varepsilon^{p}(t)\n$$\n弹性应变由胡克定律给出，$\\sigma(t) = E \\, \\varepsilon^{e}(t)$。由于应力是恒定的，$\\sigma(t) = \\sigma_{0}$，弹性应变也是恒定的：\n$$\n\\varepsilon^{e}(t) = \\frac{\\sigma_{0}}{E}\n$$\n黏塑性应变 $\\varepsilon^{p}$ 的演化由 Perzyna 流动法则控制：\n$$\n\\dot{\\varepsilon}^{p} = \\frac{1}{\\eta} \\left\\langle f(\\sigma,\\varepsilon^{p}) \\right\\rangle\n$$\n其中屈服函数 $f$ 由 $f(\\sigma,\\varepsilon^{p}) = |\\sigma| - \\sigma_{y} - H \\, \\varepsilon^{p}$ 给出。\n给定 $\\sigma(t) = \\sigma_{0} > 0$，我们有 $|\\sigma| = \\sigma_{0}$。屈服函数变为 $f(\\sigma_{0},\\varepsilon^{p}) = \\sigma_{0} - \\sigma_{y} - H \\, \\varepsilon^{p}$。\n初始条件为 $\\varepsilon^{p}(0)=0$。在 $t=0$ 时，屈服函数的值为 $f(\\sigma_0, 0) = \\sigma_0 - \\sigma_y$。由于题目给定 $\\sigma_{0} > \\sigma_{y}$，该值为正。根据连续性，$f$ 在 $t=0$ 后的某个时间区间内将保持为正。只要 $f \\ge 0$，Macaulay 括号就可以去掉，即 $\\left\\langle f \\right\\rangle = f$。因此，$\\varepsilon^{p}$ 的控制方程是一个线性一阶常微分方程（ODE）：\n$$\n\\frac{d\\varepsilon^{p}}{dt} = \\frac{1}{\\eta} (\\sigma_{0} - \\sigma_{y} - H \\, \\varepsilon^{p})\n$$\n这可以重排为标准形式：\n$$\n\\frac{d\\varepsilon^{p}}{dt} + \\frac{H}{\\eta} \\varepsilon^{p} = \\frac{\\sigma_{0} - \\sigma_{y}}{\\eta}\n$$\n该 ODE 在初始条件 $\\varepsilon^{p}(0)=0$ 下的解可通过标准方法求得。通解是齐次解 $\\varepsilon^{p}_{h}(t) = C \\exp\\left(-\\frac{H}{\\eta}t\\right)$ 和特解 $\\varepsilon^{p}_{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H}$ 的和。\n完整解为 $\\varepsilon^{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} + C \\exp\\left(-\\frac{H}{\\eta}t\\right)$。\n应用初始条件 $\\varepsilon^{p}(0)=0$：\n$$\n0 = \\frac{\\sigma_{0} - \\sigma_{y}}{H} + C \\implies C = -\\frac{\\sigma_{0} - \\sigma_{y}}{H}\n$$\n将 $C$ 代回，我们得到黏塑性应变的解析表达式：\n$$\n\\varepsilon^{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H}{\\eta}t\\right) \\right)\n$$\n当 $t \\to \\infty$ 时，$\\varepsilon^{p}(t) \\to \\frac{\\sigma_{0} - \\sigma_{y}}{H}$，这使得 $f \\to \\sigma_{0} - \\sigma_{y} - H \\frac{\\sigma_{0} - \\sigma_{y}}{H} = 0$。因此，条件 $f \\ge 0$ 对所有 $t \\ge 0$ 都成立。\n总应变 $\\varepsilon(t)$ 则为：\n$$\n\\varepsilon(t) = \\frac{\\sigma_{0}}{E} + \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H}{\\eta}t\\right) \\right)\n$$\n\n**任务2：后向欧拉（BE）离散化**\n\n我们用一个恒定的时间步长 $\\Delta t$ 对时域进行离散化，使得 $t_{k} = k \\Delta t$。后向欧拉格式将时间 $t_{k+1}$ 时的速率 $\\dot{\\varepsilon}^{p}$ 近似为 $\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t}$，并在 $t_{k+1}$ 处计算 ODE 的右侧：\n$$\n\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t} = \\frac{1}{\\eta} \\left\\langle \\sigma_{0} - \\sigma_{y} - H \\varepsilon^{p}_{k+1} \\right\\rangle\n$$\n这里，$\\varepsilon^{p}_{k}$ 表示 $\\varepsilon^{p}(t_k)$ 的数值近似。假设在第 $k+1$ 步发生塑性流动（考虑到加载情况，这是一个一致的假设），我们可以去掉 Macaulay 括号：\n$$\n\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t} = \\frac{1}{\\eta} (\\sigma_{0} - \\sigma_{y} - H \\varepsilon^{p}_{k+1})\n$$\n我们求解 $\\varepsilon^{p}_{k+1}$：\n$$\n\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k} = \\frac{\\Delta t}{\\eta} (\\sigma_{0} - \\sigma_{y}) - \\frac{H \\Delta t}{\\eta} \\varepsilon^{p}_{k+1}\n$$\n$$\n\\varepsilon^{p}_{k+1} \\left(1 + \\frac{H \\Delta t}{\\eta}\\right) = \\varepsilon^{p}_{k} + \\frac{\\Delta t}{\\eta} (\\sigma_{0} - \\sigma_{y})\n$$\n$$\n\\varepsilon^{p}_{k+1} = \\frac{1}{1 + \\frac{H \\Delta t}{\\eta}} \\varepsilon^{p}_{k} + \\frac{\\frac{\\Delta t}{\\eta}(\\sigma_{0} - \\sigma_{y})}{1 + \\frac{H \\Delta t}{\\eta}}\n$$\n这是一个形式为 $\\varepsilon^{p}_{k+1} = A \\varepsilon^{p}_{k} + B$ 的线性递推关系，其中 $\\varepsilon^{p}_{0}=0$。$N$ 步后的解由 $\\varepsilon^{p}_{N} = B \\sum_{k=0}^{N-1} A^k = B \\frac{1 - A^N}{1 - A}$ 给出。\n我们来计算项 $\\frac{B}{1-A}$：\n$$\n1 - A = 1 - \\frac{1}{1 + \\frac{H \\Delta t}{\\eta}} = \\frac{H \\Delta t/\\eta}{1 + H \\Delta t/\\eta}\n$$\n$$\n\\frac{B}{1 - A} = \\frac{\\frac{\\frac{\\Delta t}{\\eta}(\\sigma_{0} - \\sigma_{y})}{1 + \\frac{H \\Delta t}{\\eta}}}{\\frac{\\frac{H \\Delta t}{\\eta}}{1 + \\frac{H \\Delta t}{\\eta}}} = \\frac{\\sigma_{0} - \\sigma_{y}}{H}\n$$\n因此，$\\varepsilon^{p}_{N}$ 的闭式表达式为：\n$$\n\\varepsilon^{p}_{N} = \\frac{\\sigma_{0} - \\sigma_{y}}{H} (1 - A^N) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(\\frac{1}{1 + \\frac{H \\Delta t}{\\eta}}\\right)^N \\right)\n$$\n这也可以写成：\n$$\n\\varepsilon^{p}_{N} = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} \\right)\n$$\n\n**任务3：误差计算**\n\n我们需要计算在时间 $T = N \\Delta t$ 时总应变的绝对误差：\n$Error = \\left|\\varepsilon_{\\text{exact}}(T) - \\varepsilon_{\\text{BE}}(T)\\right|$。\n$T$ 时刻的精确总应变为 $\\varepsilon_{\\text{exact}}(T) = \\varepsilon^{e}(T) + \\varepsilon^{p}_{\\text{exact}}(T)$。\n$T$ 时刻的 BE 近似总应变为 $\\varepsilon_{\\text{BE}}(T) = \\varepsilon^{e}(T) + \\varepsilon^{p}_{N}$。\n弹性应变项 $\\varepsilon^{e}(T) = \\sigma_{0}/E$ 在两个表达式中是共同的，在求差时会消掉。误差完全来自于黏塑性应变分量：\n$$\nError = \\left| \\varepsilon^{p}_{\\text{exact}}(T) - \\varepsilon^{p}_{N} \\right|\n$$\n代入任务1和任务2中推导出的表达式，并设 $T=N\\Delta t$：\n$$\nError = \\left| \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H T}{\\eta}\\right) \\right) - \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} \\right) \\right|\n$$\n$$\nError = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left| \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} - \\exp\\left(-\\frac{H T}{\\eta}\\right) \\right|\n$$\n现在，我们代入给定的数值：\n$E = 30 \\times 10^{9}\\,\\mathrm{Pa}$\n$H = 2 \\times 10^{9}\\,\\mathrm{Pa}$\n$\\eta = 2 \\times 10^{14}\\,\\mathrm{Pa\\,s}$\n$\\sigma_{y} = 40 \\times 10^{6}\\,\\mathrm{Pa}$\n$\\sigma_{0} = 60 \\times 10^{6}\\,\\mathrm{Pa}$\n$T = 2.0 \\times 10^{5}\\,\\mathrm{s}$\n$\\Delta t = 2.5 \\times 10^{4}\\,\\mathrm{s}$\n$N = T/\\Delta t = (2.0 \\times 10^{5}) / (2.5 \\times 10^{4}) = 8$\n\n首先，计算前置因子：\n$$\n\\frac{\\sigma_{0} - \\sigma_{y}}{H} = \\frac{60 \\times 10^{6}\\,\\mathrm{Pa} - 40 \\times 10^{6}\\,\\mathrm{Pa}}{2 \\times 10^{9}\\,\\mathrm{Pa}} = \\frac{20 \\times 10^{6}}{2 \\times 10^{9}} = 1 \\times 10^{-2} = 0.01\n$$\n接下来，计算绝对值内各项的自变量：\n$$\n\\frac{H \\Delta t}{\\eta} = \\frac{(2 \\times 10^{9}\\,\\mathrm{Pa}) \\times (2.5 \\times 10^{4}\\,\\mathrm{s})}{2 \\times 10^{14}\\,\\mathrm{Pa\\,s}} = \\frac{5 \\times 10^{13}}{2 \\times 10^{14}} = 0.25\n$$\n$$\n\\frac{H T}{\\eta} = \\frac{(2 \\times 10^{9}\\,\\mathrm{Pa}) \\times (2.0 \\times 10^{5}\\,\\mathrm{s})}{2 \\times 10^{14}\\,\\mathrm{Pa\\,s}} = \\frac{4 \\times 10^{14}}{2 \\times 10^{14}} = 2\n$$\n注意 $\\frac{HT}{\\eta} = \\frac{H(N\\Delta t)}{\\eta} = N \\left(\\frac{H\\Delta t}{\\eta}\\right) = 8 \\times 0.25 = 2$，这是一致的。\n\n现在，将这些代入误差公式：\n$$\nError = 0.01 \\times \\left| \\left(1 + 0.25\\right)^{-8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| (1.25)^{-8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| \\left(\\frac{5}{4}\\right)^{-8} - \\exp(-2) \\right| = 0.01 \\times \\left| \\left(\\frac{4}{5}\\right)^{8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| (0.8)^{8} - \\exp(-2) \\right|\n$$\n现在我们计算数值：\n$(0.8)^{8} \\approx 0.16777216$\n$\\exp(-2) \\approx 0.13533528$\n$$\nError \\approx 0.01 \\times |0.16777216 - 0.13533528|\n$$\n$$\nError \\approx 0.01 \\times 0.03243688\n$$\n$$\nError \\approx 0.0003243688\n$$\n四舍五入到四位有效数字，误差为 $0.0003244$。用科学记数法表示，即为 $3.244 \\times 10^{-4}$。", "answer": "$$\n\\boxed{3.244 \\times 10^{-4}}\n$$", "id": "3521801"}, {"introduction": "在处理了简单的单轴模型之后，我们现在转向更符合实际的、在岩土力学中广泛使用的三维Mohr-Coulomb模型。该模型的一个关键特征是其屈服面在主应力空间中存在不可导的棱和角，这给定义塑性流动方向带来了数值上的挑战 [@problem_id:3521788]。本练习将指导您运用凸分析中的次微分理论，为这些奇点情况设计一个稳健的算法，从而在程序中正确地确定塑性流动的方向。掌握这一技能对于在实际工程软件中实现高级本构模型至关重要。", "problem": "考虑一个三维应力状态，其主应力由向量 $\\boldsymbol{\\sigma} = [\\sigma_1,\\sigma_2,\\sigma_3]$ 表示，并约定不假定其顺序。在摩尔-库仑模型中，屈服条件可以在主应力空间中，通过摩擦角 $\\varphi$ 和粘聚力 $c$ 表示为一个凸函数：\n$$\nf(\\boldsymbol{\\sigma};\\varphi,c) = \\max(\\sigma_1,\\sigma_2,\\sigma_3) - K(\\varphi)\\,\\min(\\sigma_1,\\sigma_2,\\sigma_3) - 2\\,c\\,\\sqrt{K(\\varphi)},\n$$\n其中 $K(\\theta) = \\dfrac{1+\\sin\\theta}{1-\\sin\\theta}$。对于弹黏塑性（EVP），塑性流动的速率由塑性势 $g$ 控制，该塑性势由剪胀角 $\\psi$ 以类似方式构造：\n$$\ng(\\boldsymbol{\\sigma};\\psi) = \\max(\\sigma_1,\\sigma_2,\\sigma_3) - K(\\psi)\\,\\min(\\sigma_1,\\sigma_2,\\sigma_3).\n$$\n由于 $g$ 在对应于主应力相等的棱和角点处不可微，因此塑性流动方向必须使用次微分 $\\partial g(\\boldsymbol{\\sigma};\\psi)$ 来定义。EVP 中的返回映射算法需要检测应力状态是位于光滑面上（棱）还是角点上，并选择一个一致的次梯度方向。\n\n从逐点最大和最小函数的凸次微分的基本定义出发，推导一个算法，该算法能够：\n- 使用容差 $\\varepsilon$ 识别相等情况，检测摩尔-库仑 EVP 更新在主应力空间中的激活棱或角点集，并在最大和最小集均为单元素集时将状态分类为“棱”，否则分类为“角点”。\n- 通过选择次微分中的最小范数元素（在最大和最小集中的相等索引上使用均匀凸权重），计算主应力空间中塑性流动的明确次梯度方向 $\\mathbf{n}_p \\in \\partial g(\\boldsymbol{\\sigma};\\psi)$。\n- 当次梯度方向的范数非零时，将其归一化为单位欧几里得范数；如果范数为零，则保持为零向量。\n\n使用以下基本依据：\n- 在主应力空间中，摩尔-库仑屈服函数以及作为主应力凸函数的塑性势 $g$ 的定义。\n- 线性泛函的逐点最大值和最小值的次微分，以及通过凸包来表征不可微点上的次梯度。\n- 由于对称性，选择相等激活集上的均匀凸权重会产生最小欧几里得范数的次梯度这一原理。\n\n将推导出的算法在一个完整的、可运行的程序中实现，该程序对每个测试用例返回：\n- 一个整数分类代码 $c_{\\text{class}}$，$0$ 代表棱，$1$ 代表角点。\n- 激活最大值集的索引列表 $\\mathcal{I}_{\\max} \\subset \\{0,1,2\\}$。\n- 激活最小值集的索引列表 $\\mathcal{J}_{\\min} \\subset \\{0,1,2\\}$。\n- 从 $g(\\boldsymbol{\\sigma};\\psi)$ 计算出的塑性流动归一化次梯度方向向量 $\\mathbf{n}_p$。\n- 以 $\\mathrm{MPa}$ 为单位的屈服超应力 $f(\\boldsymbol{\\sigma};\\varphi,c)$。\n\n角度必须以度为单位提供，并在应用正弦函数前在内部转换为弧度。应力数值必须以兆帕（$\\mathrm{MPa}$）处理。归一化的次梯度方向是无量纲的，屈服超应力必须以 $\\mathrm{MPa}$ 报告。程序必须生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。\n\n测试套件：\n使用以下参数集验证算法，表示为元组 $(\\boldsymbol{\\sigma}\\ \\text{in}\\ \\mathrm{MPa},\\ c\\ \\text{in}\\ \\mathrm{MPa},\\ \\varphi\\ \\text{in}\\ \\text{degrees},\\ \\psi\\ \\text{in}\\ \\text{degrees},\\ \\varepsilon\\ \\text{in}\\ \\mathrm{MPa})$：\n1. $\\left([100.0, 70.0, 30.0],\\ 5.0,\\ 30.0,\\ 5.0,\\ 10^{-3}\\right)$：不同的主应力，典型的棱情况。\n2. $\\left([100.0, 100.0 - 10^{-4}, 40.0],\\ 5.0,\\ 30.0,\\ 10.0,\\ 10^{-3}\\right)$：最大值接近相等，角点情况。\n3. $\\left([50.0, 50.0, 50.0],\\ 0.0,\\ 25.0,\\ 5.0,\\ 10^{-6}\\right)$：静水应力，顶点处的角点，零粘聚力。\n4. $\\left([90.0, 30.0, 30.0],\\ 10.0,\\ 35.0,\\ 5.0,\\ 10^{-6}\\right)$：最小值相等，角点情况。\n5. $\\left([-10.0, -20.0, -30.0],\\ 2.0,\\ 30.0,\\ 0.0,\\ 10^{-4}\\right)$：零剪胀角的拉伸区域，棱情况。\n6. 使用 $\\varphi=30.0^\\circ$ 时的 $K(\\varphi)$；选择 $\\sigma_3=30.0$，然后设置 $\\sigma_1 = K(\\varphi)\\,\\sigma_3 + 2\\,c\\,\\sqrt{K(\\varphi)}$ 和 $\\sigma_2=50.0$，其中 $c=5.0$，$\\varphi=30.0^\\circ$，$\\psi=10.0^\\circ$，$\\varepsilon=10^{-6}$：测试屈服面上接近零的超应力。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身是一个列表，格式为\n$$\n\\left[c_{\\text{class}},\\ \\mathcal{I}_{\\max},\\ \\mathcal{J}_{\\min},\\ \\mathbf{n}_p,\\ f(\\boldsymbol{\\sigma};\\varphi,c)\\right].\n$$\n所有列表必须对主应力位置使用从零开始的索引。归一化的次梯度向量 $\\mathbf{n}_p$ 必须报告为包含三个浮点数的列表，$f(\\boldsymbol{\\sigma};\\varphi,c)$ 必须是 $\\mathrm{MPa}$ 单位的浮点数。", "solution": "该问题要求推导并实现一个算法，用于确定由非关联摩尔-库仑模型控制的弹黏塑性材料的塑性流动方向。这是计算岩土力学中的一项基本任务，特别是对于称为返回映射算法的应力更新过程。核心挑战在于处理塑性势函数 $g(\\boldsymbol{\\sigma};\\psi)$ 在主应力相等（对应于主应力空间中屈服面的棱和角点）的应力状态下的不可微性。\n\n解决方案通过将凸分析的原理应用于塑性势函数来展开。塑性流动方向由塑性势的梯度 $\\nabla g$ 给出。然而，在 $g$ 不可微的地方，梯度不是唯一确定的。我们转而使用次微分，记为 $\\partial g$，它是所有有效次梯度的集合。\n\n塑性势由下式给出：\n$$\ng(\\boldsymbol{\\sigma};\\psi) = \\max(\\sigma_1, \\sigma_2, \\sigma_3) - K(\\psi)\\,\\min(\\sigma_1, \\sigma_2, \\sigma_3)\n$$\n其中 $\\boldsymbol{\\sigma} = [\\sigma_1, \\sigma_2, \\sigma_3]$ 是主应力向量，$\\psi$ 是剪胀角，$K(\\psi) = \\frac{1+\\sin\\psi}{1-\\sin\\psi}$。我们定义 $\\sigma_{\\max} = \\max_i\\{\\sigma_i\\}$ 和 $\\sigma_{\\min} = \\min_i\\{\\sigma_i\\}$。函数 $g$ 可以写成 $g(\\boldsymbol{\\sigma}) = \\sigma_{\\max} - K(\\psi)\\sigma_{\\min}$。\n\n$\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 都是 $\\boldsymbol{\\sigma}$ 的凸函数。凸函数之和的次微分是它们各自次微分的闵可夫斯基和。因此，$g$ 的次微分是：\n$$\n\\partial g(\\boldsymbol{\\sigma}) = \\partial(\\sigma_{\\max}) - K(\\psi)\\,\\partial(\\sigma_{\\min})\n$$\n一组函数的逐点最大值的次微分是激活函数的梯度的凸包。设 $\\mathcal{I}_{\\max} = \\{i \\in \\{1,2,3\\} \\mid \\sigma_i = \\sigma_{\\max}\\}$ 为对应于最大主应力的索引集。单个函数 $\\sigma_i$ 的梯度是标准基向量 $\\mathbf{e}_i$。因此，$\\sigma_{\\max}$ 的次微分是：\n$$\n\\partial(\\sigma_{\\max}) = \\text{conv}\\{\\mathbf{e}_i \\mid i \\in \\mathcal{I}_{\\max}\\} = \\left\\{ \\sum_{i \\in \\mathcal{I}_{\\max}} \\alpha_i \\mathbf{e}_i \\mid \\alpha_i \\ge 0, \\sum_{i \\in \\mathcal{I}_{\\max}} \\alpha_i = 1 \\right\\}\n$$\n类似地，设 $\\mathcal{J}_{\\min} = \\{j \\in \\{1,2,3\\} \\mid \\sigma_j = \\sigma_{\\min}\\}$ 为对应于最小主应力的索引集。$\\sigma_{\\min}$ 的次微分是：\n$$\n\\partial(\\sigma_{\\min}) = \\text{conv}\\{\\mathbf{e}_j \\mid j \\in \\mathcal{J}_{\\min}\\} = \\left\\{ \\sum_{j \\in \\mathcal{J}_{\\min}} \\beta_j \\mathbf{e}_j \\mid \\beta_j \\ge 0, \\sum_{j \\in \\mathcal{J}_{\\min}} \\beta_j = 1 \\right\\}\n$$\n任何次梯度 $\\mathbf{m} \\in \\partial g(\\boldsymbol{\\sigma})$ 都可以表示为 $\\mathbf{m} = \\mathbf{a} - K(\\psi)\\mathbf{b}$，其中 $\\mathbf{a} \\in \\partial(\\sigma_{\\max})$ 且 $\\mathbf{b} \\in \\partial(\\sigma_{\\min})$。\n\n为了确保唯一的塑性流动方向，我们选择具有最小欧几里得范数的次梯度，由于 $\\partial g(\\boldsymbol{\\sigma})$ 是一个闭凸集，这是一个唯一的向量。这个最小范数元素通过为激活梯度选择均匀的凸权重来找到。这一选择因凸包的对称性而合理。设 $N_{\\max} = |\\mathcal{I}_{\\max}|$ 和 $N_{\\min} = |\\mathcal{J}_{\\min}|$ 分别为相等的最大和最小主应力的数量。权重为 $\\alpha_i = 1/N_{\\max}$ 和 $\\beta_j = 1/N_{\\min}$。\n\n得到的最小范数次梯度，记为 $\\mathbf{m}_p$，是：\n$$\n\\mathbf{m}_p = \\left( \\frac{1}{N_{\\max}} \\sum_{i \\in \\mathcal{I}_{\\max}} \\mathbf{e}_i \\right) - K(\\psi) \\left( \\frac{1}{N_{\\min}} \\sum_{j \\in \\mathcal{J}_{\\min}} \\mathbf{e}_j \\right)\n$$\n这个向量 $\\mathbf{m}_p$ 代表塑性流动的方向。为保证在本构模型中的一致性，如果它不是零向量，就将其归一化为单位欧几里得范数。归一化的塑性流动方向 $\\mathbf{n}_p$ 是：\n$$\n\\mathbf{n}_p = \\begin{cases} \\frac{\\mathbf{m}_p}{\\|\\mathbf{m}_p\\|_2}  \\text{if } \\|\\mathbf{m}_p\\|_2 \\neq 0 \\\\ \\mathbf{0}  \\text{if } \\|\\mathbf{m}_p\\|_2 = 0 \\end{cases}\n$$\n范数 $\\|\\mathbf{m}_p\\|_2$ 仅在静水应力状态（$\\sigma_1 = \\sigma_2 = \\sigma_3$，因此 $\\mathcal{I}_{\\max} = \\mathcal{J}_{\\min} = \\{1,2,3\\}$）和零剪胀角（$\\psi=0$，因此 $K(\\psi)=1$）的特定条件下为零。\n\n算法流程如下：\n1. 给定一个应力向量 $\\boldsymbol{\\sigma}$，找到 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$。\n2. 使用一个数值容差 $\\varepsilon > 0$，识别激活索引集：\n    $\\mathcal{I}_{\\max} = \\{i \\in \\{0,1,2\\} \\mid \\sigma_i \\ge \\sigma_{\\max} - \\varepsilon\\}$\n    $\\mathcal{J}_{\\min} = \\{j \\in \\{0,1,2\\} \\mid \\sigma_j \\le \\sigma_{\\min} + \\varepsilon\\}$\n3. 分类应力状态。如果 $N_{\\max} = 1$ 且 $N_{\\min} = 1$，状态位于光滑面上（“棱”），分类代码为 $c_{\\text{class}} = 0$。否则，它位于非光滑的交点上（“角点”），分类代码为 $c_{\\text{class}} = 1$。\n4. 计算向量 $\\mathbf{m}_p = [m_{p,1}, m_{p,2}, m_{p,3}]$ 的分量。对于每个分量 $k \\in \\{1,2,3\\}$：\n    $$\n    m_{p,k} = \\begin{cases} 1/N_{\\max}  \\text{if } k-1 \\in \\mathcal{I}_{\\max} \\text{ and } k-1 \\notin \\mathcal{J}_{\\min} \\\\ -K(\\psi)/N_{\\min}  \\text{if } k-1 \\notin \\mathcal{I}_{\\max} \\text{ and } k-1 \\in \\mathcal{J}_{\\min} \\\\ 1/N_{\\max} - K(\\psi)/N_{\\min}  \\text{if } k-1 \\in \\mathcal{I}_{\\max} \\text{ and } k-1 \\in \\mathcal{J}_{\\min} \\\\ 0  \\text{otherwise} \\end{cases}\n    $$\n    注意，在实现中我们使用从0开始的索引 $\\{0,1,2\\}$。\n5. 计算欧几里得范数 $\\|\\mathbf{m}_p\\|_2$ 并归一化以找到 $\\mathbf{n}_p$。\n6. 最后，使用摩尔-库仑屈服函数计算屈服超应力 $f(\\boldsymbol{\\sigma};\\varphi,c)$：\n    $$\n    f(\\boldsymbol{\\sigma};\\varphi,c) = \\sigma_{\\max} - K(\\varphi)\\,\\sigma_{\\min} - 2\\,c\\,\\sqrt{K(\\varphi)}\n    $$\n该算法为确定分类、激活集、塑性流动方向和屈服超应力提供了一个完整而稳健的方法，这些是弹黏塑性本构模型数值积分的基本组成部分。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements an algorithm to compute the plastic flow direction\n    for a non-associated Mohr-Coulomb model in principal stress space.\n    \"\"\"\n\n    # Pre-calculate stress for test case 6\n    # phi = 30.0 degrees, c = 5.0 MPa, sigma_3 = 30.0 MPa\n    k_phi_30 = (1 + np.sin(np.deg2rad(30.0))) / (1 - np.sin(np.deg2rad(30.0)))\n    sigma1_tc6 = k_phi_30 * 30.0 + 2 * 5.0 * np.sqrt(k_phi_30)\n\n    test_cases = [\n        ([100.0, 70.0, 30.0], 5.0, 30.0, 5.0, 1e-3),\n        ([100.0, 100.0 - 1e-4, 40.0], 5.0, 30.0, 10.0, 1e-3),\n        ([50.0, 50.0, 50.0], 0.0, 25.0, 5.0, 1e-6),\n        ([90.0, 30.0, 30.0], 10.0, 35.0, 5.0, 1e-6),\n        ([-10.0, -20.0, -30.0], 2.0, 30.0, 0.0, 1e-4),\n        ([sigma1_tc6, 50.0, 30.0], 5.0, 30.0, 10.0, 1e-6),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_vec, c, phi_deg, psi_deg, eps = case\n        sigma = np.array(sigma_vec, dtype=float)\n        \n        # Convert angles to radians\n        phi_rad = np.deg2rad(phi_deg)\n        psi_rad = np.deg2rad(psi_deg)\n        \n        # Calculate K coefficients\n        # Handle the case where sin(theta) is 1.0, though unlikely with typical angles.\n        if np.isclose(np.sin(phi_rad), 1.0):\n            k_phi = np.inf\n        else:\n            k_phi = (1 + np.sin(phi_rad)) / (1 - np.sin(phi_rad))\n\n        if np.isclose(np.sin(psi_rad), 1.0):\n            k_psi = np.inf\n        else:\n            k_psi = (1 + np.sin(psi_rad)) / (1 - np.sin(psi_rad))\n        \n        # Find max and min principal stresses\n        sigma_max = np.max(sigma)\n        sigma_min = np.min(sigma)\n        \n        # Identify active sets using tolerance\n        I_max_indices = np.where(sigma >= sigma_max - eps)[0]\n        J_min_indices = np.where(sigma = sigma_min + eps)[0]\n        \n        N_max = len(I_max_indices)\n        N_min = len(J_min_indices)\n        \n        # Classify as edge or corner\n        if N_max == 1 and N_min == 1:\n            c_class = 0  # Edge\n        else:\n            c_class = 1  # Corner\n\n        # Compute minimal-norm subgradient m_p\n        m_p = np.zeros(3)\n        if N_max > 0:\n            m_p[I_max_indices] += 1.0 / N_max\n        if N_min > 0:\n            m_p[J_min_indices] -= k_psi / N_min\n            \n        # Normalize the subgradient to get plastic flow direction n_p\n        norm_mp = np.linalg.norm(m_p)\n        if norm_mp > 1e-12: # Use a machine epsilon for floating point comparison\n            n_p = m_p / norm_mp\n        else:\n            n_p = np.zeros(3)\n            \n        # Compute yield overstress f\n        if np.isinf(k_phi):\n            # This is a special case (tension cut-off) not formally handled by the formula\n            # For this problem, it's safe to assume phi  90 deg.\n            pass\n        f_overstress = sigma_max - k_phi * sigma_min - 2 * c * np.sqrt(k_phi)\n\n        result_tuple = [\n            c_class,\n            I_max_indices.tolist(),\n            J_min_indices.tolist(),\n            n_p.tolist(),\n            f_overstress\n        ]\n        results.append(result_tuple)\n\n    # Format the final output string\n    # Using str(list) automatically creates the desired output format '[...]'\n    output_str = f\"[{','.join(map(str, results))}]\"\n    # Replace spaces after commas inside each list for a more compact representation, optional but cleaner.\n    output_str = output_str.replace(\", \", \",\")\n    print(output_str)\n\nsolve()\n\n```", "id": "3521788"}]}