{"hands_on_practices": [{"introduction": "设计一个健全的用户认证体系，始于凭证本身的设计。一个理想的密码策略必须在“足够强以抵御攻击”和“足够简单以便用户记忆”之间取得精妙的平衡。本练习将指导你量化这一权衡，使用香农熵来衡量安全性，并用一个成本模型来代表记忆难度，从而让你能够设计出一个最优的策略 [@problem_id:3689498]。", "problem": "您正在为操作系统 (OS) 登录设计一种单因素用户身份验证策略，旨在平衡安全性和易记性。用户将创建由一个单词序列后跟一小段数字组成的密码短语。安全性将通过香农熵 (Shannon entropy) 进行量化，而易记性将通过线性成本模型进行量化。\n\n假设该策略下的用户行为模型如下：\n- 单词选择：每个单词都从一个包含 $1000$ 个单词的固定词典中独立选择，其分布遵循以下两层结构：有 $100$ 个“常用”词，每个词被选中的概率为 $0.004$；有 $900$ 个“罕见”词，每个词被选中的概率为 $1/1500$。这是一个有效的分布，因为 $100 \\cdot 0.004 + 900 \\cdot (1/1500) = 1$。\n- 数字选择：每个附加的数字都独立地从一个分布中选择，其中数字 $0$ 被选中的概率为 $0.28$，而数字 $1$到 $9$ 中每个数字被选中的概率为 $(1 - 0.28)/9$。\n\n使用香农熵（单位为比特）来度量单个符号，其分布为 $\\{p_i\\}$，定义为 $H = \\sum_{i} p_i \\log_{2}(1/p_i)$。假设各个符号之间是独立的，因此总熵是独立选择的单词和数字的熵之和。\n\n根据此策略，一个密码由 $m$ 个单词后跟 $k$ 个数字组成。因此，总熵为 $H_{\\text{total}}(m,k) = m \\cdot H_{\\text{word}} + k \\cdot H_{\\text{digit}}$，其中 $H_{\\text{word}}$ 和 $H_{\\text{digit}}$ 分别是在指定分布下一个单词和一个数字的香non熵。\n\n为了量化易记性，定义成本函数 $C(m,k) = c_{w} \\cdot m + c_{d} \\cdot k$，其中单词的权重为 $c_{w} = 1$，数字的权重为 $c_{d} = 0.5$。较大的 $C$ 值表示较高的认知负担。为了保证可用性和最小多样性，将策略约束为 $m \\geq 2$ 和 $k \\geq 2$，其中 $m$ 和 $k$ 均为整数。\n\n请设计该策略，找出 $m$ 和 $k$ 的值，使其在满足所述约束条件的前提下，达到至少 $T = 50$ 比特熵的目标安全性，同时最小化 $C(m,k)$。可实现的最小易记性成本 $C^{\\star}$ 是多少？将最终答案表示为一个实数。无需四舍五入。所有熵的单位均为比特。", "solution": "问题要求在满足最小总熵约束的条件下，找到密码短语策略的最小易记性成本 $C(m,k)$。密码短语由 $m$ 个单词和 $k$ 个数字组成。这可以被表述为一个带约束的整数优化问题。\n\n首先，我们必须计算单个单词的香农熵 $H_{\\text{word}}$ 和单个数字的香农熵 $H_{\\text{digit}}$。对于一组概率为 $\\{p_i\\}$ 的事件，其香农熵由公式 $H = \\sum_{i} p_i \\log_{2}(1/p_i)$ 给出。\n\n单词词典包含 $N_{\\text{common}} = 100$ 个常用词，每个词的概率为 $p_{\\text{common}} = 0.004$，以及 $N_{\\text{rare}} = 900$ 个罕见词，每个词的概率为 $p_{\\text{rare}} = 1/1500$。单个单词的熵 $H_{\\text{word}}$ 通过对所有可能的单词求和计算得出：\n$$H_{\\text{word}} = \\sum_{i=1}^{1000} p_i \\log_{2}\\left(\\frac{1}{p_i}\\right) = N_{\\text{common}} \\cdot p_{\\text{common}} \\log_{2}\\left(\\frac{1}{p_{\\text{common}}}\\right) + N_{\\text{rare}} \\cdot p_{\\text{rare}} \\log_{2}\\left(\\frac{1}{p_{\\text{rare}}}\\right)$$\n代入给定值：\n$$H_{\\text{word}} = 100 \\cdot (0.004) \\log_{2}\\left(\\frac{1}{0.004}\\right) + 900 \\cdot \\left(\\frac{1}{1500}\\right) \\log_{2}\\left(\\frac{1}{1/1500}\\right)$$\n$$H_{\\text{word}} = 0.4 \\log_{2}(250) + 0.6 \\log_{2}(1500)$$\n为了用更基本的形式表示，我们将对数的参数分解为其质因数：\n$250 = 2 \\cdot 125 = 2 \\cdot 5^3$\n$1500 = 15 \\cdot 100 = 3 \\cdot 5 \\cdot 10^2 = 3 \\cdot 5 \\cdot (2 \\cdot 5)^2 = 2^2 \\cdot 3 \\cdot 5^3$。\n使用对数性质 $\\log(ab) = \\log(a) + \\log(b)$：\n$$\\log_{2}(250) = \\log_{2}(2 \\cdot 5^3) = \\log_{2}(2) + 3\\log_{2}(5) = 1 + 3\\log_{2}(5)$$\n$$\\log_{2}(1500) = \\log_{2}(2^2 \\cdot 3 \\cdot 5^3) = 2\\log_{2}(2) + \\log_{2}(3) + 3\\log_{2}(5) = 2 + \\log_{2}(3) + 3\\log_{2}(5)$$\n将这些代回 $H_{\\text{word}}$ 的表达式中：\n$$H_{\\text{word}} = 0.4 (1 + 3\\log_{2}(5)) + 0.6 (2 + \\log_{2}(3) + 3\\log_{2}(5))$$\n$$H_{\\text{word}} = 0.4 + 1.2\\log_{2}(5) + 1.2 + 0.6\\log_{2}(3) + 1.8\\log_{2}(5)$$\n$$H_{\\text{word}} = 1.6 + 0.6\\log_{2}(3) + 3\\log_{2}(5)$$\n\n接下来，我们计算单个数字的熵 $H_{\\text{digit}}$。数字 $0$ 被选中的概率为 $p_0 = 0.28$。其余的 $9$ 个数字（$1$ 到 $9$）每个被选中的概率为 $p_{1-9} = (1 - 0.28)/9 = 0.72/9 = 0.08$。\n$$H_{\\text{digit}} = p_0 \\log_{2}\\left(\\frac{1}{p_0}\\right) + \\sum_{i=1}^{9} p_{1-9} \\log_{2}\\left(\\frac{1}{p_{1-9}}\\right) = p_0 \\log_{2}\\left(\\frac{1}{p_0}\\right) + 9 \\cdot p_{1-9} \\log_{2}\\left(\\frac{1}{p_{1-9}}\\right)$$\n代入概率值：\n$$H_{\\text{digit}} = 0.28 \\log_{2}\\left(\\frac{1}{0.28}\\right) + 9 \\cdot (0.08) \\log_{2}\\left(\\frac{1}{0.08}\\right)$$\n$$H_{\\text{digit}} = 0.28 \\log_{2}\\left(\\frac{100}{28}\\right) + 0.72 \\log_{2}\\left(\\frac{100}{8}\\right) = 0.28 \\log_{2}\\left(\\frac{25}{7}\\right) + 0.72 \\log_{2}\\left(\\frac{25}{2}\\right)$$\n使用对数性质：\n$$\\log_{2}\\left(\\frac{25}{7}\\right) = \\log_{2}(5^2) - \\log_{2}(7) = 2\\log_{2}(5) - \\log_{2}(7)$$\n$$\\log_{2}\\left(\\frac{25}{2}\\right) = \\log_{2}(5^2) - \\log_{2}(2) = 2\\log_{2}(5) - 1$$\n将这些代回 $H_{\\text{digit}}$ 的表达式中：\n$$H_{\\text{digit}} = 0.28 (2\\log_{2}(5) - \\log_{2}(7)) + 0.72 (2\\log_{2}(5) - 1)$$\n$$H_{\\text{digit}} = 0.56\\log_{2}(5) - 0.28\\log_{2}(7) + 1.44\\log_{2}(5) - 0.72$$\n$$H_{\\text{digit}} = 2\\log_{2}(5) - 0.28\\log_{2}(7) - 0.72$$\n\n优化问题是在以下约束条件下最小化成本函数 $C(m,k) = c_w m + c_d k = m + 0.5k$：\n1. $H_{\\text{total}}(m,k) = m \\cdot H_{\\text{word}} + k \\cdot H_{\\text{digit}} \\geq 50$\n2. $m \\geq 2$\n3. $k \\geq 2$\n4. $m, k$ 为整数。\n\n为了解决这个整数线性规划问题，我们可以从 $m$ 的最小值 $m=2$ 开始测试整数值，并对每个 $m$ 确定满足所有约束的最小整数 $k$。成本函数 $C(m,k)$ 是关于 $m$ 和 $k$ 的增函数，因此我们可以预期最优解位于或接近由熵约束 $m H_{\\text{word}} + k H_{\\text{digit}} = 50$ 定义的边界上。\n\n对于一个固定的整数 $m \\geq 2$，熵约束要求 $k \\geq \\frac{50 - m H_{\\text{word}}}{H_{\\text{digit}}}$。由于 $k$ 也必须是整数且 $k \\geq 2$，对于给定的 $m$，最小的有效 $k$ 为 $k_{\\min}(m) = \\max\\left(2, \\left\\lceil \\frac{50 - m H_{\\text{word}}}{H_{\\text{digit}}} \\right\\rceil\\right)$。然后我们计算成本 $C(m, k_{\\min}(m))$，并在 $m$ 的相关范围内找到最小成本。\n\n为了方便计算，我们使用数值近似值：$\\log_2(3) \\approx 1.585$，$\\log_2(5) \\approx 2.322$，$\\log_2(7) \\approx 2.807$。\n$H_{\\text{word}} \\approx 1.6 + 0.6(1.585) + 3(2.322) = 1.6 + 0.951 + 6.966 = 9.517$ 比特。\n$H_{\\text{digit}} \\approx 2(2.322) - 0.28(2.807) - 0.72 = 4.644 - 0.78596 - 0.72 = 3.138$ 比特。\n\n让我们对 $m \\geq 2$ 的较小整数值评估 $k_{\\min}(m)$ 和相应的成本：\n- 对于 $m=2$：$k \\geq \\frac{50 - 2 H_{\\text{word}}}{H_{\\text{digit}}} \\approx \\frac{50 - 2(9.517)}{3.138} \\approx \\frac{30.966}{3.138} \\approx 9.868$。最小的整数 $k$ 是 $10$。这满足 $k \\geq 2$。因此，$(m,k) = (2,10)$ 是一个候选解。成本为 $C(2,10) = 2 + 0.5(10) = 7$。\n\n- 对于 $m=3$：$k \\geq \\frac{50 - 3 H_{\\text{word}}}{H_{\\text{digit}}} \\approx \\frac{50 - 3(9.517)}{3.138} \\approx \\frac{21.449}{3.138} \\approx 6.835$。最小的整数 $k$ 是 $7$。这满足 $k \\geq 2$。因此，$(m,k) = (3,7)$ 是一个候选解。成本为 $C(3,7) = 3 + 0.5(7) = 6.5$。\n\n- 对于 $m=4$：$k \\geq \\frac{50 - 4 H_{\\text{word}}}{H_{\\text{digit}}} \\approx \\frac{50 - 4(9.517)}{3.138} \\approx \\frac{11.932}{3.138} \\approx 3.802$。最小的整数 $k$ 是 $4$。这满足 $k \\geq 2$。因此，$(m,k) = (4,4)$ 是一个候选解。成本为 $C(4,4) = 4 + 0.5(4) = 6$。\n\n- 对于 $m=5$：$k \\geq \\frac{50 - 5 H_{\\text{word}}}{H_{\\text{digit}}} \\approx \\frac{50 - 5(9.517)}{3.138} \\approx \\frac{2.415}{3.138} \\approx 0.769$。向上取整为 $1$。然而，我们有约束 $k \\geq 2$。所以允许的最小 $k$ 是 $2$。我们必须验证 $(m,k)=(5,2)$ 是否满足熵约束：$5 H_{\\text{word}} + 2 H_{\\text{digit}} \\approx 5(9.517) + 2(3.138) = 47.585 + 6.276 = 53.861 \\geq 50$。约束得到满足。因此，$(m,k) = (5,2)$ 是一个候选解。成本为 $C(5,2) = 5 + 0.5(2) = 6$。\n\n- 对于 $m=6$：$k \\geq \\frac{50 - 6 H_{\\text{word}}}{H_{\\text{digit}}} \\approx \\frac{50 - 6(9.517)}{3.138}  0$。对于任何 $k \\geq 0$，熵约束都得到满足。对 $k$ 的约束条件是 $k \\geq 2$，所以我们选择 $k=2$。候选解是 $(m,k)=(6,2)$。成本为 $C(6,2) = 6 + 0.5(2) = 7$。\n\n比较计算出的成本：$\\{7, 6.5, 6, 6, 7, ...\\}$。对于任何 $m > 6$，$k$ 的最小值为 $k=2$，成本将是 $C(m,2) = m + 1 > 7$。因此，当 $m > 5$ 时不会出现最小成本。候选解中的最小成本是 $6$。\n\n问题要求的是可实现的最小易记性成本 $C^{\\star}$。根据我们的分析，这个最小成本是 $6$。该值可以通过两种不同的策略配置实现：$(m,k) = (4,4)$ 和 $(m,k) = (5,2)$。所需的答案是最小成本本身。\n$C^{\\star} = 6$。", "answer": "$$\\boxed{6}$$", "id": "3689498"}, {"introduction": "即使是强密码，也可能被坚持不懈的攻击者通过暴力破解方法攻破。因此，认证系统必须采用主动防御措施，例如速率限制。本练习将深入探讨如何为一个失败的登录尝试配置时间延迟机制，挑战你找到一个既能有效阻止攻击者，又对合法用户造成最小不便的配置方案 [@problem_id:3689453]。", "problem": "一个操作系统使用可插拔认证模块（Pluggable Authentication Modules, PAM）进行登录。为了阻止暴力破解攻击，管理员通过可插拔认证模块（PAM）的控制标志 $PAM\\_FAIL\\_DELAY$ 配置了一个基于失败次数的延迟计划。具体来说，对于给定账户的第 $k$ 次连续失败尝试，系统在返回认证结果前会增加 $D_k$ 秒的延迟，其中 $D_k$ 被建模为一个线性计划 $D_k = d_0 + (k-1)\\delta$，且 $d_0 \\ge 0$，$ \\delta \\ge 0$。假设在所考虑的工作负载下，该延迟计划不会饱和或达到上限，即对于所有遇到的 $k$，$D_k = d_0 + (k-1)\\delta$ 均成立。\n\n必须同时满足两个设计目标：\n\n1. 针对短时脉冲式攻击的暴力破解威慑：在线攻击者通常在每个账户连续失败最多 $n$ 次后轮换账户。为降低攻击者的脉冲式吞吐量，要求对一个给定账户的前 $n$ 次连续失败尝试，每次尝试的平均墙上时钟时间至少为 $1/R^\\star$，其中 $R^\\star$ 是此类脉冲式攻击每秒尝试次数的目标上限。每次尝试的墙上时钟时间是固定的基本处理时间 $t_b$ 和延迟 $D_k$ 的总和。\n\n2. 合法用户的可接受延迟：对于合法用户，每次认证尝试独立地以概率 $s$ 成功，以概率 $p = 1-s$ 失败。首次成功前的失败次数呈几何分布。仅由 $PAM\\_FAIL\\_DELAY$ 引起的预期附加延迟（不包括基本处理时间 $t_b$）不得超过 $L_{\\max}$ 秒。\n\n使用以下参数：基本处理时间为 $t_b = 0.1$ 秒，初始延迟为 $d_0 = 0.5$ 秒，脉冲长度为 $n = 3$，目标脉冲速率上限为 $R^\\star = 1$ 次尝试/秒，合法用户单次尝试的成功概率为 $s = 0.8$（因此 $p = 0.2$）。合法用户的可接受预期附加延迟为 $L_{\\max} = 0.2$ 秒。如上所述，假设合法用户的尝试是独立的。\n\n找出满足这两个设计目标的最小 $\\delta$（以秒为单位）。将您的答案四舍五入到三位有效数字。最终值以秒表示。", "solution": "我们首先将两个约束条件形式化。\n\n对于暴力破解脉冲式攻击的约束，攻击者对一个账户产生 $n$ 次连续失败。第 $k$ 次失败尝试的墙上时钟时间为 $t_b + D_k = t_b + d_0 + (k-1)\\delta$。前 $n$ 次失败尝试的平均每次尝试墙上时钟时间为\n$$\n\\frac{1}{n} \\sum_{k=1}^{n} \\left(t_b + d_0 + (k-1)\\delta\\right)\n= t_b + \\frac{1}{n} \\sum_{k=1}^{n} \\left(d_0 + (k-1)\\delta\\right).\n$$\n该和是一个等差数列：\n$$\n\\sum_{k=1}^{n} \\left(d_0 + (k-1)\\delta\\right) = n d_0 + \\delta \\sum_{k=1}^{n} (k-1) = n d_0 + \\delta \\frac{(n-1)n}{2}.\n$$\n因此，平均墙上时钟时间为\n$$\nt_b + d_0 + \\delta \\frac{n-1}{2}.\n$$\n要求该平均值至少为 $1/R^\\star$ 可得\n$$\nt_b + d_0 + \\delta \\frac{n-1}{2} \\ge \\frac{1}{R^\\star}.\n$$\n求解 $\\delta$ 可得\n$$\n\\delta \\ge \\frac{2}{n-1}\\left(\\frac{1}{R^\\star} - t_b - d_0\\right).\n$$\n使用给定的参数 $t_b = 0.1$，$d_0 = 0.5$，$n = 3$ 和 $R^\\star = 1$，我们得到\n$$\n\\delta \\ge \\frac{2}{3-1}\\left(1 - 0.1 - 0.5\\right)\n= 1 \\cdot \\left(0.4\\right)\n= 0.4.\n$$\n\n接下来，我们考虑合法用户的延迟约束。设 $K$ 为首次成功前的失败次数，$K$ 服从参数为 $s$（成功概率）和失败概率 $p = 1-s$ 的几何分布。对于 $K=k$ 的一次实现，由配置的延迟计划所引起的总附加延迟为 $\\sum_{i=1}^{k} D_i = \\sum_{i=1}^{k} \\left(d_0 + (i-1)\\delta\\right)$。预期的附加延迟是\n$$\n\\mathbb{E}\\left[\\sum_{i=1}^{K} D_i\\right]\n= \\sum_{i=1}^{\\infty} D_i \\, \\mathbb{P}(K \\ge i).\n$$\n对于首次成功前的几何分布失败次数，$\\mathbb{P}(K \\ge i) = p^{i}$（$i \\ge 1$）。因此\n$$\n\\mathbb{E}\\left[\\sum_{i=1}^{K} D_i\\right]\n= \\sum_{i=1}^{\\infty} \\left(d_0 + (i-1)\\delta\\right) p^{i}\n= d_0 \\sum_{i=1}^{\\infty} p^{i} + \\delta \\sum_{i=1}^{\\infty} (i-1) p^{i}.\n$$\n我们对 $|p|1$ 的情况计算这两个级数。第一个是几何级数：\n$$\n\\sum_{i=1}^{\\infty} p^{i} = \\frac{p}{1-p}.\n$$\n第二个级数可以使用已知的幂级数恒等式 $\\sum_{i=0}^{\\infty} i x^{i} = \\frac{x}{(1-x)^{2}}$（对于 $|x|1$）来重写。我们有\n$$\n\\sum_{i=1}^{\\infty} (i-1) p^{i} = p \\sum_{j=0}^{\\infty} j p^{j} = p \\cdot \\frac{p}{(1-p)^{2}} = \\frac{p^{2}}{(1-p)^{2}}.\n$$\n因此，\n$$\n\\mathbb{E}\\left[\\sum_{i=1}^{K} D_i\\right] = d_0 \\frac{p}{1-p} + \\delta \\frac{p^{2}}{(1-p)^{2}}.\n$$\n该约束要求\n$$\nd_0 \\frac{p}{1-p} + \\delta \\frac{p^{2}}{(1-p)^{2}} \\le L_{\\max}.\n$$\n求解 $\\delta$：\n$$\n\\delta \\le \\left(L_{\\max} - d_0 \\frac{p}{1-p}\\right) \\frac{(1-p)^{2}}{p^{2}}.\n$$\n当 $s = 0.8$ 从而 $p = 0.2$，$d_0 = 0.5$，$L_{\\max} = 0.2$ 时，我们计算\n$$\n\\frac{p}{1-p} = \\frac{0.2}{0.8} = 0.25, \\quad \\frac{p^{2}}{(1-p)^{2}} = \\frac{0.04}{0.64} = 0.0625,\n$$\n所以\n$$\nd_0 \\frac{p}{1-p} = 0.5 \\times 0.25 = 0.125,\n$$\n上限变为\n$$\n0.125 + 0.0625 \\delta \\le 0.2 \\quad \\Longrightarrow \\quad \\delta \\le \\frac{0.2 - 0.125}{0.0625} = \\frac{0.075}{0.0625} = 1.2.\n$$\n\n结合这两个约束，我们要求\n$$\n0.4 \\le \\delta \\le 1.2.\n$$\n为了在满足暴力破解脉冲式攻击威慑的同时，最小化对合法用户的影响，我们选择最小的可行 $\\delta$，即\n$$\n\\delta^{\\star} = 0.4.\n$$\n四舍五入到三位有效数字并以秒表示，得到 $0.400$ 秒。", "answer": "$$\\boxed{0.400}$$", "id": "3689453"}, {"introduction": "除了针对登录过程的直接攻击，敏感凭证也可能通过间接的、系统级的机制泄露。一个常见但常被忽视的风险，是通过进程核心转储（程序崩溃时创建的内存快照）泄露信息。这最后一个练习将演示如何分析此类漏洞，要求你根据内存布局和系统资源限制来计算凭证泄露的程度 [@problem_id:3689504]。", "problem": "您的任务是在操作系统用户认证方法的背景下，分析由核心转储引起的凭据泄漏风险。请考虑以下基于进程内存和资源限制基本定义的场景。核心转储是操作系统 (OS) 在进程发生某些故障时写入的进程映像快照。在许多遵循可移植操作系统接口 (POSIX) 的类 Unix 系统中，可以写入核心文件的数据量受到核心文件大小资源限制 ($RLIMIT\\_CORE$) 的约束。对于本问题，将核心转储写入程序建模为：首先序列化一个固定大小的头部，然后按固定顺序序列化进程内存区域。环境变量（可能包含凭据）在内存中表示为一系列形如 \"NAME=VALUE$\\backslash$0\" 的字节字符串，并作为最后一个区域附加。\n\n基本设定：\n- 进程内存区域的顺序是：头部、代码区、已初始化数据区、未初始化数据区、堆、栈，最后是环境区。\n- 核心转储写入程序按顺序写入这些区域，并在达到配置的 $RLIMIT\\_CORE$ 时进行截断，从而产生序列化映像的一个前缀。\n- 环境变量中的敏感凭据是指那些具有特定名称（例如 \"DB\\_PASSWORD\" 和 \"API\\_TOKEN\"）的变量，泄漏量以截断输出中仅包含的那些敏感变量的 VALUE 部分的字节数来衡量。\n\n模型参数：\n- 设核心文件大小限制为 $L$ 字节（即 $RLIMIT\\_CORE = L$）。\n- 设头部大小为 $H$ 字节。\n- 设非环境区域的大小分别为 $\\mathbf{R} = [C,D,B,He,St]$，分别对应代码区、已初始化数据区、未初始化数据区、堆和栈，单位均为字节。\n- 设环境区域是编码为 \"NAME\\_i=VALUE\\_i$\\backslash$0\" 的变量 $v_i$ 的拼接。设 $\\ell^{\\text{name}}_i$ 为 \"NAME\\_i\" 的字节长度，$\\ell^{\\text{val}}_i$ 为 \"VALUE\\_i\" 的字节长度。变量 $i$ 的总字节数为 $\\ell^{\\text{name}}_i + 1 + \\ell^{\\text{val}}_i + 1$（包括等号和终止空字节）。环境区是这些单个变量块按指定顺序的拼接。\n\n泄漏定义：\n- 定义非环境区域总大小为 $T = C + D + B + He + St$。\n- 在限制 $L$ 下，可写入环境区域的容量为 $E_{\\text{leak}} = \\max\\left(0,\\min\\left(E, L - (H + T)\\right)\\right)$，其中 $E$ 是环境区域的总大小（以字节为单位）。\n- 设 $o_i$ 表示第 $i$ 个变量的 VALUE 部分相对于环境区域起始位置的偏移量（以字节为单位）。则敏感变量 $i$ 的泄漏字节数为 $\\max\\left(0,\\min\\left(E_{\\text{leak}} - o_i, \\ell^{\\text{val}}_i\\right)\\right)$。总的敏感字节泄漏量是所有敏感变量的泄漏量之和。\n\n给定：\n- 头部大小 $H = 1024$。\n- 区域大小 $\\mathbf{R}$ 为 $C = 4096$, $D = 2048$, $B = 1024$, $He = 8192$, $St = 4096$。因此 $T = 19456$ 且 $H + T = 20480$。\n- 环境变量（按顺序）：\n  1. \"PATH=/usr/bin\"\n  2. \"DB\\_PASSWORD=supersecret\"\n  3. \"API\\_TOKEN=abcdef123456\"\n  4. \"LANG=C\"\n- 敏感变量名精确为 \"DB\\_PASSWORD\" 和 \"API\\_TOKEN\"。只有其 VALUE 部分的字节计入泄漏量。\n\n测试套件（每个案例指定 $L$）：\n- 案例 1：$L = 0$。\n- 案例 2：$L = 1024$。\n- 案例 3：$L = 20479$。\n- 案例 4：$L = 20510$。\n- 案例 5：$L = 20529$。\n- 案例 6：$L = 20548$。\n\n您的任务：\n- 实现一个程序，为每个测试用例计算如上定义的敏感字节泄漏总数。\n- 除了字节之外，不需要其他物理单位。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 \"[result1,result2,...,result6]\"。\n\n约束和要求：\n- 您必须将核心转储写入程序视为严格按照所述顺序进行序列化，并且仅根据限制 $L$ 进行截断。在截断之前，不会发生区域的压缩或省略。\n- 您必须将环境区视为所提供变量编码按所示确切顺序的拼接。\n- 所有计算都以字节为单位。结果必须是整数。", "solution": "该问题被认为是有效的，因为它基于操作系统原理，具有科学依据，在数学上是适定的，并且是客观和自包含的。所有计算唯一解所需的参数和定义都已提供。我们进行形式化推导。\n\n该问题要求基于一个简化但明确定义的核心转储生成模型，来量化进程核心转储中的敏感数据泄漏。核心转储是进程内存区域的顺序序列化，并在给定的大小限制 $L$ 处被截断。泄漏量定义为截断后的转储文件中存在的特定敏感环境变量的 `VALUE` 部分的字节数。\n\n区域的顺序是：头部、代码区、已初始化数据区、未初始化数据区、堆、栈和环境区。\n环境变量之前的区域总大小是头部大小 $H$ 和非环境区域大小 $T$ 的总和。\n给定的值为：\n- 头部大小：$H = 1024$ 字节。\n- 非环境区域大小：代码区 $C = 4096$，已初始化数据区 $D = 2048$，未初始化数据区 $B = 1024$，堆 $He = 8192$，栈 $St = 4096$，单位均为字节。\n\n首先，我们计算非环境数据区域的总大小 $T$：\n$$ T = C + D + B + He + St = 4096 + 2048 + 1024 + 8192 + 4096 = 19456 \\text{ 字节} $$\n环境块只有在所有先前的区域都写入后才被写入核心转储文件。因此，环境区域在完整核心转储映像中的起始偏移量为：\n$$ \\text{前缀大小} = H + T = 1024 + 19456 = 20480 \\text{ 字节} $$\n\n接下来，我们分析环境区域的结构。它是一系列格式为 `\"NAME=VALUE\\0\"` 的以空字符结尾的字符串的拼接。我们必须根据给定的环境变量计算该区域的大小和布局。对于名称长度为 $\\ell^{\\text{name}}_i$、值长度为 $\\ell^{\\text{val}}_i$ 的单个变量块 $v_i$，其大小为 $\\ell^{\\text{name}}_i + 1 + \\ell^{\\text{val}}_i + 1$ 字节。\n\n环境变量按顺序给出：\n1.  $v_1$: `\"PATH=/usr/bin\"`。此处，$\\ell^{\\text{name}}_1 = \\text{strlen}(\"PATH\") = 4$，$\\ell^{\\text{val}}_1 = \\text{strlen}(\"/usr/bin\") = 8$。\n    $v_1$ 块的大小 = $4 + 1 + 8 + 1 = 14$ 字节。\n2.  $v_2$: `\"DB_PASSWORD=supersecret\"`。这是一个敏感变量。此处，$\\ell^{\\text{name}}_2 = 11$，$\\ell^{\\text{val}}_2 = 11$。\n    $v_2$ 块的大小 = $11 + 1 + 11 + 1 = 24$ 字节。\n3.  $v_3$: `\"API_TOKEN=abcdef123456\"`。这是一个敏感变量。此处，$\\ell^{\\text{name}}_3 = 9$，$\\ell^{\\text{val}}_3 = 12$。\n    $v_3$ 块的大小 = $9 + 1 + 12 + 1 = 23$ 字节。\n4.  $v_4$: `\"LANG=C\"`。此处，$\\ell^{\\text{name}}_4 = 4$，$\\ell^{\\text{val}}_4 = 1$。\n    $v_4$ 块的大小 = $4 + 1 + 1 + 1 = 7$ 字节。\n\n环境区域的总大小 $E$ 是各个块大小的总和：\n$$ E = 14 + 24 + 23 + 7 = 68 \\text{ 字节} $$\n\n核心转储大小限制为 $L$ 字节。可以写入核心文件的环境区域字节数，记为 $E_{\\text{leak}}$，是文件容量 $L$ 在写入大小为 $H+T$ 的前缀后剩余的部分。该值不能超过环境区域的总大小 $E$。\n$$ E_{\\text{leak}} = \\max\\left(0, \\min\\left(E, L - (H + T)\\right)\\right) = \\max\\left(0, \\min\\left(68, L - 20480\\right)\\right) $$\n\n为了计算每个敏感变量的泄漏字节数，我们需要其 `VALUE` 部分相对于环境区域起始位置的偏移量。这个偏移量 $o_i$ 是所有先前变量块的大小之和，再加上当前变量的 `NAME` 长度和等号（`=`）的长度。\n\n对于敏感变量 $v_2$ (\"DB_PASSWORD\")：\n- 它前面是 $v_1$（大小为 $14$ 字节）。\n- 其名称长度为 $\\ell^{\\text{name}}_2 = 11$。\n- 其值的偏移量为 $o_2 = (v_1 \\text{的大小}) + \\ell^{\\text{name}}_2 + 1 = 14 + 11 + 1 = 26$ 字节。\n- 其值的长度为 $\\ell^{\\text{val}}_2 = 11$ 字节。\n\n对于敏感变量 $v_3$ (\"API_TOKEN\")：\n- 它前面是 $v_1$ 和 $v_2$（总大小 $14 + 24 = 38$ 字节）。\n- 其名称长度为 $\\ell^{\\text{name}}_3 = 9$。\n- 其值的偏移量为 $o_3 = (v_1 \\text{的大小} + v_2 \\text{的大小}) + \\ell^{\\text{name}}_3 + 1 = 38 + 9 + 1 = 48$ 字节。\n- 其值的长度为 $\\ell^{\\text{val}}_3 = 12$ 字节。\n\n敏感变量 $v_i$ 的泄漏字节数通过公式计算：$\\max\\left(0, \\min\\left(E_{\\text{leak}} - o_i, \\ell^{\\text{val}}_i\\right)\\right)$。总泄漏量是所有敏感变量的这些值的总和。\n\n我们现在将此框架应用于每个测试用例。\n\n- **案例 1: $L = 0$**\n  $E_{\\text{leak}} = \\max(0, \\min(68, 0 - 20480)) = 0$。\n  总泄漏量 = $0$。\n\n- **案例 2: $L = 1024$**\n  $E_{\\text{leak}} = \\max(0, \\min(68, 1024 - 20480)) = 0$。\n  总泄漏量 = $0$。\n\n- **案例 3: $L = 20479$**\n  $E_{\\text{leak}} = \\max(0, \\min(68, 20479 - 20480)) = 0$。\n  总泄漏量 = $0$。\n\n- **案例 4: $L = 20510$**\n  $E_{\\text{leak}} = \\max(0, \\min(68, 20510 - 20480)) = \\max(0, 30) = 30$。\n  - $v_2$ 的泄漏量：$\\max(0, \\min(30 - o_2, \\ell^{\\text{val}}_2)) = \\max(0, \\min(30 - 26, 11)) = \\min(4, 11) = 4$。\n  - $v_3$ 的泄漏量：$\\max(0, \\min(30 - o_3, \\ell^{\\text{val}}_3)) = \\max(0, \\min(30 - 48, 12)) = \\max(0, -18) = 0$。\n  总泄漏量 = $4 + 0 = 4$。\n\n- **案例 5: $L = 20529$**\n  $E_{\\text{leak}} = \\max(0, \\min(68, 20529 - 20480)) = \\max(0, 49) = 49$。\n  - $v_2$ 的泄漏量：$\\max(0, \\min(49 - o_2, \\ell^{\\text{val}}_2)) = \\max(0, \\min(49 - 26, 11)) = \\min(23, 11) = 11$。\n  - $v_3$ 的泄漏量：$\\max(0, \\min(49 - o_3, \\ell^{\\text{val}}_3)) = \\max(0, \\min(49 - 48, 12)) = \\min(1, 12) = 1$。\n  总泄漏量 = $11 + 1 = 12$。\n\n- **案例 6: $L = 20548$**\n  $E_{\\text{leak}} = \\max(0, \\min(68, 20548 - 20480)) = \\max(0, 68) = 68$。\n  - $v_2$ 的泄漏量：$\\max(0, \\min(68 - o_2, \\ell^{\\text{val}}_2)) = \\max(0, \\min(68 - 26, 11)) = \\min(42, 11) = 11$。\n  - $v_3$ 的泄漏量：$\\max(0, \\min(68 - o_3, \\ell^{\\text{val}}_3)) = \\max(0, \\min(68 - 48, 12)) = \\min(20, 12) = 12$。\n  总泄漏量 = $11 + 12 = 23$。\n\n测试套件的最终结果是 $[0, 0, 0, 4, 12, 23]$。", "answer": "[0,0,0,4,12,23]", "id": "3689504"}]}