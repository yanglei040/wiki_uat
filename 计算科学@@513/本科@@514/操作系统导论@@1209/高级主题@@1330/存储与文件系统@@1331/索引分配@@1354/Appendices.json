{"hands_on_practices": [{"introduction": "索引分配方案的核心优势在于其处理大文件的能力，这得益于其精巧的指针结构。本练习将引导你从第一性原理出发，通过分析一个包含直接指针和多级间接指针的典型 inode 结构，来推导其所能支持的最大文件大小 [@problem_id:3649508]。掌握这个计算方法是理解和评估任何索引式文件系统扩展能力的基础。", "problem": "一个操作系统（OS）中的文件系统组件使用索引分配。每个文件由大小为 $B$ 字节的固定大小数据块组成。文件的 inode（索引节点）包含 $a$ 个直接块指针，这些指针直接引用数据块。它还可能包含指向间接索引块的指针，提供最多 $d$ 级间接。每个间接索引块是一个固定大小的块，仅存储块指针，每个指针大小为 $p$ 字节，因此一个间接索引块可以容纳 $k$ 个指针，其中 $k$ 等于一个大小为 $B$ 的块在填充 $p$ 字节指针时的整数容量。假设 $k$ 是已知的，并且第 $i$ 级（$i \\in \\{1,\\dots,d\\}$）的每个间接指针最终只引用叶子节点的数据块；中间级别引用更深层次的间接块。除了其 $a$ 个直接指针外，inode 对每个间接级别 $i \\in \\{1,\\dots,d\\}$ 都有且仅有一个指针。索引块本身不计入逻辑文件大小；只有数据块被计算在内。\n\n从这些定义和基本计数原理出发，推导出一个文件中可寻址数据块最大数量的解析表达式，该表达式是 $a$、$k$ 和 $d$ 的函数，然后推导出以字节为单位的最大文件大小的解析表达式，该表达式是 $B$、$a$、$k$ 和 $d$ 的函数。\n\n最后，在 $B=4\\,\\mathrm{KB}$、$p=4\\,\\mathrm{B}$、$a=12$ 和 $d=3$ 的情况下，计算最大文件大小。以字节为单位表示最终的最大文件大小。不要四舍五入；给出确切的整数值。", "solution": "用户希望我解决一个关于操作系统中索引文件分配的问题。\n\n### 第 1 步：提取给定条件\n- 文件系统块大小：$B$ 字节。\n- inode 中的直接块指针数量：$a$。\n- 最大间接深度：$d$。\n- 块指针大小：$p$ 字节。\n- 每个间接索引块中的指针数量：$k = \\lfloor B/p \\rfloor$。\n- Inode 结构：$a$ 个直接指针和对应于每个间接级别 $i \\in \\{1, \\dots, d\\}$ 的一个指针。\n- 任务 1：推导可寻址数据块最大数量 $N_{blocks}$ 的解析表达式，作为 $a$、$k$ 和 $d$ 的函数。\n- 任务 2：推导最大文件大小 $S_{max}$ 的解析表达式，作为 $B$、$a$、$k$ 和 $d$ 的函数。\n- 任务 3：在特定情况下计算 $S_{max}$：$B=4\\,\\mathrm{KB}$、$p=4\\,\\mathrm{B}$、$a=12$ 和 $d=3$。\n\n### 第 2 步：使用提取的给定条件进行验证\n该问题描述了索引文件分配的标准模型，这是操作系统中的一个基本概念。\n- **科学依据：** 该模型是像 Unix 文件系统（UFS）等文件系统的公认简化表示。所有概念在计算机科学中都是标准的。\n- **适定性：** 问题定义清晰，提供了所有必要的变量（$B, p, a, d$）和关系（$k = \\lfloor B/p \\rfloor$）。inode 的结构已明确说明。任务具体，并能导向唯一解。\n- **客观性：** 语言正式且无歧义。\n\n该问题没有任何缺陷。它不是科学上不合理、不可形式化、不完整、不切实际、不适定或微不足道的。这是操作系统领域一个标准的可解问题。\n\n### 第 3 步：结论与行动\n问题是**有效的**。将提供一个解决方案。\n\n### 最大可寻址数据块数量的推导\n\n设 $N_{blocks}$ 是一个文件可以拥有的最大数据块数。这由从文件的 inode 开始可以访问的数据块指针总数决定。我们将直接指针和间接指针的贡献相加。\n\n1.  **直接指针的贡献：** inode 包含 $a$ 个直接指针。每个直接指针引用一个数据块。\n    来自直接指针的贡献 = $a$。\n\n2.  **间接指针的贡献：** 问题陈述 inode “对每个间接级别 $i \\in \\{1,\\dots,d\\}$ 都有且仅有一个指针”。这意味着有一个单级间接指针，一个双级间接指针，...，以及一个 $d$ 级间接指针。\n\n    -   **第 1 级（单级间接指针）：** inode 中的单级间接指针指向一个*索引块*。该索引块包含 $k$ 个指针。这 $k$ 个指针中的每一个都引用一个数据块。\n        来自第 1 级指针的贡献 = $k^1 = k$。\n\n    -   **第 2 级（双级间接指针）：** inode 中的双级间接指针指向一个一级索引块。该块包含 $k$ 个指针，每个指针指向一个二级索引块。因此，有 $k$ 个二级索引块。这些二级索引块中的每一个都包含 $k$ 个指向数据块的指针。\n        来自第 2 级指针的贡献 = $k \\times k = k^2$。\n\n    -   **第 $i$ 级（$i$ 级间接指针）：** 推广该模式，inode 中的 $i$ 级间接指针启动一个深度为 $i$ 的索引块树。该结构允许寻址 $k^i$ 个数据块。\n        来自第 $i$ 级指针的贡献 = $k^i$。\n\n    所有间接指针的总贡献是从 1 到 $d$ 的每个间接级别的贡献之和。\n    来自间接指针的总贡献 = $\\sum_{i=1}^{d} k^i$。\n\n3.  **数据块总数：** 可寻址数据块的总数 $N_{blocks}$ 是由直接指针和所有级别的间接指针寻址的块的总和。\n    $$N_{blocks}(a, k, d) = a + \\sum_{i=1}^{d} k^i$$\n    这是第一个要求的表达式。该和是一个几何级数。对于 $k \\neq 1$，这也可以写成 $N_{blocks}(a, k, d) = a + k \\frac{k^d - 1}{k - 1}$。\n\n### 最大文件大小的推导\n\n文件的逻辑大小仅由数据块的内容决定。每个数据块的大小为 $B$ 字节。最大文件大小 $S_{max}$ 是可寻址数据块的总数乘以每个块的大小。\n\n使用上面推导出的 $N_{blocks}$ 表达式：\n$$S_{max}(B, a, k, d) = B \\times N_{blocks}(a, k, d)$$\n代入 $N_{blocks}$ 的表达式：\n$$S_{max}(B, a, k, d) = B \\left( a + \\sum_{i=1}^{d} k^i \\right)$$\n这是第二个要求的解析表达式。\n\n### 特定情况的计算\n\n我们被要求在 $B=4\\,\\mathrm{KB}$、$p=4\\,\\mathrm{B}$、$a=12$ 和 $d=3$ 的情况下计算最大文件大小。\n\n1.  **计算 $k$：**\n    首先，我们必须将 $B$ 转换为字节。\n    $B = 4\\,\\mathrm{KB} = 4 \\times 1024\\,\\mathrm{Bytes} = 4096\\,\\mathrm{Bytes}$。\n    指针的大小为 $p = 4\\,\\mathrm{Bytes}$。\n    一个索引块中的指针数量 $k$ 是：\n    $$k = \\left\\lfloor \\frac{B}{p} \\right\\rfloor = \\left\\lfloor \\frac{4096}{4} \\right\\rfloor = 1024$$\n\n2.  **计算块的总数 $N_{blocks}$：**\n    我们使用 $N_{blocks}$ 的公式，其中 $a=12$，$d=3$，和 $k=1024$。\n    $$N_{blocks} = a + \\sum_{i=1}^{d} k^i = 12 + \\sum_{i=1}^{3} (1024)^i$$\n    $$N_{blocks} = 12 + 1024^1 + 1024^2 + 1024^3$$\n    让我们计算 $1024$ 的幂：\n    $1024^1 = 1024$\n    $1024^2 = (2^{10})^2 = 2^{20} = 1,048,576$\n    $1024^3 = (2^{10})^3 = 2^{30} = 1,073,741,824$\n    现在，我们将这些值相加：\n    $$N_{blocks} = 12 + 1024 + 1,048,576 + 1,073,741,824$$\n    $$N_{blocks} = 1036 + 1,048,576 + 1,073,741,824$$\n    $$N_{blocks} = 1,049,612 + 1,073,741,824$$\n    $$N_{blocks} = 1,074,791,436$$\n\n3.  **计算最大文件大小 $S_{max}$：**\n    最大文件大小是 $N_{blocks}$ 乘以块大小 $B$。\n    $$S_{max} = N_{blocks} \\times B$$\n    $$S_{max} = 1,074,791,436 \\times 4096$$\n    执行乘法：\n    $$S_{max} = 4,402,345,721,856$$\n最大文件大小确切为 $4,402,345,721,856$ 字节。这大约是 $4$ 太字节（$4\\,\\mathrm{TiB}$）。", "answer": "$$\\boxed{4402345721856}$$", "id": "3649508"}, {"introduction": "理解了文件系统如何组织数据块后，一个自然而然的工程问题便是：如何配置系统以达到最高效率？本练习探讨了块大小（$B$）选择所带来的一个核心权衡：较大的块可以减少索引开销，但可能导致更严重的内部碎片。你将扮演系统设计者的角色，通过计算来为特定大小的文件找到最优的块大小，从而最小化总存储空间占用 [@problem_id:3649516]。", "problem": "一个操作系统（OS）中的存储子系统使用带链接的单级索引块的索引分配方式。一个数据块的大小为 $B$，从集合 $\\{1\\,\\mathrm{KB},2\\,\\mathrm{KB},4\\,\\mathrm{KB},8\\,\\mathrm{KB}\\}$ 中选择，其中 $1\\,\\mathrm{KB}=1024$ 字节。每个索引块仅由大小为 $p$ 字节的定长块指针组成，其中 $p=8$ 字节。对于给定的块大小 $B$，一个索引块的指针容量为 $k=\\lfloor B/p\\rfloor$，最大单间接覆盖范围（单个索引块可寻址的最大文件大小）为 $k\\cdot B$ 字节。\n\n假设一个大小为 $S$ 字节的单个文件采用以下存储模型：\n- 文件使用 $n_{d}(B)=\\lceil S/B\\rceil$ 个数据块。\n- 如果所需的数据块数量超过单个索引块所能寻址的范围，则会链接额外的索引块。使用的索引块数量为 $n_{i}(B)=\\left\\lceil n_{d}(B)/k\\right\\rceil$。每个索引块占用一个大小为 $B$ 的完整块，并且只存储数据块指针。你可以假设链接元数据在索引块之外管理，并且不影响 $k$。\n- 内部碎片仅产生于最后一个未完全填充的数据块，并通过对 $n_{d}(B)$ 的向上取整操作来体现。\n\n设文件大小为 $S=15000000$ 字节，且 $p=8$ 字节。\n\n任务：\n1. 对于每个候选块大小 $B\\in\\{1\\,\\mathrm{KB},2\\,\\mathrm{KB},4\\,\\mathrm{KB},8\\,\\mathrm{KB}\\}$，确定 $k=\\lfloor B/p\\rfloor$ 和最大单间接覆盖范围 $k\\cdot B$。\n2. 使用上述模型，对于每个 $B$，确定大小为 $S$ 的文件所需的总分配空间 $A(B)=\\big(n_{d}(B)+n_{i}(B)\\big)\\cdot B$（以字节为单位）。\n3. 选择使 $A(B)$ 最小化的块大小 $B^{\\star}$（若存在平局，则选择较大的 $B$），并计算相应的最大单间接覆盖范围 $k(B^{\\star})\\cdot B^{\\star}$。\n\n将你的最终答案表示为一个整数，单位为字节。无需四舍五入。在任何中间计算和解释中，请使用字节作为单位。", "solution": "该问题要求分析索引文件分配系统中的存储开销。目标是从给定集合中确定最佳块大小 $B$，以最小化特定大小文件的总分配空间，然后为该最佳块大小计算一个相关属性。分析将根据提供的模型，系统地评估每个候选块大小。\n\n给定的参数是：\n- 文件大小: $S = 15000000$ 字节。\n- 块指针大小: $p = 8$ 字节。\n- 候选块大小: $B \\in \\{1\\,\\mathrm{KB}, 2\\,\\mathrm{KB}, 4\\,\\mathrm{KB}, 8\\,\\mathrm{KB}\\}$。我们使用 $1\\,\\mathrm{KB} = 1024$ 字节将它们转换为字节，因此 $B \\in \\{1024, 2048, 4096, 8192\\}$ 字节。\n\n该模型为给定的块大小 $B$ 定义了以下量：\n- 每个索引块的指针数: $k(B) = \\lfloor B/p \\rfloor$。\n- 文件所需的数据块数: $n_{d}(B) = \\lceil S/B \\rceil$。\n- 指向所有数据块所需的索引块数: $n_{i}(B) = \\lceil n_{d}(B)/k(B) \\rceil$。\n- 总分配空间: $A(B) = (n_{d}(B) + n_{i}(B)) \\cdot B$。\n\n我们现在将为每个候选块大小计算这些值。\n\n**情况1：块大小 $B = 1024$ 字节**\n\n首先，我们计算单个索引块中可以存储的指针数量。\n$$k(1024) = \\left\\lfloor \\frac{1024}{8} \\right\\rfloor = \\lfloor 128 \\rfloor = 128$$\n最大单间接覆盖范围是一个索引块可寻址的数据量。\n$$k(1024) \\cdot B = 128 \\cdot 1024 = 131072 \\text{ 字节}$$\n接下来，我们确定文件所需的数据块数量。\n$$n_{d}(1024) = \\left\\lceil \\frac{15000000}{1024} \\right\\rceil = \\lceil 14648.4375 \\rceil = 14649$$\n然后，我们计算寻址这些数据块所需的索引块数量。\n$$n_{i}(1024) = \\left\\lceil \\frac{n_{d}(1024)}{k(1024)} \\right\\rceil = \\left\\lceil \\frac{14649}{128} \\right\\rceil = \\lceil 114.4453125 \\rceil = 115$$\n最后，我们计算总分配空间。\n$$A(1024) = (n_{d}(1024) + n_{i}(1024)) \\cdot 1024 = (14649 + 115) \\cdot 1024 = 14764 \\cdot 1024 = 15118336 \\text{ 字节}$$\n\n**情况2：块大小 $B = 2048$ 字节**\n\n遵循相同的步骤：\n$$k(2048) = \\left\\lfloor \\frac{2048}{8} \\right\\rfloor = \\lfloor 256 \\rfloor = 256$$\n最大单间接覆盖范围是：\n$$k(2048) \\cdot B = 256 \\cdot 2048 = 524288 \\text{ 字节}$$\n数据块的数量是：\n$$n_{d}(2048) = \\left\\lceil \\frac{15000000}{2048} \\right\\rceil = \\lceil 7324.21875 \\rceil = 7325$$\n索引块的数量是：\n$$n_{i}(2048) = \\left\\lceil \\frac{n_{d}(2048)}{k(2048)} \\right\\rceil = \\left\\lceil \\frac{7325}{256} \\right\\rceil = \\lceil 28.61328125 \\rceil = 29$$\n总分配空间是：\n$$A(2048) = (n_{d}(2048) + n_{i}(2048)) \\cdot 2048 = (7325 + 29) \\cdot 2048 = 7354 \\cdot 2048 = 15060992 \\text{ 字节}$$\n\n**情况3：块大小 $B = 4096$ 字节**\n\n再次，我们应用公式：\n$$k(4096) = \\left\\lfloor \\frac{4096}{8} \\right\\rfloor = \\lfloor 512 \\rfloor = 512$$\n最大单间接覆盖范围是：\n$$k(4096) \\cdot B = 512 \\cdot 4096 = 2097152 \\text{ 字节}$$\n数据块的数量是：\n$$n_{d}(4096) = \\left\\lceil \\frac{15000000}{4096} \\right\\rceil = \\lceil 3662.109375 \\rceil = 3663$$\n索引块的数量是：\n$$n_{i}(4096) = \\left\\lceil \\frac{n_{d}(4096)}{k(4096)} \\right\\rceil = \\left\\lceil \\frac{3663}{512} \\right\\rceil = \\lceil 7.154296875 \\rceil = 8$$\n总分配空间是：\n$$A(4096) = (n_{d}(4096) + n_{i}(4096)) \\cdot 4096 = (3663 + 8) \\cdot 4096 = 3671 \\cdot 4096 = 15036416 \\text{ 字节}$$\n\n**情况4：块大小 $B = 8192$ 字节**\n\n最后，对于最大的块大小：\n$$k(8192) = \\left\\lfloor \\frac{8192}{8} \\right\\rfloor = \\lfloor 1024 \\rfloor = 1024$$\n最大单间接覆盖范围是：\n$$k(8192) \\cdot B = 1024 \\cdot 8192 = 8388608 \\text{ 字节}$$\n数据块的数量是：\n$$n_{d}(8192) = \\left\\lceil \\frac{15000000}{8192} \\right\\rceil = \\lceil 1831.0546875 \\rceil = 1832$$\n索引块的数量是：\n$$n_{i}(8192) = \\left\\lceil \\frac{n_{d}(8192)}{k(8192)} \\right\\rceil = \\left\\lceil \\frac{1832}{1024} \\right\\rceil = \\lceil 1.7890625 \\rceil = 2$$\n总分配空间是：\n$$A(8192) = (n_{d}(8192) + n_{i}(8192)) \\cdot 8192 = (1832 + 2) \\cdot 8192 = 1834 \\cdot 8192 = 15024128 \\text{ 字节}$$\n\n**最佳块大小 $B^{\\star}$ 的比较与选择**\n\n我们现在比较每种块大小的总分配空间 $A(B)$：\n- $A(1024) = 15118336$ 字节\n- $A(2048) = 15060992$ 字节\n- $A(4096) = 15036416$ 字节\n- $A(8192) = 15024128$ 字节\n\n通过比较这些值，我们发现最小总分配空间为 $15024128$ 字节。这个最小值是在块大小 $B = 8192$ 字节时实现的。因此，最佳块大小是 $B^{\\star} = 8192$ 字节。\n\n**最终计算**\n\n问题要求计算与最佳块大小 $B^{\\star}$ 对应的最大单间接覆盖范围 $k(B^{\\star}) \\cdot B^{\\star}$。我们已经为 $B=8192$ 计算过这个值。\n$$k(B^{\\star}) \\cdot B^{\\star} = k(8192) \\cdot 8192 = 1024 \\cdot 8192 = 8388608$$\n这个值表示当块大小为 $B^{\\star}$ 时，单个索引块可以支持的最大文件大小。", "answer": "$$\\boxed{8388608}$$", "id": "3649516"}, {"introduction": "没有一种文件分配策略是万能的。为了更深刻地理解索引分配的特点，本次练习将其与另一种主流方法——基于“区段”（extent-based）的分配——进行对比。通过分析两种策略在处理大文件时的元数据开销，你将推导出决定哪种方法更节省空间的“盈亏平衡点” [@problem_id:3649420]。这项练习将提升你的批判性思维，让你明白为何不同的文件系统会根据预期的工作负载选择不同的设计方案。", "problem": "一个文件系统将文件块地址存储在索引节点（inode）中。每个 inode 最多可存储 $a$ 个直接数据块地址，其后最多可跟一个单级间接指针和一个双级间接指针。存储单元是一个大小为 $B$ 字节的固定大小数据块，每个磁盘上的指针占用 $p$ 字节，且 $p$ 能整除 $B$。间接块是仅包含指针的块；因此，一个单级间接块可以精确存储 $k = B/p$ 个指向数据块的指针，而一个双级间接指针引用一个二级块，该二级块包含 $k$ 个指向一级间接块的指针，每个一级间接块又包含 $k$ 个指向数据块的指针，当完全利用时，总容量为 $k^{2}$ 个数据块。\n\n定义一个大小为 $S$ 字节的文件的元数据空间开销为：不承载文件数据但定位文件数据所需的总磁盘字节数，计算时包括：\n- inode 内部使用的指针字段所消耗的字节数，\n- 任何级别的每个已分配间接块的全部 $B$ 字节。\n\n忽略除 inode 中实际使用的指针字段之外的任何固定的每文件头部，忽略间接块内部的任何内部头部，并将任何部分填充的间接块视为占用完整的 $B$ 字节。\n\n现在，将这种索引指针方案与一种基于区段（extent）的方案进行比较，在该方案中，文件表示为连续运行（区段）的列表。假设平均区段长度为 $\\ell$ 个数据块，并且每个区段描述符恰好由两个指针大小的字段组成（一个用于起始块地址，一个用于运行长度），每个区段总计 $2p$ 字节。将区段描述符视为无填充紧凑排列，并忽略除区段描述符本身之外的任何额外的每文件头部。\n\n在超大文件的渐近情况下，即前 $a$ 个直接指针和单级间接层的贡献在每个数据块的基础上可以忽略不计，推导出临界平均区段长度 $\\ell^{\\star}$，在该长度下，索引指针方案的每数据块渐近元数据开销等于基于区段方案的开销。请用仅包含 $B$ 和 $p$ 的单个闭式符号表达式来表示你的最终答案（你可以使用 $k = B/p$）。不需要进行数值计算。最终答案必须是单个解析表达式。", "solution": "该问题陈述清晰，具有科学依据，并为推导所求量提供了足够的信息。这是文件系统研究中的一个标准理论问题。我将开始进行解答。\n\n目标是找到临界平均区段长度，记为 $\\ell^{\\star}$，在该长度下，索引指针分配方案的每数据块渐近元数据开销等于基于区段方案的开销。\n\n我们首先分析索引指针方案的渐近元数据开销。问题指明，对于超大文件，前 $a$ 个直接指针和单级间接层的贡献在每个数据块的基础上变得可以忽略不计。这意味着我们只需要考虑与双级间接指针相关的开销，因为它寻址了超大文件中的绝大多数块。\n\n在该方案中，inode 中的一个双级间接指针指向一个二级（L2）间接块。这个 L2 块包含 $k = B/p$ 个指针，每个指针指向一个一级（L1）间接块。每个 L1 块又包含 $k$ 个指向数据块的指针。因此，一个完全利用的双级间接结构支持 $k \\times k = k^2$ 个数据块。\n\n根据问题对元数据开销的定义，我们必须计算每个已分配间接块的完整大小（$B$ 字节）。要通过双级间接指针寻址 $k^2$ 个数据块，我们需要：\n1. 一个 L2 间接块，占用 $B$ 字节。\n2. $k$ 个 L1 间接块，总共占用 $k \\times B$ 字节。\n\n这 $k^2$ 个数据块的总元数据开销 $M_{idx}$ 是这些间接块所占用空间的总和：\n$$M_{idx} = B + k B = B(1+k)$$\n由这些元数据寻址的数据块数量 $N_{data}$ 为 $k^2$。因此，每数据块的渐近元数据开销 $O_{idx}$ 是该元数据成本与其支持的数据块数量之比。\n$$O_{idx} = \\frac{M_{idx}}{N_{data}} = \\frac{B(1+k)}{k^2}$$\n问题指出，inode 内部的指针也构成开销。对于一个大到足以使用双级间接指针的文件，其 inode 将会使用 $a$ 个直接指针、1 个单级间接指针和 1 个双级间接指针。这是一个固定成本。在无限大文件的渐近极限下计算*每数据块*的开销时，这个固定成本被无限数量的块所除，其贡献趋于零。因此，在渐近分析中忽略它是正确的，这与问题陈述一致。\n\n接下来，我们分析基于区段方案的元数据开销。文件表示为区段列表，其中平均区段长度为 $\\ell$ 个数据块。每个区段由一个大小为 $2p$ 字节的描述符来描述。\n对于一个包含 $N$ 个数据块的大文件，区段的数量 $N_{extents}$ 可近似为：\n$$N_{extents} \\approx \\frac{N}{\\ell}$$\n总元数据开销 $M_{ext}$ 是所有区段描述符的总大小：\n$$M_{ext} \\approx N_{extents} \\times 2p = \\frac{N}{\\ell} \\times 2p$$\n每数据块的渐近元数据开销 $O_{ext}$ 是总元数据成本除以数据块数量：\n$$O_{ext} = \\frac{M_{ext}}{N} = \\frac{(N/\\ell) \\times 2p}{N} = \\frac{2p}{\\ell}$$\n通过令两种开销相等来找到临界平均区段长度 $\\ell^{\\star}$：当 $\\ell = \\ell^{\\star}$ 时，$O_{idx} = O_{ext}$。\n$$\\frac{B(1+k)}{k^2} = \\frac{2p}{\\ell^{\\star}}$$\n我们现在求解 $\\ell^{\\star}$：\n$$\\ell^{\\star} = \\frac{2p \\cdot k^2}{B(1+k)}$$\n问题要求最终答案仅用 $B$ 和 $p$ 表示。我们将定义 $k = B/p$ 代入 $\\ell^{\\star}$ 的表达式中：\n$$\\ell^{\\star} = \\frac{2p \\left(\\frac{B}{p}\\right)^2}{B\\left(1+\\frac{B}{p}\\right)}$$\n简化分子和分母：\n$$\\ell^{\\star} = \\frac{2p \\left(\\frac{B^2}{p^2}\\right)}{B\\left(\\frac{p+B}{p}\\right)} = \\frac{\\frac{2B^2}{p}}{\\frac{B(p+B)}{p}}$$\n分子和分母的分母中的因子 $p$ 相互抵消：\n$$\\ell^{\\star} = \\frac{2B^2}{B(p+B)}$$\n最后，我们从分子和分母中消去一个因子 $B$，得到最终的闭式表达式：\n$$\\ell^{\\star} = \\frac{2B}{p+B} = \\frac{2B}{B+p}$$\n这就是临界平均区段长度，以数据块为单位进行度量。", "answer": "$$\\boxed{\\frac{2B}{B+p}}$$", "id": "3649420"}]}