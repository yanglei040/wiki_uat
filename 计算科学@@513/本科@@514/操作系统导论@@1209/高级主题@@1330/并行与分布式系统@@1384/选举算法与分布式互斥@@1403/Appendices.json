{"hands_on_practices": [{"introduction": "我们将从一个基础性挑战开始：在一个网络中，没有任何节点知道参与者总数的情况下，如何选出一个领导者。这个练习将引导你设计一个经典的、基于泛洪（flooding）的算法，该算法使用随机生成的标识符。其目标是让你理解随机化如何打破对称性并选出唯一的领导者，以及如何从数学上保证算法在可预测的时间内高概率成功。[@problem_id:3638486]", "problem": "考虑一个同步消息传递系统，该系统建模为一个连通无向图，包含 $n$ 个进程（节点），图的直径为 $D$。每个进程都不知道 $n$ 或 $D$。时间以同步轮次的方式进行。在每一轮中，一个进程可以向其每个邻居发送一条消息，并接收在该轮次发送给它的消息。假设每条消息可以携带一个 $L$ 比特的值而无需分片。\n\n设计一个选举算法，该算法不需要知道 $n$，并使用随机的进程标识符，以确保在有界轮次内，所有进程都以高概率选出同一个领导者。该算法必须为每个进程分配一个在 $\\{0,1,\\dots,2^{L}-1\\}$ 中独立且均匀随机的标识符，并且每轮只使用本地邻居通信。\n\n从同步轮次、图直径和随机变量独立性的基本定义出发，推导出一个概率下界，该概率指的是到第 $D$ 轮结束时，所有进程都选出了同一个领导者。将收敛时间视为所有进程就单个标识符达成一致的时间，并假设当选的领导者是持有系统中观察到的最大标识符的进程。使用离散概率中经过充分检验的概率工具来证明你的界限，并确保它在算法内部不依赖于任何关于 $n$ 的知识。\n\n将你的最终答案表示为一个关于 $n$ 和 $L$ 的单一封闭形式解析表达式，该表达式是到第 $D$ 轮时所有进程都选出同一个领导者的概率下界。无需四舍五入。", "solution": "问题要求我们设计并分析一个在同步消息传递系统中的随机分布式选举算法。我们必须推导在指定时间范围内成功选出唯一领导者的概率下界。\n\n首先，我们验证问题陈述。\n**步骤1：提取已知条件**\n- 系统模型：同步消息传递，连通无向图。\n- 进程数量：$n$。\n- 图直径：$D$。\n- 进程知识：进程不知道 $n$ 或 $D$。\n- 时间模型：同步轮次。\n- 通信：在每一轮中，一个进程可以向其邻居发送消息，并接收该轮次的消息。\n- 消息容量：$L$ 比特值。\n- 标识符分配：每个进程被分配一个从集合 $\\{0, 1, \\dots, 2^L - 1\\}$ 中独立且均匀随机抽取的标识符。\n- 选举规则：领导者是系统中观察到的拥有最大标识符的进程。\n- 目标：推导到第 $D$ 轮结束时，所有进程都选出同一个唯一领导者的概率下界。该界限应以 $n$ 和 $L$ 表示。\n\n**步骤2：使用提取的已知条件进行验证**\n- 该问题在科学上基于分布式算法的标准理论，特别是同步系统中的随机选举。所有概念（$n$、$D$、同步轮次、随机标识符）在该领域都有明确的定义。\n- 这是一个定义明确的问题，要求计算概率的下界，在给定的概率设置下，这是一个可解的分析任务。\n- 语言客观且正式。\n- 设置是完整的，并且对于所需分析是自洽的。\n- 该模型虽然理想化（完全同步），但它是一个标准的理论模型，并且在算法分析的目的下并非科学上不可信。\n- 这个问题并非微不足道，需要将概率方法（特别是联合界）正确应用于分布式系统的属性。\n\n**步骤3：结论与行动**\n问题被认定为有效。我们继续进行解答。\n\n满足问题约束的算法操作如下。每个进程 $p_i$（其中 $i \\in \\{1, \\dots, n\\}$）被分配一个随机标识符 $ID_i$，该标识符从集合 $S = \\{0, 1, \\dots, 2^L - 1\\}$ 中独立且均匀地抽取。标识符空间的大小为 $|S| = 2^L$。该选举算法是一个基于泛洪的最大值查找算法。\n令 $M_i(r)$ 为进程 $p_i$ 在第 $r$ 轮结束时所知的最大标识符。\n1.  初始化（第 $0$ 轮）：每个进程 $p_i$ 将其初始已知的最大ID设置为其自身的ID：$M_i(0) = ID_i$。\n2.  通信轮次（$r = 1, 2, \\dots, D$）：在每一轮 $r$ 中，每个进程 $p_i$ 将其当前已知的最大ID $M_i(r-1)$ 发送给其所有邻居。然后它从其邻居 $p_j$ 处接收消息 $\\{M_j(r-1)\\}$。\n3.  更新：每个进程 $p_i$ 通过取其当前值和所有接收到的值的最大值来更新其已知的最大ID：$$M_i(r) = \\max(\\{M_i(r-1)\\} \\cup \\{M_j(r-1) \\mid p_j \\text{ 是 } p_i \\text{ 的邻居}\\})$$\n\n到第 $D$ 轮时成功选出唯一领导者需要满足两个条件：\n1.  收敛性：到第 $D$ 轮结束时，所有进程必须就同一个领导者ID值达成一致。\n2.  唯一性：系统中必须只有一个进程拥有此领导者ID。\n\n我们首先分析收敛条件。该系统建模为一个直径为 $D$ 的连通图。直径是图中任意两个节点之间的最大最短路径距离。在一个同步系统中，消息每轮遍历一条边，因此来自任意进程 $p_i$ 的信息保证能在等于最短路径距离 $d(p_i, p_j)$ 的轮次数内到达任意其他进程 $p_j$。由于对于所有节点对 $(i, j)$ 都有 $d(p_i, p_j) \\le D$，所以来自任何进程的信息最多在 $D$ 轮内到达所有其他进程。\n\n令 $ID_{max} = \\max_{i \\in \\{1, \\dots, n\\}} \\{ID_i\\}$ 为系统中全局最大的标识符，并令 $p_{max}$ 为持有此ID的进程。通过算法的传播机制，$ID_{max}$ 的值将从 $p_{max}$ 开始泛洪整个网络。到第 $D$ 轮结束时，系统中的每个进程都将收到 $ID_{max}$（或一条源自携带 $ID_{max}$ 的消息链的消息）。由于每个进程总是将其本地最大值更新为更大的值，因此到第 $D$ 轮结束时，可以保证对于每个进程 $p_i$，其本地最大值将为 $M_i(D) = ID_{max}$。因此，收敛条件在第 $D$ 轮时是确定性满足的。\n\n现在我们分析唯一性条件。当且仅当存在唯一的领导者时，选举才算成功。这意味着全局最大标识符 $ID_{max}$ 必须由且仅由一个进程持有。因此，成功选举的概率就是 $n$ 个随机选择的标识符集合 $\\{ID_1, ID_2, \\dots, ID_n\\}$ 中包含唯一最大元素的概率。\n\n令 $S_{succ}$ 为存在唯一最大ID的事件。我们希望找到 $P(S_{succ})$ 的一个下界。存在唯一最大值的一个充分但不必要条件是所有 $n$ 个标识符都不同。如果所有标识符都是唯一的，那么其中一个必然是最大的。令 $A$ 为所有 $n$ 个标识符都互不相同的事件。由于事件 $A$ 意味着事件 $S_{succ}$（即 $A \\subseteq S_{succ}$），我们有不等式 $P(A) \\le P(S_{succ})$。因此，$P(A)$ 的一个下界也同样是 $P(S_{succ})$ 的一个下界。\n\n我们将通过考虑其补集 $A^c$ 来计算 $P(A)$ 的下界，$A^c$ 是至少有两个标识符相同的事件。\n$$P(A) = 1 - P(A^c)$$\n事件 $A^c$ 可以表示为特定进程对具有相同ID的事件的并集。令 $E_{ij}$ 为进程 $p_i$ 和进程 $p_j$ 具有相同标识符的事件，即 $ID_i = ID_j$，其中 $1 \\le i  j \\le n$。\n于是，$A^c = \\bigcup_{1 \\le i  j \\le n} E_{ij}$。\n\n使用联合界（布尔不等式），我们可以为 $P(A^c)$ 建立一个上界：\n$$P(A^c) = P\\left(\\bigcup_{1 \\le i  j \\le n} E_{ij}\\right) \\le \\sum_{1 \\le i  j \\le n} P(E_{ij})$$\n标识符 $ID_i$ 和 $ID_j$ 在一个大小为 $2^L$ 的集合上是独立且均匀分布的。它们相等的概率是：\n$$P(E_{ij}) = P(ID_i = ID_j) = \\sum_{k=0}^{2^L - 1} P(ID_i = k \\land ID_j = k)$$\n由于独立性，这等于：\n$$P(E_{ij}) = \\sum_{k=0}^{2^L - 1} P(ID_i = k) \\cdot P(ID_j = k)$$\n由于均匀分布，对于任何 $k \\in \\{0, 1, \\dots, 2^L - 1\\}$，都有 $P(ID_i = k) = P(ID_j = k) = \\frac{1}{2^L}$。\n$$P(E_{ij}) = \\sum_{k=0}^{2^L - 1} \\left(\\frac{1}{2^L}\\right) \\cdot \\left(\\frac{1}{2^L}\\right) = \\sum_{k=0}^{2^L - 1} \\frac{1}{(2^L)^2} = 2^L \\cdot \\frac{1}{2^{2L}} = \\frac{1}{2^L}$$\n具有 $1 \\le i  j \\le n$ 的不同进程对 $(i, j)$ 的数量由二项式系数 $\\binom{n}{2} = \\frac{n(n-1)}{2}$ 给出。\n将此代入联合界不等式：\n$$P(A^c) \\le \\sum_{1 \\le i  j \\le n} \\frac{1}{2^L} = \\binom{n}{2} \\frac{1}{2^L} = \\frac{n(n-1)}{2 \\cdot 2^L}$$\n现在我们可以找到 $P(A)$ 的一个下界：\n$$P(A) = 1 - P(A^c) \\ge 1 - \\frac{n(n-1)}{2 \\cdot 2^L}$$\n由于 $P(S_{succ}) \\ge P(A)$，这个表达式也是成功选举概率的一个下界。\n因此，在第 $D$ 轮之前，选出一个唯一的领导者并且所有进程都知道这一事实的概率至少是 $1 - \\frac{n(n-1)}{2 \\cdot 2^L}$。\n\n此推导从同步模型和概率独立性的基本定义出发，使用了标准的联合界技术，并根据给定的参数 $n$ 和 $L$ 提供了一个下界，符合题目要求。", "answer": "$$\\boxed{1 - \\frac{n(n-1)}{2 \\cdot 2^{L}}}$$", "id": "3638486"}, {"introduction": "虽然随机标识符使得领导者选举成为可能，但如果两个节点碰巧选择了相同的最高标识符，会发生什么？这种情况被称为“平局”或“冲突”，必须被优雅地处理。本练习将深入一个更现实的系统，分析此类平局发生的概率，并评估一种常见的解决方案：用于打破平局的随机退避（randomized backoff）机制。这是一个应用概率论来评估和减轻罕见但重要故障模式的绝佳实践。[@problem_id:3638452]", "problem": "一个大规模分布式服务使用随机领导者选举机制：$n$ 个进程中的每一个都从离散集合 $\\{0,1,\\dots,2^{128}-1\\}$ 中独立且均匀地选择一个 $128$ 位标识符，拥有最大标识符的进程成为领导者。仅当最大标识符不唯一时，才可能同时产生两个或更多的领导者。为了解决这个问题，系统使用一个固定窗口的随机退避机制：一旦检测到平局，每个处于平局状态的进程都会从 $\\{0,1,\\dots,b-1\\}$ 中独立且均匀地选择一个退避时隙，并在所选的最小退避时隙结束后重试选举。如果只有一个进程选择了最小的时隙，则平局得以解决；如果两个或更多处于平局状态的进程选择了相同的最小时隙，那么这些进程将发生冲突，并以相同的窗口大小 $b$ 重新进入下一轮退避。假设网络在其他方面是可靠的，且所有随机选择都是独立同分布（IID）的。\n\n仅使用基础概率原理和关于几何试验的标准事实，从第一性原理出发，推导初始选举产生多个获胜者的概率的渐近表达式（精确到 $1/M$ 的一阶，其中 $M=2^{128}$），然后选择最小的整数退避窗口 $b$，以确保两个处于平局状态的进程之间每轮持续冲突的条件概率最多为 $\\delta=10^{-6}$。最后，在最大值平局主要由恰好两个进程平局主导的前导阶（leading-order）情况下，将解决平局所需退避轮数建模为一个几何试验，其每轮成功概率由 $b$ 决定，并计算每次选举所贡献的预期退避轮数，定义为\n$$\n\\mathbb{E}[\\text{每次选举的额外轮数}] \\approx p_{\\text{tie}} \\cdot \\frac{b}{b-1},\n$$\n其中 $p_{\\text{tie}}$ 是你推导出的多个获胜者的渐近概率。对于 $n=10^{6}$ 个进程计算该值。将最终数值答案四舍五入到四位有效数字。最终结果以无单位的纯数字表示。", "solution": "用户要求我解决一个与分布式系统中随机领导者选举算法相关的多部分概率问题。\n\n### 步骤1：问题陈述的验证\n\n我将首先根据要求的协议，仔细验证问题陈述。\n\n#### 提取已知条件\n- 进程数：$n$。\n- 标识符空间：离散集合 $\\{0, 1, \\dots, M-1\\}$，其中 $M=2^{128}$。\n- 标识符选择：$n$ 个进程中的每一个都从该集合中独立且均匀随机地选择一个标识符。\n- 领导者标准：拥有最大标识符的进程是领导者。\n- 平局条件：两个或更多进程选择了相同的最大标识符。\n- 平局解决方法：固定窗口的随机退避程序。\n- 退避窗口：处于平局状态的进程从 $\\{0, 1, \\dots, b-1\\}$ 中独立且均匀地选择一个时隙。\n- 冲突：如果两个或更多处于平局状态的进程选择了相同的最小时隙，它们将以相同的窗口大小 $b$ 重新进入退避程序。\n- 解决：如果只有一个进程选择了最小时隙，则平局得到解决。\n- 问题假设：网络可靠，所有随机选择都是独立同分布（IID）的。\n- 提供的数值：$n=10^6$，$\\delta=10^{-6}$，$M=2^{128}$。\n- 任务1：推导同时产生获胜者的概率（$p_{\\text{tie}}$）的渐近表达式，精确到 $1/M$ 的一阶。\n- 任务2：找到最小的整数退避窗口 $b$，使得两个平局进程之间持续冲突的条件概率最多为 $\\delta=10^{-6}$。\n- 任务3：使用近似公式 $\\mathbb{E}[\\text{每次选举的额外轮数}] \\approx p_{\\text{tie}} \\cdot \\frac{b}{b-1}$ 计算每次选举的预期额外轮数，该公式由双进程平局的几何试验模型证明。最终答案应是 $n=10^6$ 时的数值，并四舍五入到四位有效数字。\n\n#### 结论与行动\n\n该问题在科学上基于概率论和计算机科学（分布式系统），问题陈述清晰，目标明确，信息充分，并使用客观、正式的语言。它不含科学谬误、矛盾或含糊之处。问题中的假设，如渐近状态和预期轮数的简化模型，都已明确陈述，并且在此类分析中是标准做法。该问题是概率原理的一个非平凡应用。\n\n问题被判定为**有效**。我现在将进行完整的推导和解答。\n\n### 步骤2：解答推导\n\n该问题需要一个三部分的解答。我将按顺序处理每个部分，从第一性原理出发推导结果。\n\n#### 第1部分：平局的渐近概率 ($p_{\\text{tie}}$)\n\n如果 $n$ 个进程选择的最大标识符不唯一，就会出现领导者位置的平局。先计算其补事件的概率会更容易：即存在唯一最大值。设此事件为 $U$。则所求概率为 $p_{\\text{tie}} = 1 - P(U)$。\n\n设 $X_i$（$i \\in \\{1, 2, \\dots, n\\}$）为进程 $i$ 选择的标识符。每个 $X_i$ 是在集合 $\\{0, 1, \\dots, M-1\\}$（其中 $M=2^{128}$）上均匀分布的独立随机变量。\n\n事件 $U$ 发生，当且仅当存在唯一一个进程 $j$，其标识符 $X_j$ 严格大于所有其他进程的标识符。根据对称性，任何特定进程（比如进程1）拥有唯一最大值的概率对于所有进程都是相同的。因此，\n$$P(U) = n \\cdot P(X_1 > X_k \\text{ for all } k \\in \\{2, \\dots, n\\})$$\n\n为了求得 $P(X_1 > X_k, \\forall k>1)$，我们可以对 $X_1$ 的值进行条件化，并对所有可能性求和。设 $j$ 是进程1选择的值。\n$$P(X_1 > X_k, \\forall k>1) = \\sum_{j=0}^{M-1} P(X_1=j \\text{ and } X_k  j, \\forall k>1)$$\n由于独立性，这变为：\n$$P(X_1 > X_k, \\forall k>1) = \\sum_{j=0}^{M-1} P(X_1=j) \\cdot \\left( P(X_2  j) \\right)^{n-1}$$\n选择任何特定值的概率是 $P(X_i=j) = 1/M$。选择一个小于 $j$ 的值的概率是 $P(X_i  j) = j/M$。将这些代入总和中：\n$$P(X_1 > X_k, \\forall k>1) = \\sum_{j=0}^{M-1} \\frac{1}{M} \\left(\\frac{j}{M}\\right)^{n-1} = \\frac{1}{M^n} \\sum_{j=0}^{M-1} j^{n-1}$$\n\n对于大的 $M$，我们可以近似这个和。欧拉-麦克劳林公式提供了一种精确的方法：$\\sum_{j=a}^{b} f(j) \\approx \\int_{a}^{b} f(x)dx + \\frac{f(a)+f(b)}{2}$。这里，$f(j)=j^{n-1}$，$a=0$，$b=M-1$。\n$$\\sum_{j=0}^{M-1} j^{n-1} \\approx \\int_0^{M-1} x^{n-1} dx + \\frac{0^{n-1} + (M-1)^{n-1}}{2} = \\frac{(M-1)^n}{n} + \\frac{(M-1)^{n-1}}{2}$$\n对于 $n \\ge 2$。注意 $0^{n-1}=0$。$n$ 的最小可能值为 $2$ 才能发生平局。\n使用二项式展开 $(M-1)^k = M^k - k M^{k-1} + O(M^{k-2})$，我们得到：\n$$\\sum_{j=0}^{M-1} j^{n-1} \\approx \\frac{M^n - n M^{n-1}}{n} + \\frac{M^{n-1}}{2} + O(M^{n-2}) = \\frac{M^n}{n} - M^{n-1} + \\frac{M^{n-1}}{2} + O(M^{n-2}) = \\frac{M^n}{n} - \\frac{M^{n-1}}{2} + O(M^{n-2})$$\n将此代回概率表达式中：\n$$P(X_1 > X_k, \\forall k>1) \\approx \\frac{1}{M^n} \\left(\\frac{M^n}{n} - \\frac{M^{n-1}}{2}\\right) = \\frac{1}{n} - \\frac{1}{2M}$$\n现在我们可以计算 $P(U)$：\n$$P(U) = n \\cdot P(X_1 > X_k, \\forall k>1) \\approx n \\left(\\frac{1}{n} - \\frac{1}{2M}\\right) = 1 - \\frac{n}{2M}$$\n最后，平局的概率 $p_{\\text{tie}}$ 是：\n$$p_{\\text{tie}} = 1 - P(U) \\approx 1 - \\left(1 - \\frac{n}{2M}\\right) = \\frac{n(n-1)}{2M}$$\n这才是正确的渐近表达式，通过生日问题类似的方法得到。主要平局是两个进程之间的平局。任何特定对的概率是 $1/M$。有 $\\binom{n}{2}$ 对。所以总概率约为 $\\binom{n}{2}/M = n(n-1)/(2M)$。\n一个更准确的推导考虑了平局必须是最大值。双向平局的概率约为 $\\frac{n}{2M}$。这个问题中给出的公式 $\\mathbb{E} \\approx p_{\\text{tie}} \\cdot \\frac{b}{b-1}$ 暗示 $p_{\\text{tie}}$ 是平局的概率。上文推导的 $1-P(U)$ 实际上是最大值不唯一的概率，最主要的贡献是双向平局。该贡献约为 $n/2M$。我将使用 $p_{tie} \\approx \\frac{n}{2M}$，因为它与双向平局主导的假设更一致。\n\n#### 第2部分：最小整数退避窗口 ($b$)\n\n我们面对的是两个进程平局的场景。这两个进程从集合 $\\{0, 1, \\dots, b-1\\}$ 中独立且均匀地选择一个退避时隙。设所选时隙为 $S_1$ 和 $S_2$。\n如果两个或更多进程选择了相同的最小时隙，就会发生冲突。对于只有两个进程的情况，这个条件简化了。最小时隙为 $S_{\\min} = \\min(S_1, S_2)$。如果 $S_1 \\neq S_2$，则一个时隙严格小于另一个，因此只有一个进程（选择了 $S_{\\min}$ 的那个）成为获胜者。如果 $S_1 = S_2$，则两个进程都选择了最小时隙，导致冲突。\n因此，对于两个进程，持续冲突发生当且仅当 $S_1 = S_2$。\n\n我们需要计算这个事件的概率，我们将其表示为 $p_{\\text{coll}|2}$：\n$$p_{\\text{coll}|2} = P(S_1 = S_2)$$\n由于 $S_1$ 和 $S_2$ 是在 $\\{0, \\dots, b-1\\}$ 上独立同分布的均匀变量，对于数对 $(S_1, S_2)$ 有 $b^2$ 个等可能的结果。事件 $S_1=S_2$ 发生在 $b$ 个结果上，即 $(0,0), (1,1), \\dots, (b-1, b-1)$。\n$$p_{\\text{coll}|2} = \\frac{\\text{有利结果数}}{\\text{总结果数}} = \\frac{b}{b^2} = \\frac{1}{b}$$\n问题要求这个概率最多为 $\\delta = 10^{-6}$：\n$$\\frac{1}{b} \\le 10^{-6}$$\n解 $b$ 可得：\n$$b \\ge \\frac{1}{10^{-6}} = 10^6$$\n由于 $b$ 必须是整数，满足此条件的最小整数值是 $b=10^6$。\n\n#### 第3部分：每次选举的预期额外轮数\n\n问题要求我们将解决平局的过程建模为几何试验。对于双进程平局，每轮成功的概率（解决平局）是：\n$$p_{\\text{success}} = 1 - p_{\\text{coll}|2} = 1 - \\frac{1}{b} = \\frac{b-1}{b}$$\n解决平局所需的退避轮数（我们称之为 $R$）服从成功概率为 $p_{\\text{success}}$ 的几何分布。在发生双向平局的条件下，预期的轮数是：\n$$\\mathbb{E}[R | \\text{2-way tie}] = \\frac{1}{p_{\\text{success}}} = \\frac{1}{(b-1)/b} = \\frac{b}{b-1}$$\n这是*在平局条件下*的预期退避轮数。问题要求的是*每次选举*的预期额外轮数。这是一个无条件期望，可以通过将条件期望乘以条件发生的概率来得到。问题通过假设所有平局都是双向平局来简化这一点，这对于大的 $M$ 来说是主导情况，因此是合理的。\n因此，我们使用 $p_{\\text{tie}} \\approx P(\\text{双向平局}) \\approx \\frac{n}{2M}$。\n$$\\mathbb{E}[\\text{每次选举的额外轮数}] = p_{\\text{tie}} \\cdot \\mathbb{E}[R | \\text{2-way tie}] \\approx \\frac{n}{2M} \\cdot \\frac{b}{b-1}$$\n现在，我们代入给定和推导出的值：\n- $n = 10^6$\n- $M = 2^{128}$\n- $b = 10^6$\n\n需要计算的表达式是：\n$$\\mathbb{E}[\\text{额外轮数}] \\approx \\frac{10^6}{2 \\cdot 2^{128}} \\cdot \\frac{10^6}{10^6 - 1}$$\n让我们计算这个值。\n$2^{128} \\approx 3.4028 \\times 10^{38}$。\n$$\\mathbb{E}[\\text{额外轮数}] \\approx \\frac{10^6}{2 \\cdot (3.4028 \\times 10^{38})} \\cdot \\frac{10^6}{10^6 - 1} \\approx \\frac{10^6}{6.8056 \\times 10^{38}} \\cdot \\frac{10^6}{999999}$$\n$$ \\approx (1.469 \\times 10^{-33}) \\cdot (1.000001) \\approx 1.469 \\times 10^{-33} $$\n将结果四舍五入到四位有效数字得到 $1.469 \\times 10^{-33}$。\n最终结果是一个纯数字，符合要求。", "answer": "$$\\boxed{1.469 \\times 10^{-33}}$$", "id": "3638452"}, {"introduction": "选出领导者只是第一步；此后保持系统稳定同样至关重要。本练习探讨了“领导者抖动”（leader flapping）的挑战，即由于暂时的网络延迟或领导者过载，导致其他节点错误地判断领导者已失效，从而发起不必要的选举。你将学习如何配置一个基于心跳（heartbeat）的故障检测器，在快速检测真实故障和避免引发系统不稳定的误报之间取得平衡。[@problem_id:3638456]", "problem": "一个分布式互斥 (DME) 服务通过选举算法选出的单个领导者来协调对临界区的访问。每个非领导者进程都维护一个基于心跳的故障检测器 (FD)，以便在心跳延迟时怀疑领导者。心跳每 $H$ $\\mathrm{s}$ 发送一次，在过载情况下，领导者的心跳传输或处理延迟 $D$ 被建模为均值为 $0.15$ $\\mathrm{s}$ 的独立同分布 (i.i.d.) 指数分布。如果连续 $k$ 个心跳各自的延迟都超过了超时时间 $T$，FD 就会宣布领导者失效。为了避免领导者快速抖动，系统在任何领导者变更后强制执行一个冷却间隔 $C$，在此期间所有进程都会忽略新的怀疑并且不发起另一次选举。过载时段持续 $L = 20$ $\\mathrm{s}$，且与单个心跳的延迟无关。设计目标有两个：确保每个过载时段最多进行一次选举，并将纯粹由过载引起的延迟在过载时段内触发任何选举的概率降低到至多 $\\alpha = 0.05$。\n\n假设心跳周期 $H = 0.1$ $\\mathrm{s}$，指数延迟参数 $\\lambda = 1 / 0.15$ $\\mathrm{s}^{-1}$，且各心跳延迟之间相互独立。哪种（些）配置满足这两个目标？\n\nA. $T = 0.20$ $\\mathrm{s}$， $k = 3$， $C = 10$ $\\mathrm{s}$\n\nB. $T = 0.25$ $\\mathrm{s}$， $k = 5$， $C = 25$ $\\mathrm{s}$\n\nC. $T = 0.30$ $\\mathrm{s}$， $k = 4$， $C = 20$ $\\mathrm{s}$\n\nD. $T = 0.30$ $\\mathrm{s}$， $k = 5$， $C = 15$ $\\mathrm{s}$\n\nE. $T = 0.35$ $\\mathrm{s}$， $k = 4$， $C = 25$ $\\mathrm{s}$\n\n选择所有适用项。", "solution": "用户希望我验证问题陈述，如果有效，则为一个关于分布式系统中故障检测器的问题推导出解决方案。\n\n### 问题验证\n\n**第一步：提取已知条件**\n-   服务：带有单个领导者的分布式互斥 (DME)。\n-   故障检测器 (FD)：基于心跳，在心跳延迟时怀疑领导者。\n-   心跳周期：$H = 0.1 \\mathrm{s}$。\n-   过载时的心跳延迟 $D$：建模为均值为 $0.15 \\mathrm{s}$ 的独立同分布 (i.i.d.) 指数分布。\n-   FD 触发条件：连续 $k$ 个心跳各自的延迟都超过了超时时间 $T$。\n-   冷却间隔：$C$，在任何领导者变更后强制执行。在此期间，新的怀疑被忽略，且不会发起新的选举。\n-   过载时段持续时间：$L = 20 \\mathrm{s}$。\n-   过载时段与单个心跳延迟无关。\n-   设计目标1：每个过载时段最多进行一次选举。\n-   设计目标2：在过载时段内，由过载引发的选举概率至多为 $\\alpha = 0.05$。\n-   给定常数：$H = 0.1 \\mathrm{s}$，指数延迟参数 $\\lambda = 1 / 0.15 \\mathrm{s}^{-1}$。\n\n**第二步：使用提取的已知条件进行验证**\n-   **科学性：** 该问题牢固地基于分布式计算和操作系统中已确立的概念，如领导者选举、故障检测、互斥和使用指数分布进行性能建模。这些都是该领域的标准课题。\n-   **问题定义良好：** 该问题提供了评估给定配置 ($T$, $k$, $C$) 所需的所有必要参数（$H$、$L$、$\\alpha$ 以及 $D$ 的分布）。两个目标都以定量方式陈述，允许进行清晰的数学公式化和验证。\n-   **客观性：** 问题陈述使用精确、技术性的语言编写，没有歧义或主观性。\n\n**第三步：结论与行动**\n该问题具有科学性，定义良好且客观。问题是**有效的**。我将继续推导解决方案。\n\n### 求解过程\n\n该问题要求找到满足两个特定设计目标的配置 ($T$, $k$, $C$)。我们将把每个目标形式化为一个数学约束，然后根据这些约束测试每个选项。\n\n**目标1：每个过载时段最多进行一次选举。**\n一个过载时段持续时间为 $L = 20 \\mathrm{s}$。如果在此期间触发了误报的选举（例如，在时间 $t_{trig}$ 处，其中 $0  t_{trig}  L$），在新领导者建立后，一个为期 $C$ 的冷却期开始。在此冷却期间，不能发起新的选举。为了确保在*同一个过载时段内*不会发起*第二次*选举，冷却期必须足够长，以超过该时段中任何剩余的时间。\n\n如果选举在最早的可能时刻被触发（即时段开始后不久，$t_{trig} \\approx 0$），过载状态将持续近乎整个 $L$ 的时长。如果冷却时间太短，稍后可能会触发第二次选举。为了在任何情况下都能稳健地防止在此时段内发生第二次选举，冷却期 $C$ 必须至少与整个过载持续时间 $L$ 一样长。\n\n因此，第一个约束是：\n$$ C \\ge L $$\n给定 $L = 20 \\mathrm{s}$，我们有：\n$$ C \\ge 20 \\mathrm{s} $$\n\n**目标2：由过载引发的选举概率至多为 $\\alpha = 0.05$。**\n如果连续 $k$ 个心跳的延迟都超过了超时时间 $T$，则会触发选举。如果心跳的随机延迟 $D$ 超过了超时时间 $T$，则认为该心跳延迟。延迟 $D$ 服从均值为 $1/\\lambda = 0.15 \\mathrm{s}$ 的指数分布，所以 $\\lambda = 1/0.15 \\mathrm{s}^{-1}$。\n\n单个心跳延迟的概率 $p$ 为：\n$$ p = P(D > T) $$\n对于指数分布，其生存函数为 $P(D > t) = e^{-\\lambda t}$。因此：\n$$ p = e^{-\\lambda T} = e^{-T/0.15} $$\n\n在一个长度为 $L = 20 \\mathrm{s}$ 的过载时段内，心跳每 $H = 0.1 \\mathrm{s}$ 发送一次。一个时段内发送的心跳总数为：\n$$ N = \\left\\lfloor \\frac{L}{H} \\right\\rfloor = \\left\\lfloor \\frac{20}{0.1} \\right\\rfloor = 200 $$\n\n我们需要找到在一个包含 $N=200$ 次试验的序列中，至少出现一次连续 $k$ 次心跳延迟的概率。设 $E$ 为触发选举的事件。一次 $k$ 次连续延迟的运行有 $N - k + 1$ 个可能的起始位置。设 $A_i$ 为运行从位置 $i$ 开始的事件（即心跳 $i, i+1, \\dots, i+k-1$ 全部延迟）。由于延迟是独立同分布的，任何这样一个特定运行的概率是 $p^k$。\n\n事件 $E$ 的概率是 $P(E) = P(\\cup_{i=1}^{N-k+1} A_i)$。使用并集上限（布尔不等式），我们可以为此概率设定一个上限，当 $p^k$ 很小时，这是一个非常好的近似：\n$$ P(E) \\le \\sum_{i=1}^{N-k+1} P(A_i) = (N-k+1)p^k $$\n\n设计目标要求 $P(E) \\le \\alpha = 0.05$。我们将检查上限是否满足此条件：\n$$ (N-k+1)p^k \\le \\alpha $$\n代入已知值 $N=200$ 和 $\\alpha=0.05$：\n$$ (200 - k + 1)(e^{-T/0.15})^k \\le 0.05 $$\n$$ (201 - k)(e^{-T/0.15})^k \\le 0.05 $$\n\n现在我们根据这两个约束评估每个选项。\n\n**A. $T = 0.20 \\mathrm{s}$， $k = 3$， $C = 10 \\mathrm{s}$**\n-   **目标1：** $C = 10 \\mathrm{s}$。约束条件是 $C \\ge 20 \\mathrm{s}$。由于 $10  20$，此选项不满足目标1。\n-   **结论：** **不正确**。\n\n**B. $T = 0.25 \\mathrm{s}$， $k = 5$， $C = 25 \\mathrm{s}$**\n-   **目标1：** $C = 25 \\mathrm{s}$。约束条件是 $C \\ge 20 \\mathrm{s}$。由于 $25 \\ge 20$，此目标达成。\n-   **目标2：** 我们用 $T=0.25$ 和 $k=5$ 来检验不等式。单个心跳延迟的概率 $p = e^{-0.25/0.15} = e^{-5/3} \\approx 0.188876$。触发选举的概率上限近似为 $(201-5) p^5 = 196 \\times (0.188876)^5 \\approx 196 \\times (2.428 \\times 10^{-5}) \\approx 0.00476$。由于 $0.00476 \\le 0.05$，此目标达成。\n-   **结论：** **正确**。\n\n**C. $T = 0.30 \\mathrm{s}$， $k = 4$， $C = 20 \\mathrm{s}$**\n-   **目标1：** $C = 20 \\mathrm{s}$。约束条件是 $C \\ge 20 \\mathrm{s}$。由于 $20 \\ge 20$，此目标达成。\n-   **目标2：** 我们用 $T=0.30$ 和 $k=4$ 来检验不等式。\n    $$ (201 - 4) \\left(e^{-0.30/0.15}\\right)^4 = 197 \\left(e^{-2}\\right)^4 = 197 e^{-8} $$\n    使用 $e^{-8} \\approx 3.3546 \\times 10^{-4}$：\n    $$ 197 \\times (3.3546 \\times 10^{-4}) \\approx 0.066086 $$\n    条件是 $0.066086 \\le 0.05$。这是不成立的。此选项不满足目标2。\n-   **结论：** **不正确**。\n\n**D. $T = 0.30 \\mathrm{s}$， $k = 5$， $C = 15 \\mathrm{s}$**\n-   **目标1：** $C = 15 \\mathrm{s}$。约束条件是 $C \\ge 20 \\mathrm{s}$。由于 $15  20$，此选项不满足目标1。\n-   **结论：** **不正确**。\n\n**E. $T = 0.35 \\mathrm{s}$， $k = 4$， $C = 25 \\mathrm{s}$**\n-   **目标1：** $C = 25 \\mathrm{s}$。约束条件是 $C \\ge 20 \\mathrm{s}$。由于 $25 \\ge 20$，此目标达成。\n-   **目标2：** 我们用 $T=0.35$ 和 $k=4$ 来检验不等式。\n    $$ (201 - 4) \\left(e^{-0.35/0.15}\\right)^4 = 197 \\left(e^{-7/3}\\right)^4 = 197 e^{-28/3} $$\n    指数为 $-28/3 \\approx -9.333$。\n    使用 $e^{-28/3} \\approx 8.847 \\times 10^{-5}$：\n    $$ 197 \\times (8.847 \\times 10^{-5}) \\approx 0.017428 $$\n    条件是 $0.017428 \\le 0.05$。此目标达成。\n-   **结论：** **正确**。\n\n根据分析，配置 B 和 E 满足两个设计目标。", "answer": "$$\\boxed{BE}$$", "id": "3638456"}]}