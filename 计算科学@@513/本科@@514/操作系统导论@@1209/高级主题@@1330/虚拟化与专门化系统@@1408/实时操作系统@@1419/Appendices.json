{"hands_on_practices": [{"introduction": "为保证时序约束，一些最关键的安全实时系统依赖于时间触发执行器，其中所有任务的执行都在一个静态调度表中预先规划好。本练习将引导你确定这种调度的基本周期长度，即超周期（hyperperiod）。理解这个概念是设计可预测和确定性系统的第一步 [@problem_id:3675995]。", "problem": "在一个实时操作系统 (RTOS) 中，考虑一个单核处理器正在一个时间触发执行器 (TTE) 的调度下执行一组独立的、严格周期的任务。每个任务 $\\tau_i$ 都有一个周期 $T_i$、一个最坏情况执行时间 $C_i$、零发布偏移、零发布抖动，以及一个等于其周期的相对截止期。系统滴答分辨率为 $1$ 毫秒，并且每个作业都在滴答的整数倍时间点上启动。任务集如下：\n- 任务 $\\tau_A$：$T_A = 12$ 毫秒, $C_A = 3$ 毫秒。\n- 任务 $\\tau_B$：$T_B = 20$ 毫秒, $C_B = 5$ 毫秒。\n- 任务 $\\tau_C$：$T_C = 30$ 毫秒, $C_C = 7$ 毫秒。\n- 任务 $\\tau_D$：$T_D = 50$ 毫秒, $C_D = 10$ 毫秒。\n\n在 TTE 的调度下，会离线构建一个静态调度表，该表为所有作业分配固定的启动时间，并在一个最小周期后完全相同地重复。仅从周期性任务和时间触发调度的定义出发，确定该任务集的一个无冲突的静态表的重复周期的最小持续时间。以毫秒为单位表示你的最终答案。提供精确的整数值，无需四舍五入。", "solution": "用户希望我扮演一位严谨的STEM教授。我将首先验证这个问题。\n\n### 第1步：提取已知条件\n- **系统：** 单核处理器。\n- **调度器：** 带有静态调度表的时间触发执行器 (TTE)。\n- **任务模型：** 一组独立的、严格周期的任务。\n- **任务属性：** 对于每个任务 $\\tau_i$，周期为 $T_i$，最坏情况执行时间为 $C_i$，发布偏移为 $0$，发布抖动为 $0$，相对截止期等于其周期 ($D_i = T_i$)。\n- **系统滴答：** 分辨率为 $1$ 毫秒。作业启动时间是滴答的整数倍。\n- **任务集数据：**\n    - 任务 $\\tau_A$：$T_A = 12$ 毫秒, $C_A = 3$ 毫秒。\n    - 任务 $\\tau_B$：$T_B = 20$ 毫秒, $C_B = 5$ 毫秒。\n    - 任务 $\\tau_C$：$T_C = 30$ 毫秒, $C_C = 7$ 毫秒。\n    - 任务 $\\tau_D$：$T_D = 50$ 毫秒, $C_D = 10$ 毫秒。\n- **目标：** 确定一个无冲突静态表的重复周期的最小持续时间。\n\n### 第2步：使用提取的已知条件进行验证\n1.  **科学依据：** 该问题基于实时系统理论中的基本且成熟的概念，特别是周期性任务的调度和时间触发系统的特性。所有使用的术语（例如，周期性任务、执行时间、超周期）在计算机工程和操作系统领域都是标准术语。该问题在科学上是合理的。\n2.  **适定性：** 该问题要求一个唯一定义的量：一组同步周期任务的静态调度的最小重复周期长度。这个量被称为超周期，它由任务的周期唯一确定。问题提供了计算该值所需的所有信息（即周期）。“无冲突”调度的存在性是一个独立的可调度性问题，但周期长度本身与可调度性无关，仅取决于周期。总处理器利用率为 $U = \\frac{3}{12} + \\frac{5}{20} + \\frac{7}{30} + \\frac{10}{50} = 0.25 + 0.25 + \\frac{7}{30} + 0.2 = 0.7 + \\frac{7}{30} = \\frac{21}{30} + \\frac{7}{30} = \\frac{28}{30} \\approx 0.933$。由于 $U \\le 1$，该任务集不会因过载而不可调度，这也增加了问题的连贯性。该问题是适定的。\n3.  **客观性：** 该问题使用精确、无歧义的技术语言陈述。数据是数值型的，目标是一个具体的计算。它不含主观论斷。\n\n### 第3步：结论与行动\n该问题是**有效的**。它有科学依据、适定、客观且完整。我将继续进行解答。\n\n问题要求在时间触发执行器 (TTE) 下，一个静态调度的重复周期的最小持续时间。该任务集由独立的、严格周期的任务组成，所有任务的发布偏移都为零。这意味着每个任务的第一个作业在时间 $t=0$ 同步发布。\n\n在这样的系统中，所有作业到达的模式在一个称为超周期（用 $H$ 表示）的时间间隔内重复。超周期是作业发布时间的精确模式再次出现所需的最小时间间隔。为了确保静态调度表能够在系统的整个生命周期内确定性地管理所有可能的作业调度情景，其长度必须包含一个完整的超周期。因此，静态调度的重复周期的最小持续时间等于该任务集的超周期。\n\n超周期 $H$ 在数学上定义为集合中所有任务周期的最小公倍数 (LCM)。给定任务集 $\\{\\tau_A, \\tau_B, \\tau_C, \\tau_D\\}$ 及其对应的周期 $\\{T_A, T_B, T_C, T_D\\}$，超周期计算如下：\n$$H = \\text{lcm}(T_A, T_B, T_C, T_D)$$\n给定的周期是 $T_A = 12$，$T_B = 20$，$T_C = 30$ 和 $T_D = 50$ 毫秒。我们必须计算：\n$$H = \\text{lcm}(12, 20, 30, 50)$$\n为了计算最小公倍数，我们可以使用质因数分解法。我们首先找出每个周期的质因数分解：\n\\begin{itemize}\n    \\item $12 = 2 \\times 6 = 2 \\times 2 \\times 3 = 2^2 \\times 3^1$\n    \\item $20 = 2 \\times 10 = 2 \\times 2 \\times 5 = 2^2 \\times 5^1$\n    \\item $30 = 3 \\times 10 = 2^1 \\times 3^1 \\times 5^1$\n    \\item $50 = 5 \\times 10 = 2^1 \\times 5 \\times 5 = 2^1 \\times 5^2$\n\\end{itemize}\n最小公倍数是分解式中出现的每个质因数的最高次幂的乘积。质因数是 $2$，$3$ 和 $5$。\n\\begin{itemize}\n    \\item 质因数 $2$ 的最高次幂是 $2^2$。\n    \\item 质因数 $3$ 的最高次幂是 $3^1$。\n    \\item 质因数 $5$ 的最高次幂是 $5^2$。\n\\end{itemize}\n我们将这些最高次幂相乘得到超周期 $H$：\n$$H = 2^2 \\times 3^1 \\times 5^2$$\n$$H = 4 \\times 3 \\times 25$$\n$$H = 12 \\times 25$$\n$$H = 300$$\n因此，重复周期的最小持续时间是 $300$ 毫秒。最坏情况执行时间 ($C_i$) 对于执行可调度性分析和构建实际的调度表是必需的，但它们不影响基本重复周期的持续时间，该持续时间仅由周期决定。", "answer": "$$\n\\boxed{300}\n$$", "id": "3675995"}, {"introduction": "虽然时间触发系统提供了高度的可预测性，但使用基于优先级的调度（如速率单调调度，RM）的事件触发系统则提供了更大的灵活性。然而，这种灵活性也带来了挑战：我们如何保证一个任务在受到更高优先级任务抢占的情况下仍能满足其截止时间？本练习将指导你进行响应时间分析（Response Time Analysis, RTA），这是一种计算任务最坏情况完成时间并验证其可调度性的基础技术 [@problem_id:3675984]。", "problem": "考虑一个实时操作系统 (RTOS)，它使用速率单调 (RM) 固定优先级策略在单处理器上调度一组周期性任务。每个任务 $\\tau_i$ 由其周期 $T_i$、最坏情况执行时间 (WCET) $C_i$、相对截止时间 $D_i$ 以及一个阻塞项 $B_i$ 来表征，该阻塞项 $B_i$ 用于说明因互斥共享资源引起的最坏情况优先级反转。假设采用抢占式调度，截止时间等于周期 ($D_i = T_i$)，并且所有任务在时间 $t = 0$ 同步释放，这定义了固定优先级响应时间的最坏情况。\n\n仅使用以下基本事实：\n- 在 RM 策略下，周期较短的任务具有较高的静态优先级。\n- 任务 $\\tau_i$ 的最坏情况响应时间 $R_i$ 是指在最坏情况的抢占和阻塞下，从任务释放到其实例完成的最长时间。\n- 在任何长度为 $R$ 的时间间隔内，来自更高优先级任务的干扰等于所有可以在该时间间隔内到达并执行的更高优先级任务的作业对处理器的需求，而一个周期性任务在长度为 $R$ 的时间间隔内可以到达的作业数量由周期性到达的属性决定。\n\n根据这些原则，推导一种方法，该方法使用任务 $\\tau_i$ 的阻塞时间 $B_i$、其自身的执行时间 $C_i$ 以及一个考虑了所有更高优先级任务的干扰函数 $I_i(R)$ 来界定其最坏情况响应时间 $R_i$。然后，将您推导的方法应用于以下在 RM 策略下调度的任务集，以计算 $\\tau_3$ 的响应时间界限。使用给定的参数，并将处理器解释为在有待处理工作时是工作保守且非空闲的。\n\n任务参数：\n- $\\tau_1$：$T_1 = 10\\,\\mathrm{ms}$，$C_1 = 1\\,\\mathrm{ms}$，$B_1 = 0\\,\\mathrm{ms}$。\n- $\\tau_2$：$T_2 = 15\\,\\mathrm{ms}$，$C_2 = 2\\,\\mathrm{ms}$，$B_2 = 0\\,\\mathrm{ms}$。\n- $\\tau_3$：$T_3 = 40\\,\\mathrm{ms}$，$C_3 = 8\\,\\mathrm{ms}$，$B_3 = 1\\,\\mathrm{ms}$。\n\n以毫秒为单位表示 $\\tau_3$ 的最终响应时间界限。如果您的结果不是整数，则四舍五入到四位有效数字；否则，报告确切的整数值。", "solution": "该问题是有效的，因为它在科学上基于实时系统理论，问题设定良好，数据充分且一致，并且陈述客观。因此，我们可以进行求解。\n\n该问题要求推导一种界定周期性任务最坏情况响应时间的方法，并将其应用于一个具体的任务集。\n\n**第一部分：响应时间分析方法的推导**\n\n设 $\\tau_i$ 是一个周期性任务，其最坏情况执行时间 (WCET) 为 $C_i$，周期为 $T_i$，以及由较低优先级任务引起的最坏情况阻塞时间为 $B_i$。已知任务在单处理器上使用抢占式、固定优先级的速率单调 (RM) 策略进行调度。在 RM 策略下，任务的静态优先级与其周期成反比；因此，较短的周期 $T_i$ 意味着较高的优先级。响应时间的最坏情况发生在所有任务于时间 $t=0$ 同步释放时。\n\n任务 $\\tau_i$ 的最坏情况响应时间 $R_i$ 是从其释放到完成执行所经过的时间。在此期间，处理器忙于执行 $\\tau_i$ 本身、抢占它的更高优先级任务，或阻塞它的较低优先级任务。由于处理器是工作保守的，总时间 $R_i$ 必须等于这些贡献的总和。\n\n响应时间的组成部分是：\n1.  任务自身的执行时间 $C_i$。\n2.  任务可能被较低优先级任务阻塞的最长时间 $B_i$。这种阻塞通常在任务执行开始时发生一次。\n3.  来自所有更高优先级任务的总干扰，记为 $I_i$。\n\n因此，我们可以说响应时间 $R_i$ 是这三项之和：\n$$ R_i = C_i + B_i + I_i $$\n\n提供的第三个基本事实指导了干扰项 $I_i$ 的构建。在长度为 $t$ 的时间间隔内对 $\\tau_i$ 的干扰是该时间间隔内释放的所有更高优先级任务的总执行需求。设 $hp(i)$ 为所有比 $\\tau_i$ 优先级更高的任务的集合。\n\n对于任何周期为 $T_j$、WCET 为 $C_j$ 的更高优先级任务 $\\tau_j \\in hp(i)$，我们需要找出在长度为 $R_i$ 的时间间隔内它可能被释放的最大次数。假定在 $t=0$ 同步释放，$\\tau_j$ 的作业在时间 $0, T_j, 2T_j, \\ldots, k_j T_j$ 释放，其中 $k_j T_j  R_i$。在区间 $[0, R_i)$ 内的此类释放次数为 $\\lfloor R_i/T_j \\rfloor + 1$（如果 $R_i$ 不是 $T_j$ 的倍数），如果 $R_i$ 是 $T_j$ 的倍数，则在 $[0, R_i-T_j]$ 内释放的作业数量为 $R_i/T_j$。一个更简洁的表示在长度为 $R_i$ 的繁忙期内可以释放且必须完成的 $\\tau_j$ 作业数量的方法是由向上取整函数给出：$\\lceil \\frac{R_i}{T_j} \\rceil$。\n\n这些作业中的每一个都会贡献 $C_j$ 的处理器需求。因此，在时间间隔 $R_i$ 内，来自任务 $\\tau_j$ 的总干扰为 $\\left\\lceil \\frac{R_i}{T_j} \\right\\rceil C_j$。总干扰 $I_i$ 是来自 $hp(i)$ 中所有任务的干扰之和：\n$$ I_i(R_i) = \\sum_{j \\in hp(i)} \\left\\lceil \\frac{R_i}{T_j} \\right\\rceil C_j $$\n\n将这个干扰表达式代回响应时间方程，我们得到以下关于 $R_i$ 的关系式：\n$$ R_i = C_i + B_i + \\sum_{j \\in hp(i)} \\left\\lceil \\frac{R_i}{T_j} \\right\\rceil C_j $$\n这个方程以 $R_i$ 本身来定义 $R_i$。它没有一个通用的封闭形式解。界定 $R_i$ 的“方法”是一个迭代过程，用以找到满足该方程的最小 $R_i$ 值。这通过构建一个递归关系来实现：\n$$ R_i^{(k+1)} = C_i + B_i + \\sum_{j \\in hp(i)} \\left\\lceil \\frac{R_i^{(k)}}{T_j} \\right\\rceil C_j $$\n迭代从对响应时间的初始猜测开始。一个合适的起始点是没有干扰时所需的时间，即 $R_i^{(0)} = C_i + B_i$。值序列 $R_i^{(k)}$ 保证是单调不减的。迭代持续进行，直到达到一个不动点，即 $R_i^{(k+1)} = R_i^{(k)}$。这个不动点值就是最坏情况响应时间 $R_i$。如果在任何时候 $R_i^{(k)}$ 超过了任务的截止时间 $D_i$，则该任务被认为是不可调度的。\n\n**第二部分：应用于给定任务集**\n\n任务参数为：\n- $\\tau_1$：$T_1 = 10\\,\\mathrm{ms}$，$C_1 = 1\\,\\mathrm{ms}$，$B_1 = 0\\,\\mathrm{ms}$。\n- $\\tau_2$：$T_2 = 15\\,\\mathrm{ms}$，$C_2 = 2\\,\\mathrm{ms}$，$B_2 = 0\\,\\mathrm{ms}$。\n- $\\tau_3$：$T_3 = 40\\,\\mathrm{ms}$，$C_3 = 8\\,\\mathrm{ms}$，$B_3 = 1\\,\\mathrm{ms}$。\n\n根据速率单调 (RM) 调度策略，优先级基于任务周期分配。周期越短，优先级越高。\n由于 $T_1  T_2  T_3$ ($10  15  40$)，优先级顺序为：优先级($\\tau_1$)  优先级($\\tau_2$)  优先级($\\tau_3$)。\n\n我们需要计算 $\\tau_3$ 的响应时间界限，记为 $R_3$。比 $\\tau_3$ 优先级更高的任务集合是 $hp(3) = \\{\\tau_1, \\tau_2\\}$。\n\n使用推导出的 $R_3$ 公式：\n$$ R_3 = C_3 + B_3 + \\left\\lceil \\frac{R_3}{T_1} \\right\\rceil C_1 + \\left\\lceil \\frac{R_3}{T_2} \\right\\rceil C_2 $$\n代入给定的数值：\n$$ R_3 = 8 + 1 + \\left\\lceil \\frac{R_3}{10} \\right\\rceil (1) + \\left\\lceil \\frac{R_3}{15} \\right\\rceil (2) $$\n$$ R_3 = 9 + \\left\\lceil \\frac{R_3}{10} \\right\\rceil + 2 \\left\\lceil \\frac{R_3}{15} \\right\\rceil $$\n我们迭代求解这个方程。令 $w_3^{(k)}$ 表示 $\\tau_3$ 响应时间的第 $k$ 次迭代值。\n初始猜测值为 $w_3^{(0)} = C_3 + B_3 = 8 + 1 = 9$。\n\n第 1 次迭代：\n$$ w_3^{(1)} = 9 + \\left\\lceil \\frac{w_3^{(0)}}{10} \\right\\rceil + 2 \\left\\lceil \\frac{w_3^{(0)}}{15} \\right\\rceil = 9 + \\left\\lceil \\frac{9}{10} \\right\\rceil + 2 \\left\\lceil \\frac{9}{15} \\right\\rceil $$\n$$ w_3^{(1)} = 9 + \\lceil 0.9 \\rceil + 2 \\lceil 0.6 \\rceil = 9 + 1 + 2(1) = 12 $$\n\n第 2 次迭代：\n$$ w_3^{(2)} = 9 + \\left\\lceil \\frac{w_3^{(1)}}{10} \\right\\rceil + 2 \\left\\lceil \\frac{w_3^{(1)}}{15} \\right\\rceil = 9 + \\left\\lceil \\frac{12}{10} \\right\\rceil + 2 \\left\\lceil \\frac{12}{15} \\right\\rceil $$\n$$ w_3^{(2)} = 9 + \\lceil 1.2 \\rceil + 2 \\lceil 0.8 \\rceil = 9 + 2 + 2(1) = 13 $$\n\n第 3 次迭代：\n$$ w_3^{(3)} = 9 + \\left\\lceil \\frac{w_3^{(2)}}{10} \\right\\rceil + 2 \\left\\lceil \\frac{w_3^{(2)}}{15} \\right\\rceil = 9 + \\left\\lceil \\frac{13}{10} \\right\\rceil + 2 \\left\\lceil \\frac{13}{15} \\right\\rceil $$\n$$ w_3^{(3)} = 9 + \\lceil 1.3 \\rceil + 2 \\lceil 0.866... \\rceil = 9 + 2 + 2(1) = 13 $$\n\n由于 $w_3^{(3)} = w_3^{(2)} = 13$，迭代已经收敛。不动点是 $13$。\n任务 $\\tau_3$ 的最坏情况响应时间界限为 $R_3 = 13\\,\\mathrm{ms}$。该值也小于其截止时间 $D_3 = T_3 = 40\\,\\mathrm{ms}$，因此该任务是可调度的，尽管题目并未要求判断这一点。\n\n最终结果是一个整数，所以无需四舍五入。", "answer": "$$ \\boxed{13} $$", "id": "3675984"}, {"introduction": "在实际系统中，任务通常需要共享资源（如数据缓冲区或外围设备），这需要使用互斥锁（mutex）等机制来确保数据完整性。然而，这会引入一种称为“优先级反转”的危险现象，即一个高优先级任务可能被一个低优先级任务无限期地延迟。最后的这个练习将探讨这个问题及其解决方案——优先级天花板协议（Priority Ceiling Protocol, PCP），并要求你计算一个任务可能经历的最坏情况阻塞时间 [@problem_id:3676081]。", "problem": "考虑一个用于实时操作系统 (RTOS) 的抢占式固定优先级单处理器调度器，其优先级通过速率单调排序分配。三个周期性任务 $A$、$B$ 和 $C$ 在处理器上运行，其周期、最坏情况执行时间 (WCET) 和临界区使用情况如下：\n\n- 任务 $A$：周期 $T_{A} = 10\\,\\mathrm{ms}$，最坏情况执行时间 $C_{A} = 1\\,\\mathrm{ms}$。在其执行过程中，$A$ 会锁定一个由互斥锁保护的共享资源 $R_{1}$，时间最长为 $0.80\\,\\mathrm{ms}$。\n- 任务 $C$：周期 $T_{C} = 20\\,\\mathrm{ms}$，最坏情况执行时间 $C_{C} = 2\\,\\mathrm{ms}$。在其执行过程中，$C$ 会锁定另一个共享资源 $R_{2}$，时间最长为 $0.60\\,\\mathrm{ms}$。\n- 任务 $B$：周期 $T_{B} = 40\\,\\mathrm{ms}$，最坏情况执行时间 $C_{B} = 5\\,\\mathrm{ms}$。在其执行过程中，$B$ 会锁定 $R_{1}$，时间最长为 $1.20\\,\\mathrm{ms}$，并在一个独立的非重叠代码段中，锁定 $R_{2}$，时间最长为 $2.50\\,\\mathrm{ms}$。\n\n假设每个任务的相对截止时间等于其周期，并且互斥锁提供互斥访问，无忙等待（即，被阻塞的任务会被挂起）。\n\n1. 解释在该设置下，如果没有资源访问协议，$A$、$B$ 和 $C$ 之间如何发生优先级反转。你的解释必须基于抢占式固定优先级调度、因互斥导致的阻塞以及优先级反转概念的基本定义。\n2. 使用优先级天花板协议 (Priority Ceiling Protocol, PCP) 提出一个系统性修复方案，并从概念层面解释它如何在这种情况下防止无界优先级反转。你的解释必须从资源天花板的核心定义以及允许任务锁定资源的规则开始。\n3. 在优先级天花板协议 (PCP) 下，确定任务 $A$ 因低优先级任务而经历的最坏情况阻塞时间 $B_{A}$。你的推导需基于资源天花板和阻塞语义的第一性原理，而不是引用一个现成的界限。以毫秒为单位报告 $B_{A}$ 的最终值。将你的答案四舍五入到三位有效数字。", "solution": "该问题定义良好，科学上基于实时系统理论的原理，并包含足够的信息以得到唯一解。我们开始进行分析。\n\n调度策略是抢占式固定优先级，优先级通过速率单调排序分配。这意味着任务的优先级与其周期成反比。给定周期 $T_{A} = 10\\,\\mathrm{ms}$、$T_{C} = 20\\,\\mathrm{ms}$ 和 $T_{B} = 40\\,\\mathrm{ms}$，优先级顺序为 $P_{A}  P_{C}  P_{B}$，其中 $P_{i}$ 是任务 $i$ 的优先级。任务 $A$ 的优先级最高，$C$ 的优先级居中，$B$ 的优先级最低。\n\n1. 优先级反转的解释\n\n优先级反转是指高优先级任务被迫等待低优先级任务执行的场景。在抢占式调度器中，理想情况下，高优先级任务只应被其自身的计算或更高优先级的任务延迟。因低优先级任务持有的共享资源而导致的阻塞是优先级反转的一种形式。当这种阻塞持续时间无界或被中等优先级任务的执行所延长时，问题就变得严重。\n\n在没有资源访问协议的情况下，一个说明任务 $A$、$B$ 和 $C$ 之间“无界”优先级反转的具体场景如下：\n\n- **时间 $t_{0}$**: 任务 $B$ (低优先级) 开始执行。\n- **时间 $t_{1}$**: 任务 $B$ 锁定资源 $R_{1}$ 的互斥锁。\n- **时间 $t_{2}$**: 任务 $A$ (高优先级) 变为就绪态。由于 $P_{A}  P_{B}$，它抢占任务 $B$。\n- **时间 $t_{3}$**: 任务 $A$ 执行并尝试锁定资源 $R_{1}$ 的互斥锁。由于 $R_{1}$ 被任务 $B$ 持有，任务 $A$ 被阻塞并挂起。调度器将CPU交还给当前优先级最高的就绪任务，即任务 $B$。任务 $B$ 必须执行以释放对 $R_{1}$ 的锁定。\n- **时间 $t_{4}$**: 任务 $C$ (中等优先级) 变为就绪态。由于 $P_{C}  P_{B}$，任务 $C$ 抢占任务 $B$。\n- **从 $t_{4}$ 开始**: 任务 $C$ 执行。高优先级的任务 $A$ 仍然被阻塞，等待低优先级的任务 $B$。然而，任务 $B$ 无法执行以释放资源，因为它被中等优先级的任务 $C$ 抢占。任务 $A$ 的等待时间现在取决于任务 $C$ 的执行时间。如果其他中等优先级的任务到达，它们也会抢占 $B$，可能无限期地延长 $A$ 的阻塞时间。这就构成了无界优先级反转。\n\n2. 作为解决方案的优先级天花板协议 (PCP)\n\n解决此问题的系统性方案是优先级天花板协议 (PCP)。它通过在标准互斥锁机制的基础上增加基于资源天花板的特定规则，来防止无界优先级反转和死锁。\n\nPCP 的核心定义是：\n- **资源的优先级天花板**: 资源 $R_{k}$ 的优先级天花板，记为 $\\mathrm{Ceiling}(R_{k})$，是可以锁定 $R_{k}$ 的任务中的最高优先级。\n- **系统天花板**: 在任何时刻 $t$，系统天花板 $\\hat{\\Pi}(t)$ 是当前所有被锁定资源的优先级天花板中的最大值。如果没有资源被锁定，系统天花板是一个特殊值 $\\Omega$，其低于任何任务的优先级。\n\n对于给定的问题，资源天花板如下：\n- 资源 $R_{1}$ 被任务 $A$ 和 $B$ 使用。它们的优先级为 $P_{A}$ 和 $P_{B}$。较高的优先级是 $P_{A}$。因此，$\\mathrm{Ceiling}(R_{1}) = P_{A}$。\n- 资源 $R_{2}$ 被任务 $C$ 和 $B$ 使用。它们的优先级为 $P_{C}$ 和 $P_{B}$。较高的优先级是 $P_{C}$。因此，$\\mathrm{Ceiling}(R_{2}) = P_{C}$。\n\nPCP 采用两个关键规则：\n- **锁定规则**: 优先级为 $P_{i}$ 的任务 $T_{i}$ 只有当其优先级 $P_{i}$ 严格高于当前系统天花板 $\\hat{\\Pi}(t)$ 时才能锁定资源。否则，$T_{i}$ 被阻塞（这称为天花板阻塞）。\n- **继承规则**: 当任务 $T_{i}$ 被一个低优先级任务 $T_{j}$ 阻塞时（无论是在资源上直接阻塞还是通过天花板阻塞），$T_{j}$ 会临时继承 $T_{i}$ 的优先级，并以这个较高的优先级执行，直到它释放了所有导致 $T_{i}$（或其他更高优先级任务）阻塞的资源。\n\nPCP 按如下方式防止了前面描述的优先级反转场景：\n1. 任务 $B$ 锁定 $R_{1}$。系统天花板 $\\hat{\\Pi}(t)$ 变为 $\\mathrm{Ceiling}(R_{1}) = P_{A}$。\n2. 任务 $A$ 抢占 $B$，运行，并尝试锁定 $R_{1}$。它被阻塞。\n3. 根据继承规则，任务 $B$ 现在继承任务 $A$ 的优先级，因此它以优先级 $P_{A}$ 执行。\n4. 任务 $C$ 变为就绪态。它尝试抢占当前运行的任务，即 $B$。然而，此时 $B$ 正以优先级 $P_{A}$ 运行，并且由于 $P_{C}  P_{A}$，任务 $C$ 不能抢占任务 $B$。\n5. 任务 $B$ 继续以高优先级执行，直到它释放 $R_{1}$。一旦 $R_{1}$ 被释放，$B$ 的优先级恢复为 $P_{B}$。任务 $A$ 被解除阻塞，并且作为优先级最高的就绪任务，立即抢占 $B$ 并运行。$A$ 的阻塞时间被限制在 $B$ 完成其临界区所需的时间内，并且不受任务 $C$ 的影响。\n\n3. PCP 下任务 A 的最坏情况阻塞时间\n\n在 PCP 下，任务 $T_{i}$ 的最坏情况阻塞时间 $B_{i}$ 是最多一个低优先级任务的一个临界区的持续时间。从第一性原理出发，任务 $T_{i}$ 可能被阻塞，一种是直接请求一个被低优先级任务 $T_{j}$ 持有的资源，另一种是间接的（天花板阻塞），即由于 $T_{j}$ 持有一个资源 $R_{k}$，而该资源的天花板至少与 $P_i$ 一样高，从而导致 $T_{i}$ 无法执行。低优先级任务 $T_{j}$ 能够阻塞 $T_{i}$ 的条件是，$T_{j}$ 使用了一个资源 $R_{k}$，满足 $\\mathrm{Ceiling}(R_{k}) \\ge P_{i}$。\n\n我们关心的是任务 $A$ 的最坏情况阻塞时间 $B_{A}$。任务 $A$ 的优先级是 $P_{A}$。低优先级的任务是 $C$ 和 $B$。\n\n- **来自任务 $C$ 的潜在阻塞（优先级 $P_C  P_A$）：**\n任务 $C$ 使用资源 $R_{2}$。该资源的天花板是 $\\mathrm{Ceiling}(R_{2}) = P_{C}$。我们检查 $\\mathrm{Ceiling}(R_{2}) \\ge P_{A}$ 是否成立。由于 $P_{C}  P_{A}$，该条件为假。因此，任务 $C$ 持有资源 $R_{2}$ 不会引起对任务 $A$ 的天花板阻塞。此外，由于任务 $A$ 从不使用 $R_{2}$，也不可能发生直接阻塞。因此，在 PCP 下，任务 $C$ 不能阻塞任务 $A$。\n\n- **来自任务 $B$ 的潜在阻塞（优先级 $P_B  P_A$）：**\n任务 $B$ 使用资源 $R_{1}$ 和 $R_{2}$。我们逐个分析。\n- 使用 $R_{2}$ 的情况：天花板是 $\\mathrm{Ceiling}(R_{2}) = P_{C}$。如前所述，$P_C  P_A$，所以任务 $B$ 持有 $R_2$ 不会引起对任务 $A$ 的天花板阻塞。由于 $A$ 不使用 $R_2$，也不存在直接阻塞。\n- 使用 $R_{1}$ 的情况：天花板是 $\\mathrm{Ceiling}(R_{1}) = P_{A}$。我们检查 $\\mathrm{Ceiling}(R_{1}) \\ge P_{A}$ 是否成立。该条件为真。因此，如果任务 $B$ 持有 $R_{1}$，它可以阻塞任务 $A$。这种阻塞可能发生在任务 $A$ 变为就绪态时，发现任务 $B$ 已经锁定了 $R_{1}$。此时，任务 $A$ 将被阻塞，直到任务 $B$ 在 $R_{1}$ 上的临界区结束。这种阻塞的最坏持续时间是该临界区的最坏情况执行时间，即给定的 $1.20\\,\\mathrm{ms}$。\n\n综合这些发现，任务 $A$ 唯一的阻塞来源是任务 $B$ 持有资源 $R_{1}$。任务 $A$ 可能的阻塞持续时间集合只包含一个值，即任务 $B$ 在 $R_{1}$ 上的临界区长度。\n\n任务 $A$ 的最坏情况阻塞时间是所有可能阻塞持续时间中的最大值。\n$$ B_{A} = \\max\\{ \\text{length of } CS_{B,R_1} \\} $$\n其中 $ CS_{B,R_1} $ 是任务 $B$ 在资源 $R_1$ 上的临界区。\n$$ B_{A} = 1.20\\,\\mathrm{ms} $$\n该值已经表示为三位有效数字。", "answer": "$$\\boxed{1.20}$$", "id": "3676081"}]}