{"hands_on_practices": [{"introduction": "高效的电源管理不仅要考虑性能，还常常需要在多个相互冲突的目标之间寻求平衡。在存储管理中，操作系统必须决定将数据写入非易失性存储器的频率，这一过程称为日志记录 (journaling)。本实践 [@problem_id:3669960] 探讨了一个根本性的权衡：一方面通过降低日志记录频率来节省能源，另一方面通过增加频率来减少因意外崩溃导致数据丢失的风险。你将建立一个模型，以找到那个最佳的平衡点。", "problem": "一个移动操作系统采用回写式页面缓存，通过对非易失性闪存进行周期性文件系统日志记录来管理能耗。每次日志刷新都以固定的时间间隔 $ \\tau_{j} $（单位为秒）进行调度，并消耗固定的能量 $ E_{f} $（单位为焦耳），该能耗与 $ \\tau_{j} $ 无关。应用程序的写入操作以平均速率 $ r $（单位为字节/秒）产生脏数据。设备会发生意外断电导致的系统崩溃，该事件服从速率为 $ \\lambda_{c} $（单位为秒的倒数）的泊松过程，且与文件系统的日志记录调度和写入过程无关。如果发生崩溃，自上次刷新以来累积的所有脏数据都将丢失，系统设计者在目标函数中指定一个能量等效惩罚 $ c_{L} $（单位为焦耳/字节）来量化数据持久性的损失。假设刷新调度是完全周期性的，并且每次日志刷新的写入能量 $ E_{f} $ 不依赖于脏数据的数量。\n\n仅从泊松过程的定义、确定性周期调度的时间平均以及期望的线性性质出发，推导由崩溃引起的长期期望能量等效损失率（单位为焦耳/秒）作为 $ \\tau_{j} $ 的函数，并将其与刷新能量率相结合，得到总目标函数 $ g(\\tau_{j}) $（单位为焦耳/秒）。然后，确定使 $ g(\\tau_{j}) $ 最小化的 $ \\tau_{j} $。\n\n最后，使用参数 $ E_{f} = 2.5 \\times 10^{-3} $ J，$ r = 1.024 \\times 10^{4} $ 字节 s$^{-1}$，$ \\lambda_{c} = 1.0 \\times 10^{-6} $ s$^{-1}$ 和 $ c_{L} = 5.0 \\times 10^{-7} $ J 字节$^{-1}$，对此最优 $ \\tau_{j} $ 进行数值计算。请以秒为单位表示最终答案，并将其四舍五入到四位有效数字。", "solution": "该问题具有科学依据，提法恰当，并包含获得唯一解所需的所有信息，因此是有效的。我们着手进行推导。\n\n目标是找到使总的长期期望能量等效率 $ g(\\tau_{j}) $ 最小化的日志记录间隔 $ \\tau_{j} $。这个总速率是两个分量的和：周期性日志刷新所消耗的能量率 $ g_{f}(\\tau_{j}) $，以及由崩溃引起的长期期望能量等效损失率 $ g_{L}(\\tau_{j}) $。\n\n$ g(\\tau_{j}) = g_{f}(\\tau_{j}) + g_{L}(\\tau_{j}) $\n\n首先，我们定义刷新的能量率。每次刷新消耗固定的能量 $ E_{f} $，并以固定的间隔 $ \\tau_{j} $ 秒发生。因此，刷新的长期平均能量率为：\n$ g_{f}(\\tau_{j}) = \\frac{E_{f}}{\\tau_{j}} $\n\n接下来，我们推导由崩溃引起的期望能量等效损失率。问题陈述应用程序写入以恒定的平均速率 $ r $ 产生脏数据。在一次成功的日志刷新后的时间 $ t $，累积的脏数据量为 $ D(t) = r \\cdot t $。如果此时发生崩溃，这些数据将丢失。此损失的能量等效惩罚由 $ L(t) = c_{L} \\cdot D(t) = c_{L} r t $ 给出。\n\n崩溃被建模为速率为 $ \\lambda_{c} $ 的泊松过程。泊松过程的一个关键性质是到达（本例中为崩溃）看到的是时间平均值（PASTA 性质）。问题陈述崩溃过程与日志记录调度无关。自上次刷新以来的时间 $ t $ 是一个从 $ 0 $ 到 $ \\tau_{j} $ 周期性地线性增加的值。在很长一段时间内，$ t $ 的分布在区间 $ [0, \\tau_{j}] $ 上是均匀的。根据 PASTA 性质，崩溃在此周期内的任何时刻发生的可能性是均等的。因此，从上次刷新开始测量的崩溃发生时间 $ t_{crash} $ 是一个在 $ [0, \\tau_{j}] $ 上均匀分布的随机变量。\n\n$ t_{crash} $ 的概率密度函数（PDF）为 $ f(t) = \\frac{1}{\\tau_{j}} $，对于 $ t \\in [0, \\tau_{j}] $，其他情况下为 $ 0 $。\n\n区间内崩溃的期望时间是这个均匀分布的均值：\n$ E[t_{crash}] = \\int_{0}^{\\tau_{j}} t \\cdot f(t) \\,dt = \\int_{0}^{\\tau_{j}} t \\cdot \\frac{1}{\\tau_{j}} \\,dt = \\frac{1}{\\tau_{j}} \\left[ \\frac{t^2}{2} \\right]_{0}^{\\tau_{j}} = \\frac{1}{\\tau_{j}} \\frac{\\tau_{j}^2}{2} = \\frac{\\tau_{j}}{2} $\n\n*每次崩溃*的期望能量等效损失是通过在期望时间 $ E[t_{crash}] $ 处评估损失函数 $ L(t) $ 得到的：\n$ E[\\text{Loss per crash}] = c_{L} r E[t_{crash}] = c_{L} r \\frac{\\tau_{j}}{2} $\n\n长期期望损失率 $ g_{L}(\\tau_{j}) $ 是崩溃率 $ \\lambda_{c} $ 和每次崩溃的期望损失的乘积：\n$ g_{L}(\\tau_{j}) = \\lambda_{c} \\cdot E[\\text{Loss per crash}] = \\lambda_{c} c_{L} r \\frac{\\tau_{j}}{2} $\n\n现在，我们可以写出总目标函数 $ g(\\tau_{j}) $：\n$ g(\\tau_{j}) = \\frac{E_{f}}{\\tau_{j}} + \\frac{1}{2} \\lambda_{c} c_{L} r \\tau_{j} $\n\n为了找到使 $ g(\\tau_{j}) $ 最小化的最优间隔 $ \\tau_{j} $，我们计算 $ g(\\tau_{j}) $ 相对于 $ \\tau_{j} $ 的一阶导数并将其设为零。\n$ \\frac{dg}{d\\tau_{j}} = \\frac{d}{d\\tau_{j}} \\left( E_{f} \\tau_{j}^{-1} + \\frac{1}{2} \\lambda_{c} c_{L} r \\tau_{j} \\right) = -E_{f} \\tau_{j}^{-2} + \\frac{1}{2} \\lambda_{c} c_{L} r $\n\n将导数设为零：\n$ - \\frac{E_{f}}{\\tau_{j}^2} + \\frac{1}{2} \\lambda_{c} c_{L} r = 0 $\n$ \\frac{E_{f}}{\\tau_{j}^2} = \\frac{1}{2} \\lambda_{c} c_{L} r $\n$ \\tau_{j}^2 = \\frac{2 E_{f}}{\\lambda_{c} c_{L} r} $\n\n解出 $ \\tau_{j} $（由于时间必须为正，我们取正根）：\n$ \\tau_{j,opt} = \\sqrt{\\frac{2 E_{f}}{\\lambda_{c} c_{L} r}} $\n\n为了验证这对应一个最小值，我们检查二阶导数：\n$ \\frac{d^2g}{d\\tau_{j}^2} = \\frac{d}{d\\tau_{j}} \\left( -E_{f} \\tau_{j}^{-2} + \\frac{1}{2} \\lambda_{c} c_{L} r \\right) = 2 E_{f} \\tau_{j}^{-3} $\n由于 $ E_{f} > 0 $ 且 $ \\tau_{j} > 0 $，二阶导数总是正的，这证实了函数 $ g(\\tau_{j}) $ 是凸函数，并且我们的解是一个全局最小值。\n\n最后，我们使用给定的参数计算这个最优的 $ \\tau_{j} $：\n$ E_{f} = 2.5 \\times 10^{-3} $ J\n$ r = 1.024 \\times 10^{4} $ 字节 s$^{-1}$\n$ \\lambda_{c} = 1.0 \\times 10^{-6} $ s$^{-1}$\n$ c_{L} = 5.0 \\times 10^{-7} $ J 字节$^{-1}$\n\n首先，我们计算平方根下分数的分母 $ \\lambda_{c} c_{L} r $：\n$ \\lambda_{c} c_{L} r = (1.0 \\times 10^{-6} \\text{ s}^{-1}) \\cdot (5.0 \\times 10^{-7} \\text{ J 字节}^{-1}) \\cdot (1.024 \\times 10^{4} \\text{ 字节 s}^{-1}) $\n$ \\lambda_{c} c_{L} r = (1.0 \\cdot 5.0 \\cdot 1.024) \\times 10^{-6-7+4} \\text{ J s}^{-2} = 5.12 \\times 10^{-9} \\text{ J s}^{-2} $\n\n接下来，我们计算分子 $ 2 E_{f} $：\n$ 2 E_{f} = 2 \\cdot (2.5 \\times 10^{-3} \\text{ J}) = 5.0 \\times 10^{-3} \\text{ J} $\n\n现在我们可以计算 $ \\tau_{j,opt}^2 $：\n$ \\tau_{j,opt}^2 = \\frac{5.0 \\times 10^{-3} \\text{ J}}{5.12 \\times 10^{-9} \\text{ J s}^{-2}} = \\frac{5.0}{5.12} \\times 10^{6} \\text{ s}^2 \\approx 0.9765625 \\times 10^{6} \\text{ s}^2 $\n$ \\tau_{j,opt}^2 = 976562.5 \\text{ s}^2 $\n\n取平方根求 $ \\tau_{j,opt} $：\n$ \\tau_{j,opt} = \\sqrt{976562.5} \\text{ s} \\approx 988.21176 \\text{ s} $\n\n按要求将结果四舍五入到四位有效数字：\n$ \\tau_{j,opt} \\approx 988.2 \\text{ s} $", "answer": "$$\\boxed{988.2}$$", "id": "3669960"}, {"introduction": "最先进的节能功能能够感知上下文，根据设备的使用方式进行自适应调整。本练习 [@problem_id:3669962] 深入探讨了一种智能“打盹” (Doze) 模式，该模式利用传感器数据来判断设备是否处于静止状态，从而决定能否进入深度睡眠。你的任务是量化该系统的能源开销，不仅要计算周期性检查的成本，还要考虑因系统不必要地“误唤醒”而浪费的能量。", "problem": "一个移动操作系统 (OS) 实现了一种自适应的低功耗“打盹”(Doze) 模式，该模式依赖于来自设备上传感器流的运动推断。该操作系统计算固定时长窗口内加速度计幅值的香农熵 $H$，以决定何时退出或进入打盹模式。在打盹模式下，操作系统每 $\\tau$ 秒进行一次周期性检查，通过收集一个持续时间为 $w$ 秒的窗口并计算 $H$。退出规则是：如果在打盹检查中 $H > T$，操作系统会立即退出打盹模式，进入低延迟的活动状态；否则，它将保持在打盹模式。假设以下科学上符合实际的模型和参数：\n\n- 在静止条件下，熵 $H$ 是一个高斯随机变量，其分布为 $H \\sim \\mathcal{N}(\\mu_{0}, \\sigma_{0}^{2})$，参数为 $\\mu_{0} = 1.0$ 比特，$\\sigma_{0} = 0.15$ 比特。在运动条件下，$H \\sim \\mathcal{N}(\\mu_{1}, \\sigma_{1}^{2})$，参数为 $\\mu_{1} = 1.6$ 比特，$\\sigma_{1} = 0.20$ 比特。检测阈值为 $T = 1.3$ 比特。\n- 打盹检查周期和窗口持续时间分别为 $\\tau = 30$ 秒和 $w = 5$ 秒。当设备静止时，各次检查的窗口结果可视为相互独立。\n- 设备在 $p = 0.80$ 的时间比例内处于静止状态，在 $1 - p$ 的时间比例内处于运动状态。周期性检查仅在打盹模式下（即静止时）进行。\n- 能量成本：计算单次打盹检查（收集 $w$ 秒的窗口并计算 $H$）消耗 $E_{\\text{check}} = 0.06$ 焦耳。如果操作系统因错误退出（即设备静止但 $H > T$）而退出打盹模式，唤醒转换开销为 $E_{\\text{wake}} = 1.5$ 焦耳，并且设备在重新进入打盹模式前，会以恒定功率 $P_{\\text{active}} = 0.8$ 瓦特保持活动状态 $L = 10$ 秒（在此验证间隔内忽略其他流量或应用活动）。\n\n从核心定义出发，即 (i) 能量是功率对时间的积分，以及 (ii) 稀有事件的期望计数等于试验次数乘以事件概率，请从第一性原理推导一个表达式，用于计算每小时归因于打盹检测流程和虚假唤醒的预期总能量开销。总开销是静止时计算周期性检查所花费的能量与静止期间因错误退出所花费的能量之和。最终答案以焦耳表示，并将最终数值四舍五入至四位有效数字。在获得最终的四舍五入答案时，不应使用任何中间的四舍五入值。", "solution": "问题指定了一种自适应的打盹机制，在设备静止时执行周期性检查。每小时的预期能量开销必须考虑两个部分：(i) 执行检查的能量，以及 (ii) 当设备静止但熵 $H$ 超过阈值 $T$ 时，因错误退出打盹模式而产生的能量。\n\n我们从以下基本原理出发：\n\n1. 能量等于功率对时间的积分。对于恒定功率 $P$ 在时间 $t$ 上的作用，能量为 $E = P t$。\n2. 对于事件概率为 $q$ 的独立伯努利试验，在 $N$ 次试验中事件的期望发生次数为 $N q$。\n3. 随机变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^{2})$ 的高斯分布具有密度函数 $f_{X}(x) = \\frac{1}{\\sigma \\sqrt{2 \\pi}} \\exp\\!\\left(-\\frac{(x - \\mu)^{2}}{2 \\sigma^{2}}\\right)$。超过阈值 $T$ 的尾部概率为\n$$\n\\mathbb{P}(X > T) = \\int_{T}^{\\infty} \\frac{1}{\\sigma \\sqrt{2 \\pi}} \\exp\\!\\left(-\\frac{(x - \\mu)^{2}}{2 \\sigma^{2}}\\right) \\, dx = \\frac{1}{2} \\operatorname{erfc}\\!\\left(\\frac{T - \\mu}{\\sigma \\sqrt{2}}\\right),\n$$\n其中 $\\operatorname{erfc}$ 是互补误差函数。\n\n我们首先量化每小时的打盹检查次数。设静止的时间比例为 $p$。操作系统仅在静止时以周期 $\\tau$ 执行检查。因此，每小时的预期检查次数为\n$$\nN_{\\text{checks}} = \\frac{p \\times 3600}{\\tau}.\n$$\n当 $p = 0.80$ 且 $\\tau = 30$ 秒时，\n$$\nN_{\\text{checks}} = \\frac{0.80 \\times 3600}{30} = \\frac{2880}{30} = 96.\n$$\n\n接下来，我们计算每次静止检查的错误退出概率。在静止条件下，$H \\sim \\mathcal{N}(\\mu_{0}, \\sigma_{0}^{2})$，其中 $\\mu_{0} = 1.0$ 比特，$\\sigma_{0} = 0.15$ 比特。当 $H > T$ 时触发退出规则，其中 $T = 1.3$ 比特。标准化变量为\n$$\nz = \\frac{T - \\mu_{0}}{\\sigma_{0}} = \\frac{1.3 - 1.0}{0.15} = \\frac{0.3}{0.15} = 2.0.\n$$\n因此，每次检查的错误退出概率是在 $z = 2$ 处的标准正态分布的上尾概率，即\n$$\nq_{\\text{fp}} = \\mathbb{P}(H > T \\mid \\text{stationary}) = \\frac{1}{2} \\operatorname{erfc}\\!\\left(\\frac{z}{\\sqrt{2}}\\right) = \\frac{1}{2} \\operatorname{erfc}\\!\\left(\\frac{2}{\\sqrt{2}}\\right) = \\frac{1}{2} \\operatorname{erfc}\\!\\left(\\sqrt{2}\\right).\n$$\n数值上，$\\operatorname{erfc}\\!\\left(\\sqrt{2}\\right) \\approx 0.045500263896$，所以\n$$\nq_{\\text{fp}} \\approx 0.022750131948.\n$$\n\n那么，每小时的预期错误退出次数为\n$$\nN_{\\text{fp}} = N_{\\text{checks}} \\times q_{\\text{fp}} \\approx 96 \\times 0.022750131948 \\approx 2.1840126624.\n$$\n\n我们现在计算能量的组成部分：\n\n- 每小时的检查能量：\n$$\nE_{\\text{checks/hour}} = N_{\\text{checks}} \\times E_{\\text{check}} = 96 \\times 0.06 = 5.76 \\text{ J}.\n$$\n\n- 每次错误退出的能量：唤醒转换能量为 $E_{\\text{wake}}$，活动验证间隔以恒定功率 $P_{\\text{active}}$ 持续时间 $L$，所以\n$$\nE_{\\text{per-false-exit}} = E_{\\text{wake}} + P_{\\text{active}} \\times L.\n$$\n当 $E_{\\text{wake}} = 1.5$ 焦耳，$P_{\\text{active}} = 0.8$ 瓦特，且 $L = 10$ 秒时，\n$$\nE_{\\text{per-false-exit}} = 1.5 + 0.8 \\times 10 = 1.5 + 8.0 = 9.5 \\text{ J}.\n$$\n因此，每小时的错误退出能量为\n$$\nE_{\\text{fp/hour}} = N_{\\text{fp}} \\times E_{\\text{per-false-exit}} \\approx 2.1840126624 \\times 9.5 \\approx 20.7481202928 \\text{ J}.\n$$\n\n将这两个部分相加，得到每小时的预期总能量开销：\n$$\nE_{\\text{total/hour}} = E_{\\text{checks/hour}} + E_{\\text{fp/hour}} \\approx 5.76 + 20.7481202928 = 26.5081202928 \\text{ J}.\n$$\n\n四舍五入到四位有效数字，最终结果是\n$$\n26.51 \\text{ J}.\n$$\n\n因此，在给定参数下，归因于自适应打盹检测和错误退出的每小时预期总能量开销为 $26.51$ 焦耳（四舍五入到四位有效数字）。", "answer": "$$\\boxed{26.51}$$", "id": "3669962"}]}