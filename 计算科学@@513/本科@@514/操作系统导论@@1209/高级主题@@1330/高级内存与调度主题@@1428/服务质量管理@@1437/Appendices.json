{"hands_on_practices": [{"introduction": "管理服务质量（QoS）的第一步是能够准确地预测系统性能。本练习向您介绍一个基本但功能强大的工具：排队论。您将首先使用一个理想化的 $M/M/1$ 模型来估算一个假设的操作系统服务的响应时间，然后通过评估该模型的局限性，认识到现实世界中流量的突发性（由变异系数 $C_a^2$ 和 $C_s^2$ 度量）如何影响性能。通过为通用到达和服务时间（$G/G/1$ 模型）应用修正，您将学习如何建立更贴近现实的性能模型，这是设计和验证 QoS 策略的关键技能。[@problem_id:3674525]", "problem": "一个由操作系统（OS）管理的加密服务被实现为单个内核线程，该线程以先到先服务（FCFS）的方式处理文件系统块请求。在一个长度为 $10$ 分钟的稳态观测窗口内，进行了以下测量：平均到达率为 $\\lambda = 900$ 请求/秒，平均服务时间为 $\\mathbb{E}[S] = 0.9$ 毫秒，到达间隔时间的变异系数平方（SCV）为 $C_{a}^{2} = 5.0$，服务时间的 SCV 为 $C_{s}^{2} = 1.5$。假设到达间隔时间和服务时间是独立同分布（i.i.d.）的，并且系统是稳定的。\n\n仅以基本的排队论原理和经过充分检验的结论作为出发点：\n\n1) 在 $M/M/1$ 排队（马尔可夫到达和马尔可夫服务）的假设下，从第一性原理推导平均响应时间 $W$ 关于 $\\lambda$ 和 $\\mu$ 的表达式，其中 $\\mu$ 是服务率，然后根据上述测量值进行数值计算。结果以毫秒表示。\n\n2) 根据测得的变异性 $C_{a}^{2}$ 和 $C_{s}^{2}$，批判性地评估 $M/M/1$ 假设是否适用于这种具有突发性到达的操作系统管理服务。定性地解释与 $M/M/1$ 的预测相比，突发性预计会如何改变等待时间。\n\n3) 使用考虑了一般到达和一般服务时间（$G/G/1$ 模型）的一阶修正，通过 SCV 计算修正后的平均响应时间估计值。最终响应时间以毫秒表示。将最终答案四舍五入到四位有效数字。", "solution": "问题陈述是自洽的，科学上基于排队论原理，并且提供的数据是内部一致的。给定的参数是：平均到达率 $\\lambda = 900 \\text{ s}^{-1}$，平均服务时间 $\\mathbb{E}[S] = 0.9 \\text{ ms} = 0.0009 \\text{ s}$，到达间隔时间的变异系数平方（SCV）$C_{a}^{2} = 5.0$，以及服务时间的 SCV $C_{s}^{2} = 1.5$。服务率为 $\\mu = 1/\\mathbb{E}[S] = 1/0.0009 \\text{ s}^{-1} \\approx 1111.1 \\text{ s}^{-1}$。系统利用率为 $\\rho = \\lambda \\mathbb{E}[S] = 900 \\times 0.0009 = 0.81$。由于 $\\rho  1$，系统如题所述是稳定的。该问题是有效的，可以如下解决。\n\n1) M/M/1 排队的平均响应时间\n\n$M/M/1$ 排队假设到达间隔时间和服务时间是马尔可夫的（服从指数分布），具有单个服务器和无限缓冲区容量。排队规则是先到先服务（FCFS）。\n\n我们首先从第一性原理推导系统中的平均请求数 $L$。对于处于稳态的 $M/M/1$ 排队，系统中存在 $n$ 个请求的概率 $p_n$ 服从几何分布：\n$$p_n = (1-\\rho)\\rho^n, \\quad \\text{for } n = 0, 1, 2, \\dots$$\n其中 $\\rho = \\lambda/\\mu$ 是服务器利用率。\n\n系统中的平均请求数 $L$ 是该分布的期望值：\n$$L = \\mathbb{E}[n] = \\sum_{n=0}^{\\infty} n p_n = \\sum_{n=0}^{\\infty} n (1-\\rho)\\rho^n = (1-\\rho) \\sum_{n=0}^{\\infty} n \\rho^n$$\n我们使用几何级数导数的恒等式，$\\sum_{n=1}^{\\infty} n x^{n-1} = \\frac{d}{dx} \\sum_{n=0}^{\\infty} x^n = \\frac{d}{dx} \\left(\\frac{1}{1-x}\\right) = \\frac{1}{(1-x)^2}$ 对于 $|x|1$。\n$$L = (1-\\rho) \\rho \\sum_{n=1}^{\\infty} n \\rho^{n-1} = (1-\\rho) \\rho \\left( \\frac{1}{(1-\\rho)^2} \\right) = \\frac{\\rho}{1-\\rho}$$\n根据利特尔法则（Little's Law），系统中的平均请求数与平均到达率 $\\lambda$ 和平均响应时间 $W$ 的关系为 $L = \\lambda W$。令 $L$ 的两个表达式相等：\n$$\\lambda W = \\frac{\\rho}{1-\\rho}$$\n求解 $W$ 并代入 $\\rho = \\lambda/\\mu$：\n$$W = \\frac{1}{\\lambda} \\frac{\\rho}{1-\\rho} = \\frac{1}{\\lambda} \\frac{\\lambda/\\mu}{1-\\lambda/\\mu} = \\frac{1}{\\lambda} \\frac{\\lambda/\\mu}{(\\mu-\\lambda)/\\mu} = \\frac{1}{\\mu-\\lambda}$$\n这就是 $M/M/1$ 排队中平均响应时间的表达式。\n\n现在，我们对这个表达式进行数值计算。\n给定 $\\lambda = 900 \\text{ s}^{-1}$ 和 $\\mathbb{E}[S] = 0.9 \\text{ ms} = 0.0009 \\text{ s}$。\n服务率为 $\\mu = \\frac{1}{\\mathbb{E}[S]} = \\frac{1}{0.0009} \\text{ s}^{-1} = \\frac{10000}{9} \\text{ s}^{-1}$。\n$$W = \\frac{1}{\\mu - \\lambda} = \\frac{1}{\\frac{10000}{9} - 900} = \\frac{1}{\\frac{10000 - 8100}{9}} = \\frac{9}{1900} \\text{ s}$$\n为了以毫秒表示结果，我们乘以 $1000$：\n$$W = \\frac{9}{1900} \\times 1000 \\text{ ms} = \\frac{90}{19} \\text{ ms} \\approx 4.7368 \\text{ ms}$$\n\n2) M/M/1 假设的适当性\n\n$M/M/1$ 模型假设到达间隔时间和服务时间都服从指数分布。指数分布的一个决定性特征是其变异系数的平方（SCV）恰好为 $1$。随机变量 $X$ 的 SCV 定义为 $C_X^2 = \\frac{\\text{Var}(X)}{(\\mathbb{E}[X])^2}$。\n\n问题提供了以下测量的 SCV 值：\n- 到达间隔时间的 SCV：$C_a^2 = 5.0$\n- 服务时间的 SCV：$C_s^2 = 1.5$\n\n由于 $C_a^2 = 5.0 \\neq 1$，到达过程不是马尔可夫过程（即不是泊松过程）。$C_a^2 > 1$ 的值表示一种“突发性”的到达模式，其中到达比纯粹随机的泊松过程更加聚集。\n由于 $C_s^2 = 1.5 \\neq 1$，服务时间不服从指数分布。$C_s^2 > 1$ 的值表示服务时间比指数分布假设的更具可变性。\n\n因此，$M/M/1$ 假设对于该系统是**不合适的**。\n\n定性地看，与具有平滑到达和服务时间的系统相比，到达的突发性（$C_a^2 > 1$）和服务时间的高可变性（$C_s^2 > 1$）都会导致拥塞加剧和队列长度增加。突发性到达倾向于间歇性地涌入队列，导致长时间的等待。类似地，一个异常长的服务时间会阻塞单个服务器，导致请求积压。因此，预计实际的平均等待时间将显著**长于** $M/M/1$ 模型的预测值。\n\n3) G/G/1 平均响应时间的修正估计\n\n为了考虑到达间隔时间和服务时间的一般（非指数）分布，我们使用一个成熟的近似公式来计算 $G/G/1$ 系统中队列的平均等待时间 $W_q$。这通常被称为 Kingman 近似公式或 Allen-Cunneen 公式：\n$$W_q \\approx \\mathbb{E}[S] \\left( \\frac{\\rho}{1-\\rho} \\right) \\left( \\frac{C_a^2 + C_s^2}{2} \\right)$$\n总平均响应时间 $W$ 是在队列中等待的平均时间与平均服务时间之和：\n$$W = W_q + \\mathbb{E}[S]$$\n我们有以下数值：\n- $\\mathbb{E}[S] = 0.9 \\text{ ms}$\n- $\\rho = 0.81$\n- $C_a^2 = 5.0$\n- $C_s^2 = 1.5$\n\n首先，根据 SCV 计算修正因子：\n$$\\frac{C_a^2 + C_s^2}{2} = \\frac{5.0 + 1.5}{2} = \\frac{6.5}{2} = 3.25$$\n现在，将数值代入 $W_q$ 的公式：\n$$W_q \\approx (0.9 \\text{ ms}) \\left( \\frac{0.81}{1-0.81} \\right) (3.25) = (0.9 \\text{ ms}) \\left( \\frac{0.81}{0.19} \\right) (3.25)$$\n$$W_q \\approx (0.9 \\text{ ms}) \\times (4.263157...) \\times (3.25) \\approx 12.469736... \\text{ ms}$$\n最后，我们计算总平均响应时间 $W$：\n$$W = W_q + \\mathbb{E}[S] \\approx 12.469736... \\text{ ms} + 0.9 \\text{ ms} = 13.369736... \\text{ ms}$$\n将最终答案四舍五入到四位有效数字，我们得到：\n$$W \\approx 13.37 \\text{ ms}$$\n正如在第 2 部分中预测的那样，这个修正后的估计值远大于 $M/M/1$ 模型预测的 $\\approx 4.74 \\text{ ms}$，这反映了突发性到达和可变服务时间对系统性能的显著影响。", "answer": "$$\\boxed{13.37}$$", "id": "3674525"}, {"introduction": "虽然平均性能很重要，但许多应用需要严格的延迟保证。本练习将您的注意力从统计预测转移到确定性保证上，这是硬实时系统 QoS 管理的核心。您将从基本原理出发，推导并应用响应时间分析（Response-Time Analysis）方法，来计算一个任务的最坏情况响应时间 $R_i$。通过考虑任务自身的计算时间 $C_i$、来自更高优先级任务的抢占干扰以及由资源共享引起的阻塞时间 $B_i$，您将掌握验证系统是否可调度（即所有任务是否能满足其最后期限）的核心技术。[@problem_id:3674520]", "problem": "操作系统中的一个实时子系统通过限制单个中央处理器（CPU）上的任务延迟来管理服务质量（QoS）。考虑一个周期性的独立任务集，该任务集采用固定优先级抢占式调度，遵循速率单调调度（RMS）策略，即周期越短，优先级越高。系统使用互斥锁（mutex）实现互斥，低优先级任务可能会执行非抢占式临界区，从而通过资源共享阻塞高优先级任务。\n\n任务按索引排序，任务 $\\tau_{1}$ 优先级最高，其次是 $\\tau_{2}$，然后是 $\\tau_{3}$ 和 $\\tau_{4}$。任务参数如下：\n- 任务 $\\tau_{1}$：周期 $T_{1} = 25$ 毫秒，最坏情况执行时间 $C_{1} = 3$ 毫秒。\n- 任务 $\\tau_{2}$：周期 $T_{2} = 40$ 毫秒，最坏情况执行时间 $C_{2} = 5$ 毫秒。\n- 任务 $\\tau_{3}$：周期 $T_{3} = 100$ 毫秒，最坏情况执行时间 $C_{3} = 12$ 毫秒。\n- 任务 $\\tau_{4}$：周期 $T_{4} = 200$ 毫秒，最坏情况执行时间 $C_{4} = 20$ 毫秒，它可以持有受互斥锁保护的临界区长达 $4$ 毫秒。\n\n假设如下：\n- 所有任务发布在最坏情况下（关键时刻）是严格周期性和同步的。\n- 不存在发布抖动、自我挂起和执行时间变化。\n- 任务 $\\tau_{3}$ 最多可能被一个非抢占式的低优先级临界区阻塞，阻塞时间上限为 $B_{3} = 4$ 毫秒。\n- 截止时间等于周期。\n\n仅从核心定义和基本调度事实（例如，响应时间定义为完成时间减去发布时间，固定优先级调度的最坏情况关键时刻概念，以及干扰是由响应区间内发布的更高优先级作业的抢占引起的这一事实）出发，推导任务 $\\tau_{3}$ 的最坏情况响应时间的界限，将其表示为其自身计算、低优先级任务的一次性阻塞以及高优先级任务的干扰的函数。然后，根据给定的任务参数，对该界限进行数值评估。\n\n以毫秒为单位表示最终的数值界限。无需四舍五入。", "solution": "目标是求出在固定优先级抢占式调度下，任务 $\\tau_{3}$ 因低优先级临界区可能引起的阻塞的最坏情况响应时间。\n\n**1. 原理推导**\n\n从定义开始：任务 $\\tau_{i}$ 的一个作业的响应时间 $R_{i}$ 是指从其发布到完成所经过的时间。在固定优先级抢占式调度下，最坏情况响应时间发生在“关键时刻”，即目标作业与所有更高优先级的作业同时发布的瞬间。\n\n在响应时间 $R_{i}$ 的区间内，任务 $\\tau_{i}$ 的作业需要完成其自身的计算，同时可能被更高优先级的任务抢占，以及被低优先级的任务阻塞。因此，其响应时间由三部分组成：\n1. **自身计算时间**：$C_{i}$\n2. **阻塞时间**：由持有共享资源的低优先级任务引起的最大阻塞时间 $B_{i}$。\n3. **干扰时间**：由所有更高优先级任务集 $hp(i)$ 中的任务 $\\tau_j$ 的抢占所引起的总时间。\n\n对于任何更高优先级的任务 $\\tau_j$（其中 $j  i$），在时间间隔 $R_i$ 内，它最多可以发布 $\\lceil R_i / T_j \\rceil$ 次。每次发布都会产生一个需要 $C_j$ 时间的作业来抢占 $\\tau_i$。因此，来自所有更高优先级任务的总干扰为 $\\sum_{j  i} \\lceil R_i / T_j \\rceil C_j$。\n\n综合这些影响，最坏情况响应时间 $R_{i}$ 必须满足以下递归关系：\n$$R_{i} = C_{i} + B_{i} + \\sum_{j  i} \\lceil R_i / T_j \\rceil C_j$$\n\n这个方程可以通过迭代求解。我们从一个初始估计 $R_i^{(0)} = C_i + B_i$ 开始，然后反复代入方程右侧计算新的估计值 $R_i^{(k+1)}$，直到 $R_i^{(k+1)} = R_i^{(k)}$。\n\n**2. 数值计算**\n\n现在我们将此公式应用于任务 $\\tau_{3}$。\n- 任务 $\\tau_3$ 的参数：$C_{3} = 12$ ms, $T_{3} = 100$ ms。\n- 阻塞时间：$B_{3} = 4$ ms。\n- 更高优先级的任务是 $\\tau_1$ 和 $\\tau_2$。\n- $\\tau_1$: $C_{1} = 3$ ms, $T_{1} = 25$ ms。\n- $\\tau_2$: $C_{2} = 5$ ms, $T_{2} = 40$ ms。\n\n$\\tau_3$ 的响应时间方程为：\n$$R_{3} = C_{3} + B_{3} + \\lceil R_3/T_1 \\rceil C_1 + \\lceil R_3/T_2 \\rceil C_2$$\n$$R_{3} = 12 + 4 + \\lceil R_3/25 \\rceil \\cdot 3 + \\lceil R_3/40 \\rceil \\cdot 5$$\n\n我们开始迭代求解：\n- **第0步 (初始值):**\n  $R_{3}^{(0)} = C_{3} + B_{3} = 12 + 4 = 16$ ms。\n- **第1步:**\n  $R_{3}^{(1)} = 16 + \\lceil 16/25 \\rceil \\cdot 3 + \\lceil 16/40 \\rceil \\cdot 5 = 16 + 1 \\cdot 3 + 1 \\cdot 5 = 16 + 3 + 5 = 24$ ms。\n- **第2步:**\n  $R_{3}^{(2)} = 16 + \\lceil 24/25 \\rceil \\cdot 3 + \\lceil 24/40 \\rceil \\cdot 5 = 16 + 1 \\cdot 3 + 1 \\cdot 5 = 16 + 3 + 5 = 24$ ms。\n\n由于 $R_{3}^{(2)} = R_{3}^{(1)}$，迭代收敛。最坏情况响应时间为 $R_{3} = 24$ ms。\n\n最后，我们检查任务是否满足其截止时间（$D_3 = T_3 = 100$ ms）。由于 $24 \\text{ ms} \\leq 100 \\text{ ms}$，任务 $\\tau_3$ 是可调度的。", "answer": "$$\\boxed{24}$$", "id": "3674520"}, {"introduction": "有效的 QoS 管理通常需要在相互冲突的目标之间进行权衡。本练习模拟了一个在现代存储系统中常见的真实设计挑战：通过 I/O 合并来平衡吞吐量和延迟。您将建立一个模型，量化更大的合并批次 $M$ 如何在摊销固定开销以提高效率的同时，也增加了单个请求的等待时间。您的任务是利用该模型，在给定的 99 百分位（$p_{99}$）延迟服务水平目标（SLO）下，确定最佳的合并大小，从而体验如何通过量化分析来做出满足复杂性能要求的工程决策。[@problem_id:3674540]", "problem": "一个用于固态硬盘（SSD）的操作系统存储栈实现了基于时间的 I/O 合并，以便在遵循服务质量（QoS）尾部延迟目标的同时提高吞吐量。该调度程序在长度为 $\\delta$ 的周期性合并窗口中运行，在此期间，它会将所有新到达的小型读取请求加入队列，并在窗口结束时发出一个合并后的单一 I/O，将所有收集到的读取作为一次连续的操作来服务。假设小型读取的到达过程为平稳泊松过程，速率为 $\\lambda$（单位为 $\\text{s}^{-1}$），并且包含 $M$ 个小型读取的合并 I/O 的设备服务时间可以通过仿射模型 $S(M) = \\alpha + \\beta M$ 很好地近似，其中 $\\alpha$ 模拟了每个 I/O 的固定开销，$\\beta$ 模拟了每次读取的传输时间。操作系统强制执行一个百分位延迟服务水平目标（SLO）：任何小型读取的端到端延迟的第 $99$ 百分位数（$p_{99}$）不得超过一个预算上限 $L_{\\max}$。\n\n为控制平均批处理大小，调度程序通过强制执行稳态关系 $\\mathbb{E}[N(\\delta)] = \\lambda \\delta = M$ 来选择窗口长度作为目标合并大小 $M$ 的函数，其中 $N(\\delta)$ 是一个窗口内的到达次数。对于泊松过程和独立于到达的周期性门控，从任意一次达到到下一个门控边界的剩余时间在 $[0,\\delta]$ 上均匀分布。因此，由合并引起的排队延迟贡献具有在 $[0,\\delta]$ 上的均匀随机变量的累积分布函数。读取的端到端延迟被建模为该等待时间与随后的合并 I/O 服务时间 $S(M)$ 之和。\n\n给定以下参数：\n- 到达速率 $\\lambda = 5000$ $\\text{s}^{-1}$，\n- 固定服务开销 $\\alpha = 0.08$ $\\text{ms}$，\n- 每次读取的传输时间 $\\beta = 0.03$ $\\text{ms}$，\n- 尾部延迟预算上限 $L_{\\max} = 4$ $\\text{ms}$，\n\n并使用合并窗口规则 $\\delta(M) = M / \\lambda$（单位为秒），确定使得建模的 $p_{99}$ 端到端延迟不超过 $L_{\\max}$ 的最大整数合并大小 $M$。所有时间量均以毫秒（ms）表示。最终答案必须是单个整数 $M$。由于 $M$ 是一个整数决策变量，因此无需四舍五入到有效数字。\n\n注意：合并的动机是，平均每次请求的服务时间随 $M$ 的增大而减小，因为 $\\frac{S(M)}{M} = \\frac{\\alpha}{M} + \\beta$，而较大的 $M$ 会增加由合并引起的等待时间。您的任务是平衡这些效应以满足 $p_{99}$ 约束。", "solution": "该问题要求找到满足给定服务质量（QoS）尾部延迟目标的最大整数合并大小 $M$。解决方案需要为小型读取请求的端到端延迟建立一个模型，然后在指定的约束条件下求解 $M$。\n\n首先，我们来定义端到端延迟 $L$ 的组成部分。根据问题陈述，任意小型读取的延迟是两个部分的总和：\n1. 等待时间 $W$，即从请求到达直到当前合并窗口结束的时间。\n2. 包含该请求的合并 I/O 操作的服务时间 $T_s$。\n\n因此，总延迟为 $L = W + T_s$。我们必须刻画 $L$ 的概率特性。\n\n调度程序以持续时间为 $\\delta$ 的合并窗口运行。问题陈述指出，对于一个平稳泊松到达过程，任意一次到达的等待时间 $W$ 在区间 $[0, \\delta]$ 上均匀分布。我们可以将其写作 $W \\sim U[0, \\delta]$。\n\n包含目标为 $M$ 个小型读取的合并 I/O 的服务时间 $T_s$ 由确定性的仿射模型 $S(M) = \\alpha + \\beta M$ 给出。所以，$T_s = S(M)$。\n\n窗口持续时间 $\\delta$ 被设置为目标合并大小 $M$ 和到达速率 $\\lambda$ 的函数，以满足稳态条件 $\\lambda \\delta = M$。由此得出 $\\delta = M / \\lambda$。\n\n总延迟 $L$ 是一个随机变量，定义为随机变量 $W$ 和常数 $T_s = S(M)$（对于一个固定的目标 $M$）之和。\n$L = W + S(M)$，其中 $W \\sim U[0, M/\\lambda]$。\n一个均匀随机变量 $U[a, b]$ 与一个常数 $c$ 的和也是一个均匀随机变量，分布在 $[a+c, b+c]$ 上。\n在我们的例子中，$L$ 在区间 $[0 + S(M), \\delta + S(M)]$ 上均匀分布，即 $[S(M), S(M) + \\delta]$。\n\nQoS 约束是针对延迟的第 $99$ 百分位数（$p_{99}$），该值不得超过 $L_{\\max}$。我们用 $L_{0.99}$ 表示这个百分位数。为了求得 $L_{0.99}$，我们使用 $L$ 的累积分布函数（CDF）。对于一个随机变量 $X \\sim U[a, b]$，其 CDF 为 $F_X(x) = \\frac{x-a}{b-a}$，其中 $x \\in [a, b]$。\n因此，$L$ 的 CDF 为：\n$$ F_L(l) = \\frac{l - S(M)}{(S(M) + \\delta) - S(M)} = \\frac{l - S(M)}{\\delta} \\quad \\text{for } l \\in [S(M), S(M) + \\delta] $$\n第 $p$ 百分位延迟 $L_p$ 是使 $F_L(l) = p$ 成立的 $l$ 值。\n$$ p = \\frac{L_p - S(M)}{\\delta} \\implies L_p = S(M) + p \\cdot \\delta $$\n对于第 $99$ 百分位数，我们设置 $p=0.99$：\n$$ L_{0.99} = S(M) + 0.99 \\delta $$\nQoS 约束为 $L_{0.99} \\leq L_{\\max}$。代入 $L_{0.99}$、$S(M)$ 和 $\\delta$ 的表达式：\n$$ (\\alpha + \\beta M) + 0.99 \\left(\\frac{M}{\\lambda}\\right) \\leq L_{\\max} $$\n我们想找到满足此不等式的最大整数 $M$。我们可以重排该不等式以求解 $M$：\n$$ \\alpha + M \\left(\\beta + \\frac{0.99}{\\lambda}\\right) \\leq L_{\\max} $$\n$$ M \\left(\\beta + \\frac{0.99}{\\lambda}\\right) \\leq L_{\\max} - \\alpha $$\n$$ M \\leq \\frac{L_{\\max} - \\alpha}{\\beta + \\frac{0.99}{\\lambda}} $$\n现在，我们代入给定的参数值。确保所有单位一致至关重要。问题建议对时间使用毫秒（ms）。\n给定的参数是：\n- $\\lambda = 5000$ $\\text{s}^{-1}$\n- $\\alpha = 0.08$ $\\text{ms}$\n- $\\beta = 0.03$ $\\text{ms}$\n- $L_{\\max} = 4$ $\\text{ms}$\n\n我们将到达速率 $\\lambda$ 的单位转换为 $\\text{ms}^{-1}$：\n$$ \\lambda = 5000 \\text{ s}^{-1} = 5000 \\times (1000 \\text{ ms})^{-1} = \\frac{5000}{1000} \\text{ ms}^{-1} = 5 \\text{ ms}^{-1} $$\n现在我们可以将数值代入关于 $M$ 的不等式中：\n$$ M \\leq \\frac{4 - 0.08}{0.03 + \\frac{0.99}{5}} $$\n我们分别计算分子和分母。\n分子：\n$$ L_{\\max} - \\alpha = 4 - 0.08 = 3.92 $$\n分母：\n$$ \\beta + \\frac{0.99}{\\lambda} = 0.03 + \\frac{0.99}{5} = 0.03 + 0.198 = 0.228 $$\n将这些值代回不等式：\n$$ M \\leq \\frac{3.92}{0.228} \\approx 17.19298... $$\n问题要求的是满足此条件的最大整数合并大小 $M$。小于或等于 $17.19298...$ 的最大整数是 $17$。\n\n为了验证，我们来计算 $M = 17$ 和 $M = 18$ 时的 $p_{99}$ 延迟。\n对于 $M=17$：\n$L_{0.99}(17) = \\alpha + 17(\\beta + \\frac{0.99}{\\lambda}) = 0.08 + 17(0.03 + \\frac{0.99}{5}) = 0.08 + 17(0.228) = 0.08 + 3.876 = 3.956$ $\\text{ms}$。\n由于 $3.956 \\leq 4$，所以 $M=17$ 是一个有效的大小。\n\n对于 $M=18$：\n$L_{0.99}(18) = \\alpha + 18(\\beta + \\frac{0.99}{\\lambda}) = 0.08 + 18(0.228) = 0.08 + 4.104 = 4.184$ $\\text{ms}$。\n由于 $4.184 > 4$，所以 $M=18$ 违反了延迟约束。\n\n因此，最大整数合并大小是 $17$。", "answer": "$$ \\boxed{17} $$", "id": "3674540"}]}