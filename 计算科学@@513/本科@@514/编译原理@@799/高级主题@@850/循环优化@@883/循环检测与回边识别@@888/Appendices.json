{"hands_on_practices": [{"introduction": "本练习旨在通过一个具体的控制流图（CFG）来巩固您对支配关系和回边识别的基本理解。您将需要从最基本的定义出发，一步步计算每个节点的直接支配节点，构建支配树，并最终根据支配关系找出图中的所有回边 [@problem_id:3652216]。这个过程是掌握循环分析算法的基石。", "problem": "考虑一个具有单一入口节点的控制流图 (CFG)。设顶点集为 $V=\\{r,a,b,c,d,e,f,g,h,i,j\\}$，其中 $r$ 是入口节点，有向边集为\n$$\nE=\\{(r,a),\\ (a,b),\\ (a,c),\\ (b,d),\\ (c,d),\\ (d,e),\\ (e,f),\\ (f,g),\\ (g,h),\\ (h,i),\\ (i,j),\\ (j,d),\\ (e,d),\\ (g,e),\\ (h,f),\\ (i,g)\\}.\n$$\n使用以下基本定义。\n- 如果从入口节点 $r$ 到节点 $y$ 的每条路径都包含节点 $x$，则称节点 $x$ \\emph{支配}节点 $y$。\n- $n$ 的\\emph{直接支配节点}，记作 $\\operatorname{idom}(n)$，是 $n$ 的唯一严格支配节点，且该节点不严格支配任何其他 $n$ 的严格支配节点。\n- \\emph{支配树} $DT$ 是一个以 $V$ 为顶点集、以 $r$ 为根的有根树，其边集为对所有 $u\\in V\\setminus\\{r\\}$ 的 $(\\operatorname{idom}(u),u)$。\n\n执行以下任务：\n1. 仅使用支配和直接支配节点的定义，计算所有 $n\\in V$ 的 $\\operatorname{idom}(n)$。\n2. 构建支配树 $DT$。\n3. 形成候选回边集合，该集合包含所有满足以下条件的有序对 $(u,v)$：$v$ 位于 $DT$ 中从 $r$ 到 $u$ 的唯一路径上。然后筛选此集合，只保留那些同时也是 CFG 中的边（即 $E$ 的元素）的有序对。\n4. 对于每个保留的有序对 $(u,v)$，令 $d_{DT}(v,u)$ 为 $DT$ 中从 $v$ 到 $u$ 的唯一路径上的树边数量。定义\n$$\nS=\\sum_{\\text{retained }(u,v)} d_{DT}(v,u).\n$$\n\n计算 $S$。给出你的最终答案，答案应为精确整数，无单位，且不进行四舍五入。", "solution": "用户要求我根据给定的控制流图 (CFG) 解决一个问题，该问题涉及计算直接支配节点、构建支配树、识别一组特定的边，并根据树中的路径长度计算一个总和。\n\n首先，我将验证问题陈述的有效性。\n该问题通过一个顶点集 $V=\\{r,a,b,c,d,e,f,g,h,i,j\\}$ 和一个边集 $E$ 提供了有向图的完整规范。入口节点被指定为 $r$。它为支配、直接支配节点 ($\\operatorname{idom}$) 和支配树 ($DT$) 提供了标准定义。这些任务是基于编译器理论中的这些标准概念明确定义的。该问题是自包含的、数学上合理的、且提法恰当的。唯一解存在，并且可以通过算法化地应用给定定义来确定。因此，该问题是有效的。\n\n现在我将按照问题陈述中列出的任务进行求解。\n\n### 任务1：计算所有 $n\\in V$ 的 $\\operatorname{idom}(n)$\n\n节点 $n$ 的直接支配节点 $\\operatorname{idom}(n)$ 是 $n$ 的唯一严格支配节点，且在从入口节点出发的任何路径上，该节点离 $n$ 最近。我们通过分析从入口节点 $r$ 出发的所有路径来确定每个节点 $n \\in V \\setminus \\{r\\}$ 的 $\\operatorname{idom}(n)$。\n\n-   **节点 a**：从 $r$ 到 $a$ 的唯一路径是 $(r, a)$。$a$ 的支配节点集合是 $\\{r, a\\}$。唯一的严格支配节点是 $r$。因此，$\\operatorname{idom}(a) = r$。\n-   **节点 b**：从 $r$ 到 $b$ 的唯一路径是 $(r, a, b)$。$b$ 的支配节点是 $\\{r, a, b\\}$。严格支配节点是 $\\{r, a\\}$。由于 $r$ 支配 $a$，直接支配节点是离 $b$ “最近”的那个，即 $a$。因此，$\\operatorname{idom}(b) = a$。\n-   **节点 c**：类似地，从 $r$ 到 $c$ 的唯一路径是 $(r, a, c)$。$c$ 的支配节点是 $\\{r, a, c\\}$。因此，$\\operatorname{idom}(c) = a$。\n-   **节点 d**：要到达 $d$，路径必须从 $r$ 开始。从 $r$ 出发的唯一边是 $(r, a)$，所以到任何其他节点的任何路径都必须包含 $a$。因此，$a$ 支配 $d$。路径 $(r,a,b,d)$ 和 $(r,a,c,d)$ 表明 $b$ 和 $c$ 都不支配 $d$。任何涉及循环的路径，例如通过边 $(j,d)$ 的路径，必须先到达 $j$，而任何到 $j$ 的路径都必须先经过 $a$ 和 $d$ 本身。因此，$d$ 的唯一严格支配节点是 $\\{r, a\\}$。由于 $a$ 被 $r$ 支配，所以 $a$ 是直接支配节点。因此，$\\operatorname{idom}(d) = a$。\n-   **节点 e**：从 $r$ 到 $e$ 的任何路径都必须先到达 $d$。$d$ 的前驱是 $b$、$c$ 和 $j$。到这些前驱的任何路径都必须包含 $a$。所以到 $d$ 的任何路径都必须包含 $a$。一旦到达 $d$，离开 $d$ 的唯一边是 $(d,e)$。因此，从 $r$ 到集合 $\\{e, f, g, h, i, j\\}$ 中任何节点的任何路径都必须包含子路径 $a \\to \\dots \\to d \\to e$。这意味着 $d$ 支配 $e$。因为存在直接边 $(d,e)$，所以 $d$ 和 $e$ 之间不可能有其他支配节点。因此，$\\operatorname{idom}(e) = d$。\n-   **节点 f**：如前所述，从 $r$ 到 $f$ 的任何路径都必须包含 $e$。所以我们考虑从 $e$ 到 $f$ 的路径。$f$ 的前驱是 $e$ 和 $h$。从 $e$ 出发的路径可以是直接边 $(e,f)$。任何到 $h$ 的路径都必须经过 $g$，而任何到 $g$ 的路径都必须经过 $f$ 或 $i$。假设存在一条从 $e$ 到 $f$ 的路径避开了直接边 $(e,f)$。这条路径必须从 $h$ 到达 $f$，所以它看起来像 $e \\leadsto h \\to f$。但是任何从 $e$ 到 $h$ 的路径都必须先经过 $f$（路径：$e \\to f \\to g \\to h$）。所以不可能在不首先经过 $f$ 的情况下从 $e$ 到达 $f$。更正式地说，从 $r$ 出发的任何路径都必须经过 $e$。从 $e$ 到达 $f$ 而不走边 $(e,f)$ 的唯一方法是通过循环结构。为此，必须最终到达 $h$ 并走边 $(h,f)$。到 $h$ 的路径是 $e \\to f \\to g \\to h$。这条路径已经包含了 $f$。因此，从 $r$ 到 $f$ 的每条路径都包含 $e$。鉴于边 $(e,f)$ 的存在，我们有 $\\operatorname{idom}(f) = e$。\n-   **节点 g**：从 $r$ 到 $g$ 的任何路径都必须包含 $f$。要看到这一点，任何从 $r$ 出发的路径都必须包含 $e$。我们检查从 $e$ 到 $g$ 的路径。节点集 $\\{g, h, i, j\\}$ 的前驱是单元素集 $\\{f\\}$。因此，从 $e$ 到 $\\{g, h, i, j\\}$ 中任何节点的任何路径都必须首先通过 $f$ 进入。具体来说，路径必须包含边 $(f,g)$ 或通过 $f$ 到达另一个入口点，但没有其他入口点。所以 $f$ 支配 $g$。由于边 $(f,g)$ 的存在，我们有 $\\operatorname{idom}(g) = f$。\n-   **节点 h**：$h$ 的唯一前驱是 $g$。因此，到 $h$ 的任何路径都必须经过 $g$。因此，$g$ 支配 $h$。边 $(g,h)$ 意味着 $\\operatorname{idom}(h) = g$。\n-   **节点 i**：$i$ 的唯一前驱是 $h$。因此，$h$ 支配 $i$。边 $(h,i)$ 意味着 $\\operatorname{idom}(i) = h$。\n-   **节点 j**：$j$ 的唯一前驱是 $i$。因此，$i$ 支配 $j$。边 $(i,j)$ 意味着 $\\operatorname{idom}(j) = i$。\n\n直接支配节点总结：\n$\\operatorname{idom}(a)=r, \\operatorname{idom}(b)=a, \\operatorname{idom}(c)=a, \\operatorname{idom}(d)=a, \\operatorname{idom}(e)=d, \\operatorname{idom}(f)=e, \\operatorname{idom}(g)=f, \\operatorname{idom}(h)=g, \\operatorname{idom}(i)=h, \\operatorname{idom}(j)=i$。\n\n### 任务2：构建支配树 $DT$\n\n支配树 $DT$ 的顶点集为 $V$，边为所有 $u \\in V \\setminus \\{r\\}$ 的 $(\\operatorname{idom}(u), u)$。\n-   根：$r$\n-   边：$(r,a), (a,b), (a,c), (a,d), (d,e), (e,f), (f,g), (g,h), (h,i), (i,j)$。\n树结构如下：$r$ 是根节点。节点 $a$ 是 $r$ 的一个子节点。节点 $b$、$c$ 和 $d$ 是 $a$ 的子节点。节点 $d$ 有一个单独的子节点 $e$，它开始一个链：$d \\to e \\to f \\to g \\to h \\to i \\to j$。\n\n### 任务3：识别保留的边\n\n我们需要找到所有满足 $v$ 支配 $u$ 的边 $(u,v) \\in E$。在支配树中，这等价于 $v$ 是 $u$ 的祖先。我们遍历 $E$ 中不是树边的边。值得关注的边是那些形成循环或跨越分支的边。它们是 $(b,d), (c,d), (j,d), (e,d), (g,e), (h,f), (i,g)$。\n\n-   $(b,d)$：$u=b, v=d$。在 $DT$ 中，$b$ 和 $d$ 是兄弟节点。$d$ 不支配 $b$。\n-   $(c,d)$：$u=c, v=d$。在 $DT$ 中，$c$ 和 $d$ 是兄弟节点。$d$ 不支配 $c$。\n-   $(j,d)$：$u=j, v=d$。在 $DT$ 中从 $r$ 到 $j$ 的路径是 $r \\to a \\to d \\to e \\to f \\to g \\to h \\to i \\to j$。节点 $d$ 是 $j$ 的祖先。此边被保留。\n-   $(e,d)$：$u=e, v=d$。在 $DT$ 中从 $r$ 到 $e$ 的路径是 $r \\to a \\to d \\to e$。节点 $d$ 是 $e$ 的父节点（因此是祖先）。此边被保留。\n-   $(g,e)$：$u=g, v=e$。在 $DT$ 中从 $r$ 到 $g$ 的路径是 $r \\to a \\to d \\to e \\to f \\to g$。节点 $e$ 是 $g$ 的祖先。此边被保留。\n-   $(h,f)$：$u=h, v=f$。在 $DT$ 中从 $r$ 到 $h$ 的路径是 $r \\to a \\to d \\to e \\to f \\to g \\to h$。节点 $f$ 是 $h$ 的祖先。此边被保留。\n-   $(i,g)$：$u=i, v=g$。在 $DT$ 中从 $r$ 到 $i$ 的路径是 $r \\to a \\to d \\to e \\to f \\to g \\to h \\to i$。节点 $g$ 是 $i$ 的祖先。此边被保留。\n\n保留的有序对 $(u,v)$ 集合是 $\\{(j,d), (e,d), (g,e), (h,f), (i,g)\\}$。\n\n### 任务4：计算 S\n\n我们为保留的有序对 $(u,v)$ 计算 $S = \\sum d_{DT}(v,u)$。项 $d_{DT}(v,u)$ 是支配树中从 $v$ 到 $u$ 的唯一路径上的边数。\n\n1.  对于 $(u,v) = (j,d)$：在 $DT$ 中从 $d$ 到 $j$ 的路径是 $d \\to e \\to f \\to g \\to h \\to i \\to j$。长度为 $6$ 条边。$d_{DT}(d,j)=6$。\n2.  对于 $(u,v) = (e,d)$：在 $DT$ 中从 $d$ 到 $e$ 的路径是 $d \\to e$。长度为 $1$ 条边。$d_{DT}(d,e)=1$。\n3.  对于 $(u,v) = (g,e)$：在 $DT$ 中从 $e$ 到 $g$ 的路径是 $e \\to f \\to g$。长度为 $2$ 条边。$d_{DT}(e,g)=2$。\n4.  对于 $(u,v) = (h,f)$：在 $DT$ 中从 $f$ 到 $h$ 的路径是 $f \\to g \\to h$。长度为 $2$ 条边。$d_{DT}(f,h)=2$。\n5.  对于 $(u,v) = (i,g)$：在 $DT$ 中从 $g$ 到 $i$ 的路径是 $g \\to h \\to i$。长度为 $2$ 条边。$d_{DT}(g,i)=2$。\n\n总和 $S$ 是这些距离的总计：\n$$ S = 6 + 1 + 2 + 2 + 2 = 13 $$", "answer": "$$\n\\boxed{13}\n$$", "id": "3652216"}, {"introduction": "在真实的程序中，一个循环的头部可能会有多个入口点，即存在多条回边指向同一个循环头。这个练习模拟了这种情况，要求您分析一个具有两个“锁存节点”（latch nodes）的循环结构 [@problem_id:3652277]。通过此练习，您将学会如何处理具有多个回边的循环，并理解如何通过合并由各回边定义的自然循环来确定整个循环的边界。", "problem": "考虑以下控制流图（CFG），其入口节点为 $s$，出口节点为 $t$。节点为 $s, h, x, y, z, l_1, l_2, t$。有向边如下：\n- $s \\rightarrow h$\n- $h \\rightarrow x$\n- $x \\rightarrow y$\n- $y \\rightarrow l_1$\n- $l_1 \\rightarrow h$\n- $h \\rightarrow z$\n- $z \\rightarrow l_2$\n- $l_2 \\rightarrow h$\n- $h \\rightarrow t$\n\n假设使用编译器理论中的标准定义：\n- 如果从 $s$ 到 $n$ 的每条路径都包含 $d$，则节点 $d$ 支配节点 $n$。\n- 如果 $v$ 支配 $u$，则边 $(u,v)$ 是一条回边（back edge）。\n- 给定一条回边 $(u,v)$，其自然循环（natural loop）是集合 $\\{v\\} \\cup \\{ n \\mid \\text{存在一条从 } n \\text{ 到 } u \\text{ 且不经过 } v \\text{ 的路径} \\}$。\n- 对于一个有多个闩锁节点（latch node） $l_i$ 且存在回边 $(l_i,h)$ 的头节点（header）$h$，循环 $L(h)$ 是由这些回边导出的、且以 $h$ 为头节点的自然循环中的所有节点组成的集合。\n\n根据这些第一性原理的定义，判断下列关于边 $(l_1,h)$ 和 $(l_2,h)$ 以及以 $h$ 为头节点的所得自然循环的大小 $|L(h)|$ 的陈述中，哪一个是正确的。\n\nA. $(l_1,h)$ 和 $(l_2,h)$ 都是回边，因为 $h$ 支配 $l_1$ 和 $l_2$。自然循环 $L(h)$ 是各个独立自然循环的并集，即 $L(h)=\\{h,x,y,l_1,z,l_2\\}$，所以 $|L(h)|=6$。\n\nB. 只有 $(l_1,h)$ 是回边；$(l_2,h)$ 不是回边，因为 $h$ 不支配 $l_2$。在这种情况下，$L(h)=\\{h,x,y,l_1\\}$ 且 $|L(h)|=4$。\n\nC. $(l_1,h)$ 和 $(l_2,h)$ 都是回边，但是 $L(h)$ 等于两个独立自然循环中较大的一个，即 $L(h)=\\{h,x,y,l_1\\}$，所以 $|L(h)|=4$。\n\nD. 回边的状态取决于深度优先搜索（DFS）的选择，因此根据 DFS 树的不同，$|L(h)|$ 的大小可能是4或6；$L(h)$ 并非仅由图唯一确定。", "solution": "首先评估问题陈述的有效性。\n\n**步骤1：提取已知条件**\n- **节点集：** $\\{s, h, x, y, z, l_1, l_2, t\\}$\n- **入口节点：** $s$\n- **出口节点：** $t$\n- **有向边：** $s \\rightarrow h$, $h \\rightarrow x$, $x \\rightarrow y$, $y \\rightarrow l_1$, $l_1 \\rightarrow h$, $h \\rightarrow z$, $z \\rightarrow l_2$, $l_2 \\rightarrow h$, $h \\rightarrow t$.\n- **支配的定义：** 如果从入口节点 $s$到节点 $n$ 的每条路径都必须包含节点 $d$，则节点 $d$ 支配节点 $n$。\n- **回边的定义：** 如果一条边 $(u,v)$ 的头节点 $v$ 支配其尾节点 $u$，则该边是回边。\n- **边 $(u,v)$ 的自然循环的定义：** 集合 $\\{v\\} \\cup \\{ n \\mid \\text{存在一条从 } n \\text{ 到 } u \\text{ 且不经过 } v \\text{ 的路径} \\}$。\n- **循环 $L(h)$ 的定义：** 对于一个有多个闩锁节点 $l_i$ 形成回边 $(l_i,h)$ 的头节点 $h$，循环 $L(h)$ 是由这些回边导出的自然循环中的所有节点组成的集合。这通常被解释为各个独立自然循环的并集。\n\n**步骤2：使用已知条件进行验证**\n该问题定义明确，在编译器理论领域有科学依据。它提供了一个完整的控制流图（CFG）和一套关于支配、回边和自然循环的一致的标准定义。问题是客观的，其解可以通过严格应用这些定义来确定。该问题不是病态的、模棱两可的或微不足道的。回边的定义基于支配关系，这是图本身的一种属性，与任何遍历算法（如深度优先搜索（DFS））无关。\n\n**步骤3：结论与行动**\n问题陈述有效。将推导解答。\n\n**推导过程**\n\n解答需要基于所提供的定义进行三部分分析：\n1.  确定图中节点的支配节点，特别是检查 $h$ 是否支配 $l_1$ 和 $l_2$。\n2.  识别边 $(l_1,h)$ 和 $(l_2,h)$ 中哪些是回边。\n3.  为所有已识别的回边计算自然循环，并将它们组合起来以求得 $L(h)$ 及其大小 $|L(h)|$。\n\n**1. 支配分析**\n入口节点是 $s$。离开 $s$ 的唯一一条边是 $s \\rightarrow h$。因此，从 $s$ 到图中任何其他节点的任何路径都必须经过 $h$。\n根据支配的定义（“如果从 $s$ 到 $n$ 的每条路径都包含 $d$，则节点 $d$ 支配节点 $n$”），节点 $h$ 支配图中除 $s$ 自身以外的所有节点。\n具体来说：\n- 从 $s$ 到 $l_1$ 的每条路径（例如，$s \\rightarrow h \\rightarrow x \\rightarrow y \\rightarrow l_1$）都必须包含 $h$。因此，$h$ 支配 $l_1$。\n- 从 $s$ 到 $l_2$ 的每条路径（例如，$s \\rightarrow h \\rightarrow z \\rightarrow l_2$）都必须包含 $h$。因此，$h$ 支配 $l_2$。\n\n**2. 回边识别**\n回边是边 $(u,v)$，其中 $v$ 支配 $u$。我们检查所讨论的两条边，它们的头节点都是 $h$（即 $v=h$）。\n- 对于边 $(l_1, h)$：尾节点是 $u=l_1$，头节点是 $v=h$。根据我们的支配分析，$h$ 支配 $l_1$。因此，$(l_1, h)$ 是一条回边。\n- 对于边 $(l_2, h)$：尾节点是 $u=l_2$，头节点是 $v=h$。根据我们的支配分析，$h$ 支配 $l_2$。因此，$(l_2, h)$ 是一条回边。\n\n$(l_1,h)$ 和 $(l_2,h)$ 都是回边。\n\n**3. 自然循环计算**\n循环 $L(h)$ 是所有进入头节点 $h$ 的回边的自然循环的并集。\n\n- **$(l_1, h)$ 的自然循环：** 设其为 $N_1$。根据定义，$N_1 = \\{h\\} \\cup \\{ n \\mid \\text{存在一条从 } n \\text{ 到 } l_1 \\text{ 且不经过 } h \\text{ 的路径} \\}$。\n  为了找到并集中的第二部分节点，我们必须找到所有不经过 $h$ 就能到达 $l_1$ 的节点。我们可以通过从 $l_1$ 开始反向遍历图，并避开任何需要经过 $h$ 的路径来实现。\n  - $l_1$ 可从自身到达。\n  - $l_1$ 的前驱节点是 $\\{y\\}$。路径 $y \\rightarrow l_1$ 不包含 $h$，所以 $y$ 在集合中。\n  - $y$ 的前驱节点是 $\\{x\\}$。路径 $x \\rightarrow y \\rightarrow l_1$ 不包含 $h$，所以 $x$ 在集合中。\n  - $x$ 的前驱节点是 $\\{h\\}$。从图的其他部分（例如，从 $z$）到 $x$ 的任何路径都必须经过 $h$。因此，没有其他节点可以在不经过 $h$ 的情况下到达 $l_1$。\n  不经过 $h$ 就能到达 $l_1$ 的节点集合是 $\\{x, y, l_1\\}$。\n  因此，$N_1 = \\{h\\} \\cup \\{x, y, l_1\\} = \\{h, x, y, l_1\\}$。其大小为 $|N_1| = 4$。\n\n- **$(l_2, h)$ 的自然循环：** 设其为 $N_2$。根据定义，$N_2 = \\{h\\} \\cup \\{ n \\mid \\text{存在一条从 } n \\text{ 到 } l_2 \\text{ 且不经过 } h \\text{ 的路径} \\}$。\n  我们从 $l_2$ 开始执行类似的反向遍历。\n  - $l_2$ 可从自身到达。\n  - $l_2$ 的前驱节点是 $\\{z\\}$。路径 $z \\rightarrow l_2$ 不包含 $h$，所以 $z$ 在集合中。\n  - $z$ 的前驱节点是 $\\{h\\}$。到 $z$ 的任何其他路径都必须经过 $h$。\n  不经过 $h$ 就能到达 $l_2$ 的节点集合是 $\\{z, l_2\\}$。\n  因此，$N_2 = \\{h\\} \\cup \\{z, l_2\\} = \\{h, z, l_2\\}$。其大小为 $|N_2| = 3$。\n\n- **组合循环 $L(h)$：** 以 $h$ 为头节点的完整循环是所有进入 $h$ 的回边的自然循环的并集。\n  $L(h) = N_1 \\cup N_2 = \\{h, x, y, l_1\\} \\cup \\{h, z, l_2\\}$\n  $L(h) = \\{h, x, y, l_1, z, l_2\\}$\n  该循环的大小是 $|L(h)| = 6$。\n\n**逐项分析**\n\n**A. $(l_1,h)$ 和 $(l_2,h)$ 都是回边，因为 $h$ 支配 $l_1$ 和 $l_2$。自然循环 $L(h)$ 是各个独立自然循环的并集，即 $L(h)=\\{h,x,y,l_1,z,l_2\\}$，所以 $|L(h)|=6$。**\n- 该陈述正确地指出了两条边都是回边，原因也正确（$h$ 支配 $l_1$ 和 $l_2$）。它正确地将组合循环定义为各个独立自然循环的并集。它正确地计算出此并集为 $\\{h,x,y,l_1,z,l_2\\}$，并正确地指出其大小为 $6$。该陈述的所有部分都与我们的推导一致。\n- 结论：**正确**。\n\n**B. 只有 $(l_1,h)$ 是回边；$(l_2,h)$ 不是回边，因为 $h$ 不支配 $l_2$。在这种情况下，$L(h)=\\{h,x,y,l_1\\}$ 且 $|L(h)|=4$。**\n- “$h$ 不支配 $l_2$”的断言是错误的。如前所述，$h$ 支配除 $s$ 之外的所有节点。因此，$(l_2,h)$ 不是回边的说法也是错误的。后续对 $L(h)$ 的计算是基于这个不正确的前提。\n- 结论：**不正确**。\n\n**C. $(l_1,h)$ 和 $(l_2,h)$ 都是回边，但是 $L(h)$ 等于两个独立自然循环中较大的一个，即 $L(h)=\\{h,x,y,l_1\\}$，所以 $|L(h)|=4$。**\n- 第一部分，“$(l_1,h)$ 和 $(l_2,h)$ 都是回边”是正确的。然而，声称 $L(h)$ 是两个循环中*较大*的一个，这并非标准定义，并且与取并集的常规做法相矛盾。最终得到的集合和大小都是不正确的。组合循环必须包含来自两个独立循环的所有节点。\n- 结论：**不正确**。\n\n**D. 回边的状态取决于深度优先搜索（DFS）的选择，因此根据 DFS 树的不同，$|L(h)|$ 的大小可能是4或6；$L(h)$ 并非仅由图唯一确定。**\n- 问题明确地提供了基于支配关系的回边定义，而不是基于 DFS 遍历。支配关系是 CFG 的内在属性，不依赖于任何特定的遍历顺序。因此，回边仅由图结构唯一确定。其结果是，自然循环及其并集也是唯一确定的。在问题给定定义的背景下，此选项的前提是无效的。\n- 结论：**不正确**。", "answer": "$$\\boxed{A}$$", "id": "3652277"}, {"introduction": "并非所有循环都具有良好结构。本练习将引导您分析一个包含“跳转到循环中部”的非结构化控制流，这会导致一个不可规约循环（irreducible loop）的形成 [@problem_id:3652294]。通过计算支配节点和识别回边，您将发现为什么有些循环不满足“单一入口头节点支配循环中所有节点”的特性，并理解区分可规约与不可规约循环在编译器优化中的重要性。", "problem": "考虑一个带有标签语句和 `goto` 的程序片段，它有意地跳转到迭代结构的中间。该片段被组织成具有唯一数字标识符的基本块，入口在块 $1$；这些块如下所示，使用标签 $L_{\\text{hdr}}$ 表示预期的循环头，使用标签 $L_{\\text{mid}}$ 表示循环体中标注的中间位置：\n\n- 块 $1$：初始化；条件分支到块 $2$ 或块 $6$。\n- 块 $2$ ($L_{\\text{hdr}}$)：条件分支；如果循环继续条件成立，则分支到块 $3$，否则分支到块 $8$（出口）。\n- 块 $3$：无条件 `goto` 到 $L_{\\text{mid}}$（块 $4$）。\n- 块 $4$ ($L_{\\text{mid}}$)：条件分支；如果条件成立，则分支到块 $5$，否则分支到块 $7$。\n- 块 $5$：无条件 `goto` 到 $L_{\\text{mid}}$（块 $4$）。\n- 块 $6$：无条件 `goto` 到 $L_{\\text{mid}}$（块 $4$）。这是一个从外部跳转到循环中间的跳转。\n- 块 $7$：无条件 `goto` 到块 $2$（$L_{\\text{hdr}}$）。\n- 块 $8$：出口。\n\n构造控制流图（Control Flow Graph, CFG）$G$，其节点为 $\\{1,2,3,4,5,6,7,8\\}$，有向边由所述的控制转移给出：$1 \\to 2$、$1 \\to 6$、$2 \\to 3$、$2 \\to 8$、$3 \\to 4$、$4 \\to 5$、$4 \\to 7$、$5 \\to 4$、$6 \\to 4$、$7 \\to 2$。\n\n从基本定义开始：\n- 在流图中，如果从入口节点到节点 $n$ 的每条路径都经过节点 $d$，则称节点 $d$ 支配节点 $n$。\n- 如果边 $(u,v)$ 的头节点 $v$ 支配其尾节点 $u$，则该边是一条回边。\n- 如果一个环有一个单一入口的头节点，该头节点支配环中所有节点，则该环是可规约的；否则，它是不可规约的。\n\n仅使用这些定义和一个标准的用于支配节点的迭代数据流公式，确定所有节点的支配节点集，识别 $G$ 中的所有回边，并评估由路径 $2 \\to 3 \\to 4 \\to 7 \\to 2$ 形成的环 $C$ 是可规约的还是不可规约的。最后，如果环 $C$ 是可规约的，则令 $r$ 为 $1$，否则为 $0$；并令 $\\mathcal{B}$ 为 $G$ 中所有回边的集合。计算值\n$$\nS \\;=\\; r \\;+\\; \\sum_{(u,v)\\in \\mathcal{B}} \\big(u + 2v\\big).\n$$\n以精确整数形式提供 $S$。无需四舍五入，答案中不包含单位。", "solution": "该问题要求通过分析给定的控制流图（CFG）$G$ 来计算一个值 $S$。该分析涉及三个主要阶段：计算支配节点集、识别回边和评估特定环的可规约性。最终值由公式 $S = r + \\sum_{(u,v)\\in \\mathcal{B}} (u + 2v)$ 给出，其中 $r$ 反映了环 $C=2 \\to 3 \\to 4 \\to 7 \\to 2$ 的可规约性，而 $\\mathcal{B}$ 是 $G$ 中所有回边的集合。\n\n首先，我们建立 CFG $G=(N, E, n_0)$ 的结构，其中节点集为 $N=\\{1, 2, 3, 4, 5, 6, 7, 8\\}$，入口节点为 $n_0=1$，边集 $E$ 由指定的控制转移给出。为了计算支配节点集，我们首先确定每个节点 $n \\in N$ 的前驱节点集 $\\text{pred}(n)$：\n- $\\text{pred}(1) = \\emptyset$\n- $\\text{pred}(2) = \\{1, 7\\}$\n- $\\text{pred}(3) = \\{2\\}$\n- $\\text{pred}(4) = \\{3, 5, 6\\}$\n- $\\text{pred}(5) = \\{4\\}$\n- $\\text{pred}(6) = \\{1\\}$\n- $\\text{pred}(7) = \\{4\\}$\n- $\\text{pred}(8) = \\{2\\}$\n\n一个节点 $n$ 的支配节点集，记为 $D(n)$，使用基于以下方程的迭代数据流分析框架进行计算：\n$$ D(n_0) = \\{n_0\\} $$\n$$ D(n) = \\{n\\} \\cup \\bigcap_{p \\in \\text{pred}(n)} D(p) \\quad \\text{for } n \\neq n_0 $$\n我们初始化集合为 $D(1) = \\{1\\}$ 和对于所有 $n \\in \\{2, 3, 4, 5, 6, 7, 8\\}$，$D(n) = N$。然后我们进行迭代，直到达到不动点。\n\n迭代 1：\n- $D(1) = \\{1\\}$\n- $D(2) = \\{2\\} \\cup (D(1) \\cap D(7))_{\\text{old}} = \\{2\\} \\cup (\\{1\\} \\cap \\{1, 2, 3, 4, 5, 6, 7, 8\\}) = \\{1, 2\\}$\n- $D(3) = \\{3\\} \\cup D(2) = \\{3\\} \\cup \\{1, 2\\} = \\{1, 2, 3\\}$\n- $D(6) = \\{6\\} \\cup D(1) = \\{6\\} \\cup \\{1\\} = \\{1, 6\\}$\n- $D(8) = \\{8\\} \\cup D(2) = \\{8\\} \\cup \\{1, 2\\} = \\{1, 2, 8\\}$\n- $D(4) = \\{4\\} \\cup (D(3) \\cap D(5)_{\\text{old}} \\cap D(6)) = \\{4\\} \\cup (\\{1, 2, 3\\} \\cap N \\cap \\{1, 6\\}) = \\{4\\} \\cup \\{1\\} = \\{1, 4\\}$\n- $D(5) = \\{5\\} \\cup D(4) = \\{5\\} \\cup \\{1, 4\\} = \\{1, 4, 5\\}$\n- $D(7) = \\{7\\} \\cup D(4) = \\{7\\} \\cup \\{1, 4\\} = \\{1, 4, 7\\}$\n\n第一次迭代后，集合为：\n- $D(1) = \\{1\\}$\n- $D(2) = \\{1, 2\\}$\n- $D(3) = \\{1, 2, 3\\}$\n- $D(4) = \\{1, 4\\}$\n- $D(5) = \\{1, 4, 5\\}$\n- $D(6) = \\{1, 6\\}$\n- $D(7) = \\{1, 4, 7\\}$\n- $D(8) = \\{1, 2, 8\\}$\n\n迭代 2：我们使用第一次迭代的值重新计算集合。\n- $D(2) = \\{2\\} \\cup (D(1) \\cap D(7)) = \\{2\\} \\cup (\\{1\\} \\cap \\{1, 4, 7\\}) = \\{1, 2\\}$ （无变化）\n- $D(3) = \\{3\\} \\cup D(2) = \\{3\\} \\cup \\{1, 2\\} = \\{1, 2, 3\\}$ （无变化）\n- $D(4) = \\{4\\} \\cup (D(3) \\cap D(5) \\cap D(6)) = \\{4\\} \\cup (\\{1, 2, 3\\} \\cap \\{1, 4, 5\\} \\cap \\{1, 6\\}) = \\{4\\} \\cup \\{1\\} = \\{1, 4\\}$ （无变化）\n由于所有其他节点的支配节点集都依赖于这些集合，并且它们的输入没有改变，所以它们自身的集合也不会改变。算法已经收敛到不动点。\n\n最终的支配节点集为：\n$D(1) = \\{1\\}$、$D(2) = \\{1, 2\\}$、$D(3) = \\{1, 2, 3\\}$、$D(4) = \\{1, 4\\}$、$D(5) = \\{1, 4, 5\\}$、$D(6) = \\{1, 6\\}$、$D(7) = \\{1, 4, 7\\}$、$D(8) = \\{1, 2, 8\\}$。\n\n接下来，我们识别回边。如果一条边 $(u,v)$ 的头节点 $v$ 支配其尾节点 $u$，即 $v \\in D(u)$，那么它就是一条回边。我们对 $E = \\{(1,2), (1,6), (2,3), (2,8), (3,4), (4,5), (4,7), (5,4), (6,4), (7,2)\\}$ 中的所有边检查此条件。\n- 边 $(1,2)$：$2 \\notin D(1)=\\{1\\}$。不是回边。\n- 边 $(1,6)$：$6 \\notin D(1)=\\{1\\}$。不是回边。\n- 边 $(2,3)$：$3 \\notin D(2)=\\{1, 2\\}$。不是回边。\n- 边 $(2,8)$：$8 \\notin D(2)=\\{1, 2\\}$。不是回边。\n- 边 $(3,4)$：$4 \\notin D(3)=\\{1, 2, 3\\}$。不是回边。\n- 边 $(4,5)$：$5 \\notin D(4)=\\{1, 4\\}$。不是回边。\n- 边 $(4,7)$：$7 \\notin D(4)=\\{1, 4\\}$。不是回边。\n- 边 $(5,4)$：$4 \\in D(5)=\\{1, 4, 5\\}$。这是一条回边。\n- 边 $(6,4)$：$4 \\notin D(6)=\\{1, 6\\}$。不是回边。\n- 边 $(7,2)$：$2 \\notin D(7)=\\{1, 4, 7\\}$。不是回边。路径 $1 \\to 6 \\to 4 \\to 7$ 到达节点 $7$ 而不经过节点 $2$，所以 $2$ 不支配 $7$。\n因此，回边的集合是 $\\mathcal{B} = \\{(5,4)\\}$。\n\n现在，我们评估由路径 $2 \\to 3 \\to 4 \\to 7 \\to 2$ 形成的环 $C$ 的可规约性。该环中的节点为 $V_C = \\{2, 3, 4, 7\\}$。如果一个环有一个单一入口的头节点，并且该头节点支配环中所有其他节点，则该环是可规约的。环的入口节点（或头节点）是环内的一个节点，它有一个在环外的前驱节点。\n- 对于节点 $2 \\in V_C$，其前驱节点是 $\\{1, 7\\}$。由于 $1 \\notin V_C$，节点 $2$ 是一个入口节点。\n- 对于节点 $3 \\in V_C$，其前驱节点是 $\\{2\\}$。由于 $2 \\in V_C$，节点 $3$ 不是一个入口节点。\n- 对于节点 $4 \\in V_C$，其前驱节点是 $\\{3, 5, 6\\}$。由于 $5 \\notin V_C$ 且 $6 \\notin V_C$，节点 $4$ 是一个入口节点。\n环 $C$ 有两个入口节点，$2$ 和 $4$。根据定义，具有多个入口的环是不可规约环。因此，环 $C$ 是不可规约的。这意味着参数 $r$ 为 $0$。\n\n最后，我们计算 $S$ 的值。\n$$ S = r + \\sum_{(u,v)\\in \\mathcal{B}} (u + 2v) $$\n代入已确定的值，$r=0$ 和 $\\mathcal{B}=\\{(5,4)\\}$，我们得到：\n$$ S = 0 + (5 + 2 \\times 4) $$\n$$ S = 5 + 8 $$\n$$ S = 13 $$\n最终值为 $13$。", "answer": "$$\\boxed{13}$$", "id": "3652294"}]}