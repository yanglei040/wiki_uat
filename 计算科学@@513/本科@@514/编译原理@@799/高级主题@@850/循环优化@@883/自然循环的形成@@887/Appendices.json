{"hands_on_practices": [{"introduction": "理论学习之后，最佳的巩固方式莫过于亲手实践。这个练习将引导你处理一个具体的控制流图（CFG），通过按部就班地应用形式化定义，来识别程序中的循环结构。你将首先计算支配节点，然后利用支配关系找出后向边，并最终确定每个自然循环的关键组成部分——闩锁（latch），从而为编译器的循环优化打下坚实的基础。[@problem_id:3659023]", "problem": "给定一个可规约控制流图 (CFG) $G=(V,E)$，其具有唯一入口节点 $s$ 和节点集 $V=\\{1,2,3,4,5,6,7,8,9,10\\}$。其有向边集为\n$$\nE=\\{(1,2),(2,3),(3,4),(4,5),(5,3),(4,6),(6,7),(7,4),(4,8),(8,9),(9,8),(9,10)\\}.\n$$\n从基本定义开始：\n- 如果从 $s$到 $b$ 的每一条路径都包含 $a$，则称节点 $a$ 支配节点 $b$（记作“$a$ 支配 $b$”）。\n- 对于节点 $n\\neq s$，其直接支配节点 $\\operatorname{idom}(n)$ 是 $n$ 的唯一的严格支配节点，该节点支配 $n$ 的所有其他严格支配节点。\n- 当且仅当 $h$ 支配 $t$ 时，边 $(t,h)$ 是一条回边。\n- 对于一条回边 $(t,h)$，与头节点 $h$ 相关联的自然循环 $L(h)$ 是包含 $h$ 和 $t$ 的最小节点集，使得对于任何节点 $x\\in L(h)\\setminus\\{h\\}$，都存在一条从 $x$ 到 $t$ 的路径，该路径不经过 $h$ 且其所有节点都在 $L(h)$ 中。\n- 闩锁节点是指一个节点 $l$，它有一条边 $(l,h)$ 指向循环头节点 $h$，满足 $l\\in L(h)$，并且从 $h$ 回到 $h$ 的每个环路在紧邻 $h$ 之前都经过 $l$。\n\n任务：\n1. 使用入口为 $s=1$ 的支配定义，为每个节点 $n\\in V\\setminus\\{1\\}$ 推导出其 $\\operatorname{idom}(n)$。\n2. 通过检查头尾节点上的支配条件，识别出所有的回边 $(t,h)$。\n3. 对于此图 $G$ 中的每条回边 $(t,h)$，使用上述定义来论证：如果 $\\operatorname{idom}(h)\\neq t$，那么在此图中 $t$ 是 $L(h)$ 的闩锁节点。枚举出 $G$ 中所有这样的闩锁节点 $t$，并验证每个自然循环 $L(h)$ 都有唯一的闩锁节点。\n4. 设 $S$ 为你在第3项中枚举出的所有闩锁节点的数字标签之和。计算 $S$。\n\n给出 $S$ 的最终值，为一个整数。无需四舍五入。", "solution": "问题要求我们分析一个给定的控制流图 (CFG) $G=(V,E)$，以识别其自然循环和相关的闩锁节点，然后计算这些闩锁节点标签的总和。整个过程将遵循问题陈述中指定的四个任务。\n\n给定的CFG有一个节点集 $V=\\{1,2,3,4,5,6,7,8,9,10\\}$ 和一个边集 $E=\\{(1,2),(2,3),(3,4),(4,5),(5,3),(4,6),(6,7),(7,4),(4,8),(8,9),(9,8),(9,10)\\}$。唯一的入口节点是 $s=1$。\n\n**任务1：为每个节点 $n\\in V\\setminus\\{1\\}$ 推导出其直接支配节点 $\\operatorname{idom}(n)$。**\n\n如果从入口节点 $s=1$ 到节点 $b$ 的每一条路径都包含节点 $a$，则称 $a$ 支配 $b$。直接支配节点 $\\operatorname{idom}(n)$ 是 $n$ 的严格支配节点中，在任何从 $s$ 出发的路径上离 $n$ 最近的那个。\n\n- **节点 2**: 从 $1$ 出发的唯一路径是 $1 \\to 2$。$2$ 的支配节点集是 $\\{1, 2\\}$。严格支配节点集是 $\\{1\\}$。因此，$\\operatorname{idom}(2)=1$。\n- **节点 3**: 任何到 $3$ 的路径都必须先经过 $1 \\to 2$。例如，$1 \\to 2 \\to 3$。另一条路径可能是 $1 \\to 2 \\to 3 \\to 4 \\to 5 \\to 3$，但也经过了 $2$。$3$ 的支配节点集是 $\\{1, 2, 3\\}$。因此，$\\operatorname{idom}(3)=2$。\n- **节点 4**: 任何到 $4$ 的路径都必须先经过 $1 \\to 2 \\to 3$。例如，$1 \\to 2 \\to 3 \\to 4$。$4$ 的支配节点集是 $\\{1, 2, 3, 4\\}$。因此，$\\operatorname{idom}(4)=3$。\n- **节点 5**: 任何到 $5$ 的路径都必须通过边 $(4,5)$ 经过 $4$。$5$ 的支配节点集是 $\\{1, 2, 3, 4, 5\\}$。因此，$\\operatorname{idom}(5)=4$。\n- **节点 6**: 任何到 $6$ 的路径都必须通过边 $(4,6)$ 经过 $4$。$6$ 的支配节点集是 $\\{1, 2, 3, 4, 6\\}$。因此，$\\operatorname{idom}(6)=4$。\n- **节点 7**: 任何到 $7$ 的路径都必须通过边 $(6,7)$ 经过 $6$。$7$ 的支配节点集是 $\\{1, 2, 3, 4, 6, 7\\}$。因此，$\\operatorname{idom}(7)=6$。\n- **节点 8**: 任何到 $8$ 的路径都必须经过 $4$。$8$ 的支配节点集是 $\\{1, 2, 3, 4, 8\\}$。因此，$\\operatorname{idom}(8)=4$。\n- **节点 9**: 任何到 $9$ 的路径都必须通过边 $(8,9)$ 经过 $8$。$9$ 的支配节点集是 $\\{1, 2, 3, 4, 8, 9\\}$。因此，$\\operatorname{idom}(9)=8$。\n- **节点 10**: 任何到 $10$ 的路径都必须通过边 $(9,10)$ 经过 $9$。$10$ 的支配节点集是 $\\{1, 2, 3, 4, 8, 9, 10\\}$。因此，$\\operatorname{idom}(10)=9$。\n\n支配关系集 $\\operatorname{dom}(n)$ 和直接支配节点 $\\operatorname{idom}(n)$ 如下：\n- $\\operatorname{dom}(2) = \\{1,2\\}$, $\\operatorname{idom}(2)=1$\n- $\\operatorname{dom}(3) = \\{1,2,3\\}$, $\\operatorname{idom}(3)=2$\n- $\\operatorname{dom}(4) = \\{1,2,3,4\\}$, $\\operatorname{idom}(4)=3$\n- $\\operatorname{dom}(5) = \\{1,2,3,4,5\\}$, $\\operatorname{idom}(5)=4$\n- $\\operatorname{dom}(6) = \\{1,2,3,4,6\\}$, $\\operatorname{idom}(6)=4$\n- $\\operatorname{dom}(7) = \\{1,2,3,4,6,7\\}$, $\\operatorname{idom}(7)=6$\n- $\\operatorname{dom}(8) = \\{1,2,3,4,8\\}$, $\\operatorname{idom}(8)=4$\n- $\\operatorname{dom}(9) = \\{1,2,3,4,8,9\\}$, $\\operatorname{idom}(9)=8$\n- $\\operatorname{dom}(10) = \\{1,2,3,4,8,9,10\\}$, $\\operatorname{idom}(10)=9$\n\n**任务2：识别所有的回边 $(t,h)$。**\n\n一条有向边 $(t,h)$ 是回边，如果其头节点 $h$ 支配其尾节点 $t$。我们检查 $E$ 中的每一条边：\n- $(1,2)$: $2$ 不支配 $1$。\n- $(2,3)$: $3$ 不支配 $2$。\n- $(3,4)$: $4$ 不支配 $3$。\n- $(4,5)$: $5$ 不支配 $4$。\n- $(5,3)$: $3$ 是否支配 $5$？是的，$3 \\in \\operatorname{dom}(5)=\\{1,2,3,4,5\\}$。这是一条回边，其中 $t=5, h=3$。\n- $(4,6)$: $6$ 不支配 $4$。\n- $(6,7)$: $7$ 不支配 $6$。\n- $(7,4)$: $4$ 是否支配 $7$？是的，$4 \\in \\operatorname{dom}(7)=\\{1,2,3,4,6,7\\}$。这是一条回边，其中 $t=7, h=4$。\n- $(4,8)$: $8$ 不支配 $4$。\n- $(8,9)$: $9$ 不支配 $8$。\n- $(9,8)$: $8$ 是否支配 $9$？是的，$8 \\in \\operatorname{dom}(9)=\\{1,2,3,4,8,9\\}$。这是一条回边，其中 $t=9, h=8$。\n- $(9,10)$: $10$ 不支配 $9$。\n\n回边集合为 $\\{(5,3), (7,4), (9,8)\\}$。\n\n**任务3：分析回边并识别闩锁节点。**\n\n我们必须论证，对于此图中的每条回边 $(t,h)$，如果 $\\operatorname{idom}(h) \\neq t$，则 $t$ 是自然循环 $L(h)$ 的闩锁节点。我们还要枚举这些闩锁节点 $t$ 并验证每个循环的闩锁节点唯一性。\n\n循环头节点为 $h$ 的循环的闩锁节点 $l$ 必须满足：\n1. 有一条边 $(l,h)$。\n2. $l \\in L(h)$。\n3. 从 $h$ 回到 $h$ 的每个环路在紧邻 $h$ 之前都经过 $l$。\n\n对于回边 $(t,h)$，其自然循环 $L(h)$ 由 $h$ 以及所有可以不经过 $h$ 到达 $t$ 的节点组成。\n\n**情况1：回边 $(t,h) = (5,3)$**\n- **条件检查**: $\\operatorname{idom}(h)=\\operatorname{idom}(3)=2$。尾节点是 $t=5$。因为 $2 \\neq 5$，所以条件 $\\operatorname{idom}(h)\\neq t$ 成立。\n- **自然循环 $L(3)$**: 我们寻找可以不经过 $h=3$ 到达 $t=5$ 的节点集。\n  - 从 $5$ 开始反向搜索：$5$ 的前驱节点是 $4$。路径 $4 \\to 5$ 不包含 $3$。所以 $4 \\in L(3)$。\n  - $4$ 的前驱节点是 $3$ 和 $7$。来自 $3$ 的路径被阻塞。来自 $7$ 的路径继续：$7 \\to 4 \\to 5$ 不包含 $3$。所以 $7 \\in L(3)$。\n  - $7$ 的前驱节点是 $6$。路径 $6 \\to 7 \\to 4 \\to 5$ 不包含 $3$。所以 $6 \\in L(3)$。\n  - $6$ 的前驱节点是 $4$，它已在集合中。\n  可以不经过 $3$ 到达 $5$ 的节点是 $\\{4,5,6,7\\}$。\n  因此，$L(3) = \\{3\\} \\cup \\{4,5,6,7\\} = \\{3,4,5,6,7\\}$。\n- **闩锁节点识别**: 头节点 $h=3$ 的前驱节点是 $\\{2, 5\\}$。我们检查其中哪些在 $L(3)$ 内。\n  - $2 \\notin L(3)$，所以 $2$ 不是闩锁节点。\n  - $5 \\in L(3)$，所以 $5$ 是闩锁节点的候选者。\n  唯一从其自身循环 $L(3)$ 内部进入 $h=3$ 的边是 $(5,3)$。任何从 $3$ 开始并结束于 $3$ 的环路必须从 $L(3)$ 内的一个节点重新进入 $3$。唯一这样的节点是 $5$。因此，$5$ 是 $L(3)$ 的唯一闩锁节点。\n- **结论**: 条件成立，尾节点 $t=5$ 确实是唯一的闩锁节点。\n\n**情况2：回边 $(t,h) = (7,4)$**\n- **条件检查**: $\\operatorname{idom}(h)=\\operatorname{idom}(4)=3$。尾节点是 $t=7$。因为 $3 \\neq 7$，所以条件 $\\operatorname{idom}(h)\\neq t$ 成立。\n- **自然循环 $L(4)$**: 我们寻找可以不经过 $h=4$ 到达 $t=7$ 的节点。\n  - 从 $7$ 开始反向搜索：$7$ 的前驱节点是 $6$。路径 $6 \\to 7$ 不包含 $4$。所以 $6 \\in L(4)$。\n  - $6$ 的前驱节点是 $4$。此路径被阻塞。\n  可以不经过 $4$ 到达 $7$ 的节点是 $\\{6,7\\}$。\n  因此，$L(4) = \\{4\\} \\cup \\{6,7\\} = \\{4,6,7\\}$。\n- **闩锁节点识别**: 头节点 $h=4$ 的前驱节点是 $\\{3, 7\\}$。我们检查哪些在 $L(4)$ 内。\n  - $3 \\notin L(4)$，所以 $3$ 不是闩锁节点。\n  - $7 \\in L(4)$，所以 $7$ 是闩锁节点的候选者。\n  唯一从其循环 $L(4)$ 内部进入 $h=4$ 的边是 $(7,4)$。因此，$7$ 是 $L(4)$ 的唯一闩锁节点。\n- **结论**: 条件成立，尾节点 $t=7$ 是唯一的闩锁节点。\n\n**情况3：回边 $(t,h) = (9,8)$**\n- **条件检查**: $\\operatorname{idom}(h)=\\operatorname{idom}(8)=4$。尾节点是 $t=9$。因为 $4 \\neq 9$，所以条件 $\\operatorname{idom}(h)\\neq t$ 成立。\n- **自然循环 $L(8)$**: 我们寻找可以不经过 $h=8$ 到达 $t=9$ 的节点。\n  - 从 $9$ 开始反向搜索：$9$ 的唯一前驱节点是 $8$。任何到 $9$ 的路径都必须经过 $8$。唯一的例外是从 $9$ 到自身的平凡零长度路径。\n  唯一可以不经过 $8$ 到达 $9$ 的节点是 $9$ 本身。\n  因此，$L(8) = \\{8\\} \\cup \\{9\\} = \\{8,9\\}$。\n- **闩锁节点识别**: 头节点 $h=8$ 的前驱节点是 $\\{4, 9\\}$。我们检查哪些在 $L(8)$ 内。\n  - $4 \\notin L(8)$，所以 $4$ 不是闩锁节点。\n  - $9 \\in L(8)$，所以 $9$ 是闩锁节点的候选者。\n  唯一从其循环 $L(8)$ 内部进入 $h=8$ 的边是 $(9,8)$。因此，$9$ 是 $L(8)$ 的唯一闩锁节点。\n- **结论**: 条件成立，尾节点 $t=9$ 是唯一的闩锁节点。\n\n在所有三种情况下，前提 $\\operatorname{idom}(h) \\neq t$ 为真，且结论 $t$ 是 $L(h)$ 的唯一闩锁节点也为真。问题所要求的论证对于这个特定的图 $G$ 成立。枚举出的闩锁节点为 $\\{5, 7, 9\\}$。\n\n**任务4：计算闩锁节点标签的总和 $S$。**\n\n闩锁节点集合是 $\\{5, 7, 9\\}$。它们的数字标签之和 $S$ 是：\n$$S = 5 + 7 + 9 = 21$$", "answer": "$$\n\\boxed{21}\n$$", "id": "3659023"}, {"introduction": "在程序的控制流图中，并非所有环路都能被编译器有效识别和优化。这个练习探讨一个核心问题：是什么让一个循环成为“自然循环”？通过分析一个因具有多个入口而结构“不规范”的循环，你将深入理解单一、起支配作用的循环头（header）对于形成自然循环的决定性作用，并探索如何通过图变换来构建这种优良结构。[@problem_id:3659109]", "problem": "考虑一个使用无条件转移（$goto$）编写的程序片段，其控制流图（CFG）由带标签的基本块 $L_1, L_2, L_3, L_4, L_5, L_6$ 构成，其中的有向边由 $goto$ 结构导出：\n- $L_1$: if $x  0$ then $goto\\ L_3$ else $goto\\ L_2$,\n- $L_2$: $y := y + 1$; $goto\\ L_3$,\n- $L_3$: if $y  10$ then $goto\\ L_4$ else $goto\\ L_6$,\n- $L_4$: $z := z - 1$; $goto\\ L_5$,\n- $L_5$: $goto\\ L_2$,\n- $L_6$: halt.\n\n由此，该CFG包含边 $L_1 \\to L_2$、$L_1 \\to L_3$、$L_2 \\to L_3$、$L_3 \\to L_4$、$L_3 \\to L_6$、$L_4 \\to L_5$ 和 $L_5 \\to L_2$。入口是 $L_1$。\n\n基本定义：\n- 控制流图（CFG）是一个有向图 $(V, E, s)$，其中顶点 $V$ 是基本块，边 $E$ 表示可能的控制转移，而 $s \\in V$ 是唯一的入口。\n- 对于节点 $u, v \\in V$，如果从 $s$ 到 $v$ 的每一条路径都包含 $u$，则称 $u$ 支配 $v$（记作 $u \\in \\mathrm{dom}(v)$）。\n- 如果 $h \\in \\mathrm{dom}(t)$，则边 $(t, h) \\in E$ 是一条回边。\n\n由 $\\{L_2, L_3, L_4, L_5\\}$ 导出的子图通过 $L_2 \\to L_3 \\to L_4 \\to L_5 \\to L_2$ 形成一个环，但它本身没有唯一的循环入口，因为存在多条来自 $L_1$ 的进入边（$L_1 \\to L_2$ 和 $L_1 \\to L_3$）。你的任务是确定在什么条件下，这个环可以通过插入一个新的、唯一的入口头节点 $h$ 并重新连接边，从而转换为一个自然循环，使得对于某条回边 $(t, h)$ 的尾部 $t$，满足 $h \\in \\mathrm{dom}(t)$。\n\n哪个选项正确地指明了必要的和充分的结构条件，作用于变换后的CFG上，以确保该环成为一个自然循环，且拥有一个满足 $h \\in \\mathrm{dom}(t)$ 的单一头节点 $h$？\n\nA. 插入一个新节点 $h$，并将每一条从 $\\{L_2, L_3, L_4, L_5\\}$ 外部节点进入该集合内任一节点的边，重定向到 $h$。从 $h$ 添加进入环的边，使得 $\\{L_2, L_3, L_4, L_5\\}$ 中的所有节点都可以从 $h$ 到达，且不会重新访问 $h$。选择一个尾部 $t \\in \\{L_2, L_3, L_4, L_5\\}$ 并添加一条边 $(t, h)$，并确保对于每个 $v \\in \\{L_2, L_3, L_4, L_5\\}$，都有 $h \\in \\mathrm{dom}(v)$（特别是 $h \\in \\mathrm{dom}(t)$）。除了通过 $h$ 之外，没有其他来自环外部的边可以进入 $\\{L_2, L_3, L_4, L_5\\}$。\n\nB. 在环内某处插入一个节点 $h$，并为某个 $t \\in \\{L_2, L_3, L_4, L_5\\}$ 添加一条边 $(h, t)$。要求 $t \\in \\mathrm{dom}(h)$ 并且环保持强连通；来自 $L_1$ 的边仍然可以直接进入环。\n\nC. 插入一个节点 $h$ 并要求 $h \\in \\mathrm{dom}(L_1)$，为某个 $t \\in \\{L_2, L_3, L_4, L_5\\}$ 添加一条边 $(t, h)$，并保持原始入口 $L_1 \\to L_2$ 和 $L_1 \\to L_3$ 不变。\n\nD. 插入一个节点 $h$ 并将边 $L_5 \\to L_2$ 分裂为 $L_5 \\to h$ 和 $h \\to L_2$，同时保持 $L_1 \\to L_3$ 不变；因为 $h$ 位于至少一条进入环的路径上，所以 $h$ 作为循环头。\n\nE. 插入一个节点 $h$ 并移除所有从环外进入 $\\{L_2, L_3, L_4, L_5\\}$ 的边，但不添加任何边 $(t, h)$；$h$ 将仅作为循环前置节点（preheader），而该环将被视为一个没有回边的循环。", "solution": "对问题陈述进行验证。\n\n已知条件：\n- 由基本块 $L_1, L_2, L_3, L_4, L_5, L_6$ 构成的控制流图（CFG）。\n- 控制流转移：\n  - $L_1$: if $x  0$ then $goto\\ L_3$ else $goto\\ L_2$\n  - $L_2$: $y := y + 1$; $goto\\ L_3$\n  - $L_3$: if $y  10$ then $goto\\ L_4$ else $goto\\ L_6$\n  - $L_4$: $z := z - 1$; $goto\\ L_5$\n  - $L_5$: $goto\\ L_2$\n  - $L_6$: halt\n- CFG边：$L_1 \\to L_2$、$L_1 \\to L_3$、$L_2 \\to L_3$、$L_3 \\to L_4$、$L_3 \\to L_6$、$L_4 \\to L_5$ 和 $L_5 \\to L_2$。\n- 入口节点是 $s = L_1$。\n- 定义：CFG是一个有向图 $(V, E, s)$。\n- 定义：如果从 $s$ 到 $v$ 的每一条路径都包含 $u$，则称 $u$ 支配 $v$（记作 $u \\in \\mathrm{dom}(v)$）。\n- 定义：如果 $h \\in \\mathrm{dom}(t)$，则边 $(t, h) \\in E$ 是一条回边。\n- 前提：由 $\\{L_2, L_3, L_4, L_5\\}$ 导出的子图是一个环，但它不构成一个自然循环，因为它有多个来自 $L_1$ 的入口（特别是 $L_1 \\to L_2$ 和 $L_1 \\to L_3$）。\n- 任务：确定将此环转换为具有单个头节点 $h$ 的自然循环的必要和充分的结构条件，使得对于某条回边 $(t, h)$，有 $h \\in \\mathrm{dom}(t)$。\n\n验证：\n- 该问题具有科学依据。CFG、支配者、回边和自然循环的定义在编译器理论中是标准的。\n- 该问题是适定（well-posed）的。它要求为图变换提供一组条件，这是计算机科学中的一个标准任务。\n- 该问题是客观的，并使用了精确、形式化的语言。\n- 前提是一致且不矛盾的。所提供的CFG正确反映了`goto`语句。关于该环由于有多个入口而不是自然循环的观察是正确的。例如，环内任何提议的头节点（例如 $L_2$）都不会支配环中的其他节点（例如 $L_3$），因为存在备用入口路径（$L_1 \\to L_3$）。\n- 该问题既不普通也非不适定。它要求正确应用编译器优化原理。\n\n结论：问题有效。我们可以继续进行解答。\n\n从第一性原理推导：\n一个自然循环有两个定义性属性：\n1.  它必须有一个单一的头节点 $h$。\n2.  必须至少有一条在头节点处终止的回边 $(t, h)$，其中 $h \\in \\mathrm{dom}(t)$。\n\n第二个属性，$h \\in \\mathrm{dom}(t)$，意味着头节点 $h$ 必须位于从程序入口节点 $s$ 到回边尾部 $t$ 的每一条路径上。单一头节点的一个推论是 $h$ 必须支配循环内的所有节点。如果循环中存在另一个不受 $h$ 支配的节点 $v$，那将意味着存在一条从 $s$ 到 $v$ 的路径绕过了 $h$。这将意味着 $v$ 是循环的另一个入口点，与单一头节点的属性相矛盾。\n\n给定CFG的核心问题是存在两条从节点集 $S = \\{L_2, L_3, L_4, L_5\\}$ 外部进入 $S$ 的边：$L_1 \\to L_2$ 和 $L_1 \\to L_3$。这造成了两个进入环的入口点，违反了单一头节点的要求。\n\n要构建一个有效的自然循环，我们必须执行一个变换来确立一个单一的头节点。标准的变换被称为循环前置节点插入（loop pre-header insertion）。它包括以下步骤：\n1.  创建一个新的空基本块 $h$，它将作为新循环的唯一头节点。这个节点在文献中有时被称为前置节点（pre-header），但在这里它将成为头节点本身。\n2.  识别所有边 $(u, v)$，其中 $u \\notin S$ 且 $v \\in S$。在我们的例子中，这些边是 $L_1 \\to L_2$ 和 $L_1 \\to L_3$。\n3.  将所有这些边重定向到 $h$。因此，我们移除 $L_1 \\to L_2$ 和 $L_1 \\to L_3$。由于它们都源自 $L_1$，我们添加一条边 $L_1 \\to h$。如果还有其他外部节点指向该环，它们的边也应被重定向到 $h$。这确保了任何从环外进入的路径现在都必须经过 $h$。\n4.  从 $h$ 添加到环内原始入口节点的边。在本例中，我们添加边 $h \\to L_2$ 和 $h \\to L_3$。这保留了原始的控制流逻辑。\n5.  根据构造，$h$ 现在是进入块集 $\\{L_2, L_3, L_4, L_5\\}$ 的唯一入口点。因此，$h$ 支配该集合中的每个节点：对于任何 $v \\in \\{L_2, L_3, L_4, L_5\\}$，都有 $h \\in \\mathrm{dom}(v)$。\n6.  最后，为了形成循环，我们必须创建一条指向 $h$ 的回边。原始的环是通过边 $L_5 \\to L_2$ 闭合的。我们可以修改这一点。我们在环中选择一个节点 $t$，它有一条边指回环内，然后将这条边重定向到 $h$。一个自然的选择是取 $t=L_5$ 并将边 $L_5 \\to L_2$ 替换为一条新边 $L_5 \\to h$。\n7.  新的边是 $(t, h) = (L_5, h)$。由于我们已经确定 $h \\in \\mathrm{dom}(L_5)$，这条边是一条有效的回边。最终的节点集 $\\{h, L_2, L_3, L_4, L_5\\}$ 现在构成一个以 $h$ 为头节点的自然循环。\n\n这些步骤代表了该变换的必要和充分条件。\n\n逐项分析：\n\nA. 插入一个新节点 $h$，并将每一条从 $\\{L_2, L_3, L_4, L_5\\}$ 外部节点进入该集合内任一节点的边，重定向到 $h$。从 $h$ 添加进入环的边，使得 $\\{L_2, L_3, L_4, L_5\\}$ 中的所有节点都可以从 $h$ 到达，且不会重新访问 $h$。选择一个尾部 $t \\in \\{L_2, L_3, L_4, L_5\\}$ 并添加一条边 $(t, h)$，并确保对于每个 $v \\in \\{L_2, L_3, L_4, L_5\\}$，都有 $h \\in \\mathrm{dom}(v)$（特别是 $h \\in \\mathrm{dom}(t)$）。除了通过 $h$ 之外，没有其他来自环外部的边可以进入 $\\{L_2, L_3, L_4, L_5\\}$。\n- **分析**：此选项与从第一性原理的推导完全匹配。它正确地指出了需要创建一个新头节点 $h$，将所有进入的边重定向到它，从 $h$ 添加边以保持可达性，并创建一条回边 $(t, h)$。明确的条件“除了通过 $h$ 之外，没有其他来自环外部的边可以进入……”正是保证支配属性 $h \\in \\mathrm{dom}(v)$ 对循环中所有 $v$ 成立的关键，这反过来又验证了 $(t, h)$ 作为一条回边。\n- **结论**：**正确**。\n\nB. 在环内某处插入一个节点 $h$，并为某个 $t \\in \\{L_2, L_3, L_4, L_5\\}$ 添加一条边 $(h, t)$。要求 $t \\in \\mathrm{dom}(h)$ 并且环保持强连通；来自 $L_1$ 的边仍然可以直接进入环。\n- **分析**：此选项根本上是错误的。“来自 $L_1$ 的边仍然可以直接进入环”这句话使我们试图解决的问题永久化。如果多个入口持续存在，任何单个节点都不能成为支配性的头节点。此外，它提出了一个边 $(h, t)$ 和一个支配关系 $t \\in \\mathrm{dom}(h)$，这与头节点 $h$ 的回边要求正好相反。对于回边 $(t, h)$，头节点 $h$ 必须支配尾节点 $t$。\n- **结论**：**错误**。\n\nC. 插入一个节点 $h$ 并要求 $h \\in \\mathrm{dom}(L_1)$，为某个 $t \\in \\{L_2, L_3, L_4, L_5\\}$ 添加一条边 $(t, h)$，并保持原始入口 $L_1 \\to L_2$ 和 $L_1 \\to L_3$ 不变。\n- **分析**：此选项也是错误的。由于 $L_1$ 是 CFG 的入口节点，唯一支配它的节点是 $L_1$ 本身。因此，$h \\in \\mathrm{dom}(L_1)$ 意味着 $h = L_1$，这与插入一个*新*节点相矛盾。即使忽略这一点，保持多个入口 $L_1 \\to L_2$ 和 $L_1 \\to L_3$ 不变，也使得任何节点 $h$ 都不可能支配环中的所有节点，如前所述。\n- **结论**：**错误**。\n\nD. 插入一个节点 $h$ 并将边 $L_5 \\to L_2$ 分裂为 $L_5 \\to h$ 和 $h \\to L_2$，同时保持 $L_1 \\to L_3$ 不变；因为 $h$ 位于至少一条进入环的路径上，所以 $h$ 作为循环头。\n- **分析**：此选项是错误的。它正确地确定了一种创建潜在头节点 $h$ 和回边 $L_5 \\to h$ 的方法。然而，它关键性地指出要保持边 $L_1 \\to L_3$ 不变。路径 $L_1 \\to L_3$ 的存在意味着存在一条从起始节点 $s=L_1$ 到循环节点 $L_3$ 的路径，该路径不经过 $h$。因此，$h$ 不支配 $L_3$。一个不支配循环中所有其他节点的节点不能成为自然循环的头节点。其理由“因为 $h$ 位于至少一条进入环的路径上，所以 $h$ 作为循环头”是谬误的；头节点必须位于从外部进入循环的*每一条*路径上。\n- **结论**：**错误**。\n\nE. 插入一个节点 $h$ 并移除所有从环外进入 $\\{L_2, L_3, L_4, L_5\\}$ 的边，但不添加任何边 $(t, h)$；$h$ 将仅作为循环前置节点（preheader），而该环将被视为一个没有回边的循环。\n- **分析**：此选项在多个方面都是错误的。首先，简单地移除进入的边 $L_1 \\to L_2$ 和 $L_1 \\to L_3$ 会使整个环从程序开始处不可达，这不是一个有效的变换。其次，根据定义，自然循环与一条回边相关联。声明“不添加任何边 $(t, h)$”意味着没有创建回边，因此无法形成自然循环。“没有回边的循环”这一术语在自然循环的上下文中是矛盾的。\n- **结论**：**错误**。", "answer": "$$\\boxed{A}$$", "id": "3659109"}, {"introduction": "现代编程语言中的异常处理机制为控制流引入了额外的复杂性。这个练习旨在检验你对支配关系和自然循环定义的掌握是否扎实，即便是在面对非线性的、由 `try/catch` 结构引入的异常跳转时。通过严谨地应用形式化规则而非依赖直觉，你将判断循环结构在这种复杂情景下是否依然成立，这对于处理真实世界的代码至关重要。[@problem_id:3659054]", "problem": "考虑一个控制流图 (CFG) $G=(V,E)$，它为具有单个 try/catch 的结构化异常建模，其中 $V=\\{e,h,b_1,b_2,t,c,x\\}$，$E$ 由以下有向边组成：\n- 正常边：$(e,h)$, $(h,b_1)$, $(b_1,b_2)$, $(b_2,t)$, $(t,h)$, $(h,x)$。\n- 异常边（从 try 块到 catch 处理程序）：$(b_1,c)$, $(b_2,c)$。\n- 处理程序续体：$(c,x)$。\n\n假设结构化异常的常规语义：一条异常边会立即将控制权转移到 catch 处理程序 $c$，之后控制流转向 $x$；不存在从 $c$ 到 $h$、$t$、$b_1$ 或 $b_2$ 的边。节点 $e$ 是唯一入口，$x$ 是唯一出口，$h$ 是一个循环头候选者，$t$ 是 try 块内的一个循环尾候选者，$c$ 是 catch 处理程序。\n\n根据编译原理中用于支配和自然循环的形式化定义，评估在存在异常边的情况下，$h$ 是否仍然支配 $t$，以及与回边 $(t,h)$ 相关联的自然循环 $L(h)$ 是如何计算的。选择唯一最佳答案。\n\nA. $h$ 支配 $t$，并且 $L(h)$ 的计算方法是取 $t$ 的所有前驱节点（包括通过任何类型的边可达的节点），除了 $h$，然后对前驱进行闭包运算直至饱和，最后再添加 $h$。因为 $c$ 无法到达 $t$，这得到 $L(h)=\\{h,t,b_2,b_1\\}$。\n\nB. $h$ 不支配 $t$，因为异常边引入了一条从 $e$ 经由 $c$ 到达 $t$ 且避开 $h$ 的路径，所以 $(t,h)$ 不是一条回边，$L(h)$ 未定义。\n\nC. 只有在计算支配关系时忽略异常边，$h$ 才支配 $t$；因此 $L(h)$ 必须通过在前驱闭包中排除异常边来计算，得到 $L(h)=\\{h,t,b_2,b_1\\}$。\n\nD. $h$ 支配 $t$，但 $L(h)$ 还必须包含 $c$，因为 $c$ 可以从 try 块到达；循环成员必须包括 try 块的所有后继节点，包括处理程序，所以 $L(h)=\\{h,t,b_2,b_1,c\\}$。", "solution": "该问题陈述是编译原理中的一个有效练习，具体涉及包含结构化异常处理的控制流图 (CFG) 上的数据流分析。它具有科学依据，问题定义明确且客观。我们可以开始进行解答。\n\n解答需要将支配、回边和自然循环的形式化定义应用于给定的控制流图 $G=(V,E)$。\n\n**1. 形式化定义**\n\n*   **支配 (Dominance)：** 在一个具有唯一入口节点 $e$ 的 CFG 中，如果从入口节点 $e$ 到节点 $n$ 的每一条路径都包含节点 $d$，则称节点 $d$ *支配* 节点 $n$，记作 $d \\text{ dom } n$。根据定义，每个节点都支配其自身。\n*   **回边 (Back Edge)：** 在 CFG 中，如果一条有向边 $(u, v)$ 的头节点 $v$ 支配其尾节点 $u$，则该边是一条*回边*。节点 $v$ 被称为循环头。\n*   **自然循环 (Natural Loop)：** 给定一条回边 $(u,v)$，其*自然循环*由头节点 $v$ 以及图中所有能够在不经过 $v$ 的情况下到达尾节点 $u$ 的节点组成。\n    计算回边 $(u,v)$ 的自然循环中节点集合的算法如下：\n    1.  将循环集合初始化，仅包含尾节点 $u$。\n    2.  从 $u$ 开始进行反向图遍历，找到其所有前驱节点。如果前驱节点 $p$ 不是头节点 $v$，则将其添加到循环集合中。\n    3.  对添加到循环集合中的任何新节点重复步骤2，直到没有更多节点可以添加。\n    4.  最后，将头节点 $v$ 添加到计算出的节点集合中。\n\n**2. 对给定 CFG 的分析**\n\n让我们将这些定义应用于给定的 CFG $G=(V,E)$，其中 $V=\\{e,h,b_1,b_2,t,c,x\\}$，边集为 $E = \\{(e,h), (h,b_1), (b_1,b_2), (b_2,t), (t,h), (h,x), (b_1,c), (b_2,c), (c,x)\\}$。唯一入口节点是 $e$。\n\n**2.1. $h$ 对 $t$ 的支配关系**\n\n为了确定 $h$ 是否支配 $t$，我们必须找出从入口节点 $e$到节点 $t$ 的所有可能路径。\n1.  从 $e$ 出发，唯一的出边是 $(e,h)$。因此，从 $e$到任何其他节点的任何路径都必须以子路径 $e \\rightarrow h$ 开始。\n2.  从 $h$ 出发，有两条出边：$(h,b_1)$ 和 $(h,x)$。通往 $t$ 的路径不能走向 $x$，因为 $x$ 是唯一的出口，没有指回图内部的出边。因此，通往 $t$ 的路径必须沿着 $h \\rightarrow b_1$ 继续。\n3.  从 $b_1$ 出发，有两条出边：$(b_1,b_2)$ 和异常边 $(b_1,c)$。\n    *   如果路径走的是边 $(b_1,c)$，它会到达 catch 处理程序 $c$。从 $c$ 出发的唯一出边是 $(c,x)$。从 $c$ 或 $x$ 都没有到 $t$ 的路径。所以，这条路径无法到达 $t$。\n    *   因此，要到达 $t$，路径必须走边 $(b_1,b_2)$。\n4.  从 $b_2$ 出发，有两条出边：$(b_2,t)$ 和异常边 $(b_2,c)$。\n    *   同样，如果路径走的是边 $(b_2,c)$，它会到达 $c$ 然后到 $x$，并且无法到达 $t$。\n    *   因此，要到达 $t$，路径必须走边 $(b_2,t)$。\n\n综合这些步骤，从入口节点 $e$ 到节点 $t$ 的唯一路径是 $e \\rightarrow h \\rightarrow b_1 \\rightarrow b_2 \\rightarrow t$。由于这条路径包含 $h$，因此从 $e$ 到 $t$ 的每一条路径都必须包含 $h$。\n根据定义，**$h$ 支配 $t$**。异常边的存在不会改变这个事实，因为它们导向一条出口路径 ($c \\rightarrow x$)，该路径不会重新连接到 $t$。\n\n**2.2. 回边识别**\n\n问题将边 $(t,h)$ 识别为潜在的回边。由于其头节点 $h$ 支配其尾节点 $t$，因此边 **$(t,h)$ 确实是一条回边**。\n\n**2.3. 自然循环 $L(h)$ 的计算**\n\n自然循环 $L(h)$ 与回边 $(t,h)$ 相关联。遵循算法：\n1.  设循环节点集 `LoopNodes` 初始化为空。我们将找到所有能够在不经过头节点 $h$ 的情况下到达尾节点 $t$ 的节点。\n2.  我们从 $t$ 开始进行反向可达性搜索，避开 $h$。\n    *   从 $t$ 开始。$t$ 能否在不经过 $h$ 的情况下到达 $t$？是的（长度为0的路径）。将 $t$ 添加到 `LoopNodes` 中。\n    *   找到 `LoopNodes` 中节点的前驱节点。$t$ 的唯一前驱是 $b_2$。\n    *   考虑 $b_2$。$b_2$ 能否在不经过 $h$ 的情况下到达 $t$？是的，通过路径 $b_2 \\rightarrow t$。将 $b_2$ 添加到 `LoopNodes` 中。现在 `LoopNodes` 是 $\\{t, b_2\\}$。\n    *   找到新节点的前驱节点。$b_2$ 的唯一前驱是 $b_1$。\n    *   考虑 $b_1$。$b_1$ 能否在不经过 $h$ 的情况下到达 $t$？是的，通过路径 $b_1 \\rightarrow b_2 \\rightarrow t$。将 $b_1$ 添加到 `LoopNodes` 中。现在 `LoopNodes` 是 $\\{t, b_2, b_1\\}$。\n    *   找到新节点的前驱节点。$b_1$ 的唯一前驱是 $h$。没有路径可以从 $b_1$ 的前驱（即 $h$）开始，在不经过 $h$ 的情况下到达 $b_1$。遍历在此停止。\n    *   前驱搜索必须考虑所有边，包括异常边。$c$ 的前驱是 $\\{b_1, b_2\\}$，但 $c$ 无法到达 $t$，因此从 $t$ 开始的反向搜索永远不会遇到 $c$。\n3.  能够在不经过 $h$ 的情况下到达 $t$ 的节点集合是 $\\{t, b_2, b_1\\}$。\n4.  自然循环是这个集合加上头节点 $h$。\n    因此，$L(h) = \\{t, b_2, b_1\\} \\cup \\{h\\} = \\{h, b_1, b_2, t\\}$。\n\n**3. 选项评估**\n\n*   **A. $h$ 支配 $t$，并且 $L(h)$ 的计算方法是取 $t$ 的所有前驱节点（包括通过任何类型的边可达的节点），除了 $h$，然后对前驱进行闭包运算直至饱和，最后再添加 $h$。因为 $c$ 无法到达 $t$，这得到 $L(h)=\\{h,t,b_2,b_1\\}$。**\n    *   陈述“$h$ 支配 $t$”是正确的。\n    *   对自然循环计算的描述是对标准算法的正确重述。\n    *   理由“因为 $c$ 无法到达 $t$”正确地解释了为什么从 $t$ 开始的反向遍历不包括 $c$。\n    *   最终结果 $L(h)=\\{h,t,b_2,b_1\\}$（对于集合，顺序无关紧要）与我们的推导相符。\n    *   **结论：正确。**\n\n*   **B. $h$ 不支配 $t$，因为异常边引入了一条从 $e$ 经由 $c$ 到达 $t$ 且避开 $h$ 的路径，所以 $(t,h)$ 不是一条回边，$L(h)$ 未定义。**\n    *   前提“$h$ 不支配 $t$”是错误的。\n    *   给出的理由，“一条从 $e$ 经由 $c$ 到达 $t$ 的路径”，对于给定的 CFG 在事实上是不正确的。任何到达 $c$ 的路径只能继续到 $x$，无法到达 $t$。\n    *   由于前提是错误的，结论是无效的。\n    *   **结论：不正确。**\n\n*   **C. 只有在计算支配关系时忽略异常边，$h$ 才支配 $t$；因此 $L(h)$ 必须通过在前驱闭包中排除异常边来计算，得到 $L(h)=\\{h,t,b_2,b_1\\}$。**\n    *   断言“只有在忽略异常边的情况下，$h$ 才支配 $t$”是错误的。我们的分析表明，在包括异常边的完整 CFG 上，$h$ 支配 $t$。\n    *   推理“因此 $L(h)$ 必须通过排除异常边来计算”是基于错误前提的不合逻辑的推论。自然循环的标准定义是在整个图上操作的。除非定义了特定的非标准分析框架，否则不能任意排除边。\n    *   尽管 $L(h)$ 的最终集合碰巧是正确的，但关于支配和循环计算的推理在根本上是有缺陷的。\n    *   **结论：不正确。**\n\n*   **D. $h$ 支配 $t$，但 $L(h)$ 还必须包含 $c$，因为 $c$ 可以从 try 块到达；循环成员必须包括 try 块的所有后继节点，包括处理程序，所以 $L(h)=\\{h,t,b_2,b_1,c\\}$。**\n    *   陈述“$h$ 支配 $t$”是正确的。\n    *   关于循环成员资格的推理是不正确的。它提出了一条基于“try-block”语义的临时规则，而不是基于自然循环的形式化、图论定义。该定义依赖于一个头节点、一个尾节点以及到尾节点的反向可达性，而不是从循环体内的节点向前的可达性。\n    *   如推导所示，$c$ 无法到达 $t$，因此根据标准定义，它不能成为自然循环 $L(h)$ 的一部分。所得出的集合是不正确的。\n    *   **结论：不正确。**\n\n基于对编译原理形式化定义的严格应用，选项 A 提供了完全正确的分析。", "answer": "$$\\boxed{A}$$", "id": "3659054"}]}