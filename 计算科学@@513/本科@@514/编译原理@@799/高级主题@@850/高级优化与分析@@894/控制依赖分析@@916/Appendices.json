{"hands_on_practices": [{"introduction": "控制依赖分析的学习始于对其形式化定义的精确应用。本练习提供了一个看似简单的代码片段，但它揭示了一个重要的道理：直觉有时会产生误导。通过严格分析此代码中语句的控制依赖关系 [@problem_id:3632542]，你将学会如何超越表面逻辑，精确运用后支配和控制依赖的定义来解决问题。", "problem": "考虑以下直线代码片段，它包含两个基于相同布尔表达式的条件语句和一个尾随语句：\n```\nif (p) S1;\nif ($\\lnot p$) S2;\nS3;\n```\n假设 $p$ 在求值时没有副作用；$S_1$、$S_2$ 和 $S_3$ 是基本块，它们不抛出异常，不执行异常控制转移，并且总是顺序执行到其后继节点。将此片段建模为控制流图（control flow graph (CFG)），包含一个 $Entry$ 节点、一个 $Exit$ 节点和两个不同的谓词节点：$B_1$ 用于对 $p$ 的第一次测试，$B_2$ 用于对 $\\lnot p$ 的第二次测试；then-边分别指向 $S_1$ 和 $S_2$，而 else-边则顺序执行到序列中的下一条语句。\n\n使用基于后支配的控制依赖的标准基础：\n- 如果从节点 $Y$ 到 $Exit$ 的每条路径都包含节点 $X$，则称节点 $X$ 后支配节点 $Y$。\n- 如果节点 $Y$ 至少有两个后继节点，并且节点 $X$ 后支配其中一部分而非全部后继节点，则称节点 $X$ 控制依赖于节点 $Y$。\n\n将“控制依赖于 $p$”解释为“控制依赖于评估 $p$ 或 $\\lnot p$ 的谓词节点之一”，即 $B_1$ 或 $B_2$。在这种意义下，$S_1$、$S_2$、$S_3$ 中哪些控制依赖于 $p$？\n\n选择唯一的最佳选项：\n\nA. 仅 $S_1$\n\nB. 仅 $S_2$\n\nC. $S_1$ 和 $S_2$，但不包括 $S_3$\n\nD. $S_1$、$S_2$ 和 $S_3$\n\nE. $S_1$、$S_2$、$S_3$ 都不是", "solution": "该问题陈述是控制依赖分析的一个有效练习，这是编译器理论中的一个标准主题。它提供了一个清晰的代码片段，一套用于构建相应控制流图 (CFG) 的特定规则，以及关于后支配和控制依赖的精确定义。该问题是自包含的、逻辑一致的且提法恰当的。\n\n解决方案分三步进行：\n1.  根据问题描述构建控制流图 (CFG)。\n2.  分析 CFG 内的后支配关系。\n3.  应用控制依赖的定义来确定语句 `$S_1$`、`$S_2$` 和 `$S_3$` 对谓词节点 `$B_1$` 和 `$B_2$` 的依赖关系。\n\n**1. 控制流图 (CFG) 构建**\n\n问题指定了程序片段和 CFG 的结构。\n程序片段：\n```\nif (p) S1;\nif ($\\lnot p$) S2;\nS3;\n```\n节点包括 `$Entry$`、`$B_1$`（用于 `if (p)`）、`$S_1$`、`$B_2$`（用于 `if ($\\lnot p$)`）、`$S_2$`、`$S_3$` 和 `$Exit$`。边由控制流和顺序执行行为决定：\n\n-   `$Entry \\rightarrow B_1$`: 执行从第一个条件语句开始。\n-   `$B_1 \\xrightarrow{\\text{true}} S_1$`: 如果 `$p$` 为真，执行 `$S_1$`。\n-   `$B_1 \\xrightarrow{\\text{false}} B_2$`: 如果 `$p$` 为假，跳过 `$S_1$` 并顺序执行到下一条语句，该语句从 `$B_2$` 开始。\n-   `$S_1 \\rightarrow B_2$`: `$S_1$` 执行后，顺序执行到下一条语句，该语句从 `$B_2$` 开始。\n-   `$B_2 \\xrightarrow{\\text{true}} S_2$`: 如果 `$\\lnot p$` 为真（即 `$p$` 为假），执行 `$S_2$`。\n-   `$B_2 \\xrightarrow{\\text{false}} S_3$`: 如果 `$\\lnot p$` 为假（即 `$p$` 为真），跳过 `$S_2$` 并顺序执行到 `$S_3$`。\n-   `$S_2 \\rightarrow S_3$`: `$S_2$` 执行后，顺序执行到 `$S_3$`。\n-   `$S_3 \\rightarrow Exit$`: `$S_3$` 执行后，代码片段终止。\n\n我们可以根据 `$p$` 的值追踪两种可能的执行路径：\n-   如果 `$p$` 为真：`$Entry \\rightarrow B_1 \\rightarrow S_1 \\rightarrow B_2 \\rightarrow S_3 \\rightarrow Exit$`。\n-   如果 `$p$` 为假：`$Entry \\rightarrow B_1 \\rightarrow B_2 \\rightarrow S_2 \\rightarrow S_3 \\rightarrow Exit$`。\n\n**2. 后支配分析**\n\n所提供的定义指出：如果从节点 `$Y$` 到 `$Exit$` 的每条路径都包含节点 `$X$`，则称节点 `$X$` 后支配节点 `$Y$`。我们分析控制依赖检查所需的关键后支配关系。\n\n-   **`$S_3$` 的后支配情况**：\n    -   任何从 `$S_2$` 出发的路径都必须经过 `$S_3$` (`$S_2 \\rightarrow S_3 \\rightarrow Exit$`)。因此，`$S_3$` 后支配 `$S_2$`。\n    -   从 `$B_2$` 出发的路径是 `$B_2 \\rightarrow S_2 \\rightarrow S_3 \\rightarrow Exit$` 和 `$B_2 \\rightarrow S_3 \\rightarrow Exit$`。两者都包含 `$S_3$`。因此，`$S_3$` 后支配 `$B_2$`。\n    -   任何从 `$S_1$` 出发的路径都必须经过 `$B_2$` (`$S_1 \\rightarrow B_2 \\rightarrow ...$`)，并且我们已经确定 `$S_3$` 后支配 `$B_2$`。因此，`$S_3$` 后支配 `$S_1$`。\n    -   从 `$B_1$` 出发的路径是 `$B_1 \\rightarrow S_1 \\rightarrow B_2 \\rightarrow S_3 \\rightarrow Exit$` 和 `$B_1 \\rightarrow B_2 \\rightarrow S_2 \\rightarrow S_3 \\rightarrow Exit$`。两者都包含 `$S_3$`。因此，`$S_3$` 后支配 `$B_1$`。\n\n-   **涉及 `$S_1$` 的后支配情况**：\n    -   从 `$B_1$` 出发的一条路径是 `$B_1 \\rightarrow B_2 \\rightarrow ...$`。这条路径不包含 `$S_1$`。因此，`$S_1$` 不后支配 `$B_1$`。\n    -   从 `$B_2$` 出发的一条路径是 `$B_2 \\rightarrow S_2 \\rightarrow S_3 \\rightarrow Exit$`。这条路径不包含 `$S_1$`。因此，`$S_1$` 不后支配 `$B_2$`。\n\n-   **涉及 `$S_2$` 的后支配情况**：\n    -   从 `$B_2$` 出发的一条路径是 `$B_2 \\rightarrow S_3 \\rightarrow Exit$`。这条路径不包含 `$S_2$`。因此，`$S_2$` 不后支配 `$B_2$`。\n    -   从 `$S_3$` 出发的一条路径是 `$S_3 \\rightarrow Exit$`。这条路径不包含 `$S_2$`。因此，`$S_2$` 不后支配 `$S_3$`。\n\n**3. 控制依赖分析**\n\n所提供的定义指出：如果节点 `$Y$` 至少有两个后继节点，并且节点 `$X$` 后支配其中一部分而非全部后继节点，则称节点 `$X$` 控制依赖于节点 `$Y$`。我们对每个语句 `$S_1, S_2, S_3$` 相对于谓词 `$B_1$` 和 `$B_2$` 进行检查。\n\n**对 `$B_1$` 的控制依赖**\n-   谓词节点是 `$Y=B_1$`。它的后继节点是 `$S_1$`（真分支）和 `$B_2$`（假分支）。\n\n-   `$S_1$` 是否控制依赖于 `$B_1$`？（`$X=S_1$`）\n    -   `$S_1$` 是否后支配 `$S_1$`？是的，平凡地成立。\n    -   `$S_1$` 是否后支配 `$B_2$`？不是。存在从 `$B_2$` 到 `$Exit$` 的路径不经过 `$S_1$`。\n    -   由于 `$S_1$` 后支配一个后继节点（`$S_1$`）但不是另一个（`$B_2$`），因此 **`$S_1$` 控制依赖于 `$B_1$`**。\n\n-   `$S_2$` 是否控制依赖于 `$B_1$`？（`$X=S_2$`）\n    -   `$S_2$` 是否后支配 `$S_1$`？不是。路径 `$S_1 \\rightarrow B_2 \\rightarrow S_3 \\rightarrow Exit$` 不包含 `$S_2$`。\n    -   `$S_2$` 是否后支配 `$B_2$`？不是。路径 `$B_2 \\rightarrow S_3 \\rightarrow Exit$` 不包含 `$S_2$`。\n    -   由于 `$S_2$` 不后支配任何一个后继节点，因此 **`$S_2$` 不控制依赖于 `$B_1$`**。\n\n-   `$S_3$` 是否控制依赖于 `$B_1$`？（`$X=S_3$`）\n    -   `$S_3$` 是否后支配 `$S_1$`？是的，如后支配分析所示。\n    -   `$S_3$` 是否后支配 `$B_2$`？是的，如后支配分析所示。\n    -   由于 `$S_3$` 后支配 `$B_1$` 的*所有*后继节点，因此 **`$S_3$` 不控制依赖于 `$B_1$`**。\n\n**对 `$B_2$` 的控制依赖**\n-   谓词节点是 `$Y=B_2$`。它的后继节点是 `$S_2$`（`$\\lnot p$` 的真分支）和 `$S_3$`（`$\\lnot p$` 的假分支）。\n\n-   `$S_1$` 是否控制依赖于 `$B_2$`？（`$X=S_1$`）\n    -   `$S_1$` 是否后支配 `$S_2$`？不是。路径 `$S_2 \\rightarrow S_3 \\rightarrow Exit$` 不包含 `$S_1$`。\n    -   `$S_1$` 是否后支配 `$S_3$`？不是。路径 `$S_3 \\rightarrow Exit$` 不包含 `$S_1$`。\n    -   由于 `$S_1$` 不后支配任何一个后继节点，因此 **`$S_1$` 不控制依赖于 `$B_2$`**。\n\n-   `$S_2$` 是否控制依赖于 `$B_2$`？（`$X=S_2$`）\n    -   `$S_2$` 是否后支配 `$S_2$`？是的，平凡地成立。\n    -   `$S_2$` 是否后支配 `$S_3$`？不是。路径 `$S_3 \\rightarrow Exit$` 不包含 `$S_2$`。\n    -   由于 `$S_2$` 后支配一个后继节点（`$S_2$`）但不是另一个（`$S_3$`），因此 **`$S_2$` 控制依赖于 `$B_2$`**。\n\n-   `$S_3$` 是否控制依赖于 `$B_2$`？（`$X=S_3$`）\n    -   `$S_3$` 是否后支配 `$S_2$`？是的，如后支配分析所示。\n    -   `$S_3$` 是否后支配 `$S_3$`？是的，平凡地成立。\n    -   由于 `$S_3$` 后支配 `$B_2$` 的*所有*后继节点，因此 **`$S_3$` 不控制依赖于 `$B_2$`**。\n\n**结论**\n-   `$S_1$` 控制依赖于 `$B_1$`。\n-   `$S_2$` 控制依赖于 `$B_2$`。\n-   `$S_3$` 不控制依赖于 `$B_1$` 或 `$B_2$`。\n\n问题询问哪些语句“控制依赖于 `$p$`”，意即控制依赖于 `$B_1$` 或 `$B_2$`。根据我们的分析，这些语句是 `$S_1$` 和 `$S_2$`。\n\n**逐项分析选项**\n-   A. 仅 `$S_1$`: **错误**。`$S_2$` 控制依赖于 `$B_2$`。\n-   B. 仅 `$S_2$`: **错误**。`$S_1$` 控制依赖于 `$B_1$`。\n-   C. `$S_1$` 和 `$S_2$`, 但不包括 `$S_3$`: **正确**。这与我们的分析相符。`$S_1$` 依赖于 `$B_1$`，`$S_2$` 依赖于 `$B_2$`，而 `$S_3$` 两者都不依赖，因为它是汇合点的后支配节点。\n-   D. `$S_1$`, `$S_2$` 和 `$S_3$`: **错误**。`$S_3$` 不控制依赖于任何一个谓词。\n-   E. `$S_1$`, `$S_2$`, `$S_3$` 都不是: **错误**。如上所示，`$S_1$` 和 `$S_2$` 都是控制依赖的。", "answer": "$$\\boxed{C}$$", "id": "3632542"}, {"introduction": "掌握了基础知识后，我们可以将控制依赖分析应用于更复杂的真实世界编程结构中。此练习 [@problem_id:3632595] 模拟了一个带有“贯穿”(fallthrough)行为的 `switch` 语句，这是许多编程语言中的常见特性。通过分析这个例子，你将理解一个语句的执行如何依赖于一系列决策，从而可能对多个不同的判定节点产生控制依赖。", "problem": "编译器在进行变换时，必须对控制依赖进行推理，以安全地放置指令。考虑以下抽象的控制流图 (CFG)，它用于一个多路分支，该分支模拟了在不同 case 之间具有穿透（fallthrough）特性的编程语言构造。该 CFG 有一个入口节点，然后是一个单一的选择器节点 $S$，它实现到标签 $L_{0}, L_{1}, L_{2}, L_{3}, L_{d}$ 的多路分派。对于每个标签 $L_{i}$，都有一个紧随其后的 case 体基本块 $X_{i}$；类似地，$L_{d}$ 后面是默认 case 体基本块 $X_{d}$。在每个 case 体之后，控制流如下：\n- 从 $L_{0}$ 开始：$L_{0} \\rightarrow X_{0} \\rightarrow I_{0}$，其中 $I_{0}$ 是一个决策节点，有两个后继：break 目标 $B$ 和穿透到 $L_{1}$。\n- 从 $L_{1}$ 开始：$L_{1} \\rightarrow X_{1} \\rightarrow I_{1}$，其中 $I_{1}$ 有两个后继：break 目标 $B$ 和穿透到 $L_{2}$。\n- 从 $L_{2}$ 开始：$L_{2} \\rightarrow X_{2} \\rightarrow I_{2}$，其中 $I_{2}$ 有两个后继：穿透到 $L_{3}$ 和 break 目标 $B$。\n- 从 $L_{3}$ 开始：$L_{3} \\rightarrow X_{3} \\rightarrow B$（到 $B$ 的无条件转移）。\n- 从 $L_{d}$ 开始：$L_{d} \\rightarrow X_{d} \\rightarrow B$（到 $B$ 的无条件转移）。\n\nbreak 目标 $B$ 随后流向一个唯一的 switch 退出节点 $Z$。除了所描述的边之外，没有其他边。从 $Z$ 可以到达一个单一的程序出口，并且所有从 $S$ 出发的路径最终都会到达 $Z$。\n\n使用标准定义：在控制流图 (CFG) 中，如果从节点 $q$ 到出口的每条路径都经过节点 $p$，那么节点 $p$ 后支配 (postdominates) 节点 $q$。如果节点 $Y$ 后支配节点 $X$ 的至少一个后继，但 $Y$ 并不后支配 $X$ 本身，那么节点 $Y$ 控制依赖于 (control dependent on) 节点 $X$。\n\n定义集合：\n- $C_{S}$ 为 $\\{X_{0}, X_{1}, X_{2}, X_{3}, X_{d}\\}$ 中所有控制依赖于选择器节点 $S$ 的 case 体基本块的集合。\n- $C_{F}$ 为 $\\{X_{0}, X_{1}, X_{2}, X_{3}, X_{d}\\}$ 中所有控制依赖于至少一个先前的穿透决策节点 $I_{j}$ 的 case 体基本块的集合，其中 $I_{j}$ 来自一个更早的 case 标签 $L_{j}$，满足 $j < i$（对于 $X_{i}$），即源于一个词法上更早的 case 的穿透。\n\n计算 $N = |C_{S}| + |C_{F}|$ 的值。提供 $N$ 的精确整数值。不需要四舍五入。", "solution": "问题要求我们计算 $N = |C_{S}| + |C_{F}|$ 的值，其中 $C_{S}$ 和 $C_{F}$ 是在给定的控制流图 (CFG) 中满足特定控制依赖标准的 case 体基本块集合。\n\n首先，我们必须确定 CFG 的结构和相关的后支配关系。该 CFG 有一个单一入口、一个选择器节点 $S$ 以及一条通过节点 $B$ 和 $Z$ 的单一退出路径。我们将程序的唯一出口节点表示为 `Exit`。该结构意味着从问题中描述的任何节点出发的任何路径最终都必须经过 $B$，然后是 $Z$，才能到达 `Exit`。\n\n根据所提供的定义，如果从节点 $q$ 到 `Exit` 的每条路径都经过节点 $p$，则节点 $p$ 后支配节点 $q$。\n\n控制依赖的定义也已给出：如果节点 $Y$ (1) 后支配节点 $X$ 的至少一个后继，并且 (2) $Y$ 不后支配 $X$ 本身，那么节点 $Y$ 就控制依赖于节点 $X$。\n\n现在我们将应用这些定义来计算集合 $C_S$ 和 $C_F$。\n\n**$|C_{S}|$ 的计算**\n\n$C_{S}$ 是来自 $\\{X_{0}, X_{1}, X_{2}, X_{3}, X_{d}\\}$ 中控制依赖于选择器节点 $S$ 的基本块的集合。对于每个块 $Y \\in \\{X_{0}, X_{1}, X_{2}, X_{3}, X_{d}\\}$，我们检查它是否控制依赖于 $X=S$。\n\n$S$ 的后继是标签节点 $\\{L_{0}, L_{1}, L_{2}, L_{3}, L_{d}\\}$。\n\n1.  **考虑 $Y = X_{0}$：**\n    -   $X_{0}$ 是否后支配 $S$ 的至少一个后继？\n        从 $L_{0}$ 出发的唯一边是 $L_{0} \\rightarrow X_{0}$。因此，从 $L_{0}$ 出发的每条路径都必须经过 $X_{0}$。所以，$X_{0}$ 后支配 $L_{0}$。这满足了第一个条件。\n    -   $X_{0}$ 是否后支配 $S$？\n        不是。存在一条从 $S$ 到 `Exit` 的路径绕过了 $X_{0}$，例如 $S \\rightarrow L_{1} \\rightarrow X_{1} \\rightarrow \\dots \\rightarrow B \\rightarrow Z \\rightarrow \\text{Exit}$。因此，$X_{0}$ 不后支配 $S$。这满足了第二个条件。\n    -   结论：$X_{0}$ 控制依赖于 $S$。所以，$X_{0} \\in C_{S}$。\n\n2.  **考虑 $Y = X_{1}$：**\n    -   $X_{1}$ 是否后支配 $S$ 的至少一个后继？\n        是的。由于边 $L_{1} \\rightarrow X_{1}$ 的存在，从 $L_{1}$ 出发的每条路径都必须经过 $X_{1}$。所以，$X_{1}$ 后支配 $L_{1}$。\n    -   $X_{1}$ 是否后支配 $S$？\n        不是。路径 $S \\rightarrow L_{0} \\rightarrow \\dots$ 绕过了 $X_{1}$。\n    -   结论：$X_{1}$ 控制依赖于 $S$。所以，$X_{1} \\in C_{S}$。\n\n通过相同的推理，每个 case 体块 $X_{i}$（以及 $X_{d}$）都只能从其对应的标签 $L_{i}$（或 $L_{d}$）进入，而这些标签都是 $S$ 的后继。\n-   对于 $X_{2}$：$X_{2}$ 后支配 $L_{2}$ 但不后支配 $S$。所以，$X_{2} \\in C_{S}$。\n-   对于 $X_{3}$：$X_{3}$ 后支配 $L_{3}$ 但不后支配 $S$。所以，$X_{3} \\in C_{S}$。\n-   对于 $X_{d}$：$X_{d}$ 后支配 $L_{d}$ 但不后支配 $S$。所以，$X_{d} \\in C_{S}$。\n\n因此，集合 $C_{S}$ 包含所有五个 case 体块：\n$C_{S} = \\{X_{0}, X_{1}, X_{2}, X_{3}, X_{d}\\}$。\n其基数为 $|C_{S}| = 5$。\n\n**$|C_{F}|$ 的计算**\n\n$C_{F}$ 是所有控制依赖于至少一个先前的穿透决策节点 $I_{j}$（其中 $j < i$）的 case 体基本块 $X_{i}$ 的集合。决策节点是 $I_{0}$、$I_{1}$ 和 $I_{2}$。\n\n1.  **考虑 $X_{0}$：** 不存在满足 $j < 0$ 的决策节点 $I_{j}$。所以，$X_{0} \\notin C_{F}$。\n\n2.  **考虑 $X_{1}$：** 我们检查其对 $I_{j}$（其中 $j < 1$，即只有 $I_{0}$）的依赖关系。\n    -   令 $Y=X_{1}$ 且 $X=I_{0}$。$I_{0}$ 的后继是 $B$ 和 $L_{1}$。\n    -   $X_{1}$ 是否后支配 $I_{0}$ 的至少一个后继？\n        是的。从 $L_{1}$ 出发的每条路径都必须经过 $X_{1}$。所以，$X_{1}$ 后支配 $L_{1}$。\n    -   $X_{1}$ 是否后支配 $I_{0}$？\n        不是。路径 $I_{0} \\rightarrow B \\rightarrow Z \\rightarrow \\text{Exit}$ 绕过了 $X_{1}$。\n    -   结论：$X_{1}$ 控制依赖于 $I_{0}$。所以，$X_{1} \\in C_{F}$。\n\n3.  **考虑 $X_{2}$：** 我们检查其对 $I_{j}$（其中 $j < 2$，即 $I_{0}$ 和 $I_{1}$）的依赖关系。\n    -   对 $I_{0}$ 的依赖：令 $Y=X_{2}$ 且 $X=I_{0}$。$I_{0}$ 的后继是 $B$ 和 $L_{1}$。$X_{2}$ 是否后支配 $L_{1}$？不是。路径 $L_{1} \\rightarrow X_{1} \\rightarrow I_{1} \\rightarrow B \\rightarrow Z \\rightarrow \\text{Exit}$ 不经过 $X_{2}$。因此，$X_{2}$ 不控制依赖于 $I_{0}$。\n    -   对 $I_{1}$ 的依赖：令 $Y=X_{2}$ 且 $X=I_{1}$。$I_{1}$ 的后继是 $B$ 和 $L_{2}$。\n        -   $X_{2}$ 是否后支配 $I_{1}$ 的至少一个后继？是的。从 $L_{2}$ 出发的每条路径都是 $L_{2} \\rightarrow X_{2} \\rightarrow \\dots$ 的形式。因此，$X_{2}$ 后支配 $L_{2}$。\n        -   $X_{2}$ 是否后支配 $I_{1}$？不是。路径 $I_{1} \\rightarrow B \\rightarrow Z \\rightarrow \\text{Exit}$ 绕过了 $X_{2}$。\n    -   结论：$X_{2}$ 控制依赖于 $I_{1}$。因为条件是依赖于*至少一个*先前的节点，所以 $X_{2} \\in C_{F}$。\n\n4.  **考虑 $X_{3}$：** 我们检查其对 $I_{j}$（其中 $j < 3$，即 $I_{0}$、$I_{1}$ 和 $I_{2}$）的依赖关系。\n    -   对 $I_{0}$ 的依赖：令 $Y=X_{3}, X=I_{0}$。$X_{3}$ 是否后支配 $L_{1}$？不是。从 $L_{1}$ 出发的路径可以通过 $I_{1}$ 到达 $B$，从而绕过 $X_{3}$。所以不依赖于 $I_{0}$。\n    -   对 $I_{1}$ 的依赖：令 $Y=X_{3}, X=I_{1}$。$X_{3}$ 是否后支配 $L_{2}$？不是。路径 $L_{2} \\rightarrow X_{2} \\rightarrow I_{2} \\rightarrow B \\rightarrow \\dots$ 绕过了 $X_{3}$。所以不依赖于 $I_{1}$。\n    -   对 $I_{2}$ 的依赖：令 $Y=X_{3}, X=I_{2}$。$I_{2}$ 的后继是 $L_{3}$ 和 $B$。\n        -   $X_{3}$ 是否后支配 $I_{2}$ 的至少一个后继？是的。从 $L_{3}$ 出发的每条路径都是 $L_{3} \\rightarrow X_{3} \\rightarrow \\dots$。因此，$X_{3}$ 后支配 $L_{3}$。\n        -   $X_{3}$ 是否后支配 $I_{2}$？不是。路径 $I_{2} \\rightarrow B \\rightarrow Z \\rightarrow \\text{Exit}$ 绕过了 $X_{3}$。\n    -   结论：$X_{3}$ 控制依赖于 $I_{2}$。所以，$X_{3} \\in C_{F}$。\n\n5.  **考虑 $X_{d}$：** 问题为带有索引 $i$ 的块 $X_{i}$ 定义了 $C_{F}$。块 $X_{d}$ 没有一个符合 $j < i$ 模式的数字索引，并且在问题所意指的词法意义上，在它之前没有穿透决策节点。因此，$X_{d} \\notin C_{F}$。\n\n总而言之，集合 $C_{F}$ 由那些其执行取决于从前一个 case 穿透下来的决策的块组成。\n$C_{F} = \\{X_{1}, X_{2}, X_{3}\\}$。\n其基数为 $|C_{F}| = 3$。\n\n**最终计算**\n\n问题要求计算 $N = |C_{S}| + |C_{F}|$。\n$|C_{S}| = 5$\n$|C_{F}| = 3$\n$N = 5 + 3 = 8$。", "answer": "$$ \\boxed{8} $$", "id": "3632595"}, {"introduction": "本章的最后一个练习是一项综合挑战，旨在巩固你对控制依赖分析的全面理解。这个练习 [@problem_id:3632566] 提供了一个包含循环、`break` 和 `continue` 语句的复杂控制流图。成功解决这个问题，意味着你能够系统地构建后支配树，并将其应用于分析任意复杂的程序结构，这是编译器优化和程序分析中的一项核心技能。", "problem": "考虑下面描述的循环的控制流图 (CFG)。循环守卫是谓词节点 $G$。循环体包含直线语句 $S_1, S_2, S_3, S_4, S_5, S_6$，一个 $continue$ 语句 $K$，以及一个 $break$ 语句 $R$。循环体内部有两个内部分支谓词，表示为 $C_1$ 和 $C_2$。唯一的出口节点是 $X$，唯一的入口节点是 $E$。该图是可规约的，并且只有一个出口。边如下所示：\n- $E \\to G$。\n- $G \\xrightarrow{\\text{true}} S_1$, $G \\xrightarrow{\\text{false}} X$。\n- $S_1 \\to C_1$。\n- $C_1 \\xrightarrow{\\text{true}} S_2$, $C_1 \\xrightarrow{\\text{false}} S_3$。\n- $S_2 \\to K$, $K \\to G$。\n- $S_3 \\to C_2$。\n- $C_2 \\xrightarrow{\\text{true}} S_4$, $S_4 \\to R$, $R \\to X$。\n- $C_2 \\xrightarrow{\\text{false}} S_5$, $S_5 \\to S_6$, $S_6 \\to G$。\n\n假设使用标准语义：$continue$ 将控制权直接转移到循环守卫 $G$ 处，$break$ 将控制权转移到 $X$。\n\n仅从核心定义出发，使用控制依赖分析来确定对于三个谓词节点 $G$、$C_1$ 和 $C_2$ 中的每一个，哪些循环体语句在控制上依赖于该谓词。使用以下基本定义。\n- 一个节点 $p$ 后支配 (postdominates) 一个节点 $n$，当且仅当从 $n$ 到唯一出口 $X$ 的每一条路径都包含 $p$。\n- 节点 $n$ 的直接后支配节点 (immediate postdominator) $\\operatorname{idom}(n)$ 是 $n$ 的唯一后支配节点，它严格后支配 $n$ 并且在后支配树中离 $n$ 最近。\n- 一个节点 $Y$ 控制依赖于一个节点 $X$，当且仅当存在一条从 $X$ 到 $Y$ 的有向路径，使得 $Y$ 后支配该路径上在 $X$ 之后的所有节点，并且 $Y$ 不后支配 $X$。\n\n只在集合 $\\{S_1, S_2, S_3, S_4, S_5, S_6, K, R\\}$ 中计算循环体语句；不要计算 $G$、$C_1$ 或 $C_2$ 本身。将您的最终答案报告为计数的有序三元组 $\\left(|CD(G)|, |CD(C_1)|, |CD(C_2)|\\right)$，其中 $|CD(\\cdot)|$ 表示控制依赖于给定谓词的循环体语句的数量。使用 $\\operatorname{pmatrix}$ 环境将最终答案表示为行矩阵。不需要四舍五入，也不涉及单位。", "solution": "该问题要求对给定的控制流图 (CFG) 进行控制依赖分析。分析将通过首先建立图中的后支配关系，构建后支配树，然后将控制依赖的正式定义应用于指定的谓词节点 $G$、$C_1$ 和 $C_2$ 来进行。\n\n首先，我们形式化 CFG 的结构。节点集为 $\\{E, G, S_1, C_1, S_2, K, S_3, C_2, S_4, R, S_5, S_6, X\\}$。边如下所示：\n$E \\to G$\n$G \\to S_1$ (真分支)\n$G \\to X$ (假分支)\n$S_1 \\to C_1$\n$C_1 \\to S_2$ (真分支)\n$C_1 \\to S_3$ (假分支)\n$S_2 \\to K$\n$K \\to G$\n$S_3 \\to C_2$\n$C_2 \\to S_4$ (真分支)\n$C_2 \\to S_5$ (假分支)\n$S_4 \\to R$\n$R \\to X$\n$S_5 \\to S_6$\n$S_6 \\to G$\n\n分析的核心依赖于后支配关系。一个节点 $p$ 后支配一个节点 $n$，如果从 $n$ 到唯一出口节点 $X$ 的每一条路径都必然包含 $p$。我们将 $n$ 的后支配节点集合表示为 $\\operatorname{pdom}(n)$。通过系统地分析从每个节点到 $X$ 的所有路径，我们确定这些集合。\n\n- 从 $R$ 到 $X$ 的路径：唯一的路径是 $R \\to X$。因此，$\\operatorname{pdom}(R) = \\{R, X\\}$。\n- 从 $S_4$ 到 $X$ 的路径：唯一的路径是 $S_4 \\to R \\to X$。因此，$\\operatorname{pdom}(S_4) = \\{S_4, R, X\\}$。\n- 从 $S_6$ 到 $X$ 的路径：唯一的路径是 $S_6 \\to G \\to \\dots$。从 $G$ 到 $X$ 可以走任何路径。然而，所有从 $S_6$ 出发的路径都必须先经过 $G$。因此，$G$ 后支配 $S_6$。$\\operatorname{pdom}(S_6) = \\{S_6, G, X\\}$。\n- 从 $S_5$ 到 $X$ 的路径：唯一的路径是 $S_5 \\to S_6 \\to \\dots$。因此，$S_6$ 后支配 $S_5$。$\\operatorname{pdom}(S_5) = \\{S_5, S_6, G, X\\}$。\n- 从 $K$ 到 $X$ 的路径：唯一的路径是 $K \\to G \\to \\dots$。因此，$G$ 后支配 $K$。$\\operatorname{pdom}(K) = \\{K, G, X\\}$。\n- 从 $S_2$ 到 $X$ 的路径：唯一的路径是 $S_2 \\to K \\to \\dots$。因此，$K$ 后支配 $S_2$。$\\operatorname{pdom}(S_2) = \\{S_2, K, G, X\\}$。\n- 从 $S_3$ 到 $X$ 的路径：唯一的路径是 $S_3 \\to C_2 \\to \\dots$。因此，$C_2$ 后支配 $S_3$。$\\operatorname{pdom}(S_3) = \\{S_3, C_2, X\\}$。\n- 从 $S_1$ 到 $X$ 的路径：唯一的路径是 $S_1 \\to C_1 \\to \\dots$。因此，$C_1$ 后支配 $S_1$。$\\operatorname{pdom}(S_1) = \\{S_1, C_1, X\\}$。\n- 从 $E$ 到 $X$ 的路径：唯一的路径是 $E \\to G \\to \\dots$。因此，$G$ 后支配 $E$。$\\operatorname{pdom}(E) = \\{E, G, X\\}$。\n- 从谓词节点出发的路径：\n  - 从 $G$ 出发：有一条直接路径 $G \\to X$ 和通过循环体的路径（例如，$G \\to S_1 \\to C_1 \\to S_3 \\to C_2 \\to S_4 \\to R \\to X$）。这些路径除了 $G$ 和 $X$ 之外没有公共节点。因此，$\\operatorname{pdom}(G) = \\{G, X\\}$。\n  - 从 $C_1$ 出发：真分支通向 $S_2 \\to K \\to G$，假分支通向 $S_3 \\to C_2$。从 $G$ 出发的路径可以直接在 $X$ 退出。从 $C_2$ 出发的路径可以通过 $R \\to X$ 退出。例如，路径 $C_1 \\to S_2 \\to K \\to G \\to X$ 和路径 $C_1 \\to S_3 \\to C_2 \\to S_4 \\to R \\to X$ 除了 $C_1$ 和 $X$ 之外没有共享节点。因此，$\\operatorname{pdom}(C_1) = \\{C_1, X\\}$。\n  - 从 $C_2$ 出发：真分支通向 $S_4 \\to R \\to X$，退出循环。假分支通向 $S_5 \\to S_6 \\to G$，重新进入循环结构。路径 $C_2 \\to S_4 \\to R \\to X$ 和 $C_2 \\to S_5 \\to S_6 \\to G \\to X$ 除了 $C_2$ 和 $X$ 之外没有共享节点。因此，$\\operatorname{pdom}(C_2) = \\{C_2, X\\}$。\n\n从后支配节点集合中，我们确定每个节点 $n \\neq X$ 的直接后支配节点 $\\operatorname{idom}(n)$。这定义了后支配树，其中节点 $n$ 的父节点是 $\\operatorname{idom}(n)$。\n- $\\operatorname{idom}(E) = G$\n- $\\operatorname{idom}(G) = X$\n- $\\operatorname{idom}(S_1) = C_1$\n- $\\operatorname{idom}(C_1) = X$\n- $\\operatorname{idom}(S_2) = K$\n- $\\operatorname{idom}(K) = G$\n- $\\operatorname{idom}(S_3) = C_2$\n- $\\operatorname{idom}(C_2) = X$\n- $\\operatorname{idom}(S_4) = R$\n- $\\operatorname{idom}(R) = X$\n- $\\operatorname{idom}(S_5) = S_6$\n- $\\operatorname{idom}(S_6) = G$\n\n后支配树的根是 $X$，具有以下父子关系：$X$ 是 $G, C_1, C_2, R$ 的父节点。$G$ 是 $E, K, S_6$ 的父节点。$C_1$ 是 $S_1$ 的父节点。$C_2$ 是 $S_3$ 的父节点。$R$ 是 $S_4$ 的父节点。$K$ 是 $S_2$ 的父节点。$S_6$ 是 $S_5$ 的父节点。\n\n现在我们应用控制依赖的定义：一个节点 $Y$ 控制依赖于一个谓词 $P$，如果存在一条从 $P$ 到 $Y$ 的路径，其中 $Y$ 后支配该路径上在 $P$ 之后的所有节点，并且 $Y$ 不后支配 $P$。\n一个找到控制依赖于 $P$ 的节点集合（表示为 $CD(P)$）的有效方法是，考虑每个出边 $P \\to A$。在后支配树中，从 $A$ 开始向上到树中 $P$ 和 $A$ 的最近公共祖先 $\\operatorname{lca}(P, A)$（但不包括 $\\operatorname{lca}(P, A)$）的路径上的节点都控制依赖于 $P$。\n\n1.  对 $G$ 的控制依赖：\n    - 谓词是 $P=G$。它有两条出边：$G \\to S_1$ 和 $G \\to X$。\n    - 边 $G \\to S_1$：$A=S_1$。在后支配树中，从 $G$ 到根的路径是 $G \\to X$。从 $S_1$ 到根的路径是 $S_1 \\to C_1 \\to X$。最近公共祖先是 $\\operatorname{lca}(G, S_1) = X$。从 $S_1$ 向上到 $X$（但不包括 $X$）的树路径上的节点是 $\\{S_1, C_1\\}$。\n    - 边 $G \\to X$：$A=X$。$\\operatorname{lca}(G, X) = X$。从 $X$ 到 $X$ 的路径是空的，不产生依赖关系。\n    - 因此，$CD(G) = \\{S_1, C_1\\}$。$CD(G)$ 中的循环体语句集合是 $\\{S_1, S_2, S_3, S_4, S_5, S_6, K, R\\} \\cap \\{S_1, C_1\\} = \\{S_1\\}$。\n    - 计数为 $|CD(G)| = 1$。\n\n2.  对 $C_1$ 的控制依赖：\n    - 谓词是 $P=C_1$。它有两条出边：$C_1 \\to S_2$ 和 $C_1 \\to S_3$。\n    - 边 $C_1 \\to S_2$：$A=S_2$。从 $C_1$ 出发的树路径是 $C_1 \\to X$。从 $S_2$ 出发的树路径是 $S_2 \\to K \\to G \\to X$。$\\operatorname{lca}(C_1, S_2) = X$。从 $S_2$ 向上到 $X$ 的树路径上的节点是 $\\{S_2, K, G\\}$。\n    - 边 $C_1 \\to S_3$：$A=S_3$。从 $C_1$ 出发的树路径是 $C_1 \\to X$。从 $S_3$ 出发的树路径是 $S_3 \\to C_2 \\to X$。$\\operatorname{lca}(C_1, S_3) = X$。从 $S_3$ 向上到 $X$ 的树路径上的节点是 $\\{S_3, C_2\\}$。\n    - 结合这些结果，$CD(C_1) = \\{S_2, K, G\\} \\cup \\{S_3, C_2\\} = \\{S_2, S_3, K, G, C_2\\}$。\n    - $CD(C_1)$ 中的循环体语句集合是 $\\{S_1, \\dots, R\\} \\cap \\{S_2, S_3, K, G, C_2\\} = \\{S_2, S_3, K\\}$。\n    - 计数为 $|CD(C_1)| = 3$。\n\n3.  对 $C_2$ 的控制依赖：\n    - 谓词是 $P=C_2$。它有两条出边：$C_2 \\to S_4$ 和 $C_2 \\to S_5$。\n    - 边 $C_2 \\to S_4$：$A=S_4$。从 $C_2$ 出发的树路径是 $C_2 \\to X$。从 $S_4$ 出发的树路径是 $S_4 \\to R \\to X$。$\\operatorname{lca}(C_2, S_4) = X$。从 $S_4$ 向上到 $X$ 的树路径上的节点是 $\\{S_4, R\\}$。\n    - 边 $C_2 \\to S_5$：$A=S_5$。从 $C_2$ 出发的树路径是 $C_2 \\to X$。从 $S_5$ 出发的树路径是 $S_5 \\to S_6 \\to G \\to X$。$\\operatorname{lca}(C_2, S_5) = X$。从 $S_5$ 向上到 $X$ 的树路径上的节点是 $\\{S_5, S_6, G\\}$。\n    - 结合这些结果，$CD(C_2) = \\{S_4, R\\} \\cup \\{S_5, S_6, G\\} = \\{S_4, S_5, S_6, R, G\\}$。\n    - $CD(C_2)$ 中的循环体语句集合是 $\\{S_1, \\dots, R\\} \\cap \\{S_4, S_5, S_6, R, G\\} = \\{S_4, S_5, S_6, R\\}$。\n    - 计数为 $|CD(C_2)| = 4$。\n\n计数的有序三元组 $(|CD(G)|, |CD(C_1)|, |CD(C_2)|)$ 是 $(1, 3, 4)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  3  4\n\\end{pmatrix}\n}\n$$", "id": "3632566"}]}